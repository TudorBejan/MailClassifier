YUI.add("contacts-api-io",function(F){F.namespace("contacts");var A=F.contacts,D=F.Lang,E=F.JSON;function B(G,H){return function(L,J){var I={};if(!J){return G.failure(I,J,H);}try{I=G.parseJSON(J);}catch(K){return G.failure(I,J,H);}if(I.error||!G.isSuccess(J.status)){return G.failure(I,J,H);}return G.success(I,J,H);};}function C(G){this.io=null;this.maxRetries=2;this.retryCount=0;this.uriGenerator=A.URIGenerator;this.onSuccess=function(){};this.onFailure=function(){};this.hook=G;}C.prototype={parseJSON:function(H){var G={};if(typeof H.body==="string"){G=E.parse(H.body);}else{if(typeof H.body==="object"){G=H.body;}else{if(typeof H.responseText==="string"){G=E.parse(H.responseText);}else{throw new Error("no response body to parse");}}}G.status=H.status;G.statusText=H.statusText;return G;},isSuccess:function(G){switch(G){case 200:case 201:case 202:case 204:return true;}return false;},doRetry:function(G){switch(G){case 500:return true;}return false;},success:function(G,H,I){this.onSuccess(G,H,I);this.retryCount=0;},failure:function(G,H,J){var I=G.error&&G.error.detail&&G.error.detail.match(/-\d+/);if(("-50304"===I||!H||this.doRetry(H.status))&&this.retryCount<this.maxRetries){this.retryCount+=1;return F.later(100,this,function(){this.send(J);});}this.retryCount=0;G.errorCode=(!D.isUndefined(I)&&!D.isNull(I))?I:"-99999";this.onFailure(G,H,J);},send:function(J){var K=B(this,J),I=this,H=this.uriGenerator.getURI(),G={data:E.stringify(this.uriGenerator.getParams()),on:{success:K,failure:K},headers:this.uriGenerator.getHeaders(),method:this.uriGenerator.getMethod(),sync:false};if(this.hook){I.io=this.hook(H,G);}else{F.use("io",function(L){I.io=L.io(H,G);});}},abort:function(){if(this.io&&(typeof this.io.abort==="function")){this.io.abort();return true;}else{return false;}}};A.sendRequest=function(L,K,H,G,J){var I=new C(G,J);K&&(I.onSuccess=K);H&&(I.onFailure=H);L&&(I.uriGenerator=L);I.send();return I;};A.Request=C;},"1.0.0",{requires:["contacts-api-urigenerator","json"]});YUI.add("contacts-api-adapter",function(D){D.namespace("contacts");var E=D.contacts,H=E.URIGenerator,B=E.cache,G=D.Lang,J=D.JSON,F="CONTACTS",I,C,A;if(D.common&&D.common.Utils){I=D.common.Utils;C=I.rocketstats;A=new I.Stopwatch("ContactsRequest");}E.APIAdapter={};(function(){var O=this,K=false,N=E.sendRequest;this.getContact=function(R,Y,U,S){if(B.isLoaded()&&!S){var X=B.getContacts()[R];if(X){if(Y&&G.isFunction(Y)){Y({contact:X});}}return;}var V=E.config.getAttrs(),Z=V.requestFn||null,W={baseHost:V.baseHost||D.config.win.location.host,uri:V.uri,headers:V.headers,guid:V.guid,wssid:V.wssid,type:H.METHODS.GETCONTACTS,start:V.start,count:V.count||"max",sortfields:V.sortfields,out:V.out,sort:V.sort,fields:V.fields,wspath:V.wspath,_sc:false,view:V.view,rev:V.rev,singleContact:true,id:R},P=new H(W);function T(b,a,c){if(Y&&G.isFunction(Y)){Y(b);}if(C){C.stat(F,"API:getContact");C.stat(F,"API:getContact:",b.status);}}function Q(b,a,c){if(C){C.stat(F,"API:ERR:getContact");C.stat(F,"API:ERR:getContact:",b.errorCode);}if(U&&G.isFunction(U)){U(b);}}N(P,T,Q,Z);};this.getContacts=function(S,X,U){if(B.isLoaded()&&!S){if(X&&G.isFunction(X)){X(B.getContacts());}return;}var V=E.config.getAttrs(),Y=V.requestFn||null,P,Q,W={baseHost:V.baseHost||D.config.win.location.host,uri:V.uri,headers:V.headers,guid:V.guid,wssid:V.wssid,type:H.METHODS.GETCONTACTS,start:V.start,count:V.count||"max",sortfields:V.sortfields,out:V.out,sort:V.sort,fields:V.fields,wspath:V.wspath,_sc:(typeof(NeoConfig)!=="undefined"&&NeoConfig.smartcomplete_enabled),view:V.view};function T(b,Z,d){var c=Z.responseHeaders;if(c){var a=c["X-Yahoo-Social-ContactsRev"]||c["X-Yahoo-Social-Contactsrev"]||c["x-yahoo-social-contactsrev"];if(a){B.setCurrentRevision(parseInt(a,10));}}B.load(b);if(X&&G.isFunction(X)){X(B.getContacts());}if(C){C.stat(F,"API:getContacts");C.stat(F,"API:getContacts:",b.status);}K=false;}function R(a,Z,b){K=false;if(C){C.stat(F,"API:ERR:getContacts");C.stat(F,"API:ERR:getContacts:",a.errorCode);}if(U&&G.isFunction(U)){U(a);}}if(K&&X&&G.isFunction(X)){D.once("contacts:api:loaded",function(){X(B.getContacts());});}else{K=true;P=new H(W);N(P,T,R,Y);}};this.createList=function(Z,V,R,X,T){var U=E.config.getAttrs(),Y=U.requestFn||null,W={baseHost:U.baseHost,uri:U.uri,headers:U.headers,guid:U.guid,type:H.METHODS.SAVE,wspath:U.wspath,wssid:U.wssid,rev:B.getCurrentRevision(),newContacts:Z,updateContacts:V,category:R,isCreateList:true},P=new H(W);P.setMethod("PUT");function S(c,b,d){if(C){C.stat(F,"API:createList");C.stat(F,"API:createList:",c.status);}var a=B.update(c);if(X&&G.isFunction(X)){X(a,c);}}function Q(b,a,c){if(C){C.stat(F,"API:ERR:createList");C.stat(F,"API:ERR:createList:",b.errorCode);}if(T&&G.isFunction(T)){T(b);}}N(P,S,Q,Y);};this.deleteContacts=function(Z,X,U){var V=E.config.getAttrs(),Y=V.requestFn||null,S=[],Q=(Z&&G.isArray(Z))?Z.length:0,W={baseHost:V.baseHost,guid:V.guid,type:H.METHODS.DELETE,wspath:V.wspath,uri:V.uri,headers:V.headers,rev:B.getCurrentRevision(),wssid:V.wssid},P;while(Q--){S.push({id:Z[Q],op:"remove"});}W.contacts=S;P=new H(W);function R(a){if(C){C.stat(F,"API:ERR:contactsDelete");C.stat(F,"API:ERR:contactsDelete:",a.errorCode);}if(U&&G.isFunction(U)){U(a);}}function T(d,b,g){if(d.status===202){var f=d.syncresult.results,c=f.contacts,e=c.length;while(e--){if(c[e].error){d.errorCode=c[e].error;R(false,d);return;}}}if(C){C.stat(F,"API:contactsDelete");C.stat(F,"API:contactsDelete:",d.status);}var a=B.update(d);if(X&&G.isFunction(X)){X(a,d);}}N(P,T,R,Y);};function M(Y,T,W,Z,V,S){var X=T.requestFn||null,P,U={baseHost:T.baseHost,uri:T.uri,headers:T.headers,guid:T.guid,type:H.METHODS.SAVE,wspath:T.wspath,wssid:T.wssid};function R(c,b,d){W.push(c.contact);if(C){C.stat(F,"API:multiTransactionSave");C.stat(F,"API:multiTransactionSave:",c.status);}if(Y.length===0){var a=B.update(W);if(V&&G.isFunction(V)){V(a);}}else{M(Y,T,W,Z,V,S);}}function Q(a,b){if(C){C.stat(F,"API:ERR:multiTransactionSave");C.stat(F,"API:ERR:multiTransactionSave:",a.errorCode);}if(Y.length===0&&W.length>0){B.update(W);}else{if(Y.length>0){M(Y,T,W,Z,V,S);return;}}if(S&&G.isFunction(S)){S(a);}}if(Z){U.contacts=Z;}else{U.contacts=[Y.shift()];}P=new H(U);N(P,R,Q,X,{contact:U.contacts});}function L(X,T,V,R){var W=T.requestFn||null,P,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE,wspath:T.wspath,uri:T.uri,headers:T.headers,rev:B.getCurrentRevision(),wssid:T.wssid};function S(a,Z,b){if(C){C.stat(F,"API:singleTransactionSave");C.stat(F,"API:singleTransactionSave:",a.status);}var Y=B.update(a);if(V&&G.isFunction(V)){V(Y,a);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:singleTransactionSave");C.stat(F,"API:ERR:singleTransactionSave:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}if(!G.isArray(X)){X=[X];}U.contacts=X;P=new H(U);N(P,S,Q,W);}this.saveContacts=function(S,T,R){var Q=E.config.getAttrs(),P=B.getCurrentRevision();if(P>0||!G.isArray(S)||S.length===1){L(S,Q,T,R);}else{M(S,Q,[],T,R);}};this.getContactsTinyUserCard=function(W,V,R){var T=E.config.getAttrs(),X=T.requestFn||null,U={baseHost:T.baseHost||D.config.win.location.host,uri:T.uri,headers:T.headers,guid:T.guid,wssid:T.wssid,type:H.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:W}],wspath:T.wspath,view:"tinyusercard"},P=new H(U);function S(a,Z,b){if(C){C.stat(F,"API:getUserCard");C.stat(F,"API:getUserCard:",a.status);}var Y=B.loadTinyUserCard(a)[0];if(V&&G.isFunction(V)){V(Y);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERRgetUserCard");C.stat(F,"API:ERRgetUserCard:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.saveCategory=function(R,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.SAVE_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:[R],wssid:U.wssid},P=new H(V);function T(Z,Y,d){var a=Z.syncresult.results;if(Z.status===202){var b=a.categories;if(b[0].error){Z.errorCode=b[0].error;Q(false,Z);return;}}var c=Z.syncresult.diff;if(C){C.stat(F,"API:saveCategories");
C.stat(F,"API:saveCategories:",Z.status);}B.updateCategories(Z);if(W&&G.isFunction(W)){W(c,Z);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:saveCategory");C.stat(F,"API:ERR:saveCategory:",Z.errorCode);}if(S&&G.isFunction(S)){S(Z);}}N(P,T,Q,X);};this.deleteCategory=function(R,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.DELETE_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:[{id:R,op:"remove"}],wssid:U.wssid},P=new H(V);function T(Z,Y,c){var a=Z.syncresult.results;if(Z.status===202){var b=a.categories;if(b[0].error){Z.errorCode=b[0].error;Q(false,Z);return;}}if(C){C.stat(F,"API:deleteCategories");C.stat(F,"API:deleteCategories:",Z.status);}B.updateCategories(Z);if(W&&G.isFunction(W)){W(Z.syncresult.diff,Z);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:deleteCategory");C.stat(F,"API:ERR:deleteCategory:",Z.errorCode);}if(S&&G.isFunction(S)){S(Z);}}N(P,T,Q,X);};this.updateContactsCategories=function(Z,T,Y,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:{addTo:T,removeFrom:Y},contacts:Z,wssid:U.wssid},P=new H(V);function R(b,a,e){var c=b.syncresult.results;if(b.status===202){var d=c.categories;if(d[0].error){b.errorCode=d[0].error;Q(false,b);return;}}if(C){C.stat(F,"API:updateContactsCategories");C.stat(F,"API:updateContactsCategories:",b.status);}B.updateCategories(b);if(W&&G.isFunction(W)){W(b.syncresult.diff,b);}}function Q(a,c,b,d){if(C){C.stat(F,"API:ERR:updateContactsCategories");C.stat(F,"API:ERR:updateContactsCategories:",c.errorCode);}if(S&&G.isFunction(S)){S(c);}}N(P,R,Q,X);};this.removeField=function(U,W,X,S){var T=E.config.getAttrs(),Y=T.requestFn||null,V={rev:B.getCurrentRevision(),contactId:U,fieldId:W,baseHost:T.baseHost,guid:T.guid,type:H.METHODS.REMOVE_FIELD,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid},P=new H(V);function R(a,Z,b){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",a.status);}B.updateCategories(a);if(X&&G.isFunction(X)){X(a.syncresult.diff,a);}}function Q(Z,b,a,c){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",b.errorCode);}if(S&&G.isFunction(S)){S(b);}}N(P,R,Q,Y);};this.setSortField=function(U,W,R){var T=E.config.getAttrs(),X=T.requestFn||null,V={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE_PREFS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,prefs:{sort_field:U}},P=new H(V);function S(a,Y,b){var Z=a.preferences;if(Z){B.setSortPrefs(Z.sort_order,Z.sort_type);if(W&&G.isFunction(W)){W();}if(C){C.stat(F,"API:setSortField");C.stat(F,"API:setSortField:",a.status);}}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:setSortField");C.stat(F,"API:ERR:setSortField:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.setSortOrder=function(U,W,R){var T=E.config.getAttrs(),X=T.requestFn||null,V={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE_PREFS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,prefs:{sort_order:U}},P=new H(V);function S(a,Y,b){var Z=a.preferences;if(Z){B.setSortPrefs(Z.sort_order,Z.sort_type);if(W&&G.isFunction(W)){W();}if(C){C.stat(F,"API:setSortOrder");C.stat(F,"API:setSortOrder:",a.status);}}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:setSortOrder");C.stat(F,"API:ERR:setSortOrder:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.getSortPrefs=function(V,S){if(B.getSortPrefs()){if(V&&G.isFunction(V)){V(B.getSortPrefs());}return;}var R=E.config.getAttrs(),Q=R.requestFn||null,W={baseHost:R.baseHost||D.config.win.location.host,uri:R.uri,headers:R.headers,guid:R.guid,wssid:R.wssid,type:H.METHODS.DEFAULT,wspath:R.wspath,prefs:true},T=new H(W);function P(Z,X,a){var Y=Z.preferences;if(Y){if(Y.sort_order&&Y.sort_type){B.setSortPrefs(Y.sort_order,Y.sort_type);if(V&&G.isFunction(V)){V();}if(C){C.stat(F,"API:getSortPreferences");C.stat(F,"API:getSortPreferences:",Z.status);}}}}function U(Y,X,Z){if(C){C.stat(F,"API:ERR:getSortPreferences");C.stat(F,"API:ERR:getSortPreferences:",Y.errorCode);}if(S&&G.isFunction(S)){S(Y);}}N(T,P,U,Q);};this.removeField=function(U,W,X,S){var T=E.config.getAttrs(),Y=T.requestFn||null,V={rev:B.getCurrentRevision(),contactId:U,fieldId:W,baseHost:T.baseHost,guid:T.guid,type:H.METHODS.REMOVE_FIELD,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid},P=new H(V);function R(a,Z,b){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",a.status);}B.updateCategories(a);if(X&&G.isFunction(X)){X(a.syncresult.diff,a);}}function Q(Z,b,a,c){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",b.errorCode);}if(S&&G.isFunction(S)){S(b);}}N(P,R,Q,Y);};this.searchContacts=function(X,V,R){var T=E.config.getAttrs(),W=T.requestFn||null,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.GETCONTACTS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,out:T.out,fields:T.fields,search:T.search,searchField:"all",searchCondition:"contains",searchQuery:X},P=new H(U);function S(Z,Y,b){var a=Z.contacts.contact||[];if(V&&G.isFunction(V)){V(a);}if(C){C.stat(F,"API:searchContacts");C.stat(F,"API:searchContacts:",Z.status);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:searchContacts");C.stat(F,"API:ERR:searchContacts:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,W);};this.createEmptyContact=function(){return{fields:[],categories:[]};};}.apply(E.APIAdapter));},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils","rocket-stats"]});YUI.add("contacts-api",function(E){E.namespace("contacts");var B=E.contacts,D=B.APIAdapter,C=B.cache,A=function(){var F=this;this.load=function(H,I,G){D.getContacts(H,I,G);};this.saveContacts=function(H,I,G){D.saveContacts(H,I,G);};this.deleteContacts=function(H,I,G){D.deleteContacts(H,I,G);};this.saveCategory=function(G,I,H){D.saveCategory(G,I,H);};this.deleteCategory=function(G,I,H){D.deleteCategory(G,I,H);};this.createList=function(G,I,J,K,H){D.createList(G,I,J,K,H);};this.getContacts=function(H,I,G){if(typeof(H)!=="boolean"){return;}D.getContacts(H,I,G);};this.getContact=function(J,I,G,H){D.getContact(J,I,G,H);};this.createEmptyContact=function(H,G){return D.createEmptyContact(H,G);};this.getContactImage=function(G,I,H){D.getContactsTinyUserCard(G,I,H);};this.searchContacts=function(H,I,G){D.searchContacts(H,I,G);};E.on("contacts:contactChanged",function(){F.load(1);});this.setSortOrder=function(G,I,H){D.setSortOrder(G,I,H);};this.setSortField=function(H,I,G){D.setSortField(H,I,G);};this.getSortPrefs=function(H,G){D.getSortPrefs(H,G);};this.updateContactsCategories=function(J,H,G,K,I){D.updateContactsCategories(J,H,G,K,I);};this.removeEmail=function(I,G,J,H){D.removeField(I,G,J,H);};this.removeEmail=function(J,I,H){C.removeField(J,I);var G=E.contacts.utils.getContactById(J);if(G&&!G.isSmartContact){D.removeField(J,I);}if(H){H();}};};B.api=new A();},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});