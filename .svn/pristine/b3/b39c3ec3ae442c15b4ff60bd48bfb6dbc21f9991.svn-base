YUI.add("keyhandler",function(A){var I=YUI.namespace("Messenger"),J=YUI.Messenger.Events;if(!I.KeyHandler){var E=false;function B(K){openmail.Mail.sendKeyEvent(K);}function H(K){if(K.halt){K.halt();}else{if(K.stopPropagation){K.stopPropagation();K.preventDefault();}else{K.returnCode=false;K.cancelBubble=true;}}}function C(K){switch(A.UA.os){case"macintosh":if(A.UA.gecko>0){if(K.altKey&&(K.keyCode==37||K.keyCode==39)){return;}}else{if((K.ctrlKey||K.metaKey||K.altKey)&&(K.keyCode==37||K.keyCode==39)){return;}}break;case"windows":if(K.ctrlKey&&(K.keyCode==37||K.keyCode==39)){return;}break;}if((K.ctrlKey||K.metaKey||K.altKey)&&(K.keyCode==219||K.keyCode==221||K.keyCode==37||K.keyCode==39)){H(K);}}function F(){E=false;}function D(){E=true;}function G(O){var M,P,N,L=true,K={BACKBUTTON:8,I:73,T:84};if(E){return;}M=O.target;P=M.tagName||M.get("tagName");N=(P=="INPUT")?M.type||M.get("type"):"";if(P=="TEXTAREA"||P=="IFRAME"||(P=="INPUT"&&(N=="text"||N=="passwd"))){return true;}if(O.ctrlKey||O.metaKey||O.altKey||O.shiftKey){if(O.shiftKey||!((O.ctrlKey||O.metaKey)&&(O.keyCode==65||O.keyCode==67||O.keyCode==86))){B(O);}C(O);}else{switch(O.keyCode){case K.BACKBUTTON:L=false;H(O);break;case K.I:L=false;A.Global.fire(J.OPEN_CONV_PICKER);H(O);break;case K.T:L=false;if(A.Messenger.GlobalConfig.get("smsEnabled")){A.Global.fire(J.OPEN_SMS_CONV_PICKER);}H(O);break;}if(L){B(O);}}}I.KeyHandler={handleKeyEvent:G,disable:D,enable:F,blockNavigationKeys:C};}A.namespace("Messenger").KeyHandler=I.KeyHandler;},"@VERSION@",{requires:["event"]});YUI.add("basewindow",function(C){var H=C.Node,A=C.Messenger.Intl,L=C.Messenger.Events,G=C.Messenger.SessionManager,E=C.Messenger.GlobalConfig,B=C.Messenger.WindowManager,I,F,K=window.launchData,J=C.Messenger.CommonUtils,D=YUI.namespace("Messenger.Metrics");function M(N){M.superclass.constructor.apply(this,arguments);}M.NAME="yimapp-basewindow";M.ATTRS={windowName:{value:""},templateName:{},bringToFrontOnFocus:{value:true},makePrimaryOnClick:{value:true},disableRightClick:{value:true},hideOnLogout:{value:true},autosize:{value:false},visible:{value:true},disabled:{value:false},waiting:{value:false},minimized:{value:false},replacementParms:{value:null},isDialog:{value:false},focusNode:{},newBrowserWindow:{value:false},bodyClass:{value:null}};C.extend(M,C.Base,{initializer:function(){this._evtListeners=[];this.set("windowName",C.config.win.windowName);this._evtListeners.push(E.on("themeInfoChange",C.bind(this.onWindowThemeChange,this)));this._evtListeners.push(C.Global.on(L.MPOP_STATE_CHANGE,this.onMpopStateChange,this));this._evtListeners.push(C.Global.on(L.CONNECTION_UPDATE,this.onConnectionUpdated,this));this._evtListeners.push(C.Global.on(L.WINDOW_FOCUS_CHANGE,function(Q,R){var P=this.get("windowName"),O=B.getWindow(P);if(R&&Q===P&&this.get("bringToFrontOnFocus")){O.bringToFront();}},this));F=C.config.win;I=F.document;var N=this.get("bodyClass");if(N){I.body.className+=" "+N;}},destructor:function(){C.each(this._evtListeners,function(N){N.detach();});this._firstFocusableElement=null;this._lastFocusableElement=null;},render:function(O,S){var X=C.Messenger.Templates,W=this.get("templateName")||this.get("windowName").toLowerCase(),T=X[W]&&X[W].baseTemplate?X[W].baseTemplate:null;if(this._rendered){return;}this._rendered=true;if(T){var Q=this.get("replacementParms")||{},R;Q.str_cfg_branding_messenger=E.getGenericAppName();Q.str_cfg_branding=E.getAppName();R=C.Node.create(J.substitute(T,Q));O.append(R);}var P=C.one("#closeButton");if(P){P.setAttribute("title",A.get("str_close"));P.setAttribute("aria-label",A.get("str_close"));P.setAttribute("role","button");}var N=C.one("#popOutButton");if(N){N.setAttribute("title",A.get("str_window_btn_popout"));N.setAttribute("aria-label",A.get("str_window_btn_popout"));N.setAttribute("role","button");}var U=C.one("#popInButton");if(U){var V=J.substitute(A.get("str_window_btn_popin"),{str_cfg_branding_messenger:E.getGenericAppName()});U.setAttribute("title",V);U.setAttribute("aria-label",V);U.setAttribute("role","button");}this.initializeWindow(R,S);},initializeWindow:function(R,N){var O=this.get("windowName"),Q=B.getWindow(O),P=C.one(I.body);if(Q.get("windowType")=="browserWindow"){this.set("newBrowserWindow",true);}this._evtListeners.push(C.on("focus",function(S){C.Global.fire(L.WINDOW_FOCUSED,O);},C.config.win,this));this._evtListeners.push(C.on("blur",function(S){C.Global.fire(L.WINDOW_BLURRED,O);},C.config.win,this));this._evtListeners.push(C.on("click",function(S){if(S.shiftKey&&(S.ctrlKey||S.metaKey)){if(K){var U={"AppVersion":K.phonehomeData.ver_curr,"themeData":K.themeinfo,"supportedLang":K.langSupported,"smsSupported":K.smsSupported},T={};T.config=U;T.startupLog=K.startupLog;T.perfLog=K.rollingLog;B.alert("<textarea rows=15 cols=70>"+C.JSON.stringify(T)+"</textarea>",null,"Yahoo! Messenger Config",null);}S.halt();}},C.config.doc,this));if(window.openmail){if(C.UA.ie>0){this._evtListeners.push(C.one("body").on("keydown",function(S){C.Messenger.KeyHandler.handleKeyEvent(S);}));}else{this._evtListeners.push(C.on("keydown",function(S){C.Messenger.KeyHandler.handleKeyEvent(S);}));}}if(this.get("disableRightClick")){P.on("contextmenu",C.bind(this._disableRightClick,this));}this._evtListeners.push(C.on("mousedown",this.onMouseDown,C.config.doc,this));if(C.UA.ie>0){P.addClass("IE");if(C.UA.ie==7&&navigator.userAgent.indexOf("Trident/")>0){P.addClass("IE8");P.addClass("IE8Compat");}else{P.addClass("IE"+C.UA.ie);}}else{if(C.UA.gecko>0){P.addClass("FF");}else{if(C.UA.webkit>0){P.addClass("Webkit");}}}if(A.isCJK()){P.addClass("CJK");}if(A.isRTL()){P.addClass("RTL");}if(K){P.addClass(K.intl);}if(K&&K.cobrand&&K.cobrand!=="null"){P.addClass(K.cobrand);}P.addClass("ymessenger");this.set("minimized",Q.get("minimized"));this.set("visible",Q.get("visible"));this.onInit(R,N);if(this.get("isDialog")){this._evtListeners.push(C.on("keydown",function(S){if(S.keyCode==27){B.getWindow(this.get("windowName")).hide();S.halt();}},C.config.doc,this));this._findFocusableElements();if(this._firstFocusableElement&&this._lastFocusableElement){this._evtListeners.push(this._firstFocusableElement.on("keydown",function(S){if(S.keyCode===9&&S.shiftKey){this._lastFocusableElement.focus();S.halt();}},this));this._evtListeners.push(this._lastFocusableElement.on("keydown",function(S){if(S.keyCode===9&&!S.shiftKey){this._firstFocusableElement.focus();S.halt();}},this));}}if(this.get("visible")){this.onShow(N);if(!this.get("minimized")){C.later(0,this,this.focus);}}if(this.get("minimized")){this.onMinimize();this.setMinimizeButtonLabel(true);}else{this.onRestore();this.setMinimizeButtonLabel(false);}if(this.get("autosize")){C.Global.fire(L.SYNC_WINDOW_SIZE,O);}},onWindowThemeChange:function(O){var N=O.prevVal.css,P=O.newVal.css,Q;if(N===P){return;}this.getOuiWindow().loadFiles([P],"css",function(){Q=C.one("head").all("link");C.some(Q,function(R){if(R.getAttribute("href")==N){R.remove();return true;}return false;});},F);},onConnectionUpdated:function(N){if(this.get("visible")&&this.get("hideOnLogout")&&!N.isOnline){B.getWindow(this.get("windowName")).hide();}},onWindowHide:function(){if(this.get("visible")){this.set("visible",false);this.onHide();}},onWindowShow:function(N){if(!this.get("visible")){this.set("visible",true);if(this.get("autosize")){C.Global.fire(L.SYNC_WINDOW_SIZE,this.get("windowName"));}if(this.getOuiWindow().get("windowType")=="iframe"&&!this.get("minimized")&&E.get("mpopEndPointState")=="primary"){C.later(0,this,this.focus);}}this.onShow(N);},onWindowMinimized:function(N){if(!this.get("minimized")){this.set("minimized",true);
this.onMinimize(N);this.setMinimizeButtonLabel(true);}},onWindowRestored:function(){if(this.get("minimized")){this.set("minimized",false);this.onRestore();this.setMinimizeButtonLabel(false);}},onWindowDisabled:function(){this.set("disabled",true);this.blur();},onWindowEnabled:function(){this.set("disabled",false);},onStartWaiting:function(){this.set("waiting",true);},onStopWaiting:function(){this.set("waiting",false);},focus:function(){var P=this.get("focusNode"),N;if(!P){return;}if(P._node){P=P._node;}else{if(typeof(P)=="string"){P=C.one(P);if(P&&P._node){P=P._node;this.set("focusNode",P);}}}N=P.ownerDocument;if(N.activeElement==P&&P.blur){P.blur();}if(!this._focusAttempts){this._focusAttempts=0;}if(this.get("visible")&&P.focus){try{if(C.UA.gecko){C.config.win.focus();}P.focus();}catch(O){}if(N.activeElement!=P){if(this._focusAttempts<10){C.later(100,this,this.focus);this._focusAttempts++;return;}else{}}this._focusAttempts=0;}},blur:function(){},closeOnDormant:function(){B.getWindow(this.get("windowName")).hide();},onMpopStateChange:function(N){if(!G.isPrimary()){this.closeOnDormant();}},getOuiWindow:function(){return B.getWindow(this.get("windowName"));},getDOMWindow:function(){return B.getWindow(this.get("windowName")).getDOMWindow();},setWindowTitle:function(N){B.getWindow(this.get("windowName")).set("title",N);},setMinimizeButtonLabel:function(P){var O,N=C.one("#minMaxButton");if(N){if(P){O=A.get("str_window_btn_restore")||"Restore";}else{O=A.get("str_window_btn_minimize")||"Minimize";}N.setAttribute("title",O);N.setAttribute("aria-label",O);N.setAttribute("role","button");}},_findFocusableElements:function(){var N=C.one("#titleBar"),S=C.one(".dialog-buttons"),Q,R,P,O;if(N){R=N.all("a");for(O=0;O<R.size();O++){P=R.item(O);if(P.getComputedStyle("visibility")=="visible"&&P.getComputedStyle("display")!="none"&&P.get("offsetHeight")>0){this._firstFocusableElement=P;break;}}}if(S){R=S.all("a");for(O=(R.size()-1);O>-1;O--){P=R.item(O);if(P.getComputedStyle("visibility")=="visible"&&P.getComputedStyle("display")!="none"&&P.get("offsetHeight")>0){this._lastFocusableElement=P;break;}}}if(!this._firstFocusableElement||!this._lastFocusableElement){Q=C.one("#iowaWindow-content");R=Q.all("input");if(!this._firstFocusableElement){for(O=0;O<R.size();O++){P=R.item(O);if(P.getComputedStyle("visibility")=="visible"&&P.getComputedStyle("display")!="none"&&P.get("offsetHeight")>0){this._firstFocusableElement=P;break;}}}if(!this._lastFocusableElement){for(O=(R.size()-1);O>-1;O--){P=R.item(O);if(P.getComputedStyle("visibility")=="visible"&&P.getComputedStyle("display")!="none"&&P.get("offsetHeight")>0){this._lastFocusableElement=P;break;}}}}},_disableRightClick:function(O){if(O.target){var Q=O.target.get("tagName"),N,P,S=C.config.win;if(S.getSelection){N=S.getSelection();P=N&&!N.isCollapsed;}else{if(S.document.getSelection){N=S.document.getSelection();P=N&&!N.isCollapsed;}else{if(S.document.selection){N=S.document.selection.createRange().text;P=N&&N!=="";}}}if(P){return;}switch(Q){case"TEXTAREA":case"IFRAME":case"INPUT":break;case"A":var R=O.target.getAttribute("href");if(!R||R==""||R=="#"||R.indexOf("javascript:")==0){O.halt();}break;default:O.halt();}}},onInit:function(O,N){},onMinimize:function(N){},onMouseDown:function(N){C.Messenger.WindowManager.hideWindow("ContactMenuWindow");if(this.get("makePrimaryOnClick")){C.Messenger.SessionManager.becomePrimary();}},onRestore:function(){},onShow:function(N){},onHide:function(){},onClose:function(){},onResize:function(){},onBeforeClose:function(){return false;}});C.namespace("Messenger").BaseWindow=M;},"@VERSION@",{skinnable:true,requires:["base","node","event","windowmanager","commonutils","keyhandler"]});YUI.add('lang/contactlist_en-US', function(Y){Y.namespace('Messenger.Templates').contactlist={topContactsButton: "<div id=\"tc_toggle\" class=\"{{tc_class}} hidden\"><a class=\"toTc\" title=\"Most frequent instant message contacts\">Show Top Contacts</a><a class=\"toRegular\" title=\"All online contacts\">Show Online Contacts</a></div>"};}, '@VERSION@' ,{requires:[]});YUI.add('lang/contactgroup_en-US', function(Y){Y.namespace('Messenger.Templates').contactgroup={buttonTemplate: "<span class=\"btn small left right {{btn_class}}\" title=\"{{btn_title}}\"><input id=\"{{btn_id}}\" class=\"{{css_class}}\" type=\"button\" value=\"{{input_value}}\" data-action=\"contact-new\"/></span>", baseTemplate: "<div class=\"items items-nav items-nav-msgr-contacts {{isCollapsed}} {{isExpanded}}\" data-action=\"collapsable\"><h2 role=\"toolbar\" id=\"{{id}}\" aria-label=\"{{title}}\" class=\"legend\"><span role=\"button\" tabindex=\"0\" aria-controls=\"{{list_id}}\" aria-expanded=\"{{aria_expanded}}\" class=\"label\" title=\"{{title_attr}}\">{{count}} {{title}}</span><span class=\"rht\">{{buttons}}</span></h2><ul id={{list_id}} role=\"listbox\" class=\"{{imageSize}}\">       {{contacts}}    </ul><span class=\"emptyGrpMsg hidden\"></span></div>"};}, '@VERSION@' ,{requires:[]});YUI.add('lang/contact_en-US', function(Y){Y.namespace('Messenger.Templates').contact={contactTemplate: "<li role=\"presentation\" id=\"{{contact_id}}\" class=\"ymsg-{{isMobile_else}}{{isMobile}} {{stealth_mode}} btn-contact {{isSelected}} {{fbclass}}\" data-user=\"{{user}}\" data-network=\"{{network}}\" data-action=\"contact-list\" title=\"{{yid_attr}}\">{{global_spearmint_view}} <div class=\"fb_img_logo {{isFB}}\"></div>    {{avatar}}<a role=\"option\" {{tab_index}} aria-describedby=\"{{vitality_id}}\" href=\"{{url}}\" title=\"{{yid_attr}}\" {{nameBIDIDirection}}>{{name}}<em>{{yid}}</em></a><span id=\"{{vitality_id}}\" class=\"vitality\" title=\"{{messageTitle}}\" {{messageBIDIDirection}}>{{message}}</span>{{score}}</li>"};}, '@VERSION@' ,{requires:[]});/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-base",function(e,t){var n="running",r="startTime",i="elapsedTime",s="start",o="tween",u="end",a="node",f="paused",l="reverse",c="iterationCount",h=Number,p={},d;e.Anim=function(){e.Anim.superclass.constructor.apply(this,arguments),e.Anim._instances[e.stamp(this)]=this},e.Anim.NAME="anim",e.Anim._instances={},e.Anim.RE_DEFAULT_UNIT=/^width|height|top|right|bottom|left|margin.*|padding.*|border.*$/i,e.Anim.DEFAULT_UNIT="px",e.Anim.DEFAULT_EASING=function(e,t,n,r){return n*e/r+t},e.Anim._intervalTime=20,e.Anim.behaviors={left:{get:function(e,t){return e._getOffset(t)}}},e.Anim.behaviors.top=e.Anim.behaviors.left,e.Anim.DEFAULT_SETTER=function(t,n,r,i,s,o,u,a){var f=t._node,l=f._node,c=u(s,h(r),h(i)-h(r),o);l?"style"in l&&(n in l.style||n in e.DOM.CUSTOM_STYLES)?(a=a||"",f.setStyle(n,c+a)):"attributes"in l&&n in l.attributes?f.setAttribute(n,c):n in l&&(l[n]=c):f.set?f.set(n,c):n in f&&(f[n]=c)},e.Anim.DEFAULT_GETTER=function(t,n){var r=t._node,i=r._node,s="";return i?"style"in i&&(n in i.style||n in e.DOM.CUSTOM_STYLES)?s=r.getComputedStyle(n):"attributes"in i&&n in i.attributes?s=r.getAttribute(n):n in i&&(s=i[n]):r.get?s=r.get(n):n in r&&(s=r[n]),s},e.Anim.ATTRS={node:{setter:function(t){return t&&(typeof t=="string"||t.nodeType)&&(t=e.one(t)),this._node=t,!t,t}},duration:{value:1},easing:{value:e.Anim.DEFAULT_EASING,setter:function(t){if(typeof t=="string"&&e.Easing)return e.Easing[t]}},from:{},to:{},startTime:{value:0,readOnly:!0},elapsedTime:{value:0,readOnly:!0},running:{getter:function(){return!!p[e.stamp(this)]},value:!1,readOnly:!0},iterations:{value:1},iterationCount:{value:0,readOnly:!0},direction:{value:"normal"},paused:{readOnly:!0,value:!1},reverse:{value:!1}},e.Anim.run=function(){var t=e.Anim._instances;for(var n in t)t[n].run&&t[n].run()},e.Anim.pause=function(){for(var t in p)p[t].pause&&p[t].pause();e.Anim._stopTimer()},e.Anim.stop=function(){for(var t in p)p[t].stop&&p[t].stop();e.Anim._stopTimer()},e.Anim._startTimer=function(){d||(d=setInterval(e.Anim._runFrame,e.Anim._intervalTime))},e.Anim._stopTimer=function(){clearInterval(d),d=0},e.Anim._runFrame=function(){var t=!0;for(var n in p)p[n]._runFrame&&(t=!1,p[n]._runFrame());t&&e.Anim._stopTimer()},e.Anim.RE_UNITS=/^(-?\d*\.?\d*){1}(em|ex|px|in|cm|mm|pt|pc|%)*$/;var v={run:function(){return this.get(f)?this._resume():this.get(n)||this._start(),this},pause:function(){return this.get(n)&&this._pause(),this},stop:function(e){return(this.get(n)||this.get(f))&&this._end(e),this},_added:!1,_start:function(){this._set(r,new Date-this.get(i)),this._actualFrames=0,this.get(f)||this._initAnimAttr(),p[e.stamp(this)]=this,e.Anim._startTimer(),this.fire(s)},_pause:function(){this._set(r,null),this._set(f,!0),delete p[e.stamp(this)],this.fire("pause")},_resume:function(){this._set(f,!1),p[e.stamp(this)]=this,this._set(r,new Date-this.get(i)),e.Anim._startTimer(),this.fire("resume")},_end:function(t){var n=this.get("duration")*1e3;t&&this._runAttrs(n,n,this.get(l)),this._set(r,null),this._set(i,0),this._set(f,!1),delete p[e.stamp(this)],this.fire(u,{elapsed:this.get(i)})},_runFrame:function(){var e=this._runtimeAttr.duration,t=new Date-this.get(r),n=this.get(l),s=t>=e,u,a;this._runAttrs(t,e,n),this._actualFrames+=1,this._set(i,t),this.fire(o),s&&this._lastFrame()},_runAttrs:function(t,n,r){var i=this._runtimeAttr,s=e.Anim.behaviors,o=i.easing,u=n,a=!1,f,l,c;t>=n&&(a=!0),r&&(t=n-t,u=0);for(c in i)i[c].to&&(f=i[c],l=c in s&&"set"in s[c]?s[c].set:e.Anim.DEFAULT_SETTER,a?l(this,c,f.from,f.to,u,n,o,f.unit):l(this,c,f.from,f.to,t,n,o,f.unit))},_lastFrame:function(){var e=this.get("iterations"),t=this.get(c);t+=1,e==="infinite"||t<e?(this.get("direction")==="alternate"&&this.set(l,!this.get(l)),this.fire("iteration")):(t=0,this._end()),this._set(r,new Date),this._set(c,t)},_initAnimAttr:function(){var t=this.get("from")||{},n=this.get("to")||{},r={duration:this.get("duration")*1e3,easing:this.get("easing")},i=e.Anim.behaviors,s=this.get(a),o,u,f;e.each(n,function(n,a){typeof n=="function"&&(n=n.call(this,s)),u=t[a],u===undefined?u=a in i&&"get"in i[a]?i[a].get(this,a):e.Anim.DEFAULT_GETTER(this,a):typeof u=="function"&&(u=u.call(this,s));var l=e.Anim.RE_UNITS.exec(u),c=e.Anim.RE_UNITS.exec(n);u=l?l[1]:u,f=c?c[1]:n,o=c?c[2]:l?l[2]:"",!o&&e.Anim.RE_DEFAULT_UNIT.test(a)&&(o=e.Anim.DEFAULT_UNIT);if(!u||!f){e.error('invalid "from" or "to" for "'+a+'"',"Anim");return}r[a]={from:e.Lang.isObject(u)?e.clone(u):u,to:f,unit:o}},this),this._runtimeAttr=r},_getOffset:function(e){var t=this._node,n=t.getComputedStyle(e),r=e==="left"?"getX":"getY",i=e==="left"?"setX":"setY";if(n==="auto"){var s=t.getStyle("position");s==="absolute"||s==="fixed"?(n=t[r](),t[i](n)):n=0}return n},destructor:function(){delete e.Anim._instances[e.stamp(this)]}};e.extend(e.Anim,e.Base,v)},"3.7.2",{requires:["base-base","node-style"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-color",function(e,t){var n=Number;e.Anim.getUpdatedColorValue=function(t,r,i,s,o){return t=e.Color.re_RGB.exec(e.Color.toRGB(t)),r=e.Color.re_RGB.exec(e.Color.toRGB(r)),(!t||t.length<3||!r||r.length<3)&&e.error("invalid from or to passed to color behavior"),"rgb("+[Math.floor(o(i,n(t[1]),n(r[1])-n(t[1]),s)),Math.floor(o(i,n(t[2]),n(r[2])-n(t[2]),s)),Math.floor(o(i,n(t[3]),n(r[3])-n(t[3]),s))].join(", ")+")"},e.Anim.behaviors.color={set:function(t,n,r,i,s,o,u){t._node.setStyle(n,e.Anim.getUpdatedColorValue(r,i,s,o,u))},get:function(e,t){var n=e._node.getComputedStyle(t);return n=n==="transparent"?"rgb(255, 255, 255)":n,n}},e.each(["backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],function(t,n){e.Anim.behaviors[t]=e.Anim.behaviors.color})},"3.7.2",{requires:["anim-base"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-xy",function(e,t){var n=Number;e.Anim.behaviors.xy={set:function(e,t,r,i,s,o,u){e._node.setXY([u(s,n(r[0]),n(i[0])-n(r[0]),o),u(s,n(r[1]),n(i[1])-n(r[1]),o)])},get:function(e){return e._node.getXY()}}},"3.7.2",{requires:["anim-base","node-screen"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-curve",function(e,t){e.Anim.behaviors.curve={set:function(t,n,r,i,s,o,u){r=r.slice.call(r),i=i.slice.call(i);var a=u(s,0,100,o)/100;i.unshift(r),t._node.setXY(e.Anim.getBezier(i,a))},get:function(e,t){return e._node.getXY()}},e.Anim.getBezier=function(e,t){var n=e.length,r=[];for(var i=0;i<n;++i)r[i]=[e[i][0],e[i][1]];for(var s=1;s<n;++s)for(i=0;i<n-s;++i)r[i][0]=(1-t)*r[i][0]+t*r[parseInt(i+1,10)][0],r[i][1]=(1-t)*r[i][1]+t*r[parseInt(i+1,10)][1];return[r[0][0],r[0][1]]}},"3.7.2",{requires:["anim-xy"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-easing",function(e,t){var n={easeNone:function(e,t,n,r){return n*e/r+t},easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeBoth:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInStrong:function(e,t,n,r){return n*(e/=r)*e*e*e+t},easeOutStrong:function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t},easeBothStrong:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r)===1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t)},elasticOut:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r)===1?t+n:(s||(s=r*.3),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t)},elasticBoth:function(e,t,n,r,i,s){var o;return e===0?t:(e/=r/2)===2?t+n:(s||(s=r*.3*1.5),!i||i<Math.abs(n)?(i=n,o=s/4):o=s/(2*Math.PI)*Math.asin(n/i),e<1?-0.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t)},backIn:function(e,t,n,r,i){return i===undefined&&(i=1.70158),e===r&&(e-=.001),n*(e/=r)*e*((i+1)*e-i)+t},backOut:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},backBoth:function(e,t,n,r,i){return typeof i=="undefined"&&(i=1.70158),(e/=r/2)<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t},bounceIn:function(t,n,r,i){return r-e.Easing.bounceOut(i-t,0,r,i)+n},bounceOut:function(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(t,n,r,i){return t<i/2?e.Easing.bounceIn(t*2,0,r,i)*.5+n:e.Easing.bounceOut(t*2-i,0,r,i)*.5+r*.5+n}};e.Easing=n},"3.7.2",{requires:["anim-base"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-node-plugin",function(e,t){var n=function(t){t=t?e.merge(t):{},t.node=t.host,n.superclass.constructor.apply(this,arguments)};n.NAME="nodefx",n.NS="fx",e.extend(n,e.Anim),e.namespace("Plugin"),e.Plugin.NodeFX=n},"3.7.2",{requires:["node-pluginhost","anim-base"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("anim-scroll",function(e,t){var n=Number;e.Anim.behaviors.scroll={set:function(e,t,r,i,s,o,u){var a=e._node,f=[u(s,n(r[0]),n(i[0])-n(r[0]),o),u(s,n(r[1]),n(i[1])-n(r[1]),o)];f[0]&&a.set("scrollLeft",f[0]),f[1]&&a.set("scrollTop",f[1])},get:function(e){var t=e._node;return[t.get("scrollLeft"),t.get("scrollTop")]}}},"3.7.2",{requires:["anim-base"]});
YUI.add("common-ui-intl-bidi",function(A){A.mix(A.namespace("Intl"),{_rtlChars:"[\uD83A\uD83B][\uDC00-\uDFFF]|[\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05FF\u0604\u0605\u0608\u060B\u060D\u061B-\u064A\u065F\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070E\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA-\u0815\u081A\u0824\u0828\u082E-\u08FF\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFC\uFDFE\uFDFF\uFE70-\uFEFE]|\uD803[\uDC00-\uDE5F\uDE7F-\uDFFF]|\uD802[\uDC00-\uDD1E\uDD20-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDF38\uDF40-\uDFFF]",_neutralChars:"[\uDB40-\uDB43][\uDC00-\uDFFF]|\uD802[\uDD1F\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDF39-\uDF3F]|\uD804[\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD01\uDD40-\uDD8A\uDD90-\uDD9B\uDDFD]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDD00-\uDD0A]|[\u0000-\u0040\u005B-\u0060\u007B-\u00A9\u00AB-\u00B4\u00B6-\u00B9\u00BB-\u00BF\u00D7\u00F7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u036F\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u0483-\u0489\u058A\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0600-\u0603\u0606\u0607\u0609\u060A\u060C\u060E-\u061A\u064B-\u065E\u0660-\u066C\u0670\u06D6-\u06E4\u06E7-\u06ED\u06F0-\u06F9\u070F\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07F6-\u07F9\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0900-\u0902\u093C\u0941-\u0948\u094D\u0951-\u0955\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u09F2\u09F3\u09FB\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AF1\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0BF3-\u0BFA\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C78-\u0C7E\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0CF1\u0CF2\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E3F\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39-\u0F3D\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F90-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135F\u1390-\u1399\u1400\u1680\u169B\u169C\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DB\u17DD\u17F0-\u17F9\u1800-\u180E\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1940\u1944\u1945\u19DE-\u19FF\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1DC0-\u1DE6\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200D\u2010-\u2070\u2074-\u207E\u2080-\u208E\u20A0-\u20B8\u20D0-\u20F0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189\u2190-\u2335\u237B-\u2394\u2396-\u23E8\u2400-\u2426\u2440-\u244A\u2460-\u249B\u24EA-\u26AB\u26AD-\u26CD\u26CF-\u26E1\u26E3\u26E8-\u26FF\u2701-\u2704\u2706-\u2709\u270C-\u2727\u2729-\u274B\u274D\u274F-\u2752\u2756-\u275E\u2761-\u2794\u2798-\u27AF\u27B1-\u27BE\u27C0-\u27CA\u27CC\u27D0-\u27FF\u2900-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2CEF-\u2CF1\u2CF9-\u2CFF\u2DE0-\u2E31\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u3004\u3008-\u3020\u302A-\u3030\u3036\u3037\u303D-\u303F\u3099-\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA66F-\uA673\uA67C-\uA67F\uA6F0\uA6F1\uA700-\uA721\uA788\uA802\uA806\uA80B\uA825\uA826\uA828-\uA82B\uA838\uA839\uA874-\uA877\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uABE5\uABE8\uABED\uFB1E\uFB29\uFD3E\uFD3F\uFDD0-\uFDEF\uFDFD\uFE00-\uFE19\uFE20-\uFE26\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFF0-\uFFFF]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3\uDFCE-\uDFFF]|\uD834[\uDD67-\uDD69\uDD73-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE00-\uDE45\uDF00-\uDF56]",_initializeBidiPatterns:function(){this._rtlPattern=new RegExp("^(?:"+this._neutralChars+")*(?:"+this._rtlChars+")");this._neturalPattern=new RegExp("^(?:"+this._neutralChars+")*$");},setBidiChars:function(B,C){if(B!==undefined){this._rtlChars=B;}if(C!==undefined){this._neutralChars=C;}this._initializeBidiPatterns();},detectDirection:function(C,B){if(this._rtlPattern.test(C)){return"rtl";}else{if(B==="ltr"){return"ltr";}else{if(this._neturalPattern.test(C)){if(B==="rtl"){return"rtl";}else{return"";}}else{return"ltr";}}}}});A.Intl._initializeBidiPatterns();A.mix(A.namespace("Intl"),{bidiDirection:A.Intl.detectDirection});},"1.0.0");YUI.add("contact",function(G){var B=G.Messenger.CommonUtils,F=G.Messenger.Intl,A=G.Messenger.Events,C=G.Messenger.GlobalConstants,D=G.Messenger.ContactsManager;function E(H){this._attrs={};this.init(H);}E.NAME="yim-contact";E.DISPLAY_IMAGE_NONE=launchData.isSecure?C.DEFAULT_IMAGE_SSL:C.DEFAULT_IMAGE;E.DISPLAYIMAGE_HTML='<img id="{{imageid}}" src="{{displaySource}}" width="{{pixels|16|32}}" height="{{pixels|16|32}}"/>';E.ATTRS={isMobile:{value:false},iconSize:{value:null},status:{value:-1},previousState:{value:null},name:{value:""},nodeId:{value:null},score:{value:0}};E.updateStealthState=function(I){var H=I.getAttribute("data-user"),J=I.getAttribute("data-network");if(!D.isContactVisible(H,J)){I.addClass("stealth");I.setStyle("opacity",0.6);}else{I.removeClass("stealth");I.setStyle("opacity",1);}};E.prototype={set:function(H,I){this._attrs[H]=I;},get:function(H){if(H in this._attrs){return this._attrs[H];}else{if(H in E.ATTRS){return E.ATTRS[H].value;}}},init:function(H){this._contactObject=H;this.set("status",this._contactObject.presence.state);this.set("name",B.unescapeHtml(this._contactObject.displayname));this._lname=this._contactObject.displayname.toLowerCase();if(G.Messenger.GlobalConfig.get("topContactsEnabled")){this.set("score",G.Messenger.ContactScoring.getUserScore([this.getUserId(),this.getNetwork()].join("~")));}this._domId=null;this._domString=null;},destroy:function(J,I){if(!I&&J&&this._domId){var H=G.one("#"+this._domId);this._showGoOfflineTransition(H,true);}else{if(this._onlineAnim){if(this._onlineAnimListener){this._onlineAnimListener.detach();this._onlineAnimListener=null;}this._onlineAnim.stop();this._onlineAnim.destroy();this._onlineAnim=null;}if(this._offlineAnim){if(this._offlineAnimListener){this._offlineAnimListener.detach();this._offlineAnimListener=null;}this._offlineAnim.stop();this._offlineAnim.destroy();this._offlineAnim=null;}if(!I){this.destroyDOMNode();}else{this._domId=null;this._domString=null;}}},isRendered:function(){return !(!this._domId);},getDOMNode:function(I){var H;if(!this._domId){H=this._createDOMNode();}else{H=G.one("#"+this._domId);if(!H){H=this._createDOMNode(true);}}if(I){if(this.getStatus()!=-1&&(this._contactObject.priorstate===null||this._contactObject.priorstate==-1)){this._showGoOnlineTransition(H);}else{if(this.getStatus()==-1&&this._contactObject.priorstate&&this._contactObject.priorstate!=-1){this._showGoOfflineTransition(H);}}}return H;},destroyDOMNode:function(){if(this._domId){var H=G.one("#"+this._domId);if(H){H.remove();H.destroy();G.Global.fire(A.CONTACTLIST_RESIZED);}else{}this._domId=null;this._domString=null;G.Global.fire(A.CONTACT_DESTROYED,this.getContactID());}},update:function(J,I){var K,H=this._contactObject.priorstate;if(this._contactObject.user!==J.user||this._contactObject.network!==J.network){return;}this._contactObject=J;this.set("status",this._contactObject.presence.state);this.set("name",this._contactObject.displayname);this._lname=this._contactObject.displayname.toLowerCase();if(this._domId){K=G.one("#"+this._domId);if(K){this._updateDOMNode(K,I);if(I){if(H==-1&&this.get("status")!=-1){this._showGoOnlineTransition(K);}else{if(this.get("status")==-1&&H&&H!=-1){this._showGoOfflineTransition(K);}}}}else{}}},_updateDOMNode:function(M,L){var K=M.one(".vitality"),N=M.one("a"),I=this.get("isMobile")?null:this._getStatusClass(this._contactObject.presence.state),H;if(K){K.setAttribute("title",this._getStatusMessage(false));K.set("innerHTML",this._getStatusMessage(true));}if(N){N.setAttribute("title",B.escapeHtml(this.get("name")));N.set("innerHTML",B.escapeHtml(this.get("name")));}if(I){H=M.getAttribute("class").split(" ");for(var J=0;J<H.length;J++){if(H[J].indexOf("ymsg-")===0){M.removeClass(H[J]);}}M.addClass(["ymsg-",I].join(""));}if(G.Messenger.ContactsManager.isContactVisible(this._contactObject.user,this._contactObject.network)){M.removeClass("stealth");if(!L){M.setStyle("opacity",1);}}else{M.addClass("stealth");if(!L){M.setStyle("opacity",0.6);}}},getName:function(){return this.get("name");},getStatus:function(){return this.get("status");},getUserId:function(){return this._contactObject.user;},getNetwork:function(){return this._contactObject.network;},getContact:function(){return this._contactObject;},getContactID:function(){return[this.getUserId(),this.getNetwork()].join("~");},getNodeID:function(){var H=this.get("nodeId");if(!H){H="contact-"+this._contactObject.hash;this.set("nodeId",H);}return this.get("nodeId");},getNodeImageID:function(){return(this.getNodeID()+"_img");},getNodeImageHeight:function(){return this.get("iconSize")||"32";},getNodeImageWidth:function(){return this.get("iconSize")||"32";},updateDisplayImage:function(){var H=G.one("#"+this._domId),I,J;this._contactObject=D.getContact(this._contactObject.user,this._contactObject.network);if(H){I=H.one("img");if(I){J=D.getContactDisplayImage(this._contactObject,this.get("iconSize")||32);I.setAttribute("src",J);}}},_createDOMNode:function(I){var H;if(I||!this._domString){H=G.Node.create(this.getDOMString());}else{H=G.Node.create(this._domString);}E.updateStealthState(H);return H;},getDOMString:function(){var L={name:B.escapeHtml(this.get("name")),contact_id:this.getNodeID(),vitality_id:(this.getNodeID()+"-vitality"),tab_index:window.openmail?'tabindex="-1"':"",isMobile_else:this.get("isMobile")?"":this._getStatusClass(this._contactObject.presence.state),message:this._getStatusMessage(true),messageTitle:this._getStatusMessage(false),url:"javascript:;",stealth_mode:G.Messenger.ContactsManager.isContactVisible(this._contactObject.user,this._contactObject.network)?"":"stealth",isMobile:this.get("isMobile")?"mobile":"",user:this.getUserId(),network:this.getNetwork(),fbclass:this.getNetwork()=="facebook"?"fbcontact":"",yid_attr:B.escapeHtml(this.get("name"))},N,I;if(F.isBIDI()){if(F.isRTL()){if(L.name!=""){if(G.Intl.bidiDirection(L.name)=="ltr"){L.name+="&lrm;";L.nameBIDIDirection="style='direction:ltr; text-align: right;'";}}if(L.message!=""&&G.Intl.bidiDirection(L.message)=="ltr"){L.message+="&lrm;";
L.messageBIDIDirection="style='direction:ltr; text-align: right;'";}}else{if(L.name!=""){if(G.Intl.bidiDirection(L.name)=="rtl"){L.name+="&rlm;";L.nameBIDIDirection="style='direction:rtl; text-align: left;'";}}if(L.message!=""&&G.Intl.bidiDirection(L.message)=="rtl"){L.message+="&rlm;";L.messageBIDIDirection="style='direction:rtl; text-align: left;'";}}}var H=window.launchData;if(H&&H.urlParams&&H.urlParams.ymsgrtopdebug&&this.getNetwork()!="facebook"){var M=G.Messenger.ContactScoring.getUserScore([this.getUserId(),this.getNetwork()].join("~")),K=M!==-1?M.toFixed(2):"0",J='<span title="'+M+'" class="tc_score">'+K+"</span>";L.score=J;G.later(20000,this,function(){var P,O;if(this._domId){P=G.one("#"+this._domId);if(P){O=P.one(".tc_score");O._node.innerHTML=G.Messenger.ContactScoring.getUserScore([this.getUserId(),this.getNetwork()].join("~")).toFixed(2);}}},null,true);}if(this._contactObject.network!="facebook"){I=this.getUserId();if(I!=L.yid_attr){L.yid_attr+=" ("+I+")";}}N=window.openmail?E.DISPLAY_IMAGE_NONE:D.getContactDisplayImage(this._contactObject,this.get("iconSize")||32);L.avatar=B.substitute(E.DISPLAYIMAGE_HTML,{"imageid":this.getNodeImageID(),"displaySource":B.substitute(N,{"pixels|32|48":this.get("iconSize")||"32"}),"pixels|16|32":this.get("iconSize")||"32"});this._domId=L.contact_id;if(this.getNetwork()=="facebook"){L.isFB="";if(G.UA.gecko>0&&G.UA.gecko<8){L.isFB="ff";}}else{L.isFB="hidden";}this._domString=B.substitute(G.Messenger.Templates.contact.contactTemplate,L);return this._domString;},_getStatusClass:function(I){var H="";switch(parseInt(I,10)){case -1:H="offline";break;case 0:H="available";break;case 2:H="busy";break;case 999:H="away";break;default:H="busy";break;}return H;},_getStatusMessage:function(K){var H=this._contactObject;var J=H.presence;var I=(K?J.anchoredMessage:J.message)||"";if(window.openmail&&K){I=I.replace(/class='link'/gi,'class="link" tabindex="-1"');}if(!H.authorized){I=F.get("str_cont_list_status_pending_add_request");}return I;},getDisplayImageUrl:function(){return D.getContactDisplayImage(this._contactObject,this.get("iconSize")||"32");},_showGoOnlineTransition:function(K){if(this._onlineAnim){return;}if(this._offlineAnim){if(this._offlineAnimListener){this._offlineAnimListener.detach();this._offlineAnimListener=null;}try{this._offlineAnim.stop();}catch(J){}this._offlineAnim.destroy();this._offlineAnim=null;}var I=+(K.getStyle("opacity"));if(I===1){I=0;K.setStyle("opacity",0);}var H=G.Messenger.ContactsManager.isContactVisible(this._contactObject.user,this._contactObject.network)?1:0.6;this._onlineAnim=new G.Anim({node:K,from:{opacity:I},to:{opacity:H},duration:1.5});this._onlineAnimListener=this._onlineAnim.on("end",G.bind(function(){this._onlineAnim.destroy();this._onlineAnim=null;this._onlineAnimListener.detach();this._onlineAnimListener=null;},this));this._onlineAnim.run();},_showGoOfflineTransition:function(J,H){if(this._offlineAnim){return;}if(this._onlineAnim){if(this._onlineAnimListener){this._onlineAnimListener.detach();this._onlineAnimListener=null;}try{this._onlineAnim.stop();}catch(I){}this._onlineAnim.destroy();this._onlineAnim=null;}this._offlineAnim=new G.Anim({node:J,to:{opacity:0},duration:1});this._offlineAnimListener=this._offlineAnim.on("end",G.bind(function(){this._offlineAnim.destroy();this._offlineAnim=null;this._offlineAnimListener.detach();this._offlineAnimListener=null;if(H){this.destroyDOMNode();}},this));this._offlineAnim.run();}};G.namespace("Messenger").Contact=E;},"@VERSION@",{skinnable:true,requires:["anim","contactsmanager","substitute","widget","classnamemanager","common-ui-intl-bidi","globalconstants"]});YUI.add("contactgroup",function(H){var E=H.Messenger.CommonUtils,C=E.logRocketStats,B=YUI.namespace("Messenger.Metrics"),A=H.Messenger.Events,G=H.Messenger.Contact,F=H.Messenger.GlobalConfig;function D(I){D.superclass.constructor.apply(this,arguments);}D.NAME="yim-contact-group";D.PRESENCE_ORDER={"0":1,"999":2,"2":3,"-1":4};D.MAX_FIRST_PASS=100;D.RERENDER_CUTOFF_LIMIT=25;D.FIRST_PASS_RENDER_LIMIT=70;D.SINGLE_PASS_RENDER_LIMIT=100;D.ATTRS={showOffline:{value:false},showIfEmpty:{value:false},emptyGroupMessage:{value:""},name:{value:""},id:{value:0},sortBy:{value:"presenceAndName"},isMobile:{value:false},startCollapsed:{value:false},showTransitions:{value:false},buttons:{value:[]}};H.extend(D,H.Base,{initializer:function(I){this._sorted=false;this._renderReady=false;if(I.contacts&&(this.get("showOffline")||H.Command.exec("yim:isPresenceAvailable"))){this._contacts=[];for(var J=0;J<I.contacts.length;J++){this._contacts[J]=new H.Messenger.Contact(I.contacts[J]);}this._sortContacts();this._renderReady=true;}else{this._contacts=[];this._contactMapping={};}this._renderingInProgress=false;this._contactsRendered=false;this._domNode=null;this._pendingDeletes={};this._groupId=this._generateGroupId(this.get("id"));this._groupName=this.get("name");this._pendingTimers={};this._eventHandles=[];this._eventHandles.push(this.on("showOfflineChange",function(K){if(K.newVal||!H.Messenger.GlobalConfig.get("showPresenceTransitions")){this.set("showTransitions",false);}else{this.set("showTransitions",true);}}));this._eventHandles.push(this.after("emptyGroupMessageChange",function(){if(this._domNode&&this.size()==0){var L=this.get("emptyGroupMessage"),K=this._domNode.one(".emptyGrpMsg");if(L){K.setContent(L);K.removeClass("hidden");}else{K.addClass("hidden");}}},this));this._eventHandles.push(H.Global.on(A.CONTACT_DESTROYED,H.bind(this._contactDestroyed,this)));},destructor:function(){this._inDestructor=true;this.destroyAllContacts();if(this._domNode){this._domNode.purge(true);this._domNode.remove();this._domNode.destroy(true);this._domNode=null;}H.each(this._pendingTimers,function(J,I){if(J&&J.cancel){J.cancel();J=null;}});this._pendingTimers=null;H.each(this._eventHandles,function(J,I){if(J&&J.detach){J.detach();J=null;}});this._eventHandles=null;},isRendered:function(){return !(!this._domNode);},isCollapsed:function(){return(this._domNode&&this._domNode.hasClass("collapsed"));},isHidden:function(){return(this._domNode&&this._domNode.hasClass("hidden"));},getDOMNode:function(){if(!this._domNode){var N={id:this._groupId,list_id:(this._groupId+"-list"),title:this._groupName,title_attr:this._groupName,imageSize:"lg",count:""},O=this.get("buttons"),M,L,K,J,I;if(this.get("startCollapsed")){N.isCollapsed="collapsed";N.aria_expanded="false";}else{N.isExpanded="expanded";N.aria_expanded="true";}this._domNode=H.Node.create(E.substitute(H.Messenger.Templates.contactgroup.baseTemplate,N));K=this._domNode.one("span.rht");for(M=0;M<O.length;M++){L=H.Node.create(E.substitute(H.Messenger.Templates.contactgroup.buttonTemplate,O[M]));L.on("click",O[M].callback);K.append(L);}if(!this.get("showIfEmpty")){this._domNode.addClass("hidden");}else{J=this.get("emptyGroupMessage");if(J){I=this._domNode.one(".emptyGrpMsg");I.setContent(J);I.removeClass("hidden");}}if(this._renderReady){this._renderAllContacts();}}return this._domNode;},getContacts:function(){return this._contacts;},size:function(){return this._contacts.length;},addContacts:function(R,O,L){var N,I="addContacts",M=0,K=R.length<5&&this.get("showTransitions");if(L){delete this._pendingTimers[L];}if(this._renderingInProgress){do{N=[I,M].join("-");M++;}while(this._pendingTimers[N]);this._pendingTimers[N]=H.later(100,this,this.addContacts,[R,0,N]);return;}var Q=0,J=(new Date()).getTime(),S=0,P=O?R.length-O:R.length;if(this._contactsRendered&&!O&&R.length>D.RERENDER_CUTOFF_LIMIT&&this._contacts.length<D.MAX_FIRST_PASS){this._rerenderAllContacts();return;}if(!this._contactsRendered){for(M=0;M<R.length;M++){this._addContact(R[M],K);}if(this._domNode&&this._renderReady){this._renderAllContacts();}}else{for(O=O||0;O<R.length&&S<D.SINGLE_PASS_RENDER_LIMIT;O++){this._addContact(R[O],K);S=(new Date()).getTime()-J;Q++;}H.Global.fire(A.CONTACTLIST_RESIZED);if(O<R.length){N=[I,J,O].join("-");this._pendingTimers[N]=H.later(0,this,this.addContacts,[R,O,N]);}}},updateGroupName:function(I){this.set("name",I);this._groupName=I;if(this._domNode){this._domNode.one("h2 span.label").set("title",I).set("innerHTML",I);}},_addContact:function(Q,P){var R=0,J,L,T=this.get("sortBy"),K,S,I,N,M=[Q.user,Q.network].join("~"),O=false;if(!this.get("showOffline")&&Q.presence.state==-1){return;}if(Q.network=="facebook"&&!Q.displayname){return;}if(this._pendingDeletes[M]){N=this._pendingDeletes[M];delete this._pendingDeletes[M];O=true;}else{N=new H.Messenger.Contact(Q);}if(this._sorted){if(T==="score"){J=this._sortByScore;}else{if(T==="name"){J=this._sortByName;}else{if(T==="userId"){J=this._sortByUserId;}else{J=this._sortByPresenceAndName;}}}L=this._doBinarySearch(N,J);if(L.found){return;}R=L.index;this._contacts.splice(R,0,N);if(O){this._updateContact(Q,false,P);return;}if(this._contactsRendered){K=this._domNode.one("ul");N.set("isMobile",this.get("isMobile"));S=N.getDOMNode(P);if(R===0){K.prepend(S);}else{if(R<this._contacts.length-1){I=this._contacts[R+1];if(I.isRendered()){K.insertBefore(S,I.getDOMNode());}else{K.append(S);}}else{K.append(S);}}if(this._domNode.hasClass("hidden")){this._domNode.removeClass("hidden");}}}else{if(typeof(this._contactMapping[N.getContactID()])=="undefined"){this._contactMapping[N.getContactID()]=this._contacts.length;this._contacts.push(N);this._renderReady=true;}}if(this._contactsRendered&&this._contacts.length===1){this._domNode.one(".emptyGrpMsg").addClass("hidden");}},removeContact:function(K,J,L){var N,I="removeContact",M=0;if(L){delete this._pendingTimers[L];}if(this._renderingInProgress){do{N=[I,M].join("-");M++;}while(this._pendingTimers[N]);this._pendingTimers[N]=H.later(100,this,this.removeContact,[K,J,N]);
return;}var P=H.Command.exec("yim:getContact",K,J),Q,O=[K,J].join("~");if(!this._sorted){this._sortContacts();}Q=this._findContact(P);if(Q>-1){this._pendingDeletes[O]=this._contacts[Q];this._contacts[Q].destroy(this.get("showTransitions"));this._contacts.splice(Q,1);this._hideIfEmpty();}else{}},updateDisplayImage:function(J,I){var O,M="updateDisplayImage",L=0;if(I){delete this._pendingTimers[I];}if(this._renderingInProgress){do{O=[M,L].join("-");L++;}while(this._pendingTimers[O]);this._pendingTimers[O]=H.later(100,this,this.updateDisplayImage,[J,O]);return;}if(!this._contactsRendered){return;}var K=this._findContact(J),N=K>-1?this._contacts[K]:null;if(!N){this._addContact(J,this.get("showTransitions"));return;}N.updateDisplayImage();},updateContacts:function(R,O,L){var N,I="updateContacts",M=0,K=R.length<5&&this.get("showTransitions");if(L){delete this._pendingTimers[L];}if(this._renderingInProgress){do{N=[I,M].join("-");M++;}while(this._pendingTimers[N]);this._pendingTimers[N]=H.later(100,this,this.updateContacts,[R,O,N]);return;}var J=(new Date()).getTime(),Q=0,S=0,P=O?R.length-O:R.length;if(this._contactsRendered&&!O&&R.length>D.RERENDER_CUTOFF_LIMIT&&this._contacts.length<D.MAX_FIRST_PASS){this._rerenderAllContacts();return;}for(O=O||0;O<R.length&&S<D.SINGLE_PASS_RENDER_LIMIT;O++){this._updateContact(R[O],true,K);S=(new Date()).getTime()-J;Q++;}if(this._contactsRendered){H.Global.fire(A.CONTACTLIST_RESIZED);}else{if(this._domNode&&this._renderReady){this._renderAllContacts();}}if(O<R.length){N=[I,J,O].join("-");this._pendingTimers[N]=H.later(0,this,this.updateContacts,[R,O,N]);}},_updateContact:function(I,K,L){if(!this._contactsRendered&&!this._renderReady&&I.presence.state>-1){this._renderReady=true;}var J=this._findContact(I),M=J>-1?this._contacts[J]:null,N=this.get("sortBy");if(!M){this._addContact(I,L);return;}if(this._contactsRendered&&!this.get("showOffline")&&I.presence.state==-1){this._pendingDeletes[M.getContactID()]=M;M.destroy(L);this._hideIfEmpty();if(!K){H.Global.fire(A.CONTACTLIST_RESIZED);}this._contacts.splice(J,1);}else{if(this._sorted&&this._contacts.length>1&&(N==="name"&&M.getName()!==I.displayname)||(N==="presenceAndName"&&(M.getName()!==I.displayname||M.getStatus()!==I.presence.state))){this._reorderContact(J);}else{M.update(I,L);}}},_renderAllContacts:function(J,Q,M){var O,I="_renderAllContacts",N=0;this._renderingInProgress=true;if(M){delete this._pendingTimers[M];}if(!this._sorted){this._sortContacts();O=[I,"sort"].join("-");this._pendingTimers[O]=H.later(0,this,this._renderAllContacts,[null,0,O]);return;}if(typeof B.buddyListLoadStart=="undefined"){B.buddyListLoadStart=new Date().getTime();}var P=this.get("showOffline"),U=this.get("isMobile"),R=!Q,L=R?D.FIRST_PASS_RENDER_LIMIT:D.SINGLE_PASS_RENDER_LIMIT,T="",V=0,K=(new Date()).getTime(),Y,X,S,W=this._contacts.length;if(R){}else{}if(W>0){this._domNode.one(".emptyGrpMsg").addClass("hidden");}J=J||this._domNode.one("ul");this._contactsRendered=true;for(Q=Q||0;Q<W;Q++){Y=new Date()-K;if(Y>L||(R&&V>D.MAX_FIRST_PASS)){break;}S=this._contacts[Q];if(P||S.getStatus()>-1){if(U){S.set("isMobile",true);}if(R){T+=S.getDOMString();}else{J.append(this._contacts[Q].getDOMNode());}if(this._domNode.hasClass("hidden")){this._domNode.removeClass("hidden");}V++;}}if(R){J.set("innerHTML",T);}H.Global.fire(A.CONTACTLIST_RESIZED);if(!B.firstContactsRendered){B.firstContactsRendered=new Date().getTime();if(F.get("useTopContacts")){C({key:"firstTopContactsRendered",value:(B.firstContactsRendered-B.appInit)});C({key:"loginWithTopContacts",value:""});}else{C({key:"firstOnlineContactsRendered",value:(B.firstContactsRendered-B.appInit)});C({key:"loginWithOnlineContacts",value:""});}}if(Q<this._contacts.length){O=[I,K,Q].join("-");this._pendingTimers[O]=H.later(0,this,this._renderAllContacts,[J,Q,O]);}else{this._renderingInProgress=false;J.all("li").each(function(Z){G.updateStealthState(Z);},this);if(typeof B.buddyListLoaded=="undefined"){B.buddyListLoaded=new Date().getTime();}if(H.Messenger.GlobalConfig.get("showPresenceTransitions")&&!this.get("showOffline")){this._eventHandles.push(H.Global.on(A.CONNECTION_UPDATE,H.bind(function(Z){if(Z&&!this.get("showOffline")){H.later(3000,this,function(){this.set("showTransitions",true);});}else{this.set("showTransitions",false);}},this)));if(H.Command.exec("yim:isOnline")){H.later(3000,this,function(){this.set("showTransitions",true);});}}}},destroyAllContacts:function(L){var I,M,K,J;while(this._contacts.length>0){I=this._contacts.shift();I.destroy(false,L);}for(M in this._pendingDeletes){if(this._pendingDeletes.hasOwnProperty(M)){this._pendingDeletes[M].destroy(false,L);delete this._pendingDeletes[M];}}this._contactsRendered=false;this._renderReady=false;this._sorted=false;H.each(this._pendingTimers,function(O,N){if(O&&O.cancel){O.cancel();O=null;}});this._pendingTimers={};K=this.get("emptyGroupMessage");if(K){J=this._domNode.one(".emptyGrpMsg");J.setContent(K);J.removeClass("hidden");}},_contactDestroyed:function(I){if(!this._pendingDeletes[I]){if(!this._inDestructor){}return;}delete this._pendingDeletes[I];},_rerenderAllContacts:function(){var K=this._domNode.one("ul"),N=H.Command.exec("yim:getContacts"),J,L,I=N.length,M=this.get("showOffline");this.destroyAllContacts(true);this._sorted=false;this._contactsRendered=false;for(L=0;L<I;L++){J=N[L];if(M||J.presence.state>-1){if(H.Command.exec("yim:isContactInGroup",this._groupId,J)){this._contacts.push(new H.Messenger.Contact(J));}}}this._renderAllContacts(K);},_reorderContact:function(J){var K=this._contacts.splice(J,1)[0],I=K.getContact();if(K){K.destroy(false);K=null;}this._addContact(I,false);},_findContact:function(J){var O=this.get("sortBy"),I,L,K=[J.user,J.network].join("~"),N,M;if(this._sorted){M=new H.Messenger.Contact(J);if(O==="name"){I=this._doBinarySearch(M,this._sortByName);}else{if(O==="userId"){I=this._doBinarySearch(M,this._sortByUserId);}else{if(O==="score"){I=this._doBinarySearch(M,this._sortByScore);}else{if(J.priorstate){M.set("previousState",J.priorstate);
}I=this._doBinarySearch(M,this._sortByPresenceAndName);}}}if(!I.found){for(L=0;L<this._contacts.length;L++){if(this._contacts[L].getUserId()===J.user&&this._contacts[L].getNetwork()===J.network){N=L;break;}}}else{N=I.index;}M.destroy();}else{N=this._contactMapping[K]!==undefined?this._contactMapping[K]:-1;}if(N===-1){}return N;},_doBinarySearch:function(N,O){var I=0,M=this._contacts.length-1,L,K=false,J=0;if(!this._sorted){this._sortContacts();}while(I<=M){J=Math.floor((I+M)/2);L=O(this._contacts[J],N);if(L<0){I=J+1;continue;}if(L>0){M=J-1;continue;}K=true;break;}if(!K&&L<0){J++;}return{index:J,found:K};},_sortByUserId:function(K,J){var I=K.getUserId(),M=J.getUserId(),L=(I>M)?1:(I===M)?0:-1;return L;},_sortByName:function(K,J){var I=K._lname,M=J._lname,L=(I>M)?1:(I===M)?0:-1;return L;},_sortByPresenceAndName:function(L,J){var I=D.PRESENCE_ORDER[L.getStatus()]+L._lname,K=J.get("previousState")===null?J.getStatus():J.get("previousState"),N=D.PRESENCE_ORDER[K]+J._lname,M=(I>N)?1:(I===N)?0:-1;return M;},_sortByScore:function(K,J){var I=J.get("score")||0,L=K.get("score")||0;if(I===L){I=K.getContactID();L=J.getContactID();}return(I>L)?1:(I===L)?0:-1;},_sortContacts:function(){if(this._sorted){return;}var I=this.get("sortBy");if(I==="score"){this._contacts.sort(this._sortByScore);}else{if(I==="name"){this._contacts.sort(this._sortByName);}else{if(I==="userId"){this._contacts.sort(this._sortByUserId);}else{if(I==="presenceAndName"){this._contacts.sort(this._sortByPresenceAndName);}}}}this._contactMapping={};this._sorted=true;},_buildContactMapping:function(){for(var I=0;I<this._contacts.length;I++){this._contactMapping[this._contacts[I].getContactID()]=I;}},_generateGroupId:function(I){return escape(I);},_hideIfEmpty:function(){var K=this._domNode.one("ul"),L=!K.hasChildNodes(),J,I;if(!this.get("showIfEmpty")){var K=this._domNode.one("ul");if(L){this._domNode.addClass("hidden");}else{if(this._domNode.hasClass("hidden")){this._domNode.removeClass("hidden");}}}else{if(L){J=this.get("emptyGroupMessage");if(J){I=this._domNode.one(".emptyGrpMsg");I.setContent(J);I.removeClass("hidden");}}else{this._domNode.one(".emptyGrpMsg").addClass("hidden");}}}});H.namespace("Messenger").ContactGroup=D;},"@VERSION@",{requires:["node","contact","commonutils","event-custom","command"]});YUI.add("contactscoring",function(H){var A=YUI.namespace("Messenger"),B=A.Events,G=window.launchData.userPrefs,F=H.Messenger.ContactsManager,D=H.Messenger.OMAPI,C=H.Messenger.SessionManager,E=H.Messenger.GlobalConfig;if(!A.ContactScoring){A.ContactScoring=(function(){function I(J){I.superclass.constructor.apply(this,arguments);}I.NAME="yim-contactscoring";I.ATTRS={};I.OM_KEY="mimContactScoringData";I.MIN_SCORE_THRESHOLD=5;I.POINT_MAPPING={};I.POINT_MAPPING[B.CONVERSATION_INITIATED]=1;I.POINT_MAPPING[B.ADD_CONTACT_SENT]=2;I.POINT_MAPPING[B.MESSAGE_SENT]=0.5;I.POINT_MAPPING[B.MESSAGE_RECEIVED]=0.1;I.POINT_MAPPING["online"]=0.001;I.SCORING_DATA={lastUpdated:null,mailScoreLastUpdated:null,contacts:[]};I.MSGR_SCORE_TOTAL_CAP=15;I.MSGR_SCORE_NEW_CAP=25;I.MSGR_SCORE_NEW_CONTRIB=5;I.MAIL_SCORE_CONTRIB=5;I.DECAY_MULTIPLIER=0.99;I.DECAY_INTERVAL=1*24*3600*1000;I.MAIL_SCORE_REFRESH_INTERVAL=30*24*3600*1000;I.TOP_CONTACT_MIN_COUNT=10;I.TOP_CONTACT_MAX_COUNT=15;I.TOP_CONTACT_SCORE_CUTOFF=0.5;I.PERSIST_INTERVAL=2*60*1000;I.PERSIST_THRESHOLD=15;H.extend(I,H.Base,{initializer:function(){this._dirty=false;this._listeners=[];this._messengerScores={};this._topcontactOrder=[];this._scoresLoaded=false;this._maxSessionScore=0;this._topContacts=null;this._topContactMap={};this._activitySinceStore=0;if(E.get("topContactsEnabled")){if(!E.get("useTopContacts")){H.Global.once(B.APP_INIT_COMPLETE,H.bind(function(){H.later(2000,this,this.startScoring);},this));}else{this.startScoring();}}this._settingListener=E.on("topContactsEnabledChange",function(J){if(J.newVal){this.startScoring();}else{this.stopScoring();}},this);},destructor:function(){this._detachListeners();if(this._listeners){delete this._listeners;}if(this._messengerScores){delete this._messengerScores;}if(this._topcontactOrder){delete this._topcontactOrder;}if(this._settingListener){this._settingListener.detach();this._settingListener=null;}if(this._buddyLoadListener){this._buddyLoadListener.detach();this._buddyLoadListener=null;}if(this._skipABTimer){this._skipABTimer.cancel();this._skipABTimer=null;}if(this._loadABListener){this._loadABListener.detach();this._loadABListener=null;}},startScoring:function(){if(!this._scoresLoaded){this._loadScores();}if(!this._listeners.length){this._listeners.push(H.Global.on(B.CONVERSATION_INITIATED,this._processActivityEvent,this,B.CONVERSATION_INITIATED));this._listeners.push(H.Global.on(B.MESSAGE_RECEIVED,this._processActivityEvent,this,B.MESSAGE_RECEIVED));this._listeners.push(H.Global.on(B.MESSAGE_SENT,this._processActivityEvent,this,B.MESSAGE_SENT));this._listeners.push(H.Global.on(B.CONTACT_DELETED,this._handleContactDeleted,this));}if(!this._persistTimer){this._persistTimer=H.later(I.PERSIST_INTERVAL,this,this._persistScores,null,true);}},stopScoring:function(){this._detachListeners();},resetState:function(){this.stopScoring();this.initializer();},getUserScore:function(J){if(this._messengerScores[J]){var K=this._maxSessionScore>I.MSGR_SCORE_NEW_CONTRIB?I.MSGR_SCORE_NEW_CONTRIB/this._maxSessionScore:1;return this._messengerScores[J].prev_msgr_score+this._messengerScores[J].msgr_score*K+this._messengerScores[J].mail_score;}else{return 0;}},getTopContacts:function(J){if(this._topContacts){J(this._topContacts);}else{this.once("topcontactsready",function(){J(this._topContacts);});}},_processActivityEvent:function(K,L){var J=K.userId;if(!J&&K.user&&K.network){J=[K.user,K.network].join("~");}if(J&&!C.isSelfUser(K.user)&&F.isUserInContactList(K.user,K.network)&&K.network!="sms"&&K.network!="facebook"){this._dirty=true;if(!this._messengerScores[J]){this._messengerScores[J]={};this._messengerScores[J].msgr_score=0;this._messengerScores[J].mail_score=0;this._messengerScores[J].prev_msgr_score=0;}if(L!=B.MESSAGE_RECEIVED||!K.fromSelf){if(this._messengerScores[J].msgr_score<I.MSGR_SCORE_NEW_CAP){this._messengerScores[J].msgr_score+=I.POINT_MAPPING[L];if(this._messengerScores[J].msgr_score>this._maxSessionScore){this._maxSessionScore=this._messengerScores[J].msgr_score;}this._activitySinceStore+=I.POINT_MAPPING[L];if(this._activitySinceStore>I.PERSIST_THRESHOLD){this._persistScores(true);}}}}},_handleContactDeleted:function(K){var N,J,L,O=[K.user,K.network].join("~"),M=false;if(this._topContacts){for(N=0,J=this._topContacts.length;N<J;N++){L=this._topContacts[N];if(L.userId==O){delete this._topContactMap[L.userId];this._topContacts.splice(N,1);M=true;break;}}}if(this._messengerScores[O]){delete this._messengerScores[O];}if(M){this._dirty=true;H.later(0,this,this._persistScores);}},_detachListeners:function(){while(this._listeners.length){this._listeners.pop().detach();}if(this._persistTimer){this._persistTimer.cancel();this._persistTimer=null;}},_persistScores:function(V){if(this._dirty&&window.openmail){var O={},U=I.SCORING_DATA,N,S=this._maxSessionScore,P,J,L,K=0,T,M,R,Q,W=E.get("hideAddressBookContacts");if(V){this._skip=true;}else{if(this._skip){this._skip=false;return;}}this._activitySinceStore=0;U.contacts=[];N=F.getContacts();for(P=0;P<N.length;P++){if(W&&N[P].type==="addressbook"){continue;}if(N[P].presence&&N[P].presence.state>-1){this._processActivityEvent(N[P],"online");}}J=(S>I.MSGR_SCORE_NEW_CONTRIB)?(I.MSGR_SCORE_NEW_CONTRIB/S):1;for(T in this._messengerScores){if(this._messengerScores.hasOwnProperty(T)){M=this._messengerScores[T];L=J*M.msgr_score+M.prev_msgr_score;Q=this._topcontactOrder[T];U.contacts.push({"userId":T,"msgr_score":L,"mail_score":M.mail_score,"prev_msgr_score":M.prev_msgr_score,"position":Q});if(L>K){K=L;}}}J=(K>I.MSGR_SCORE_TOTAL_CAP)?(I.MSGR_SCORE_TOTAL_CAP/K):1;for(P=0;P<U.contacts.length;P++){U.contacts[P].msgr_score*=J;U.contacts[P].score=U.contacts[P].msgr_score+U.contacts[P].mail_score;}U.contacts.sort(this._stableContactSortFunc);for(P=0;P<U.contacts.length;P++){this._topcontactOrder[U.contacts[P].userId]=P;delete U.contacts[P]["position"];}if(U.contacts.length>50){U.contacts.splice(50);}this._topContacts=U.contacts.slice(0,I.TOP_CONTACT_MIN_COUNT);if(this._topContacts.length){R=I.TOP_CONTACT_SCORE_CUTOFF*this._topContacts[this._topContacts.length-1].msgr_score;
R=R>1?R:1;for(P=I.TOP_CONTACT_MIN_COUNT;P<I.TOP_CONTACT_MAX_COUNT&&P<U.contacts.length;P++){if(U.contacts[P].msgr_score>I.TOP_CONTACT_SCORE_CUTOFF){this._topContacts.push(U.contacts[P]);}else{break;}}}this.fire("topcontactsready");U.lastUpdated=(new Date()).getTime();if(U.contacts.length&&U.contacts[0].score>I.MIN_SCORE_THRESHOLD){U.scoreThresholdReached=true;}O.keys={};O.keys[I.OM_KEY]=U;D.setData(O);this._dirty=false;}},_stableContactSortFunc:function(K,J){var L=H.Lang,N=L.isUndefined(K.score)?0:K.score,M=L.isUndefined(J.score)?0:J.score;if(N==M){return K.position-J.position;}else{return M-N;}},_loadScores:function(Q){var K=G&&G[I.OM_KEY],X=E.get("hideAddressBookContacts");if(!F.get("ABDataReceived")&&!Q){this._loadABListener=F.on("ABDataReceivedChange",function(Z){if(Z.newVal){this._skipABTimer.cancel();this._skipABTimer=null;this._loadABListener.detach();this._loadABListener=null;this._loadScores(true);}},this);this._skipABTimer=H.later(3000,this,function(){this._loadABListener.detach();this._loadABListener=null;this._skipABTimer=null;this._loadScores(true);});return;}this._topContacts=[];if(G&&G[I.OM_KEY]&&typeof(G[I.OM_KEY])!="object"){try{var L=G[I.OM_KEY];G[I.OM_KEY]=null;G[I.OM_KEY]=H.JSON.parse(L);}catch(N){}}if(G&&G[I.OM_KEY]){I.SCORING_DATA=G[I.OM_KEY];var J=(new Date()).getTime(),V=I.SCORING_DATA,Y=J-V.lastUpdated,P=Y>I.DECAY_INTERVAL?Math.pow(I.DECAY_MULTIPLIER,Math.floor(Y/I.DECAY_INTERVAL)):1,U,O,T,W,R,M,S;for(O=0;O<V.contacts.length;O++){M=V.contacts[O];S=M.userId;U=M.msgr_score||0;U*=P;this._messengerScores[S]={};this._messengerScores[S].msgr_score=0;this._messengerScores[S].prev_msgr_score=U>0?U:0;this._messengerScores[S].mail_score=M.mail_score||0;this._topcontactOrder[S]=O;}for(O=0;O<V.contacts.length&&this._topContacts.length<I.TOP_CONTACT_MAX_COUNT;O++){T=V.contacts[O].userId.split("~");if(C.isSelfUser(T[0])){continue;}W=F.getContact(T[0],T[1]);if(W&&W.type!="temporary"&&!this._topContactMap[V.contacts[O].userId]){if(this._topContacts.length==I.TOP_CONTACT_MIN_COUNT){R=I.TOP_CONTACT_SCORE_CUTOFF*this._topContacts[this._topContacts.length-1].msgr_score;R=R>1?R:1;}if(this._topContacts.length>=I.TOP_CONTACT_MIN_COUNT&&V.contacts[O].prev_msgr_score<R){break;}this._topContactMap[V.contacts[O].userId]=true;this._topContacts.push(V.contacts[O]);}}if(!V.mailScoreLastUpdated||(J-I.SCORING_DATA.mailScoreLastUpdated)>I.MAIL_SCORE_REFRESH_INTERVAL||this._topContacts.length<I.TOP_CONTACT_MIN_COUNT){this._loadABData();}else{this.fire("topcontactsready");}}else{this._loadABData(true);}log("Top Contacts data loaded");},refreshTopContacts:function(){var J=F.getContacts(),M,L,O=0,Q,N,S,R=E.get("hideAddressBookContacts");function K(U,T){var Y=typeof(U.sc_score)!="undefined"?U.sc_score:0,X=typeof(T.sc_score)!="undefined"?T.sc_score:0,W,V;if(Y==X){W=U.displayname.toLowerCase();V=T.displayname.toLowerCase();if(W>V){return 1;}else{if(V>W){return -1;}}return 0;}else{return X-Y;}}this._topContacts=[];this._topContactMap={};this._messengerScores={};this._topcontactOrder={};if(J&&J.length){J.sort(K);if(J[0].sc_score&&J[0].sc_score>I.MAIL_SCORE_CONTRIB){N=I.MAIL_SCORE_CONTRIB/J[0].sc_score;}for(M=0;M<J.length&&O<50;M++){if(J[M].network=="yahoo"){if(J[M].user&&!C.isSelfUser(J[M].user)){if(R&&J[M].type==="addressbook"){continue;}S=J[M].sc_score||0;Q=[J[M].user,J[M].network].join("~");this._topcontactOrder[Q]=M;this._messengerScores[Q]={};this._messengerScores[Q].msgr_score=0;this._messengerScores[Q].prev_msgr_score=0;this._messengerScores[Q].score=S;this._messengerScores[Q].mail_score=N?N*S:S;O++;if(this._topContacts.length<I.TOP_CONTACT_MIN_COUNT&&!this._topContactMap[Q]){this._topContactMap[Q]=true;var P=this._messengerScores[Q];P.userId=Q;this._topContacts.push(P);}}}}I.SCORING_DATA.mailScoreLastUpdated=(new Date()).getTime();}this.fire("topcontactsready");this._dirty=true;this._persistScores(false);return;},_loadABData:function(Q){var J=F.getContacts(),M,L,O=0,R,N,T,S=E.get("hideAddressBookContacts");function K(V,U){var Z=typeof(V.sc_score)!="undefined"?V.sc_score:0,Y=typeof(U.sc_score)!="undefined"?U.sc_score:0,X,W;if(Z==Y){X=V.displayname.toLowerCase();W=U.displayname.toLowerCase();if(X>W){return 1;}else{if(W>X){return -1;}}return 0;}else{return Y-Z;}}if(J&&J.length){J.sort(K);if(J[0].sc_score&&J[0].sc_score>I.MAIL_SCORE_CONTRIB){N=I.MAIL_SCORE_CONTRIB/J[0].sc_score;}for(M=0;M<J.length&&O<50;M++){if(J[M].network=="yahoo"){if(J[M].user&&!C.isSelfUser(J[M].user)){if(S&&J[M].type==="addressbook"){continue;}T=J[M].sc_score||0;R=[J[M].user,J[M].network].join("~");this._topcontactOrder[R]=M;if(!this._messengerScores[R]){this._messengerScores[R]={};this._messengerScores[R].msgr_score=0;this._messengerScores[R].prev_msgr_score=0;this._messengerScores[R].score=T;}this._messengerScores[R].mail_score=N?N*T:T;O++;if(this._topContacts.length<I.TOP_CONTACT_MIN_COUNT&&!this._topContactMap[R]){this._topContactMap[R]=true;var P=this._messengerScores[R];P.userId=R;this._topContacts.push(P);}}}}I.SCORING_DATA.mailScoreLastUpdated=(new Date()).getTime();}this.fire("topcontactsready");if(Q){this._dirty=true;this._persistScores(false);}}});return new I();})();}H.namespace("Messenger").ContactScoring=A.ContactScoring;},"@VERSION@",{requires:["events","globalconfig","omapi","contactsmanager"]});YUI.add('lang/conversationarea_en-US', function(Y){Y.namespace('Messenger.Templates').conversationarea={messageGroupTemplate: "<li class=\"messageGroupContainer {{current}} {{self}}\"><span class=\"proper\"><img src=\"{{user_img_url}}\" width=\"32\" height=\"32\"><div class=\"fb-logo-conv {{fb_hidden_class}}\"></div></span><div class=\"topLeft\"><div class=\"topRight\"><div class=\"bottomRight\"><div class=\"bottomLeft\"><div class=\"messageEnclosureGroup2\"></div></div></div></div></div><div class=\"fang\"></div></li>", baseTemplate: "<div class=\"conversation-pane yui3-yim-conversation-area\" aria-live=\"assertive\">	<div class='notification-area conversation-area hidden'></div><div class=\"conversation-area yui3-yim-conversation-area-content {{messageDisplayType}}\"><div class=\"message-area\"><ul class='hidden updates message-list recent'></ul></div><div class=\"typing hidden\">{{typingMessage}}</div></div></div>", notificationTemplate: "<div class=\"{{notifyClass}} notification\" data-id=\"{{notifyId}}\" data-type=\"{{notifyType}}\" data-autodestroy=\"{{autoDestroy}}\"><span class=\"close hidden\"></span><span class=\"{{messageContainerClass}}\">{{messageText}}</span><div class=\"{{buttonContainerClass}}\"></div></div>", textNotificationTemplate: "<div class=\"yui3-yim-notification yui3-yim-notification-content {{notifyClass}}\" id=\"{{notifyId}}\"><span class=\"{{messageContainerClass}}\">{{messageText}}</span></div>", notificationButtonTemplate: "<button class=\"{{buttonClass}} notification-button\" data-index=\"{{buttonIndex}}\" type=\"button\">{{buttonLabel}}</button>", messageTemplate: "<div class=\"active messageEnclosure2 msg yui3-conversation-message yui3-conversation-message-content\" data-hash=\"{{hash}}\" data-self=\"{{fromSelf}}\" data-network=\"{{network}}\" data-time=\"{{time}}\">	<div class=\"message msg-content {{messageClasses}}\" data-hash=\"{{hash}}\" dir=\"{{messageDir}}\">	    <span class=\"sender {{senderClasses}}\">{{yid}}</span>	    <span class=\"tsEnclosure\">&nbsp;(</span>	    <span class=\"timeStamp {{senderClasses}} {{tsClass}}\" dir=\"{{tsDir}}\">{{timestamp}}</span>	    <span class=\"tsEnclosure\">)</span>	    <span class=\"nameSeparator {{senderClasses}}\">{{nameSeparator}}</span>	    <span class=\"msg-content-inner\">{{message}}</span></div></div>"};}, '@VERSION@' ,{requires:[]});YUI.add("conversationarea",function(B){var A=B.ClassNameManager,H=B.Node,G=B.Messenger.CommonUtils,C=B.Messenger.ContactsManager,F=B.Messenger.SessionManager,J=B.Messenger.YMLUtil,D=B.Messenger.GlobalConstants,E=B.Messenger.GlobalConfig;function I(K){I.superclass.constructor.apply(this,arguments);}I.NAME="yim-conversation-area";I.MESSAGE_LIST_TEMPLATE="<ul class='updates message-list messages'></ul>";I.STATIC_NOTIFY_CLASS="yui3-yim-notification-statictop";I.ATTRS={alias:{},user:{},network:{value:"yahoo"},autoscroll:{value:true},scrollpos:{value:0},notificationsEnabled:{value:true},showInputModeChange:{value:true},tabIndex:{value:null},myImgUrl:{},theirImgUrl:{}};B.extend(I,B.Base,{initializer:function(M){this._currentState={};this.ftConvList=[];this._eventHandles=[];this._currentState._lastConversationMsgType="";this._currentState.firstMessageTimestamp=null;this._oldConvAreaTop=7;this._currentGroup=null;this._notificationCallbacks={};this._notificationCloseCallbacks={};var K=this.get("user"),N=this.get("network"),L,O;O=C.getContactDisplayImage(C.getContact(K,N),32);this.set("theirImgUrl",O);L=F.getOwnDisplayImage(32);this.set("myImgUrl",L);},destructor:function(){B.each(this._eventHandles,function(L,K){L.detach();});this._messageAreaNode&&this._messageAreaNode.remove(true);this._contentBox&&this._contentBox.remove(true);this._boundingBox&&this._boundingBox.remove(true);if(this._recentMessagesTimer){this._recentMessagesTimer.cancel();delete this._recentMessagesTimer;}},render:function(L){var P=(new Date()).getTime(),K=C.getContact(this.get("user"),this.get("network")),M=K?K.displayname:this.get("user"),Q=G.substitute(B.Messenger.Intl.get("str_conv_typing"),{conversation_user:M}),N=E.get("conversationStyle")==="text"?"conv-text":"conv-bubbles",O={typingMessage:Q,messageDisplayType:N};this._boundingBox=B.Node.create(G.substitute(B.Messenger.Templates.conversationarea.baseTemplate,O));L.append(this._boundingBox);this._messageAreaNode=L.one("div.message-area");this._contentBox=L.one("div.yui3-yim-conversation-area-content");this.recentMessageListNode=this._messageAreaNode.one("ul.recent");this.bindUI();},bindUI:function(){this._eventHandles.push(this._contentBox.on("mousewheel",B.bind(this._onConvAreaScroll,this)));this._eventHandles.push(this._contentBox.on("mousedown",B.bind(this._onMouseDown,this)));this._eventHandles.push(this._boundingBox.delegate("click",this._handleNotificationButtonClick,"button.notification-button",this));this._eventHandles.push(this._boundingBox.delegate("click",this._handleNotificationCloseClick,".notification span.close",this));},userUpdated:function(K){var M=this._contentBox,Q=M.one(".typing"),O,N,P,L;if(Q&&K){P='<div class="typing hidden">'+B.Messenger.Intl.get("str_conv_typing")+"</div>";L=G.substitute(P,{conversation_user:K.displayname});O=H.create(L);Q.replace(O);}},updateDisplayImage:function(L){var K=this._contentBox.all("li>span>img");this.set("theirImgUrl",L);K.each(function(O){if(!O.ancestor("li").hasClass("self")){var N=O.get("height"),M=O.get("width");O.set("src",L);O.set("width",M);O.set("height",N);}},this);},updateSelfDisplayImage:function(L){var K=this._contentBox.all("li>span>img");this.set("myImgUrl",L);K.each(function(O){if(O.ancestor("li").hasClass("self")){var N=O.get("height"),M=O.get("width");O.set("src",L);O.set("width",M);O.set("height",N);}},this);},_onConvAreaScroll:function(L){L.preventDefault();var K=this._contentBox,N=K.get("scrollTop"),M=10;M=(L.wheelDelta<5?25:(L.wheelDelta<10?10:(L.wheelDelta<40?4:2)));K.set("scrollTop",N-(L.wheelDelta*M));},resize:function(Q){var L=this._boundingBox,K=this._contentBox,O=K.get("scrollTop"),M=K.get("scrollHeight"),N=K.get("clientHeight"),P=this.get("autoscroll")&&((M-O-N)<10);if(typeof(Q.top)!="undefined"){L.setStyle("top",Q.top);}if(typeof(Q.bottom)!="undefined"){L.setStyle("bottom",Q.bottom);}this.onResize(P);},onResize:function(K){this.resizeConversationPane();if(K){this.scrollToBottom();}},getState:function(){return{messageContent:this._contentBox.getContent(),staticNotifications:this._boundingBox.one(".notification-area").getContent(),state:this._currentState};},setState:function(L){this._contentBox.setContent(L.messageContent);if(L.staticNotifications){this._boundingBox.one(".notification-area").setContent(L.staticNotifications);this.resizeConversationPane();}var K=this._boundingBox.all("div.message-area");if(K.size()){this._messageAreaNode=K.item(K.size()-1);}this.recentMessageListNode=this._boundingBox.one("ul.recent");K=this._contentBox.all(".messageGroupContainer");if(K.size()){this._currentGroup=K.item(K.size()-1);}this._currentState=L.state;this.scrollToBottom();},resizeConversationPane:function(){var K=this._contentBox,M=this._boundingBox.one(".notification-area"),N=0,L=0;if(!M.hasChildNodes()){M.addClass("hidden");K.removeClass("no-round-border");}else{M.removeClass("hidden");K.addClass("no-round-border");N=M.get("clientHeight");}L=N+7;if(L!==this._oldConvAreaTop){K.setStyle("top",L+"px");this._oldConvAreaTop=L;}},selectAll:function(){var K=this._contentBox.one(".message-area");if(K){G.selectNode(K._node,B.config.win);}},renderNotification:function(K){var S=B.Messenger.Templates.conversationarea,b=K.buttons||[],R=K.type||D.NOTIFICATION_INLINE,e=K.icon,Z=K.showclose,N=K.closeHandler,P=null,V=K.message||"",U="yui3-yim-notification-message",Y="yui3-yim-notification-buttons",c=K.autoDestroy,W=K.id,T=K.className||"",M,L,a,g,Q,d,f;if(!W){throw new Error("ConversationArea : renderNotification called with no id property");}if(b.length===0){Y+=" hidden";}f={messageContainerClass:U,buttonContainerClass:Y,notifyClass:T,notifyId:W,notifyType:K.className||"",autoDestroy:c};if(R===D.NOTIFICATION_INLINE_PLAINTEXT){L=B.Node.create(G.substitute(S.textNotificationTemplate,f));}else{L=B.Node.create(G.substitute(S.notificationTemplate,f));if(Z!==false&&(R===D.NOTIFICATION_STATICTOP||R===D.NOTIFICATION_STATIC_RED)){Z=true;}}P=L.one("."+U);if(R===D.NOTIFICATION_INLINE_PLAINTEXT){P.setContent(B.Node.create(V));
}else{P.setContent(B.Node.create("<em>"+V+"</em>"));}if(Z){M=L.one(".close");if(M){M.removeClass("hidden");P.addClass("closeable");if(N){this._notificationCloseCallbacks[W]=N;}}}if(b.length){this._notificationCallbacks[W]=[];a=L.one("."+Y);for(var X=0;X<b.length;X++){g=b[X];if(!g.label||!g.callback){continue;}Q=B.Node.create(G.substitute(S.notificationButtonTemplate,{buttonClass:"btn small yui3-yim-notification-button",buttonLabel:g.label,buttonIndex:X}));this._notificationCallbacks[W].push(g.callback);for(var O in g){if(g.hasOwnProperty(O)){switch(O){case"label":break;case"class":Q.addClass(g[O]);break;default:Q.setAttribute(O,g[O]);}}}a.appendChild(Q);}}switch(R){case D.NOTIFICATION_STATICTOP:L.addClass(I.STATIC_NOTIFY_CLASS);L.addClass("notice");L.addClass("staticnotice");break;case D.NOTIFICATION_INLINE_PLAINTEXT:L.addClass("yui3-yim-notification-plain");break;case D.NOTIFICATION_STATIC_RED:L.addClass(I.STATIC_NOTIFY_CLASS);L.addClass("alert");break;case D.NOTIFICATION_INLINE_RED:L.addClass("yui3-yim-notification-inline");L.addClass("alert");break;case D.NOTIFICATION_INLINE:default:L.addClass("yui3-yim-notification-inline");L.addClass("notice");break;}if(R===D.NOTIFICATION_STATICTOP||R===D.NOTIFICATION_STATIC_RED){d=this._boundingBox.one(".notification-area");d.append(L);this.resizeConversationPane();}else{if(R===D.NOTIFICATION_INLINE_TOP){this.recentMessageListNode.insert(L,"after");}else{this._messageAreaNode.append(L);if(this.messageListNode){this.messageListNode.destroy();this.messageListNode=null;}this._currentState.startNewGroup=true;}this.scrollToBottom();}},_handleNotificationButtonClick:function(L){var M=L.target.ancestor("div.notification",false),O=M.getAttribute("data-id"),N=L.target.getAttribute("data-index"),K=M.hasClass(I.STATIC_NOTIFY_CLASS);if(!this._notificationCallbacks[O]||!this._notificationCallbacks[O][N]){return;}this._notificationCallbacks[O][N](G.getConversationId(this.get("alias"),this.get("user"),this.get("network")));if(M.getAttribute("data-autodestroy")=="true"){M.remove(true);delete this._notificationCallbacks[O];if(K){this.resizeConversationPane();}}},_handleNotificationCloseClick:function(K){var L=K.target.ancestor("div.notification",false),N=L.getAttribute("data-id");if(this._notificationCloseCallbacks[N]){try{this._notificationCloseCallbacks[N]();}catch(M){}}this.destroyNotification(N);},getNotificationsByClassName:function(K){return this._boundingBox.all("."+K);},getNotification:function(K){return this._boundingBox.one('div[data-id="'+K+'"]');},hasNotification:function(L){var K=this._boundingBox.one('div[data-id="'+L+'"]');return K&&K._node;},destroyNotificationsByClassName:function(M){var L=this.getNotificationsByClassName(M),N,O,K=false;if(!L.size()){return;}while(L.size()){N=L.pop();O=N.getAttribute("data-id");this.destroyNotification(O);}},destroyNotification:function(M){var L=this._boundingBox.one('div[data-id="'+M+'"]'),K;if(L&&L._node){K=L.hasClass(I.STATIC_NOTIFY_CLASS);L.remove(true);if(this._notificationCallbacks[M]){delete this._notificationCallbacks[M];}if(this._notificationCloseCallbacks[M]){delete this._notificationCloseCallbacks[M];}if(K){this.resizeConversationPane();}}},setTypingStatus:function(K){var M=this._boundingBox.one(".typing"),L=this.atBottom();if(K===true){M.removeClass("hidden");}else{M.addClass("hidden");}if(L&&this.get("autoscroll")){this.scrollToBottom();}},clearConversationArea:function(){this._messageAreaNode.set("innerHTML","");},renderMessage:function(a){var W=this._boundingBox,k=this.atBottom(),S=false,t=this.get("network"),q=a.convId||G.getConversationId(this.get("alias"),this.get("user"),t),P=a.msg+"",L=a.hash,Z=false,Q,R=a.echo?true:false,n=a.echo,T=a.errorCode,h,l,g,V=!!a.isRecent,j,K,O=B.Messenger.Templates.conversationarea;if(a.stateXferMessage||V){g=B.one("div['data-hash'="+L+"]");if(g&&g._node){return;}}var Y="<h2 class='conv-separator'>  <div><b>{{type}}</b> {{timestamp}}{{interop_img}}</div></h2>",e=B.Messenger.Intl.get("str_conv_im"),U;if(this.get("network")=="facebook"){Y='<h2 class="conv-separator fb">  <div> {{timestamp}}</div> </h2>';}if(!this._currentState.firstMessageTimestamp){this._currentState.firstMessageTimestamp=Math.floor(+new Date/1000);}j=C.getContact(a.sender,t);if(j){K=j.displayname;}switch(a.type){case"message":e=V?"recent":B.Messenger.Intl.get("str_conv_im");break;case"sms":e=B.Messenger.Intl.get("str_conv_sms");break;default:e=B.Messenger.Intl.get("str_conv_im");break;}if(this.get("network")=="msn"){if(launchData.isSecure){U='<img src="https://s.yimg.com/ok/u/assets/sprite/default/16x16/opis-mode.png"; style="top:-543px;position:absolute;clip:rect(540px,34px,556px,-8px);padding:0px 8px;background-color: #FFFFFF;"/>';}else{U='<img src="http://mail.yimg.com/ok/u/assets/sprite/default/16x16/opis-mode.png"; style="top:-543px;position:absolute;clip:rect(540px,34px,556px,-8px);padding:0px 8px;background-color: #FFFFFF;"/>';}}else{U="";}if(!V&&(!this._currentState.lastMessage||(!a.offlineMessage&&this._currentState.lastMessage.type!==a.type))){var p=a.timeStamp?new Date(a.timeStamp*1000):new Date(),m;Q=B.DataType.Date.format(p,{format:launchData.dtf});if(launchData.intl==="tw"||launchData.intl==="hk"){Q=Q.replace("\u4e0a\u5348","AM");Q=Q.replace("\u4e0b\u5348","PM");}m=G.substitute(Y,{type:e,timestamp:Q,interop_img:U});this._currentState._lastConversationMsgType=e;if(this.get("notificationsEnabled")){this.renderNotification({message:m,type:D.NOTIFICATION_INLINE_PLAINTEXT,id:"MessageTypeChange"});}}this.set("showInputModeChange",false);if(V){if(this._recentMessagesTimer){this._recentMessagesTimer.cancel();delete this._recentMessagesTimer;this.recentMessageListNode.setContent("");}}if(!this.messageListNode){this.messageListNode=H.create(I.MESSAGE_LIST_TEMPLATE);this._messageAreaNode.append(this.messageListNode);}if(this._currentState.startNewGroup||(this._currentGroup&&(this._currentState.lastMessage&&(this._currentState.lastMessage.type!=a.type||this._currentState.lastMessage.echo!=a.echo)))){if(this._currentGroup){this._currentGroup.destroy();
this._currentGroup=null;}this._currentState.startNewGroup=false;}if(!this._currentGroup){this._currentGroup=B.Node.create(G.substitute(O.messageGroupTemplate,{activeState:"active",current:V?"recent":"current",self:R?" self":"",user_img_url:R?this.get("myImgUrl"):this.get("theirImgUrl"),fb_hidden_class:R||this.get("network")!="facebook"?"hidden":""}));if(V){this.recentMessageListNode.append(this._currentGroup);}else{this.messageListNode.append(this._currentGroup);}Z=true;}if(!this._currentGroup.get("parentNode")){if(V){this.recentMessageListNode.append(this._currentGroup);}else{this.messageListNode.append(this._currentGroup);}}var o=a.timeStamp?new Date(a.timeStamp*1000):new Date(),M=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds(),r="",s=R?((E.get("conversationStyle")=="text")?B.Messenger.Intl.get("str_conv_self_objective"):G.escapeHtml(a.sender)):G.escapeHtml(K||a.sender),f=B.Intl.bidiDirection(P)=="rtl",b="ltr",X,N=B.Messenger.Intl.isRTL()?"&nbsp;:&lrm;&nbsp;":":&lrm;&nbsp;",c="ltr";Q=B.DataType.Date.format(o,{format:launchData.dtf});if(!B.Messenger.Intl.isRTL()){if(f){r="rtl";b="rtl";X="rtl";c="rtl";}}else{if(B.Intl.bidiDirection(s)=="rtl"){N="&nbsp;"+N;}if(!f){r="ltr";b="rtl";X="ltr";}}h=B.Node.create(G.substitute(O.messageTemplate,{senderClasses:(!Z?"recurring":"")+R?" self":"",hash:L,timestamp:Q,time:a.timeStamp,nameSeparator:N,message:J.ymlToHtml(P,R,this.get("network")||"yahoo"),yid:s,messageClasses:r,messageDir:b,tsClass:X,tsDir:c,fromSelf:R,network:a.network}));if(!Z){h.addClass("submsg");}if(R){h.addClass("self");}this._currentGroup.append(h);if(R&&!V){S=true;}else{this.setTypingStatus(false);}if(S||(k&&this.get("autoscroll"))){this.scrollToBottom();}this._currentState.lastMessage=a;},getMessages:function(){var K=this._contentBox.all("div.yui3-conversation-message"),L=[];K.each(function(N){var M={content:N.one("span.msg-content-inner").get("text"),fromSelf:N.getAttribute("data-self")=="true",network:N.getAttribute("data-network"),time:N.getAttribute("data-time"),hash:N.getAttribute("data-hash")};L.push(M);});return L;},saveScrollPosition:function(){if(B.Messenger.WindowManager.getWindow(B.config.win.windowName).get("minimized")){this.scrollToBottom();}var K=this._contentBox;this.set("scrollpos",K.get("scrollTop"));},restoreScrollPosition:function(){if(this.atBottom()&&this.get("autoscroll")){this.scrollToBottom();}else{var K=this._contentBox;K.set("scrollTop",this.get("scrollpos"));}},atBottom:function(){var K=this._contentBox,M=(0.1*K.get("clientHeight")),L=(K.get("scrollHeight")-K.get("scrollTop")-M)<=K.get("clientHeight");return L;},scrollToBottom:function(){var K=this._contentBox;K.set("scrollTop",K.get("scrollHeight"));},_onMouseDown:function(K){this._contentBox.all(".timeStamp").addClass("hidden");B.once("mouseup",function(L){this._contentBox.all(".timeStamp").removeClass("hidden");},B.config.doc,this);},showRecentMessagesPending:function(){this.recentMessageListNode.removeClass("hidden");this.recentMessageListNode.setContent('<p class="yim-recent-message-loading">'+B.Messenger.Intl.get("str_comp_loadheader")+"</p>");this._recentMessagesTimer=B.later(10000,this,this._handleRecentMessagesTimeout);},_handleRecentMessagesTimeout:function(){this.recentMessageListNode.setContent('<p class="yim-recent-message-error">'+B.Messenger.Intl.get("str_error_loading_recent_messages")+"</p>");delete this._recentMessagesTimer;},hideRecentMessages:function(){this.recentMessageListNode.addClass("hidden");this.recentMessageListNode.setContent("");}});B.namespace("Messenger").ConversationArea=I;},"@VERSION@",{skinnable:true,requires:["node","datatype-date","contactsmanager","sessionmanager","yim-intl","common-ui-intl-bidi","ymlutil","globalconstants"]});YUI.add("contactlist",function(C){C.Node.DOM_EVENTS.beforedeactivate=1;var M=YUI.namespace("Messenger").Events,L=launchData.userPrefs,K=C.Messenger.CommonUtils,I=K.logRocketStats,F=YUI.namespace("Messenger.Metrics"),G=C.Messenger.GlobalConfig,A=C.Messenger.ContactScoring,H=C.Messenger.SessionManager,B=C.Messenger.ContactsManager,E=C.Messenger.Contact,D=C.Messenger.WindowAPI;function J(N){J.superclass.constructor.apply(this,arguments);}J.NAME="yim-contact-list";J.MINTY_PADDING_MINIMIZED=18;J.MINTY_PADDING=6;J.CONTACT_DOM_HEIGHT=40;J.CONTACT_IMAGE_TOLERANCE=2;J.LOADTIMER=null;J.FIXED_TOP_HEIGHT=160;J.FACEBOOK_GROUP_NAME=C.Messenger.Intl.get("str_cont_list_facebook_group_name");J.DEFAULT_GROUP_NAME=C.Messenger.Intl.get("str_cont_list_default_group_name");J.FACEBOOK_GROUP_ID=C.Messenger.Intl.get("str_cont_list_facebook_group_id");J.DEFAULT_MOBILE_GROUP_ID=C.Messenger.Intl.get("str_cont_list_default_mobile_group_id");J.DEFAULT_MOBILE_GROUP_NAME=C.Messenger.Intl.get("str_cont_list_default_mobile_group_name");J.DEFAULT_GROUP_ID=C.Messenger.Intl.get("str_cont_list_default_group_id");J.TOP_CONTACT_GROUP_NAME=C.Messenger.Intl.get("str_cont_list_top_contacts_group_name");J.RESIZE_MIN_DELAY=200;J.IMAGELOAD_MIN_DELAY=1000;J.ATTRS={showEmptyGroups:{value:true},groupSortOrder:{value:"ascending",setter:function(N){return N==="descending"?N:"ascending";}},showOffline:{value:G.get("showOfflineContacts")},showMobileContacts:{value:false},loggedInUserVisible:{value:true},showGroups:{value:true},actionEvent:{value:"dblclick"},selectionEvent:{value:"click"},sortBy:{value:"presenceAndName"},boundingBox:{value:null}};C.extend(J,C.Base,{initializer:function(){this._groups={};this._sortedGroupIds=[];this._eventListeners=[];this._initialTop=null;this._topContacts=null;this._tcMapping={};if(window.openmail){callInternal("setListener",{event:"tab.changed"},C.bind(this._resizeContactList,this));callInternal("setListener",{event:"browser.resize"},C.bind(this.loadDisplayImages,this));openmail.Application.setListener({event:"folderpane.scroll"},C.bind(this.loadDisplayImages,this));}},destructor:function(){while(this._eventListeners.length){var N=this._eventListeners.shift();if(N){N.detach();}}this._destroyAllContacts();if(this._resizeTimer){this._resizeTimer.cancel();}if(J.LOADTIMER){J.LOADTIMER.cancel();}},render:function(N){var P=G.get("contactListImageSize"),O=C.Node.create('<div class="yui3-yim-contact-list images_'+P+'"></div>');log("ContactList render method invoked");N.append(O);this.set("boundingBox",O);if(window.openmail){this._createDefaultGroup();}this._createFacebookGroup();this._renderGroups();this._resizeContactList();if(window.openmail){launchData.timers.loadedEvent=(new Date()).getTime();callInternal("event.fire",{event:"mim.changestate",args:{state:"loaded"}});log("T4 Beacon Fired");}this._attachEvents();},_attachEvents:function(){this._eventListeners.push(C.Global.on(M.NETWORK_ERROR,C.bind(this.onNetworkError,this)));this._eventListeners.push(C.Global.on(M.NETWORK_ERROR_RESOLVED,C.bind(this.onNetworkFixed,this)));var N=H.isOnline();this._connectionUpdated({isOnline:N});this._eventListeners.push(C.Global.on(M.CONNECTION_UPDATE,C.bind(this._connectionUpdated,this)));this._eventListeners.push(C.Global.on(M.LOGOUT_FACEBOOK,C.bind(this._destroyFacebook,this)));this._eventListeners.push(C.Global.on(M.CONTACTLIST_RESIZED,C.bind(this._resizeContactList,this)));var O=this.get("boundingBox");function P(S,Q){var R;if((R=S.all(".vitality a"))){R.set("tabIndex",Q);}}if(!window.openmail){this._eventListeners.push(C.delegate(this.get("actionEvent"),this.handleActionEvent,O,"li",this));this._eventListeners.push(C.delegate(this.get("selectionEvent"),this.handleSelectionEvent,O,"li",this));this._eventListeners.push(C.delegate("keydown",this.handleKeyboardInput,O,"li",this));}else{this.set("actionEvent","click");this._eventListeners.push(C.delegate(this.get("actionEvent"),this.handleActionEvent,O,"li",this));this._eventListeners.push(O.delegate("keydown",function(Q){if(Q.keyCode===13){Q.halt();this.toggleGroupExpand(Q);}},"h2 span.label",this));this._eventListeners.push(O.delegate("mousedown",function(Q){if(Q.button===1&&!Q.ctrlKey){if(C.UA.ie){C.one(document.activeElement).once("beforedeactivate",function(R){R.preventDefault();});}else{Q.preventDefault();}}},"h2 span[role=button], h2 input"));this._eventListeners.push(C.Global.on(M.CONTACTLIST_RESIZED,function(){O.all(".items-nav-msgr-contacts").each(function(S){var R=S.one("ul[role=listbox]"),Q;if((Q=R.one("a[role=option]"))){Q.set("tabIndex",0);}});}));this._eventListeners.push(C.Global.on(M.SIGNOUT_CANCELLED,C.bind(function(){this._toggleOnlineButton(this._groups[J.DEFAULT_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"online");},this)));this._eventListeners.push(O.delegate("keydown",function(T){var S=T.target,R,Q;if(T.keyCode==38||T.keyCode==40){T.halt();R=S.ancestor("li")[T.keyCode==40?"next":"previous"]();if(R){S.set("tabIndex",-1);P(S.ancestor("li"),-1);Q=R.one("a[role=option]");Q.set("tabIndex",0);P(R,0);Q.focus();}}},"a[role=option]",this));}this._eventListeners.push(C.delegate("click",this.toggleGroupExpand,O,"h2 span.label",this));this._eventListeners.push(C.delegate("contextmenu",this.handleRightClickEvent,O,"li",this));this._eventListeners.push(G.after("contactListImageSizeChange",C.bind(function(Q){var S="images_"+Q.prevVal,T="images_"+Q.newVal,R=this.get("boundingBox");R.removeClass(S);R.addClass(T);this._resizeContactList();},this)));this._eventListeners.push(G.after("showOfflineContactsChange",function(Q){var S=Q.newVal,R,T;this.set("showOffline",S);if(!G.get("useTopContacts")){for(R in this._groups){if(this._groups.hasOwnProperty(R)&&R!=J.FACEBOOK_GROUP_ID){T=this._groups[R];T.set("showOffline",S);T.destroyAllContacts();}}this.addContacts(B.getContacts(!this.get("showOffline")));}},this));this._eventListeners.push(G.after("hideAddressBookContactsChange",function(Q){for(var R in this._groups){if(this._groups.hasOwnProperty(R)&&R!=J.FACEBOOK_GROUP_ID){var S=this._groups[R];
S.destroyAllContacts();}}A.refreshTopContacts();if(!G.get("useTopContacts")){this.addContacts(B.getContacts(!this.get("showOffline")));}else{A._topContactsLoaded=false;A.getTopContacts(C.bind(function(T){this._setTopContacts(T);if(A.constructor.TOP_CONTACT_MIN_COUNT<=T.length){C.one("#tc_toggle").removeClass("hidden");}else{this._switchTopContacts();}},this));}},this));this._addContactEventListeners();},_addContactEventListeners:function(){this._eventListeners.push(C.Global.on(M.CONTACTS_ADDED,C.bind(this.addContacts,this)));this._eventListeners.push(C.Global.on(M.CONTACTS_UPDATED,C.bind(this.onIncomingStatus,this)));var N=C.Messenger.SessionManager.get("presenceState");this.set("loggedInUserVisible",(N!=-1));this._eventListeners.push(C.Global.on(M.SELF_PRESENCE_CHANGED,C.bind(this._loggedInUserPresenceUpdated,this)));this._eventListeners.push(C.Global.on(M.VISIBILITY_CHANGED,C.bind(this._updatedVisibility,this)));this._eventListeners.push(C.Global.on(M.CONTACT_IMAGE_UPDATED,this._updateDisplayImage,this));this._eventListeners.push(C.Global.on(M.CONTACT_AUTHORIZE_RESPONSE,C.bind(this._onContactAuthorizeResponse,this)));this._eventListeners.push(C.Global.on(M.CONTACT_REMOVED_FROM_GROUP,C.bind(this.removeContactFromGroup,this)));this._eventListeners.push(C.Global.on(M.CONTACT_MOVED,this._boundContactMoved));},handleToggleTc:function(N){this._switchTopContacts();if(G.get("useTopContacts")){I({key:"switchToTopContacts",value:""});}else{I({key:"switchToOnlineContacts",value:""});}return false;},_switchTopContacts:function(){this._groups[J.DEFAULT_GROUP_ID].destroyAllContacts(false);if(G.get("useTopContacts")){G.set("useTopContacts",false);this._groups[J.DEFAULT_GROUP_ID].set("showOffline",this.get("showOffline"));this._groups[J.DEFAULT_GROUP_ID].set("sortBy","name");this._groups[J.DEFAULT_GROUP_ID].updateGroupName(J.DEFAULT_GROUP_NAME);this._groups[J.DEFAULT_GROUP_ID].set("emptyGroupMessage",C.Messenger.Intl.get("str_cont_list_default_group_offline"));this._tcMapping={};this._topContactsLoaded=false;this.addContacts(B.getContacts(!this.get("showOffline")));}else{G.set("useTopContacts",true);this._groups[J.DEFAULT_GROUP_ID].updateGroupName(J.TOP_CONTACT_GROUP_NAME);this._groups[J.DEFAULT_GROUP_ID].set("showOffline",true);this._groups[J.DEFAULT_GROUP_ID].set("sortBy","score");this._groups[J.DEFAULT_GROUP_ID].set("emptyGroupMessage","");A.getTopContacts(C.bind(this._setTopContacts,this));}C.one("#tc_toggle").toggleClass("tc_tc").toggleClass("tc_regular");},_setTopContacts:function(N){var P=[];this._topContacts=N;for(var O=0;O<this._topContacts.length;O++){this._tcMapping[this._topContacts[O].userId]=true;var Q=this._topContacts[O].userId.split("~");P.push(B.getContact(Q[0],Q[1]));}this.addContacts(P);this._topContactsLoaded=true;},recordLoadStats:function(){F.ClResponsive=new Date().getTime();var N=(F.ClResponsive-F.appInit);I({key:"loginTime",value:N});if(window.openmail){callInternal("event.fire",{state:"launch"});}},addContacts:function(b){var Y,c,W,Q={},O={},T,X=this.get("showOffline"),P=this.get("showEmptyGroups"),a=this.get("sortBy"),S=false,Z,N;if(!H.isOnline()){return;}for(var V=0;V<b.length;V++){Y=b[V];N=[Y.user,Y.network].join("~");if(Y.network=="sms"&&!this.get("showMobileContacts")){continue;}if(Y.presence.state==-1&&!(X||G.get("useTopContacts"))){continue;}if(G.get("useTopContacts")&&Y.network!="facebook"&&!this._tcMapping[N]){continue;}if(G.get("hideAddressBookContacts")&&Y.type=="addressbook"){continue;}W=B.getContactGroups(Y);for(var R=0;R<W.length;R++){T=W[R];if(this._groups[T]){if(!O[T]){O[T]=[];}O[T].push(Y);}else{S=true;if(!Q[T]){Q[T]=[];}Q[T].push(Y);}}}if(S){for(T in Q){if(Q.hasOwnProperty(T)){b=Q[T];Z=!H.isOnline()||(L&&L.expandGroups===0);if(window.openmail){if(T===J.DEFAULT_MOBILE_GROUP_ID){this._groups[T]=new C.Messenger.ContactGroup({sortBy:a,showOffline:true,showIfEmpty:false,id:T,name:J.DEFAULT_MOBILE_GROUP_NAME,isMobile:true,startCollapsed:Z});}else{this._groups[T]=new C.Messenger.ContactGroup({sortBy:a,showOffline:X,showIfEmpty:P,id:T,name:T,startCollapsed:Z});}}else{this._groups[T]=new C.Messenger.ContactGroup({sortBy:a,showOffline:X,showIfEmpty:P,id:T,name:T,startCollapsed:Z});}this._groups[T].addContacts(b);if(window.openmail){this._eventListeners.push(this._groups[T].on("yim:contactGroupResized",this._resizeContactList,this));}this._sortedGroupIds.push(T);}}this._sortGroupIds();this._renderGroups();}for(T in O){if(O.hasOwnProperty(T)){this._groups[T].addContacts(O[T]);}}if(window.openmail){if(G.get("topContactsEnabled")){var U=C.one("#tc_toggle");if(U){if(G.get("useTopContacts")||B.getIMContactCount()>=A.constructor.TOP_CONTACT_MIN_COUNT){U.removeClass("hidden");}else{U.addClass("hidden");}}}}this._resizeContactList();},removeContactFromGroup:function(O){var N=O.user,P=O.network,Q=O.group;if(this._groups[Q]){this._groups[Q].removeContact(N,P);}},_createFacebookGroup:function(){if(G.get("fbEnabled")&&!this._groups[J.FACEBOOK_GROUP_ID]){var R=!H.isOnlineFacebook()||(L&&L.fbgroupExpandPref===0),Q=[],N=H.isOnlineFacebook()?"in":"out";this._sortedGroupIds.push(J.FACEBOOK_GROUP_ID);Q.push({btn_class:"signin-btn",btn_title:C.Messenger.Intl.get("str_cont_list_facebook_group_name"),btn_id:"btn-signin-facebook",css_class:"icon ymsgr_fbsignin "+N,input_value:"",callback:C.bind(this._toggleFacebookPresence,this)});this._groups[J.FACEBOOK_GROUP_ID]=new C.Messenger.ContactGroup({sortBy:this.get("sortBy"),showOffline:false,showIfEmpty:this.get("showEmptyGroups"),id:J.FACEBOOK_GROUP_ID,name:J.FACEBOOK_GROUP_NAME,startCollapsed:R,buttons:Q});this._eventListeners.push(this._groups[J.FACEBOOK_GROUP_ID].on("yim:contactGroupResized",this._resizeContactList,this));this._eventListeners.push(C.Global.on(M.LOGIN_FACEBOOK,function(){this._toggleOnlineButton(this._groups[J.FACEBOOK_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"online");this._groups[J.FACEBOOK_GROUP_ID].set("emptyGroupMessage","");},this));if(!H.isOnlineFacebook()){var P=C.Messenger.Intl.get("str_label_sign_in_facebookchat"),O=K.substitute(C.Messenger.Intl.get("str_cont_list_facebook_sign_out_msg"),{bttn_img:"<span class='ymsgr_fbsignin out'>"+P+"</span>"});
this._groups[J.FACEBOOK_GROUP_ID].set("emptyGroupMessage",O);}else{this._groups[J.FACEBOOK_GROUP_ID].set("emptyGroupMessage",C.Messenger.Intl.get("str_cont_list_default_group_offline"));}}},_createDefaultGroup:function(){var R=this.get("showOffline"),N=this.get("showEmptyGroups"),U=this.get("sortBy"),S=!H.isOnline()||(L&&L.expandGroups===0),Q=H.isOnline()?"in":"out",O=G.get("useTopContacts");var P=J.DEFAULT_GROUP_ID,V,T=[];if(O){V=J.TOP_CONTACT_GROUP_NAME;}else{V=J.DEFAULT_GROUP_NAME;}this._sortedGroupIds.push(P);if(launchData.cobrand=="nokia"){T.push({btn_class:"msgr-options",btn_title:K.substitute(C.Messenger.Intl.get("str_menu_messenger_options"),{str_cfg_branding_messenger:G.getGenericAppName()}),btn_id:"btn-options-messenger",css_class:"icon edit msgr-options-btn",input_value:"",callback:function(){C.Global.fire(M.SHOW_WINDOW,"OptionsWindow");}});}T.push({btn_class:"signin-btn",btn_title:K.substitute(C.Messenger.Intl.get("str_menu_sign_in_messenger"),{str_cfg_branding_messenger:G.getGenericAppName()}),btn_id:"btn-signin-messenger",css_class:"icon ymsgr_fbsignin "+Q,input_value:"",callback:C.bind(this._toggleMessengerPresence,this)});this._groups[P]=new C.Messenger.ContactGroup({showAdd:true,sortBy:O?"score":U,showOffline:O?true:R,showIfEmpty:N,name:V,id:P,startCollapsed:S,buttons:T,emptyGroupMessage:O?C.Messenger.Intl.get("str_cont_list_top_contacts_empty"):C.Messenger.Intl.get("str_cont_list_default_group_offline")});},_toggleOnlineButton:function(P,S){var R=P.one("input"),O=R._node.id.indexOf("facebook")>-1;R.removeClass("loading");R.removeClass("in");R.removeClass("out");switch(S){case"offline":var N=!O?K.substitute(C.Messenger.Intl.get("str_menu_sign_in_messenger"),{str_cfg_branding_messenger:G.getGenericAppName()}):C.Messenger.Intl.get("str_menu_sign_in_facebookchat");R.addClass("out");R.set("value",N);P.setAttribute("title",N);break;case"online":var Q=!O?K.substitute(C.Messenger.Intl.get("str_menu_sign_out_messenger"),{str_cfg_branding_messenger:G.getGenericAppName()}):C.Messenger.Intl.get("str_menu_sign_out_facebookchat");R.addClass("in");R.set("value",Q);P.setAttribute("title",Q);break;case"loading":R.addClass("loading");break;default:}},_toggleMessengerPresence:function(){C.Messenger.SessionManager.toggleMessengerPresence();this._toggleOnlineButton(this._groups[J.DEFAULT_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"loading");},_toggleFacebookPresence:function(){C.Messenger.SessionManager.toggleFacebookPresence();this._toggleOnlineButton(this._groups[J.FACEBOOK_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"loading");},moveContact:function(Q,P,R,N,O){},getGroups:function(){return this._groups;},getSortedGroups:function(){var O=[],N;for(N=0;N<this._sortedGroupIds.length;N++){O.push(this._groups[this._sortedGroupIds[N]]);}return O;},getNumGroups:function(){return this._sortedGroupIds.length;},getGroupNames:function(){var P,N=[],O,Q;for(P=0;P<this._sortedGroupIds.length;P++){O=this._sortedGroupIds[P];Q=this._groups[O].get("name");N.push(Q);}return N;},loadDisplayImages:function(){if(this._imgLoadPending){return;}if(this._isAllGroupsCollapsed()||G.get("contactListImageSize")=="none"||this.get("boundingBox").all("li").size()===0){return;}this._imgLoadPending=true;if(!this._previousImageLoad){this._loadImages();return;}else{var N=(new Date()).getTime()-this._previousImageLoad;if(N<J.IMAGELOAD_MIN_DELAY){this._imageLoadTimer=C.later(J.IMAGELOAD_MIN_DELAY-N,this,function(){this._imageLoadTimer=null;this._loadImages();});}else{this._loadImages();}}},_loadImages:function(){var N=C.config.win.windowName;D.GetPosAndSize(N,C.bind(function(O){if(!O){return;}D.GetViewport(C.bind(function(S){this._imgLoadPending=false;if(!S){return;}var W=this.getAllSortedVisibleContacts(),V=W[0]||null,P,T,Q,U=O.top-S.y0;if(C.Lang.isNull(this._initialTop)){this._initialTop=U;}if(V){var R=C.one("#"+V.getNodeID());if(R){J.CONTACT_DOM_HEIGHT=R.get("region").height;}}if(J.CONTACT_DOM_HEIGHT<=0){return;}Q=S.dy-U;if(C.Lang.isNumber(Q)&&C.Lang.isNumber(J.CONTACT_DOM_HEIGHT)){T=Q/J.CONTACT_DOM_HEIGHT;P=0;}else{P=0;T=W.length;}if((O.top-J.FIXED_TOP_HEIGHT)<0){var X=(this._initialTop-J.FIXED_TOP_HEIGHT)/J.CONTACT_DOM_HEIGHT;P=(this._initialTop-U)/J.CONTACT_DOM_HEIGHT;P-=(X+4);}this._fetchVisibleImages(P,T,W);},this));},this));},_fetchVisibleImages:function(U,P,N){this._previousImageLoad=(new Date()).getTime();U=Math.floor(U-J.CONTACT_IMAGE_TOLERANCE);P=Math.ceil(P+J.CONTACT_IMAGE_TOLERANCE);P=P<N.length?P:N.length;for(var R=U;R<P;R++){var Q=N[R],O,T,S=null;if(Q){S=C.one("#"+Q.getNodeImageID());if(S){T=S.get("src");O=Q.getDisplayImageUrl();if(O&&(!T||O!=T)){S.set("src",O);}}}}},getAllSortedVisibleContacts:function(){var O=this.getSortedGroups(),N=[];C.each(O,function(Q,P,R){if(Q&&!Q.isCollapsed()){N=N.concat(Q.getContacts());}});return N;},onIncomingStatus:function(U){var W={},X=[],T;for(var R=0;R<U.length;R++){var S=U[R],N=B.getContactGroups(S),V,Q,O=[S.user,S.network].join("~");if(G.get("useTopContacts")&&S.network!="facebook"&&!this._tcMapping[O]){continue;}if(G.get("hideAddressBookContacts")&&S.type=="addressbook"){continue;}for(var P=0;P<N.length;P++){Q=N[P];if(!this._groups[Q]){X.push(S);break;}else{if(!W[Q]){W[Q]={};}W[Q][O]=S;}}}if(X.length>0){this.addContacts(X);}for(Q in W){if(W.hasOwnProperty(Q)){V=W[Q];T=[];for(O in V){if(V.hasOwnProperty(O)){T.push(V[O]);}}this._groups[Q].updateContacts(T);}}this._resizeContactList();},handleActionEvent:function(N){if(!window.openmail&&this.convPicker){this.convPicker.clearSelection();}if(N.shiftKey&&(N.ctrlKey||N.metaKey)){return;}if(N.target.hasClass("link")){C.Global.fire(M.CLOSE_CONTACT_MENU);return false;}N.halt();var O=N.currentTarget.getAttribute("data-user"),P=N.currentTarget.getAttribute("data-network"),Q="im";if(!F.openConvWindowStart){F.openConvWindowStart=new Date().getTime();}if(F.openConvWindowStart&&F.openConvWindowEnd&&!F.openConvWindowStartAgain){F.openConvWindowStartAgain=new Date().getTime();}if(N.currentTarget.hasClass("ymsg-mobile")){Q="sms";
}C.Global.fire(M.SHOW_CONVERSATION,{user:O,network:P,openedBySelf:true,mode:Q});N.currentTarget.removeClass("selected");callInternal("event.fire",{event:"mt:click",action:(P=="facebook")?"fb_frnd":"mim_frnd"});},handleSelectionEvent:function(N){N.halt();if(!window.openmail&&this.convPicker){this.convPicker.clearSelection();}var P=N.ctrlKey||N.metaKey,O=this.get("boundingBox");C.Global.fire(M.CLOSE_CONTACT_MENU);if(P){if(N.currentTarget.hasClass("selected")){N.currentTarget.removeClass("selected");}else{N.currentTarget.addClass("selected");}}else{O.all("ul li.selected").removeClass("selected");N.currentTarget.addClass("selected");this.set("currentSelection",N.currentTarget);if(N.target&&N.target.hasClass("link")){window.open(N.target.get("href"),"_blank");}}N.currentTarget.one("a").focus();},handleRightClickEvent:function(N){var O=this.get("boundingBox"),P=N.currentTarget.getAttribute("data-user"),R=N.currentTarget.getAttribute("data-network");N.halt();O.all("ul li.selected").removeClass("selected");var Q=N.currentTarget.ancestor("ul li.btn-contact",true);Q.one("a").blur();Q.ancestor(".items-nav ul",true).all("li").removeClass("contact-menu");Q.addClass("contact-menu");C.Global.once(M.CONTACT_MENU_CLOSED,C.bind(function(){this.removeClass("contact-menu");this.removeClass("selected");},N.currentTarget));var S=function(V){var T=V.left+N.clientX,U=V.top+N.clientY;C.Messenger.WindowManager.showWindow("ContactMenuWindow",{left:T,top:U},{user:P,network:R});};D.GetPosAndSize(C.config.win.windowName,S);},handleKeyboardInput:function(S){var Q=this.get("boundingBox"),R=S.currentTarget,N,P,O;S.halt();C.Global.fire(M.CLOSE_CONTACT_MENU);if(S.keyCode===38||S.keyCode===40){Q.all("ul li.selected").removeClass("selected");P=Q.all("div.expanded ul li");if(R){O=P.indexOf(R);if(S.keyCode===40){if(O===P.size()-1){N=P.item(0);}else{N=P.item(O+1);}}else{if(O===0){N=P.item(P.size()-1);}else{N=P.item(O-1);}}if(N){this.set("currentSelection",N);N.addClass("selected");N.scrollIntoView();N.one("a").focus();}}}else{if(S.keyCode===13){this.handleActionEvent(S);}}},toggleGroupExpand:function(S){var T=S.currentTarget.get("parentNode"),O=unescape(T.get("id")),R=T.get("parentNode"),Q=R.one(".label"),N=null,P;if(R.hasClass("expanded")){N=0;R.removeClass("expanded");R.addClass("collapsed");R.all("li").removeClass("selected");Q.set("aria-expanded",false);P="collapsed";}else{if(R.hasClass("collapsed")){N=1;R.removeClass("collapsed");R.addClass("expanded");R.all("li").removeClass("selected");Q.set("aria-expanded",true);P="expanded";}}this.set("currentSelection",null);this._resizeContactList(true);C.Global.fire(M.GROUP_COLLAPSE_CHANGE,{groupId:O,state:P});},_loggedInUserPresenceUpdated:function(P){var Q=this.get("loggedInUserVisible"),N=this.get("boundingBox"),O=(P.state!=-1);if(Q!==O){this.set("loggedInUserVisible",O);N.all("ul li").each(function(R){E.updateStealthState(R);},this);}},_updatedVisibility:function(Q){var R=[Q.user,Q.network].join("~"),N=Q.visible,O=this.get("boundingBox"),P=O.all("ul li");if(P.size()>0){P.each(function(U){var S=U.getAttribute("data-user"),T=U.getAttribute("data-network");if(S+"~"+T===R){if(N){U.removeClass("stealth");U.setStyle("opacity",1);}else{U.addClass("stealth");U.setStyle("opacity",0.6);}}},this);}},_connectionUpdated:function(S){var N=C.one("#tc_toggle"),O,Q,P,R;this._enableMainWindow();if(!S.isOnline){if(this._groups[J.DEFAULT_GROUP_ID]){R=K.substitute(C.Messenger.Intl.get("str_label_sign_in_messenger"),{str_cfg_branding_messenger:G.getGenericAppName()});P=K.substitute(C.Messenger.Intl.get(G.get("isFresh")?"str_cont_list_default_group_sign_out_msg_fresh":"str_cont_list_default_group_sign_out_msg"),{bttn_img:"<span class='ymsgr_fbsignin out'>"+R+"</span>",str_cfg_branding_messenger:G.getGenericAppName()});this._groups[J.DEFAULT_GROUP_ID].set("emptyGroupMessage",P);}if(this._groups[J.FACEBOOK_GROUP_ID]){R=C.Messenger.Intl.get("str_label_sign_in_facebookchat");P=K.substitute(C.Messenger.Intl.get("str_cont_list_facebook_sign_out_msg"),{bttn_img:"<span class='ymsgr_fbsignin out'>"+R+"</span>"});this._groups[J.FACEBOOK_GROUP_ID].set("emptyGroupMessage",P);}this._destroyAllContacts(!window.openmail);if(window.openmail){for(O in this._groups){Q=this._groups[O].getDOMNode().one(".rht .btn.signin-btn");if(Q){this._toggleOnlineButton(Q,"offline");}}if(N){N.addClass("hidden");}}}else{if(window.openmail){this._toggleOnlineButton(this._groups[J.DEFAULT_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"online");if(N){N.removeClass("hidden");}if(this._groups[J.DEFAULT_GROUP_ID]){this._groups[J.DEFAULT_GROUP_ID].set("emptyGroupMessage",C.Messenger.Intl.get("str_cont_list_default_group_offline"));}if(G.get("useTopContacts")){A.getTopContacts(C.bind(function(T){this._setTopContacts(T);if(T.length>=A.constructor.TOP_CONTACT_MIN_COUNT){C.one("#tc_toggle").removeClass("hidden");}else{this._switchTopContacts();}},this));this.addContacts(B.getFacebookContacts());}else{if(B.isPresenceAvailable()||this.get("showOffline")){this.addContacts(B.getContacts(!this.get("showOffline")));}}}}},_updateDisplayImage:function(O){var N=O.groups,Q,R=[O.user,O.network].join("~");if(G.get("useTopContacts")&&O.network!="facebook"&&!this._tcMapping[R]){return;}if(G.get("hideAddressBookContacts")&&O.type=="addressbook"){return;}if(window.openmail){if(O.network==="facebook"){Q=J.FACEBOOK_GROUP_ID;}else{Q=J.DEFAULT_GROUP_ID;}if(this._groups[Q]){this._groups[Q].updateDisplayImage(O);}}else{for(var P=0;P<N.length;P++){Q=N[P];if(this._groups[Q]){this._groups[Q].updateDisplayImage(O);}}}},_onContactAuthorizeResponse:function(R){var O=R.sender,Q=R.network||"yahoo",N=B.getContact(O,Q);if(N){if(R.authResponse==="deny"){for(var P=0;P<N.groups.length;P++){this.removeContactFromGroup(O,Q,N.groups[P]);}}}},_destroyAllContacts:function(O){for(var N in this._groups){if(this._groups.hasOwnProperty(N)){this._groups[N].destroyAllContacts();if(O){this._groups[N].destroy();}}}if(O){this._groups={};this._sortedGroupIds=[];}this._resizeContactList();},_destroyFacebook:function(){var P=this._groups[J.FACEBOOK_GROUP_ID];
if(P){var O=C.Messenger.Intl.get("str_label_sign_in_facebookchat"),N=K.substitute(C.Messenger.Intl.get("str_cont_list_facebook_sign_out_msg"),{bttn_img:"<span class='ymsgr_fbsignin out'>"+O+"</span>"});P.set("emptyGroupMessage",N);this.removeAllContactsForGroup(J.FACEBOOK_GROUP_ID);this._toggleOnlineButton(this._groups[J.FACEBOOK_GROUP_ID].getDOMNode().one(".rht .btn.signin-btn"),"offline");this._resizeContactList();}},removeAllContactsForGroup:function(N){if(!N){return;}var P=this._groups[N],O;if(P){P.destroyAllContacts();}else{}},_renderGroups:function(){var R,P,O,S,Q,N=false;for(P=0,O=this._sortedGroupIds.length;P<O;P++){R=this._groups[this._sortedGroupIds[P]];S=R.get("name");if(S&&(S!=="0")&&this._renderGroup(R,P)){N=true;}}if(N){Q=this.get("boundingBox").all(".items-nav-msgr-contacts");if(Q&&Q.size()>0){if(G.get("isFresh")){J.DEFAULT_GROUP_NAME=J.TOP_CONTACT_GROUP_NAME=C.Messenger.Intl.get("str_cfg_generic_messenger");if(Q.item(0)){Q.item(0).get("parentNode").addClass("minty-fresh");Q.item(0).one(".legend .label").set("innerHTML",J.DEFAULT_GROUP_NAME);}if(Q.item(1)){Q.item(1).remove();H.logoutFacebook();}}Q.removeClass("last-group");Q.item(Q.size()-1).addClass("last-group");}}if(window.openmail&&N){if(Q.item(0)){Q.item(0).on("click",function(U){var T="toggle";if(U.target&&U.target.hasClass("icon")){T=H.isOnline()?"signout":"signin";}callInternal("event.fire",{event:"mt:click",action:"mim_toggle",append:{ltxt:T}});});}if(Q.item(1)){Q.item(1).on("click",function(U){var T="toggle";if(U.target&&U.target.hasClass("icon")){T=H.isOnlineFacebook()?"signout":"signin";}callInternal("event.fire",{event:"mt:click",action:"fb_toggle",append:{ltxt:T}});});}}return N;},_renderGroup:function(S,P,R){var O=this.get("boundingBox"),N;if(!S.isRendered()){N=S.getDOMNode();if(P!==undefined){O.insert(N,P);}else{O.append(N);}if(G.get("topContactsEnabled")&&S.get("id")===J.DEFAULT_GROUP_ID){var Q=G.get("useTopContacts")?"tc_tc":"tc_regular";N.append(C.Node.create(K.substitute(C.Messenger.Templates.contactlist.topContactsButton,{tc_class:Q})));this._eventListeners.push(N.one("#tc_toggle").on("click",C.bind(this.handleToggleTc,this)));}return true;}return false;},_sortGroupIds:function(){var P=this.get("groupSortOrder"),O=window.openmail?J.DEFAULT_MOBILE_GROUP_ID:"",Q=J.FACEBOOK_GROUP_ID;function N(T,S){var R,U;if(T===O||T===Q){return 1;}else{if(S===O||S===Q){return -1;}}if(P==="ascending"){R=T.toLowerCase();U=S.toLowerCase();}else{R=S.toLowerCase();U=T.toLowerCase();}return((R<U)?-1:((R>U)?1:0));}this._sortedGroupIds.sort(N);},_resizeContactList:function(){var O,N;if(window.openmail){if(!this._resizeTimer){if(!this._previousResize){N=C.Messenger.WindowManager.getWindow(C.config.win.windowName);if(N&&!N.get("cssLoaded")){this._resizeTimer=N.after("cssLoadedChange",C.bind(function(){this._resizeTimer.detach();this._resizeTimer=null;this._doResize();},this));}else{this._doResize();}return;}else{O=(new Date()).getTime()-this._previousResize;if(O<J.RESIZE_MIN_DELAY){this._resizeTimer=C.later(J.RESIZE_MIN_DELAY-O,this,function(){this._resizeTimer=null;this._doResize();});}else{this._doResize();}}}}},_doResize:function(){var P=window.openmail,N,O=this._isAllGroupsCollapsed();this._previousResize=(new Date()).getTime();if(C.config.doc.getElementById("bottomMarker")!==null){N=C.config.doc.getElementById("bottomMarker").offsetTop;}if(N==0&&!this._isAllGroupsHidden()){return;}if(P&&N!==this._lastHeightSet){D.SetSize(C.config.win.windowName,null,N);this._lastHeightSet=N;}if(J.LOADTIMER){J.LOADTIMER.cancel();J.LOADTIMER=null;}C.later(50,this,this.loadDisplayImages);},_getGroupCount:function(){return this._sortedGroupIds.length||0;},_isAllGroupsCollapsed:function(){for(var O=0,N=this._sortedGroupIds.length;O<N;O++){if(!this._groups[this._sortedGroupIds[O]].isCollapsed()){return false;}}return true;},_isAllGroupsHidden:function(){for(var O=0,N=this._sortedGroupIds.length;O<N;O++){if(!this._groups[this._sortedGroupIds[O]].isHidden()){return false;}}return true;},onNetworkError:function(N){this._disableMainWindow();},onNetworkFixed:function(N){this._enableMainWindow();},_enableMainWindow:function(){var N;N=C.Messenger.WindowManager.getWindow(C.config.win.windowName);if(N){N.enableWindow();}this.get("boundingBox").removeClass("disconnected");},_disableMainWindow:function(){var N;N=C.Messenger.WindowManager.getWindow(C.config.win.windowName);if(N){N.disableWindow(true);}this.get("boundingBox").addClass("disconnected");}});C.namespace("Messenger").ContactList=J;},"@VERSION@",{skinnable:true,requires:["intl","yim-intl","command","sessionmanager","om-window-api","contactgroup","base-base","node","contactscoring","conversationarea"]});