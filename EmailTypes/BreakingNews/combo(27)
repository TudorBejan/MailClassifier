YUI.add("_shared_module_send_confirm_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_rollup={base:'<div class="content send-confirm"> <div class="col-a" aria-live="polite" role="document"> <div class="box box-iso"> <h3 class="loading">{{str_comp_sending}}</h3></div> <div class="box box-iso hidden"> {{sending_error_else}} </div> <div class="box box-iso hidden"> {{sending_error}} </div> {{is_im}} </div> <div class="col-b"> {{is_mon}} {{is_lrec}} </div> </div>',msg_replied_to:'<h3 class="from">{{from}}</h3> <p class="subj">{{subject}}</p> <p class="snippet">{{snippet}}</p> ',is_reply:'<div class="items replied-to"> <h2 class="legend"><span class="label"><b>{{str_comp_original_msg}}</b></span></h2> {{msg_replied_to}} <div> <span class="btn left right small menu" data-action="menu"> <a title="{{str_move}}" href="#">{{str_move}}<b></b></a> </span> <span class="btn left right small"> <a title="{{str_delete}}" href="#">{{str_delete}}<b></b></a> </span> </div></div> ',message_sent_success:'<h3 class="success"><i></i><span class="msg">{{str_comp_email_sent}}</span></h3><div class="offset"> <span class="btn default left right"><a href="{{url_minty_inbox}}" data-action="navigate" role="button">{{str_comp_done}}</a></span></div>',new_recipients:"underline",contacts_not_in_ab:'<li> <span class="btn lozenge btn-contact small left" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span><span class="btn lozenge lozengeadd right small btn-kiosk-addcontact" data-name="{{name}}" data-address="{{email_id}}" data-action="modal"> <a role = "button" title="{{str_btn_add_recipient_attr}}" href="#">&nbsp;</a> </span> </li> ',contacts_in_ab:'<li> <span class="btn lozenge btn-contact left small right" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span> </li> ',global_auto_add_contacts:'checked=""',new_recipients1:'<div class="field"> <div class="checkbox"> <label><input type="checkbox" {{global_auto_add_contacts}} class="checkbox"> {{str_comp_auto_add_to_contacts}} </label> </div> </div>',sending_error_else:'{{message_sent_success}} <div class="items {{new_recipients}}"> <h2 class="legend"><span class="label"><b>{{str_comp_recipients}}</b></span></h2> <ul class="inline-items"> <span class = "lozengeContainer"> {{contacts_not_in_ab}} {{contacts_in_ab}} </span> </ul></div>{{new_recipients1}} {{is_reply}} ',sending_error:'<h3 class="error"> <span class = "error-logo"></span> {{sending_error_msg}}</h3><div>{{sending_error_detail}}</div> ',is_im:'<div id="jp_ads_sc_module"></div> <div id="jp_ads_im_sent"></div> ',is_mon:'<div id="slot_MON_sent" class="ch_mod gxBoom boom"><div id="tgtMON_sent" ></div></div> ',is_lrec:'<div id="slot_LREC_sent"><div id="tgtLREC_sent" class="darla" tabindex="-1" hidefocus="true"></div></div> '};},"1.0.0");YUI.add("mail-model-send",function(D){var C=function(){C.superclass.constructor.apply(this,arguments);};var B={oSendData:null,initializer:function(){this.oSendData={cascade:{message:{subject:null,from:null,to:null,cc:null,bcc:null,replyto:{name:null,email:null},simplebody:{html:null,text:null,attachment:null}}},origin:{fid:null,oMsg:null,action:null},draftMID:null,cid:null,requestState:null,requestId:0};},destructor:function(){},reset:function(){delete this.oSendData;this.initializer();},_setHeader:function(F){for(var E in F){if(E){this.oSendData.cascade.message[E]=F[E];}}},_setContentHTML:function(E){this.oSendData.cascade.message.simplebody.html=E;},_setContentText:function(E){this.oSendData.cascade.message.simplebody.text=E;},_setAttachments:function(E){this.oSendData.cascade.message.simplebody.attachment=E;},_setOrigin:function(E){this.oSendData.origin=E;if(E.action&&E.action!="edit"&&E.fid&&E.oMsg&&E.oMsg&&E.oMsg.mid){this.oSendData.cascade.messageReference={fid:E.fid,mid:E.oMsg.mid,replied:E.action=="reply_all"||E.action=="reply_sender",forwarded:E.action=="forward"};}},_getOrigin:function(){return this.oSendData.origin;},_setDraftMID:function(E){this.oSendData.draftMID=E;},_getDraftMID:function(){return this.oSendData.draftMID;},_setCaptcha:function(F){if(!this.oSendData.cascade.headers){this.oSendData.cascade.headers={};}for(var E in F){if(E){this.oSendData.cascade.headers[E]=F[E];}}},_getRecipients:function(){return{to:this.oSendData.cascade.message.to,cc:this.oSendData.cascade.message.cc,bcc:this.oSendData.cascade.message.bcc};},_getCascade:function(){return this.oSendData.cascade;},_setCID:function(E){this.oSendData.cid=E;},_getCID:function(){return this.oSendData.cid;},_getRequestState:function(){return this.oSendData.requestState;},_setRequestState:function(E){this.oSendData.requestState=E;},_getRequestId:function(){return this.oSendData.requestId;},_setRequestId:function(E){this.oSendData.requestId=E;}};D.extend(C,D.Base,B,{NAME:"sendModel",ATTRS:{header:{setter:B._setHeader},contenthtml:{setter:B._setContentHTML},contenttext:{setter:B._setContentText},attachments:{setter:B._setAttachments},origin:{setter:B._setOrigin,getter:B._getOrigin},draftMID:{setter:B._setDraftMID,getter:B._getDraftMID},captcha:{setter:B._setCaptcha},recipients:{getter:B._getRecipients},cascade:{getter:B._getCascade},sendaction:{},disableaddcontact:{},cid:{setter:B._setCID,getter:B._getCID},requestState:{setter:B._setRequestState,getter:B._getRequestState},requestId:{setter:B._setRequestId,getter:B._getRequestId}}});var A=new function(){var F=this;function E(){var G=new C();return G;}D.mix(F,{createModel:E});};D.namespace("mail.model");D.mail.model.SendModel=C;D.mail.model.SendModelFactory=A;},"1.0.0",{requires:["base"]});YUI.add("mail-controller-sendconfirm",function(E){var a=E.mail,D=a.Controller,V=D.extend("SendConfirm"),F=E.common.Utils,K=D.Messages,U=E.contacts,G=U.config,I=U.api,T=U.utils,R=a.model.DataStore,Z=R.Messages,P="forward",O=E.common.persist.UserData,L=F.rocketstats,B=null,C=45000,S=90000,Q=S+15000;function A(e,b){var n,g=e.get("origin"),p,d,j,m=[],f=(!e.get("disableaddcontact")&&(O.get("userSendPref.addUnknownContact")=="always"))?true:false,c=e.get("api"),h=function(){},Y={success:h,failure:h},l=function(r){try{if(r){E.mail.Controller.Messages.remove({fid:"Draft",mid:r,force:true},Y);}}catch(q){L.stat("SEND","PostSend:FailedToDeleteDraft");}};n={success:function(r,w){if(!NeoConfig.isFresh){e.set("requestState","success");}W();p=e.get("draftMID");d=e.get("keepDraft");j=e.get("cid");var s=M(w.args.sdo);s.contactsAdded=0;if(!NeoConfig.isAMT&&f&&s.unknown.length>0){var q={guid:NeoConfig.neoguid,requestFn:E.common.net.SessionMgr.requestProxy,wspath:NeoConfig.socdirProxyPath,success:h,failure:h};G.setAttrs(q);s.contactsAdded=s.unknown.length;E.Array.each(s.unknown,function(AA){m.push({fields:[{type:"email",value:AA.email}]});});s.known=s.known.concat(s.unknown);s.unknown=[];I.saveContacts(m);}e.set("sendaction",{action:"success",args:{addy:s,mid:r.mid}});try{if(g.fid&&g.oMsg){var u={fid:g.fid,mid:[g.oMsg],setFlags:g.action==P?{"forwarded":1}:{"replied":1}};K.flag(u,{suppressCodes:["*"]});}}catch(v){L.stat("SEND","PostSend:FailedToSetFlag");}if(!strings.str_cfg_tog_sendconfirm_keep_draft&&d!==true){l(p);}try{if(j){var y=e.get("cascade").message,z={mid:r.mid,cid:j,fid:"Sent",snippet:J(e),sourceFolderInfo:{fid:"Sent"},receivedDate:Math.floor((new Date().getTime())/1000),flags:{"isRead":1},from:y.from,toEmail:y.to,subject:y.subject};a.model.ConvStore.Conversations.msgAdd(j,null,z);}else{Z.set("Sent",r.mid,"add");}}catch(v){L.stat("SEND","PostSend:FailedToSetSent");}if(c==true){if(!NeoConfig.tmpForceAdSendTest){var x=R.Folders.get(g.fid),t=a.ui.common.StringUtils.getSystemFolderName(g.fid,x.folderInfo.name);E.use("mail-ui-messagepane-utils",function(AA){AA.fire("darlaEvent",{action:"sent_api",value:{siteAttr:a.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(g.oMsg,g.fid),foldername:t}});});}}else{E.fire("SentSuccess",g);}b&&b.stop();L.stat("SEND","Success");},failure:function(r,v){var q=v.args.sdo,s=r.code,u=r.fault,t=u&&u.message,w;if(!NeoConfig.isFresh){q.set("requestState","failure");}q.set("requestId",0);W();switch(s){case"Client.HumanVerificationRequired":case"Client.WrongInput":case"Client.InputTooEarly":case"Client.CannotSendThisMessage":case"Client.AccountVerificationRequired":q.set("sendaction",{action:"captcha",args:{fault:u}});L.intlStat("SEND","Failure:Captcha");break;case"Client.TimedOut":q.set("sendaction",{action:"captcha",args:{fault:u}});if(!NeoConfig.isFresh){q.set("requestState","clientTimeout");}L.intlStat("SEND","Failure:Captcha");break;case"Client.UserAbuseDetected":q.set("sendaction",{action:"abuse",args:null});p=q.get("draftMID");l(p);L.intlStat("SEND","Failure:Error:"+s);break;case"Server.SendMessageFailed":w=(t&&t.indexOf("Failed to get")>=0)?":FailedToGet":":Other";L.intlStat("SEND","Failure:Error:"+s+w);if(t){E.use("common-utils-error",function(){F.error.report("Send Failure: "+t);});}default:q.set("sendaction",{action:"error",args:{fault:u}});if(s==="timeout"&&!NeoConfig.isFresh){q.set("requestState","clientTimeout");}L.intlStat("SEND","Failure:Error:"+s);break;}},args:{sdo:e},timeout:S,suppressCodes:"*"};if(b){b.bodySize=0;if(e.get("contenthtml")){b.bodySize+=e.get("contenthtml").length;}if(e.get("contenttext")){b.bodySize+=e.get("contenttext").length;}b.attachCount=e.get("attachments").length;b.start(1,"msgSend");}L.stat("SEND","Attempt");if(e.get("origin").action==="om:app"){n.appid="MyPhotos";}if(NeoConfig.tmpForceAdSendTest&&!NeoConfig.isFresh){var o,k,i;if(g.action=="reply_all"||g.action=="reply_sender"||g.action=="forward"){k=R.Folders.get(g.fid);i=a.ui.common.StringUtils.getSystemFolderName(g.fid,k.folderInfo.name);o={siteAttr:a.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(g.oMsg,g.fid),foldername:i};}E.use("mail-ui-messagepane-utils",function(q){q.fire("darlaEvent",{action:"sent",value:o});});}if(e.get("requestId")!=0){L.stat("SEND","DuplicateSend");}else{e.set("requestId",Math.random());}E.mail.Controller.Messages.send(e.get("cascade"),n);N(e);E.fire("Y.mail.sendMessage",e);}function N(Y){if(B){B.cancel();}B=E.later(Q,this,function(b){b.set("sendaction",{action:"error",args:{fault:{code:strings["str_modal_generic_err"]}}});L.stat("SEND","Send: NetTimeout");if(!NeoConfig.isFresh){b.set("requestState","netTimeout");}},[Y],false);}function W(){if(B){B.cancel();B=null;}}function J(c){var d,b,Y=40;d=E.Lang.trim(c.get("contenttext"));if(((b=d.indexOf("\n"))!=-1)&&(b<Y)){Y=b;}return d.substring(0,Y);}function H(c,d){var e=c.auto,b={destination:{fid:"Draft"},message:c.sdo.get("cascade").message},Y={success:function(f){var h=b.message,i=c.cid,g={mid:f.mid,flags:{},header:{from:h.from,to:h.to,cc:h.cc,bcc:h.bcc,subject:h.subject,replyto:h.replyto}};if(i){g.cid=i;g.fid="Draft";g.flags={"isRead":1};g.snippet=J(c.sdo);g.header.sourceFolderInfo={fid:"Draft"};g.header.receivedDate=Math.floor((new Date().getTime())/1000);a.model.ConvStore.Conversations.msgAdd(i,null,g);}else{Z.set("Draft",g,"add");}if(c.mid){Z.remove("Draft",c.mid,true);}if(d){d(f.mid,0);}},failure:function(f){if(d){d(f.mid,-1);}},args:{sdo:c.sdo,auto:e},timeout:!e&&C,suppressCodes:e?["*"]:["Client.MessageNotFound"]};c.mid?b.destination.mid=c.mid:"";if(c.appid){Y.appid=c.appid;}E.mail.Controller.Messages.save(b,Y);}function X(){return function(d){var l=[],Y=[],f,j,b=[],g=d.get("recipients"),c=[g.to,g.cc,g.bcc],e,h,k;for(f=0,j=c.length;f<j;++f){e=E.Array.each(c[f],function(i){b.push(i);});}for(f=0,j=b.length;f<j;++f){h=(T.getContactsByEmail(b[f].email)||[])[0];if(h&&h.id>=0){if(!b[f].name){k=T.getFirstFieldValue(h,"name")||{};b[f].givenName=k.givenName;b[f].familyName=k.familyName;}b[f].cid=h.id;l.push(b[f]);
}else{if(O.isUsersEmailAddress(b[f].email)){l.push(b[f]);}else{Y.push(b[f]);}}}return{known:l,unknown:Y};};}var M=X();E.mix(V,{sendMessage:A,saveMessage:H},true);},"3.0.0",{requires:["mail-controller-base","mail-model-send","contacts-api-utils","contacts-api","mail-controller-messages-ops","rocket-stats","common-utils-stats"]});YUI.add("_shared_module_send_confirm_recipients_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_recipients_rollup={base:'<div class="items {{new_recipients}}"> <h2 class="legend"><span class="label"><b>{{str_comp_recipients}}</b></span></h2> <ul class="inline-items"> <span class = "lozengeContainer"> {{contacts_not_in_ab}} {{contacts_in_ab}} </span> </ul></div>{{new_recipients1}}',new_recipients:"underline",contacts_not_in_ab:'<li> <span class="btn lozenge btn-contact small left" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span><span class="btn lozenge lozengeadd right small btn-kiosk-addcontact" data-name="{{name}}" data-address="{{email_id}}" data-action="modal"> <a role = "button" title="{{str_btn_add_recipient_attr}}" href="#">&nbsp;</a> </span> </li> ',contacts_in_ab:'<li> <span class="btn lozenge btn-contact left small right" data-name="{{name}}" data-address="{{email_id}}" data-action="contact-menu"> <a role = "button" title="{{str_btn_recipient_lozenge_attr}}" href="#">{{msg_display_name}}</a> </span> </li> ',global_auto_add_contacts:'checked=""',new_recipients1:'<div class="field"> <div class="checkbox"> <label><input type="checkbox" {{global_auto_add_contacts}} class="checkbox"> {{str_comp_auto_add_to_contacts}} </label> </div> </div>'};},"1.0.0");YUI.add("minty_module_toolbar_inbox_sent_msg_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_inbox_sent_msg_rollup={base:'<div id="pagetoolbar" class="{{msgliststate}}"> <span class="bevel_divider"></span> {{is_reply}} {{sending_error}}</div>',is_reply:'<span class="btn left right hidden"><a href="#" data-action="back-to-message" title="{{str_toolbar_back_to_message}}">{{str_toolbar_back_to_message}}</a></span> <span class="btn left hidden"><a class="icon prev" href="#" data-action="prev" title="{{str_next_attr}}"><i>{{str_next}}</i></a></span><span class="btn right hidden"><a class="icon next" href="#" data-action="next" title="{{str_previous_attr}}"><i>{{str_previous}}</i></a></span> ',backtomsg:'<span class="btn left right btn-back"><a href="#" data-action="backtomsg" title="{{str_comp_back_to_msg_attr}}">{{str_comp_back_to_msg}}</a></span>',tryagain:'<span class="btn left right btn-retry"><a href="#" data-action="retry" title="{{str_comp_try_again_attr}}">{{str_comp_try_again}}</a></span>',abuse:'<span class="btn left right"><a href="#" data-action="navigate">{{str_comp_done}}</a></span>',sending_error:"{{backtomsg}}{{tryagain}}{{abuse}} "};},"1.0.0");YUI.add("_shared_module_send_confirm_captcha_blocked",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_send_confirm_captcha_blocked={base:"{{message_blocked}}{{account_blocked}}",message_blocked:'<div class="error"> <span class="error-logo"></span> <strong>{{str_comp_captcha_msg}}</strong> <p>{{str_comp_captcha_msg_suspicious_activity}}</p> <p>{{str_comp_captcha_msg_contact_cust_care}}</p> <p>{{str_comp_captcha_apology}}</p></div>',account_blocked:'<div class="error"> <span class="error-logo"></span> <strong>{{str_comp_captcha_account}}</strong> <p>{{str_comp_captcha_account_suspicious_activity}}</p> <p>{{str_comp_captcha_account_contact_cust_care}}</p> <p>{{str_comp_captcha_apology}}</p></div>'};},"1.0.0");YUI.add("comms-lozenge",function(D){var C=D.Lang;var B=D.comms.Utils.escapeHtml;function A(E){A.superclass.constructor.apply(this,arguments);}A.NAME="lozenge";A.ATTRS={data:{value:{value:""},setter:"_setData"},segmentCount:{value:1},segmentTypes:{value:[]},segmentHovers:{value:[]},labelSegment:{value:0},label:{valueFn:"_defEscapeDataValueFn"},validate:{value:false},error:{value:false},selectable:{value:true},selected:{value:false}};A.LOZENGE_TEMPLATE='<span class="lozengeSegment {segclass}"><a tabindex="0" role="button">{label}</a></span>';D.extend(A,D.Widget,{initializer:function(F){var E=F.data||{};if(this.get("validate")){this.set("error",this._isError(E));}},destructor:function(){this._lozengeNode=null;},renderUI:function(){var I,E,J,G,H,L,M,F=[],K;E=this.get("segmentCount");J=this.get("segmentTypes");L=this.get("labelSegment");K=this.get("contentBox");M=this.get("label");for(I=0;I<E;I++){G=D.substitute(A.LOZENGE_TEMPLATE,{label:(L==I)?M:"",segclass:J[I]});H=D.Node.create(G);F.push(H);if(I==L){this._lozengeNode=H;}K.appendChild(H);}F[0].addClass("left");F[E-1].addClass("right");},bindUI:function(){this.after("dataChange",this._afterDataChange);this.before("selectedChange",this._beforeSelectedChange);this.after("selectedChange",this._afterSelectedChange);this.after("errorChange",this._afterErrorChange);this.get("contentBox").delegate("click",this._onClick,".lozengeSegment",this);},syncUI:function(){this._updateUI();var E=this.get("boundingBox");E.lozengeObj=this;},removeSegment:function(F){var K,E,I,J,H,G;K=this.get("segmentCount");if(F<0||F>(K-1)){return;}if(K==1){}E=this.get("segmentTypes");I=this.get("labelSegment");J=this.get("contentBox");H=J.all(".lozengeSegment");G=H.item(F);K--;if(K){if(F==0){H.item(1).addClass("left");}else{if(F==K){H.item(K-1).addClass("right");}}}G.remove(true);E.splice(F,1);this.set("segmentCount",K);if(F==I){I=null;}},_defDataValueFn:function(){var E=this;return function(){return E.get("data").value||"";};},_defEscapeDataValueFn:function(){var E=this;return B(E.get("data").value||"");},_isError:function(E){E=E||this.get("data");return !!(E.value);},_setData:function(E,F){E=E||"";if(typeof(E)!=="object"){return{value:E.toString()};}return E;},_afterDataChange:function(F){var E=B((F.newVal.value)?F.newVal.value:F.newVal);this.set("label",E);this.get("segmentHovers")[this.get("labelSegment")]=E;this._updateUI();},_afterSelectedChange:function(F){var E=this.get("boundingBox");if(F.newVal){E.addClass("lozengeSelected");}else{E.removeClass("lozengeSelected");}},_beforeSelectedChange:function(E){if(!this.get("selectable")){E.preventDefault();}},_afterErrorChange:function(F){var E=this.get("boundingBox");if(F.newVal){E.addClass("lozengeError");}else{E.removeClass("lozengeError");}},_onClick:function(G){var E=this.get("contentBox");var I=this.get("segmentTypes");var H=E.all(".lozengeSegment");var F=H.indexOf(G.currentTarget);this.fire(this.name+":segmentClick",F,I[F]);},_updateUI:function(){var F,I,K,H=this.get("boundingBox"),J=this.get("contentBox").all(".lozengeSegment"),L=this.get("segmentCount"),E=this.get("segmentHovers"),G=this.get("labelSegment");for(F=0;F<L;F++){I=J.item(F);K=I.one("a");I.setAttribute("title",E[F]);if(F==G){K.setContent(this.get("label"));}else{K.setContent("&nbsp;<b></b>");}}if(this.get("error")){H.addClass("lozengeError");}else{H.removeClass("lozengeError");}if(this.get("selected")){H.addClass("lozengeSelected");}else{H.removeClass("lozengeSelected");}}});A.prototype.BOUNDING_TEMPLATE="<li></li>";A.prototype.CONTENT_TEMPLATE="<span></span>";D.namespace("comms");D.comms.Lozenge=A;D.comms.LozengeUtils={updateABSegments:function(U,E){var K,J,O,H=[],L=[],N=[],Q,T,M,G,P,S,R,I,F=[];for(O in E){S="";M=E[O]["fields"];for(K=0,J=M.length;K<J;K++){T=M[K];if(T["type"]=="email"){P=T["value"];}else{if(T["type"]=="name"){G=T["value"];S=D.common.Utils.substitute(strings["str_name_format"],{given_name:G.givenName,family_name:G.familyName});}}}H.concat(E[O]["id"]||null);L=L.concat(P);N=N.concat(S||P);}I=U.all(".plus");I.each(function(Z){var W=Z.ancestor(".yui3-lozenge"),Y=W.lozengeObj,V=Y.get("data.email"),X="";for(R=0;R<L.length;R++){X=L[R];if(X==V){F.push(W);Y.removeSegment(1);Y.set("data",{name:N[R]||X,email:X,cid:H[R]});}}});return F;}};},"0.0.1",{requires:["node","widget","substitute","comms-utils"]});YUI.add("comms-lozenge-address",function(D){var C=D.Lang;var A=D.comms.Utils.escapeHtml;function B(){}B.ATTRS={data:{value:{name:"",email:"",isNN:""},setter:"_setData"},segmentCount:{value:2},segmentTypes:{value:["name","plus"]},labelSegment:{value:0},label:{valueFn:function(){var E=this.get("data");return A(E.name||E.email||"");}},segmentHovers:{valueFn:function(){var E=this.get("data");if(E.name==E.email){return["",""];}else{return[E.email,""];}}},validate:{value:true}};B.prototype={_isError:function(E){var F=(E&&E.data&&E.data.email)||this.get("data.email");if(F){return !(this._isValidEmail(F));}return false;},_setData:function(F,G){var E,H;if(typeof(F)!=="object"){E=F.toString();F={name:"",email:E};}else{if(!F.email){return D.Attribute.INVALID_VALUE;}}return F;},_isValidEmail:function(F){var K=this,J,I,E,G,H=/^([^@ ;:()\[\],<>\\]+@[^@ ;:()\[\],<>\\]+\.[^@ ;:()\[\],<>\\]+)/;F=F||K.get("data").email;if(!H.test(F)){return false;}G=F.split("@");J=G[0];I=G[1];if(!I||!J){return false;}G=I.split(".");E=G[1];if(!E){return false;}return F;},_afterDataChange:function(I){var H,G,J,F=I.newVal.name,E=I.newVal.email;if(!F||(F===E)){F=A(E);G="";}else{F=A(F);G=E;}this.set("label",F);J=this.get("labelSegment");this.set("segmentHovers."+J,G);if(this.get("validate")){H=this._isValidEmail(E);this.set("error",!H);}this._updateUI();}};D.namespace("comms");D.comms.LozengeAddressMod=B;D.comms.AddressLozenge=D.Base.create("addressLozenge",D.comms.Lozenge,[D.comms.LozengeAddressMod]);},"0.0.1",{requires:["base-build","comms-lozenge"]});YUI.add("mail-ui-sendconfirmview-base",function(D){var k=D.common.persist.UserData,W=D.mail.persist.MetaData,s=D.mail.Controller.SendConfirm,m=D.mail.Controller.Compose,R=D.ui.Templates,p=D.common.Utils,AA=D.common.Utils.substitute,F=R._shared_module_send_confirm_rollup,v,X=D.mail.ui.Toolbar,a=R._shared_module_send_confirm_recipients_rollup,M=D.Node.create,w="hidden",T=200,z=strings["str_cfg_tog_monster_ad_send_l10n"],Z=D.mail.ui.SearchBar,d=D.common.Utils.escapeHtml,g=p.rocketstats,B,h=NeoConfig.isFresh;var r=function(Y){var AF=this,AE,AC,AD,AB=Y.sdo;AF.title="Message Sent";AF.isReply=Y.isReply;AF.isForward=Y.isForward;AF.parent=null;AF.loading=null;AF.error=null;AF.success=null;AF.isAbuseDetected=false;AF.toolong=null;AF.author=Y.author;AF.mainCol=null;AF.sendingError=false;AF.sendingErrorElse=false;AF.autoAddContacts=(k.get("userSendPref.addUnknownContact")=="always"&&!NeoConfig.isAMT)?"always":"prompt";AF.focusNode=null;AF.adNode=null;AF.spinnerState="spinning";AF.formatters={msg_replied_to:function(){return"";},is_reply:function(){return"";},message_sent_success:function(){return AA(F.message_sent_success,{},AF.formatters,null,strings,R);},sending_error_else:function(){return AA(F.sending_error_else,{},AF.formatters,null,strings,R);},sending_error:function(){return AA(F.sending_error,{},AF.formatters,null,strings,R);},is_im:function(){return"";},is_reply_else:function(){return AF.isReply?AA(F.is_reply_else,{},AF.formatters,null,strings,R):"";},global_path_img:function(){return"/ued/assets/img";}};AF.tbFormatters={is_reply:function(){return(AF.isReply||AF.isForward)&&!AF.sendingError&&NeoConfig.send_confirm_nav_enabled?AA(v.is_reply,{},AF.tbFormatters,null,strings,R):"";},sending_error:function(AG){return AF.sendingError?AA(v.sending_error,AG,AF.tbFormatters,null,strings,R):"";},backtomsg:function(AG){return(AG&&!AG.backtomsg)?"":AA(v.backtomsg,AG,AF.tbFormatters,null,strings,R);},tryagain:function(AG){return(AG&&!AG.tryagain)?"":AA(v.tryagain,AG,AF.tbFormatters,null,strings,R);},abuse:function(AG){return(!AG||!AG.abuse)?"":AA(v.abuse,AG,AF.tbFormatters,null,strings,R);}};r.superclass.constructor.call(AF);AF.modifyAttr("canClose",{getter:AF.canWeClose});AF.on("closeChange",AF.handleCloseChange,AF);AF.after("activeChange",AF.handleAfterActiveChanged,AF);AF.updateToolbar();AF.setAllButtonState(false);AF.set("charCodes","13");AF.publish("showSendConfirm");AF.on("showSendConfirm",function(){var AG=setInterval(function(){var AI,AH;if(!AF.sdo){clearInterval(AG);g.stat("SEND","SendConfirm: CascadeReturnedUserSpun");return;}AI=AF.spinnerState;AH=AF.sdo.get("requestState");if(!AH){return;}if(AI==="finished"){switch(AH){case"success":case"failure":g.stat("SEND","SendConfirm: CascadeReturnedSpinStopped");clearInterval(AG);break;default:g.stat("SEND","SendConfirm: CascadeDidNotReturnSpinStopped");clearInterval(AG);break;}}else{if(AH==="clientTimeout"){g.stat("SEND","SendConfirm: ClientTimeoutSpinNotStopped");clearInterval(AG);}else{if(AH==="netTimeout"){g.stat("SEND","SendConfirm: NetTimeoutSpinNotStopped");clearInterval(AG);}else{if(AH==="success"||AH==="failure"){g.stat("SEND","SendConfirm: UIFailure: CascadeReturnedSpinGoing");clearInterval(AG);}}}}},3000);});AF.bindSDO(AB);};function o(AB){var AD=this,Y,AC;if(!h){AB=AB||{backtomsg:true,tryagain:true,abuse:false};AC=NeoConfig.hasConv?"minty_module_toolbar_inbox_sent_msg_thread_rollup":"minty_module_toolbar_inbox_sent_msg_rollup";D.use(AC,function(AE){v=R[AC];Y=M(AA(v.base,AB,AD.tbFormatters,null,strings,R));AD.author.attachToolbar(new X({root:Y}));});}}function n(Y){var AB=this;AB.sdo=Y;AB.sdo.after("sendactionChange",function(AC){var AD=AC.newVal.action;switch(AD){case"success":B=AC.newVal.args.addy;AB.showSuccess(AC.newVal.args.addy,AC.newVal.args.mid);break;case"captcha":AB.showCaptcha(AC.newVal.args.fault);break;case"error":AB.showError(null,null,AC.newVal.args.fault);break;case"abuse":AB.showAbuse(null,null,null);break;default:break;}AB.spinnerState="finished";});}function P(Y){var AC=this,AB=Y?Y.dataAction:0;switch(AB){case"back-to-message":case"next":case"prev":AC.author.backToMessageTab&&AC.author.backToMessageTab(AB);D.fire("mt:click",{action:"send-confirm-"+AB,spid:"msgread_tabview"});break;case"retry":AC.retrySendMessage();break;case"backtomsg":AC.backToMessage();break;default:break;}}function A(){var Y=this;if(h){Y.author.showComposeShim(false);}Y.resetLoading();if(Y.sendingError){Y.sendingError=false;}Y.hideStatusBoxes();Y.adNode&&Y.adNode.get("parentNode").removeChild(Y.adNode);Y.loading.removeClass(w);Y.updateToolbar();Y.set("forceClose",1);Y.author.removeChild(Y);Y.author.showCompose(true);}function t(AC){var Y=D.one("#pagetoolbar"),AB;AB=Y.all("a");AB.each(function(AD){if(AD.getAttribute("data-action")==AC){AD.ancestor().toggleClass("disabled");return;}});}function V(AC){if(D.Lang.type(AC)!="boolean"){return;}var Y=D.one("#pagetoolbar"),AB;if(Y){AB=Y.all("span");AB.each(function(AD){AD.removeClass("disabled");});}}function K(AB){var AD=this,AC=AB.keyCode,Y=false;switch(AC){case 13:if(!AB.ctrlKey&&!AB.metaKey&&!AB.altKey&&!AB.shiftKey){if(!AD.success.hasClass(w)){AB.target.simulate("click");Y=true;}else{Y=true;}}break;case 188:if(AB.metaKey){break;}case 190:if((AC==188||AC==190)&&!AB.ctrlKey){break;}AD.handleToolbarSelection({dataAction:(AC==188?"prev":"next")});Y=true;AB.halt();break;default:break;}return Y;}function N(){var AB=this,Y;Y=AB.success.one("input.checkbox").get("checked")?"always":"prompt";if(!NeoConfig.isAMT){if(AB.autoAddContacts!=Y){k.set("userSendPref.addUnknownContact",Y);k.saveOne("userSendPref.addUnknownContact");D.fire("mt:click",{action:"send-confirm-auto-add-contacts"});}}}function Q(AB){var AC=this,Y;if(AB.newVal==1&&!AC.success.hasClass(w)){if(AC.addToABHandler){D.detach(AC.addToABHandler);}if(AC.hSentSuccess){D.detach(AC.hSentSuccess);AC.hSentSuccess=null;}Y=D.all("body>#menu-contact-compact");if(Y){Y.remove();Y.destroy(true);}if(AC.success.one("input.checkbox")){AC.setAutoAddContacts();}AC.parent&&AC.parent.remove(true);
}}function j(){return false;}function f(AB){var Y;if(AB.newVal==1){NeoConfig.send_confirm_nav_enabled&&this.showToolbarButtons();}}function y(){var AB=this,Y;Y=AB.success.one(".btn");D.on("keydown",function(AC){if(AC.keyCode===32){AC.preventDefault();AC.target.simulate("click");}},Y,AB);D.on("click",function(AD){var AC={action:"send-confirm-done"};AD.halt();AB.nextSpaceId=null;AB.author.set("forceClose",1);AB.author.set("close",1);if(AB.nextSpaceId){AC.spid=AB.nextSpaceId;}D.fire("mt:click",AC);},Y,AB);AB.mainCol.delegate("click",function(AI){var AH=AI.currentTarget,AC=AH.lozengeObj,AD=AI.target,AE=AD.ancestor(".lozengeSegment",true),AG=AC.get("data.name"),AF=AC.get("data.email");if(AE.hasClass("plus")){if(AG===AF){AG="";}D.fire("addContact",AG,AF);D.fire("mt:click",{action:"send-confirm-lozenge-add"});}},".yui3-lozenge");AB.mainCol.all(".inline-items").on("keydown",function(AE){var AD=D.UA.os,AC=(AD=="windows"||AD=="win");if((AC&&AE.shiftKey&&AE.keyCode==121)||(!AC&&AE.ctrlKey&&AE.shiftKey&&AE.altKey&&AE.keyCode==77)){AE.preventDefault();p.simulateContextMenu(AE.target);}});AB.mainCol.all(".inline-items").on("contextmenu",function(AF){AF.halt();var AH=AF.target.ancestor(".yui3-lozenge"),AC,AD,AE,AG,AI=AF.target;if(D.Lang.isNull(AH)){return false;}AC=AH.lozengeObj;AD=AH.one(".lozengeSegment");AG=AC.get("data.name");AE=AC.get("data.email");D.use("contacts-ui-contact-popup",function(AM){var AJ=!AH.one(".plus"),AK=AC.get("data.cid")||"",AL={name:AG,email:AE,cid:AK,editable:false,inAB:AJ,copyable:true};AL.stateChangeCB=function(AN){if(AN.state=="show"){AH.addClass("lozenge-open-menu");}else{AH.removeClass("lozenge-open-menu");AI&&AI.focus();}};AM.mail.ContactPopup.showContactMenu(AM.mail.ContactPopup.TYPE_INTERMEDIATE,AD,AL);});return true;});AB.hSentSuccess=D.on("SentSuccess",function(AG){var AH=this,AC,AD,AF,AE=(B.contactsAdded==0&&B.unknown.length==0);AC=h?"0":W.get("cg.pref.general.showconfirmpage");if(!(NeoConfig.expUltMode!="0"&&NeoConfig.expBucketId=="scf_test")&&(D.Lang.isUndefined(AC)||!(AC=="0"||(AC=="n"&&AE)))){if(AG.action=="reply_all"||AG.action=="reply_sender"||AG.action=="forward"){AD=D.mail.model.DataStore.Folders.get(AG.fid);AF=D.mail.ui.common.StringUtils.getSystemFolderName(AG.fid,AD.folderInfo.name);D.use("mail-ui-messagepane-utils",function(AI){var AJ=this;AJ.fire("darlaEvent",{action:"sent",value:{siteAttr:AI.mail.ui.MessagePaneUtils.getAdSiteAttribsFromMesgObj(AG.oMsg,AG.fid),foldername:AF}});});}else{AH.fire("darlaEvent",{action:"sent"});}D.fire("mt:view",{action:"sendconfirm_full"});}});}function i(AC){var AD=this,AB,Y;if(AC){AD.parent=AC;Y=z?{is_mon:AA(F.is_mon,{},AD.formatters,null,strings,R)}:{is_lrec:F.is_lrec};AB=AA(F.base,Y,AD.formatters,null,strings,R);AC.append(M(AB));AD.mainCol=AC.one(".col-a");AD.loading=AD.mainCol.one(".loading").ancestor();AD.success=AD.mainCol.one(".success").ancestor();AD.error=AD.mainCol.one(".error").ancestor();AD.bindUI();}}function b(Y){var AB=this;AB.adNode=z?Y.one("#slot_MON_sent"):Y.one("#slot_LREC_sent");AB.adNode&&AB.adNode.addClass(w);}function O(){var Y=this;Y.hideStatusBoxes();Y.loading.removeClass(w);}function U(){var AD=this;var AC=true;if(AD.dirty==="ForceClose"){return true;}var Y=AD.isDirty();if(Y){AC=false;var AB='<span id="{{btnID}}ModalOverlay" class="btn left right {{default}}"><a href="#" data-action="{{btnID}}">{{btnLabel}}</a></span>';D.use("common-ui-dialog-helper",function(AJ){var AI=AA(AB,{btnID:"SaveDraft","default":"default",btnLabel:strings["str_comp_savetodrafts"]});var AE=AA(AB,{btnID:"DontSave",btnLabel:strings["str_comp_abandon"]});var AF=AA(AB,{btnID:"Continue",btnLabel:strings["str_comp_keepwriting"]});var AH={modal_classes:"lg",hd:strings["str_comp_close"],bd:strings["str_comp_close_confirm"],ft:AI+AE+AF};var AG={SaveDraft:{handler:function(){AD.author.composeView._invokeSaveDraft({forceSave:true});AD.dirty="ForceClose";AD.author.set("forceClose",1);AD.author.set("close",1);}},DontSave:{handler:function(){AD.dirty="ForceClose";AD.author.set("forceClose",1);AD.author.set("close",1);}},Continue:{handler:function(){AD.backToMessage();}}};AJ.common.ui.DialogHelper.createCommon(AH,AG);});}return AC;}function e(){var Y=this;Y.success.addClass(w);Y.loading.addClass(w);Y.error.addClass(w);}function H(AC,AG,AH){var AE=this,AI,AD,AJ,AF=["str_cascd_ExceededMaxTo","str_cascd_ExceededMaxCc","str_cascd_ExceededMaxBcc","str_cascd_ExceededMaxRecipients","str_cascd_ExceededMaxHourlyMessages","str_cascd_ExceededMaxDailyMessages","str_cascd_InvalidRecipientAddress"];AE.sendingError=true;AE.author.composeView.lastSendState="sndError";var AB={sending_error_detail:""},Y,AK;if(!AC){Y=AH.code.replace(/[^\.]*\./,"");AB.sending_error_detail=strings["str"+"_cascd_"+Y]||"["+Y+"]";}if(h){AK=D.mail.Errormap.getMessage({fault:AH})||"";AB.sending_error_detail=AK+" "+AB.sending_error_detail;AC=AC||function(){AB.sending_error_msg=strings.str_comp_not_sent;return AA(F.sending_error,AB,null,null,strings,R);}();AE.backToMessage();AE.author.notifyError({title:strings.str_error_SendMessageFailed,body:AC});}else{AC=AC||function(){AB.sending_error_msg=strings.str_comp_send_error;return AA(F.sending_error,null,null,null,AB,R);}();AE.updateToolbar(AG);AE.hideStatusBoxes();AI=AE.error.get("children");AI.each(function(AL){AL.remove();});AE.error.appendChild(M(AC));AE.error.removeClass(w);AD=D.one("a[data-action=backtomsg]");if(AD){AD.focus();}AJ=D.one("#pagetoolbar");if(AJ){D.delegate("keydown",function(AL){if(AL.keyCode===13){AL.target.simulate("click");}},AJ,"a",AE);}if(NeoConfig.tmpForceAdSendTest){AE.adNode&&AE.adNode.removeClass(w);}}}function I(AB,Y,AF){var AG=this,AE,AD,AC;if(!Y){Y={tryagain:false,backtomsg:false,abuse:true};}AG.isAbuseDetected=true;AG.sendingError=true;AG.author.composeView.lastSendState="sndError";if(h){AG.author.notifyAbuse();AG.author.set("forceClose",1);AG.author.set("close",1);}else{AB=AB||function(){var AH=[];AH.sending_error_msg=strings.str_comp_send_abuse_error;AH.sending_error_detail="";return AA(F.sending_error,null,null,null,AH,R);
}();AG.updateToolbar(Y);AG.hideStatusBoxes();AE=AG.error.get("children");AE.each(function(AH){AH.remove();});AD=D.one('#pagetoolbar a[data-action="navigate"]');D.on("keydown",function(AH){if(AH.keyCode===32||AH.keyCode===13){AH.preventDefault();AH.target.simulate("click");}},AD,AG);D.on("click",function(AH){AG.author.set("forceClose",1);AG.author.set("close",1);AH.halt();},AD,AG);AG.error.appendChild(M(AB));AG.error.removeClass(w);if(AD){AD.focus();}if(NeoConfig.tmpForceAdSendTest){AG.adNode&&AG.adNode.removeClass(w);}}}function L(Y){var AB=this;if(/AccountVerificationRequired/.test(Y.code)){AB.doBlocked({type:"account"},Y);return;}else{if(/CannotSendThisMessage/.test(Y.code)){AB.doBlocked({type:"message"},Y);return;}}if(NeoConfig.tmpForceAdSendTest){AB.adNode&&AB.adNode.removeClass(w);}D.use("mail-ui-captcha-controller",function(AE){var AF=AB.author.tab,AC,AD={data:Y.detail,contCbk:AE.bind(function(AG){AB.retrySendMessageWithCaptcha(AG);},AB),cancelCbk:AE.bind(function(){AB.backToMessage();},AB)};if(/Client.WrongInput/.test(Y.code)){AD.data.inputError=true;}else{AD.data.inputError=false;}AC=new AE.mail.ui.CaptchaController(AD);if(AF!=AE.mail.Tabs.getActiveTab()){AF.once("activeChange",function(AG){if(AG.newVal==1){AC.show();}});}else{AC.show();}});}function C(AF,AE){var AG=this,AB,Y,AC,AD=R._shared_module_send_confirm_captcha_blocked;Y={tryagain:false,backtomsg:true,abuse:false};AC=AF.type==="message"?AD.message_blocked:AD.account_blocked;AB=AA(AC,null,null,null,strings,R);AG.showError(AB,Y,AE);}function J(AB){var AC=this,Y;if(AB.value){AC.resetLoading();AC.sendingError=false;AC.updateToolbar();AC.setAllButtonState(false);if(AB.captchaView=="audio"){AC.sdo.set("captcha",{"X-HumanVerification-AudioUrl":AB.url,"X-HumanVerification-Answer":AB.value});}else{AC.sdo.set("captcha",{"X-HumanVerification-ImageUrl":AB.url,"X-HumanVerification-Answer":AB.value});}var Y=new p.Stopwatch("SendConfirm","start");Y.action="captcha";s.sendMessage(AC.sdo,Y);}}function E(){var AB=this,Y;AB.resetLoading();var Y=new p.Stopwatch("SendConfirm","start");Y.action="retry";s.sendMessage(AB.sdo,Y);}function S(){var Y=this;Y.sendingError=false;Y.updateToolbar();Y.hideStatusBoxes();Y.loading.removeClass(w);Y.loading.one("h3").set("text",strings["str_comp_sending"]);Y.spinnerState="spinning";}function G(AG,Ae){var AT=this,Af=AT.success.one(".inline-items"),Ab=h?"0":W.get("cg.pref.general.showconfirmpage"),Ah=AG.known,Ad=AG.unknown,AX,AW,AF,AK,AV,AZ,AR,Aa=Z.getSearchField(),AM=0,AQ,AL,AC,AS,AJ=[],AO="",AI=Ah.length+Ad.length,AE=5,AY=8,AH=0,AD=0,Ac=160,AB=AI>AE,AP=function(Ai){var Aj;if(Ai.name){return Ai.name;}else{if(Ai.first){Aj=AA(strings["str_name_format"],{given_name:Ai.first||"",middle_name:"",family_name:Ai.last||""});return Aj.replace("  "," ");}else{return Ai.email;}}};AT.responseMid=Ae;AT.after("activeChange",function(Ai){if(Ai.newVal==0){AT.author.set("forceClose",1);AT.author.set("close",1);}});AT.after("closeChange",function(Ai){if(Ai.newVal){AT.author.set("forceClose",1);AT.author.set("close",1);}},AT);D.once("tabChange",function(Ak){var Aj={"Inbox":"folderview_inbox","WHAT'S NEW":"welcome_gx","SEARCH":"search_results"},Ai=(Ak&&Ak.tab&&Ak.tab.label);AT.nextSpaceId=Ai?(Aj[Ai]||"message_tabpane"):null;});AT.on("activeChange",function(Ai){if(Ai.newVal==1){AT.fire("darlaEvent",{action:"sent"});}});if((NeoConfig.expUltMode!="0"&&NeoConfig.expBucketId=="scf_test")||(!D.Lang.isUndefined(Ab)&&(Ab=="0"||(Ab=="n"&&(AG.contactsAdded==0&&AG.unknown.length==0))))){if(AT.author.subview){AT.author.subview.dirty="ForceClose";}AT.author.set("forceClose",1);AT.author.set("close",1);if(h){var Y=new D.common.ui.Notification({type:"fade",className:"top"}),Ag={msg:{mid:AT.responseMid},fid:"Sent"},AN=D.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_success;Y.on("clickEvent",function(Ai){if(Ai.action=="view"){D.fire("openMessage",Ag);}});Y.notify(AA(AN,null,null,null,strings),4000);}return;}AT.setAllButtonState(true);AT.hideStatusBoxes();AT.success.removeClass(w);function AU(Al,Ak){var Am=Al.email,Aj=Am.toLowerCase(),Ai=Al.cid||"";if(D.Array.indexOf(AJ,Aj)==-1){AJ.push(Aj);AF=AP(Al);AK=(!AF||AF==Am)?"":Am;if(AB){AD+=AF.length;if(AM==AY||(AD>Ac&&AM>=AE)){AH=AI-AM;AB=false;}}AS={data:{name:AF,email:Am,cid:Ai},segmentHovers:[AK,AA(strings["str_btn_add_recipient_attr"],{email_id:Am})],segmentCount:Ak?1:2};AC=new D.comms.AddressLozenge(AS);AC.render(Af);if(AH){AC.get("boundingBox").addClass(w);}AM++;}}AX=Ad.length;if(AX){for(AW=0;AW<AX;AW++){AU(Ad[AW],false);}AO=AA(a.new_recipients1,{"global_auto_add_contacts":(AT.autoAddContacts=="always"?AA(a.global_auto_add_contacts,{},null,null,strings,AN):"")},null,null,strings,AN);AZ=M(AO);AT.success.appendChild(AZ);AL=function(Ap){var Al,Ao,Aj,An,Ai,Am=Ap.details[0],Ak=Am.created;An=D.comms.LozengeUtils.updateABSegments(Af,Ak);Ai=An.length;for(Al=0;Al<Ai;Al++){Ao=An[Al];if(Ao.menu){Aj=Ao.lozengeObj;D.mail.ContactPopup.updateContactMenu(Ao,{name:Aj.get("data.name"),email:Aj.get("data.email"),cid:Aj.get("data.cid")});}}};AT.addToABHandler=D.on("contacts:api:contactChanged",AL);}AJ=[];AX=Ah.length;if(AX){for(AW=0;AW<AX;AW++){AU(Ah[AW],true);}}if(AH){AO='<li style="vertical-align:top"><span style="vertical-align:baseline;" class="small btn left right" data-action="more"><a role="button" href="#" title="{{str_msg_hdr_btn_more_attr}}">{{str_msg_hdr_btn_more_to}}</a></span></li>';AO=AA(AO,{has_more_to:AH},null,null,strings,AN);AR=M(AO);Af.appendChild(AR);AQ=function(Ai){Af.all("li").each(function(Aj){Aj.removeClass(w);});AR.addClass(w);};D.on("click",AQ,AR);}AT.hideStatusBoxes();AT.success.removeClass(w);AT.showToolbarButtons();if(D.UA.ie){Aa&&Aa.focus();}AT.success.one("span.btn a").focus();AT.adNode&&AT.adNode.removeClass(w);}function x(){var AB=this,Y;if(!NeoConfig.send_confirm_nav_enabled||AB.get("active")==0||AB.success.hasClass(w)){return;}Y=D.all("#pagetoolbar span");if(Y&&AB.author.backToMessageTab){Y.each(function(AC){AC.removeClass(w);});}}function l(Y){var AB=this;
if(Y){Y.focus();AB.registerFocus(Y);}}function u(Y){var AB=this;AB.focusNode=Y;if(AB.author){AB.author.set("focusNode",Y);}}function c(){var Y=this;Y.setFocus(Y.focusNode);}function q(){var Y=this;return(Y.success.hasClass(w)&&!Y.isAbuseDetected);}D.extend(r,D.mail.ui.BaseWidget,{NAME:"SendConfirmView",render:i,postrender:b,bindUI:y,canWeClose:U,showAbuse:I,showError:H,showCaptcha:L,showSuccess:G,hideStatusBoxes:e,handleToolbarSelection:P,onKeyDown:K,onFocus:j,handleAfterActiveChanged:f,retrySendMessageWithCaptcha:J,toggleButtonState:t,setAllButtonState:V,updateToolbar:o,backToMessage:A,retrySendMessage:E,showLoading:O,showToolbarButtons:x,resetLoading:S,handleCloseChange:Q,setAutoAddContacts:N,setFocus:l,registerFocus:u,restoreFocus:c,doBlocked:C,bindSDO:n,isDirty:q});D.namespace("mail");D.mail.SendConfirmView=r;if(NeoConfig.intl==="jp"){D.use("mail-ui-sendconfirmview-base-jp",function(AB){AB.mail.SendConfirmView=AB.extend(AB.mail.SendConfirmViewJp,AB.mail.SendConfirmView);});}},"1.0.0",{requires:["common-utils","_shared_module_send_confirm_rollup","mail-controller-sendconfirm","_shared_module_send_confirm_recipients_rollup","minty_module_toolbar_inbox_sent_msg_rollup","_shared_module_send_confirm_captcha_blocked","comms-lozenge-address","comms-ui-lozenge","mail-ui-searchbar","common-ui-notification","rocket-stats"]});YUI.add("om-ui-sendconfirm",function(G){var B=G.om,D=B.Controller,A=D.Compose,H=D.Views,F=B.common.Utils,C="hidden";var E=function(){var I=this;I.appViewIds=[];E.superclass.constructor.apply(I,arguments);G.later(0,null,function(){G.fire("om:compose.sendstart",{sdo:I.sdo},I);});};G.extend(E,G.mail.SendConfirmView,{NAME:"OMSendConfirmView",attachAppView:function(I,O,J){if(!this.success){F.log("trying to attach view - but sendconfirm has not rendered","OMSendConfirm");return;}var N=this,R=I.app,P=O.view,K=(P in I.views&&I.views[P].type)||"",Q=H.getInternalUserViewId(R,"sendconfirm-"+P.replace(/\W/g,"_")+(+new Date())),M=N.success.one("div.items ul"),L=true;H.openView(R,I.instance,Q,P,K,"panel",O.context||null,J,O.width,O.height,0,"","api/openView",null,null,null,null,{renderParams:[M,L],parentWidget:N,appParams:O},function(){N.appViewIds.push(Q);});},detachAppViews:function(){var I=this;I.set("closing",1);G.each(I.appViewIds,function(J){H.closeView(J);});I.appViewIds=[];},handleCloseChange:function(I){var J=this;if(I.newVal==1&&!J.success.hasClass(C)){J.detachAppViews();}E.superclass.handleCloseChange.apply(J,arguments);},handleActiveChanged:function(I){var J=this;E.superclass.handleActiveChanged.apply(J,arguments);if(!J.success.hasClass(C)&&!J.author.get("closing")){if(I.newVal==0){J.detachAppViews();}}},backToMessage:function(){var I=this;I.detachAppViews();I.set("closing",0);E.superclass.backToMessage.apply(I,arguments);}});G.namespace("om.ui");G.om.ui.SendConfirmView=E;},"1.0.0",{requires:["mail-ui-sendconfirmview-base"]});