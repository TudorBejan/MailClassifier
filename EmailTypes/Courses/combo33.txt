YUI.add("_shared_module_search_empty_rollup",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_search_empty_rollup={base:'<div class="content search"> <div class="inner {{hasMON_a}}"> <h2 class="welcome">{{search_no_results}}</h2> <ul class="services"> <li> <div class="icon-lg contact-card"></div> <p>{{str_srch_find_by_person}}</p> <div class="contact-search"> <label for="find-by-person-field" class="offscreen"></label> <div id="find-by-person" class="ac-input" data-action="autocomplete"> <ul> <li> <input id="find-by-person-field" name="find-by-person-field" placeholder="{{str_srch_type_name}}" tabIndex="0" maxlength="2048" /> </li> </ul> </div> </div> <span class="btn left right"><a href="#" title="{{str_srch_person_btn_attr}}">{{str_srch_person_btn}}</a></span></li> <li> <div class="icon-lg attachment"></div> <p>{{str_srch_find_by_file}}</p> <ul class="file-types"> <li><span class="btn left right "><a title="{{str_file_all_types}}" href="#"><i>{{str_file_all_types}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_pdf}}" href="#" class="pdf"><i>{{str_file_pdf}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_ppt}}" href="#" class="ppt"><i>{{str_file_ppt}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_xls}}" href="#" class="xls"><i>{{str_file_xls}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_doc}}" href="#" class="doc"><i>{{str_file_doc}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_img}}" href="#" class="img"><i>{{str_file_img}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_video}}" href="#" class="video"><i>{{str_file_video}}</i></a></span></li> <li><span class="btn left right "><a title="{{str_file_audio}}" href="#" class="audio"><i>{{str_file_audio}}</i></a></span></li> </ul></li> <li> <div class="icon-lg calendar"></div> <p>{{str_srch_find_by_date}}</p> <p class="date-range"> <span class="btn left right small"><a href="#" data-action="today">{{str_srch_date_today}}</a></span> <span class="btn left right small"><a href="#" data-action="week">{{str_srch_date_last_week}}</a></span> <span class="btn left right small"><a href="#" data-action="month">{{str_srch_date_last_month}}</a></span> </p></li> </ul> </div> {{jp_ads_emptysearch_mon}}</div>',jp_ads_emptysearch_mon:'<div class="{{hasMON_b}} "> <div id="slot_MON_emptysearch" class="ch_mod gxBoom boom"><div id="tgtMON_emptysearch" class="darla"></div></div>  </div> '};},"1.0.0");YUI.add("mail-ui-advancedSearchView",function(E){var C=E.common.Utils,A=C.substitute,B=[];var D=function(F){var H=this,G={rootNode:{writeOnce:true},template:{setter:function(I){H.TEMPLATE=E.ui.Templates._shared_module_search_empty_rollup;}},data:{},query:{}};E.augment(H,E.Attribute);H.addAttrs(G,F||{});E.augment(H,E.EventTarget);};D.prototype={TEMPLATE:E.ui.Templates._shared_module_search_empty_rollup,render:function(){var H=this,G=H.get("query.keyword"),F=H.get("data")||{};F.search_no_results=E.Lang.trim(G)||NeoConfig.intl!=="jp"?"{{str_srch_no_results}}":"{{str_srch_enter_search_terms}}";H.get("rootNode").appendChild(E.Node.create(A(H.TEMPLATE.base,H.get("data"),0,0,strings)));if(!(window.location.href.match(/&mswsDateSearch=1/)||window.location.href.match(/\?mswsDateSearch=1/))){H.get("rootNode").one("div.calendar").ancestor("li").remove();}H.bindUI();},bindUI:function(){var I=this,F=I.get("rootNode"),H=F.one("#find-by-person-field"),G;for(G in B){E.detach(B[G]);}B=[];B.push(F.one("div.contact-search").next("span").delegate("click",function(K){K.preventDefault();var J=F.one("div.ac-input input");if(J.get("value")){K.contactNode=J;I.fire("searchByContact",K);}},"a",I));B.push(F.one("ul.file-types").delegate("click",function(J){J.preventDefault();J.fileTypeNode=J.target;I.fire("searchByAttachmentType",J);},"span a",I));if(window.location.href.match(/&mswsDateSearch=1/)||window.location.href.match(/\?mswsDateSearch=1/)){B.push(F.one("p.date-range").delegate("click",function(J){J.preventDefault();J.dateNode=J.target;I.fire("searchByDateRange",J);},"span a",I));}B.push(H.on("focus",function(J){J.contactNode=J.target;I.fire("showAutoComplete",J);},I));B.push(H.on("keydown",function(J){J.contactNode=J.target;I.fire("autoCompleteQuery",J);},I));B.push(H.on("blur",function(J){J.contactNode=J.target;I.fire("hideAutoComplete",J);},I));if(NeoConfig.bidi&&!H.bidiTextEntry){E.use("comms-bidi-textentry",function(){H.plug(E.Plugin.BidiTextEntry);});}},close:function(){var H=this,G,F=H.get("rootNode").all("div.content.search");for(G in B){E.detach(B[G]);}B=[];F&&F.remove();}};E.namespace("mail.ui");E.mail.ui.AdvancedSearchView=D;},"1.0.0",{requires:["common-utils","_shared_module_search_empty_rollup","attribute-base","event-base"]});YUI.add("mail-ui-advancedSearchController",function(G){var E=G.common.Utils,A=E.substitute,C=[],B=G.contacts,H=B.api,D=B.utils;var F=function(I){var K=this,J={data:{},rootNode:{writeOnce:true,setter:function(){K.get("widget")&&K.get("widget").render();}},query:{},widget:{setter:function(L){K.get("rootNode")&&L.render();}}};G.augment(K,G.Attribute);K.addAttrs(J,I||{});G.augment(K,G.EventTarget);};F.prototype={process:function(){var J=this,I;J.set("widget",new G.mail.ui.AdvancedSearchView({rootNode:J.get("rootNode"),data:J.get("data"),query:J.get("query")}));I=J.get("widget");I.on("searchByContact",J.searchByContactHandler,J);I.on("searchByAttachmentType",J.searchByAttachmentTypeHandler,J);I.on("searchByDateRange",J.searchByDateRangeHandler,J);I.on("showAutoComplete",J.autoCompleteHandler,J);I.on("autoCompleteQuery",J.keyDownHandler,J);I.on("hideAutoComplete",J.hideACHandler,J);},searchByContactHandler:function(K){var L=this,I=G.comms.Utils.createAddress(K.contactNode.get("value")),J={keyword:" ",from:I.email};L.fire("doMailSearch",{query:J});},searchByAttachmentTypeHandler:function(I){var K=this,J={pdf:"pdf",ppt:"vnd.ms-powerpoint",xls:"excel",doc:"msword",img:"image",video:"video",audio:"audio"};className=I.fileTypeNode.get("className"),queryObj={keyword:" "};if(J[className]){queryObj.attachmenttypes=J[className];}else{queryObj.attachmentcount={min:1};}K.fire("doMailSearch",{query:queryObj});},searchByDateRangeHandler:function(M){var L=this,J=M.dateNode.getAttribute("data-action"),S=new Date(),O=S.getFullYear(),N=S.getMonth(),P=S.getDate(),Q=S.getDate()-S.getDay(),K,R,I={keyword:" "};switch(J){case"today":I.date={year:O,month:N+1,day:P};break;case"week":K=Date.UTC(O,N,Q-7)/1000;R=Date.UTC(O,N,Q-1)/1000;I.date={start:K,end:R};break;case"month":I.date={year:O,month:N};break;default:return;}L.fire("doMailSearch",{query:I});},autoCompleteHandler:function(L){if(L.contactNode.get("nodeName")=="INPUT"){var K=L.contactNode.get("id");if(K){L.contactNode.removeClass("whiteout");var J=L.contactNode.ancestor("#find-by-person");if(!G.ACWidgetInst){var I=A(G.ui.Templates._shared_module_offscreen_bin_compose.base,{},null,null,strings,G.ui.Templates);G.one(document.body).append(I);G.ACWidgetInst=new G.contacts.ui.ACWidget({acNode:J,acTarget:L.contactNode,contentBox:"#ac-to-results",selectFirst:true}).setAlign().render();}else{if(G.ACWidgetInst.get("ac").get("alignNode")!==J){G.ACWidgetInst.get("ac").destructor();G.ACWidgetInst.refresh({acNode:J,acTarget:L.contactNode,width:J.getStyle("width"),selectFirst:true}).setAlign().render();}}G.ACWidgetInst.get("ac").detach("ac:query");G.ACWidgetInst.get("ac").on("ac:query",function(P){var V=this,N=V.get("dataSource"),R=P.value,T,Q=this.get("badResult"),O,S,U;if(Q){O=E.escapeRegexp(E.escapeHtml(Q));S=new RegExp("^"+O,"gi");if(P.value.match(S)){this.fire("ac:load",{results:[],query:P.value});return;}}if(D.areContactsLoaded()){var M=new G.comms.FilterContacts();M.updateFilterItems(R);T=M.fastMatch();T.queryStr=R;U=G.bind(V.reload,V,T);U(T);}});G.detach("contacts:contactChanged");G.on("contacts:contactChanged",function(){G.ACWidgetInst.get("ac").set("badResult",false);});}}},keyDownHandler:function(J){var L=this,I=L.get("rootNode"),K=J.keyCode;J.stopPropagation();switch(K){case 13:if(J.ctrlKey||J.metaKey){return;}if(G.ACWidgetInst&&G.ACWidgetInst.isVisible()&&G.ACWidgetInst.get("data").length>0){G.ACWidgetInst.handleEnter(J,G.ACWidgetInst);}else{J.contactNode=I.one("div.ac-input input");if(J.contactNode.get("value")){L.get("widget").fire("searchByContact",J);}}J.halt();break;}},hideACHandler:function(I){I.preventDefault();if(G.ACWidgetInst&&!(G.one("div.ac-results:hover")||G.one("div.ac-results li.over"))){G.ACWidgetInst.hide();}},close:function(){var I=this;I.get("widget").close();}};G.namespace("mail.ui");G.mail.ui.AdvancedSearchController=F;},"1.0.0",{requires:["common-utils","mail-ui-advancedSearchView","plugin","ac-widget","filter-contacts","forms_css","autocomplete_css","_shared_module_offscreen_bin_compose","comms-utils"]});