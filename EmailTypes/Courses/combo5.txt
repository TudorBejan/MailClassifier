YUI.add("om-controller-base",function(C){var A=C.namespace("om.Controller");A.extend=function(D){if(!A[D]){A[D]=C.clone(B);}return A[D];};var B={};},"3.0.0",{requires:[]});YUI.add("om-common-utils",function(F){F.namespace("om.common.Utils");var C=F.om.common.Utils,A=F.common.Utils,E=F.Lang;var D=(function(){var G={};return function(H){return G[H]?G[H]:G[H]=C.md5(NeoConfig.om.crumb+H);};})();function B(){var S=0,G="",O=8;function P(U){return T(K(H(U),U.length*O));}function K(j,Z){var k;k=Z>>5;j[k]|=128<<((Z)%32);k=(((Z+64)>>>9)<<4)+14;j[k]=Z;var h=1732584193,g=-271733879,f=-1732584194,e=271733878,W,Y,X,V,U;for(W=0;W<j.length;W+=16){Y=h;X=g;V=f;U=e;h=N(h,g,f,e,j[W+0],7,-680876936);e=N(e,h,g,f,j[W+1],12,-389564586);f=N(f,e,h,g,j[W+2],17,606105819);g=N(g,f,e,h,j[W+3],22,-1044525330);h=N(h,g,f,e,j[W+4],7,-176418897);e=N(e,h,g,f,j[W+5],12,1200080426);f=N(f,e,h,g,j[W+6],17,-1473231341);g=N(g,f,e,h,j[W+7],22,-45705983);h=N(h,g,f,e,j[W+8],7,1770035416);e=N(e,h,g,f,j[W+9],12,-1958414417);f=N(f,e,h,g,j[W+10],17,-42063);g=N(g,f,e,h,j[W+11],22,-1990404162);h=N(h,g,f,e,j[W+12],7,1804603682);e=N(e,h,g,f,j[W+13],12,-40341101);f=N(f,e,h,g,j[W+14],17,-1502002290);g=N(g,f,e,h,j[W+15],22,1236535329);h=J(h,g,f,e,j[W+1],5,-165796510);e=J(e,h,g,f,j[W+6],9,-1069501632);f=J(f,e,h,g,j[W+11],14,643717713);g=J(g,f,e,h,j[W+0],20,-373897302);h=J(h,g,f,e,j[W+5],5,-701558691);e=J(e,h,g,f,j[W+10],9,38016083);f=J(f,e,h,g,j[W+15],14,-660478335);g=J(g,f,e,h,j[W+4],20,-405537848);h=J(h,g,f,e,j[W+9],5,568446438);e=J(e,h,g,f,j[W+14],9,-1019803690);f=J(f,e,h,g,j[W+3],14,-187363961);g=J(g,f,e,h,j[W+8],20,1163531501);h=J(h,g,f,e,j[W+13],5,-1444681467);e=J(e,h,g,f,j[W+2],9,-51403784);f=J(f,e,h,g,j[W+7],14,1735328473);g=J(g,f,e,h,j[W+12],20,-1926607734);h=R(h,g,f,e,j[W+5],4,-378558);e=R(e,h,g,f,j[W+8],11,-2022574463);f=R(f,e,h,g,j[W+11],16,1839030562);g=R(g,f,e,h,j[W+14],23,-35309556);h=R(h,g,f,e,j[W+1],4,-1530992060);e=R(e,h,g,f,j[W+4],11,1272893353);f=R(f,e,h,g,j[W+7],16,-155497632);g=R(g,f,e,h,j[W+10],23,-1094730640);h=R(h,g,f,e,j[W+13],4,681279174);e=R(e,h,g,f,j[W+0],11,-358537222);f=R(f,e,h,g,j[W+3],16,-722521979);g=R(g,f,e,h,j[W+6],23,76029189);h=R(h,g,f,e,j[W+9],4,-640364487);e=R(e,h,g,f,j[W+12],11,-421815835);f=R(f,e,h,g,j[W+15],16,530742520);g=R(g,f,e,h,j[W+2],23,-995338651);h=L(h,g,f,e,j[W+0],6,-198630844);e=L(e,h,g,f,j[W+7],10,1126891415);f=L(f,e,h,g,j[W+14],15,-1416354905);g=L(g,f,e,h,j[W+5],21,-57434055);h=L(h,g,f,e,j[W+12],6,1700485571);e=L(e,h,g,f,j[W+3],10,-1894986606);f=L(f,e,h,g,j[W+10],15,-1051523);g=L(g,f,e,h,j[W+1],21,-2054922799);h=L(h,g,f,e,j[W+8],6,1873313359);e=L(e,h,g,f,j[W+15],10,-30611744);f=L(f,e,h,g,j[W+6],15,-1560198380);g=L(g,f,e,h,j[W+13],21,1309151649);h=L(h,g,f,e,j[W+4],6,-145523070);e=L(e,h,g,f,j[W+11],10,-1120210379);f=L(f,e,h,g,j[W+2],15,718787259);g=L(g,f,e,h,j[W+9],21,-343485551);h=M(h,Y);g=M(g,X);f=M(f,V);e=M(e,U);}return Array(h,g,f,e);}function I(Z,W,V,U,Y,X){return M(Q(M(M(W,Z),M(U,X)),Y),V);}function N(W,V,e,Z,U,Y,X){return I((V&e)|((~V)&Z),W,V,U,Y,X);}function J(W,V,e,Z,U,Y,X){return I((V&Z)|(e&(~Z)),W,V,U,Y,X);}function R(W,V,e,Z,U,Y,X){return I(V^e^Z,W,V,U,Y,X);}function L(W,V,e,Z,U,Y,X){return I(e^(V|(~Z)),W,V,U,Y,X);}function M(U,X){var W=(U&65535)+(X&65535),V=(U>>16)+(X>>16)+(W>>16);return(V<<16)|(W&65535);}function Q(U,V){return(U<<V)|(U>>>(32-V));}function H(X){var W=Array(),V,U=(1<<O)-1;for(V=0;V<X.length*O;V+=O){W[V>>5]|=(X.charCodeAt(V/O)&U)<<(V%32);}return W;}function T(W){var V=S?"0123456789ABCDEF":"0123456789abcdef",X="";for(var U=0;U<W.length*4;U++){X+=V.charAt((W[U>>2]>>((U%4)*8+4))&15)+V.charAt((W[U>>2]>>((U%4)*8))&15);}return X;}return P;}F.mix(C,{getIFrameById:function(G){return F.one(document.getElementById(G));},getEventName:function(I,H,G){if(C.Event.isMailEvent(H)){return H;}switch(H){case"crumb.update":case"folderpane.scroll":case"mail.signout":case"browser.resize":case"themes:change":case"contacts.sendsms":case"contacts.sendim":case"contacts.changed":case"social.statuschanged":case"tab.changed":case"chats.sendim":case"chats.sendsms":case"search.input":return H;case"compose.start":case"compose.sendstart":case"compose.sendcomplete":case"compose.user_event":return H+I;case"message.read":case"subfolder.click":case"sandbox.controller":return H+I.split(".")[0];case"app.jserror":case"data.action":case"message.render":case"message.render.messageflagstatus":case"message.render.handleupdatelozenges":case"message.render.updateheight":case"messageview.resize":case"view.focus":case"view.blur":case"view.resize":case"view.unload":A.assert(G,"viewId is required for '"+H+"' event");H=H+"."+G;}return I+"."+H;},getDiffList:function(J,H){var L=[],K,G=J;if(E.isArray(J)){G={};for(K=J.length-1;K>=0;--K){G[J[K].app]=1;}}if(E.isArray(H)){for(var K=0,I=H.length;K<I;K++){if(!G[H[K].app]){L.push(H[K].app);}}}else{for(K in H){if(!G[H[K].app]){L.push(H[K].app);}}}return L;},Event:{PREFIX:"mail-event:",encodeMailEvent:function(G){return C.Event.PREFIX+G;},isMailEvent:function(G){return(G||"").indexOf(C.Event.PREFIX)==0;}},convertArrayIndex:function(I,H){var G,K,J=[];for(G in I){K=I[G];J[K[H]]=K;}return J;},escapeDots:function(G){return G.replace(/\./g,"\\.");},fireEvent:function(I){var H,G;H=I.match(/^om:(.*):(.*):(.*)$/);G=this.getEventName(H[1],"data.action",H[2]);F.fire(G,{data_action:H[3]});},compareVer:function(I,H){I=I.split(".");H=H.split(".");if(I.length!==3||H.length!==3){A.assert(false);return;}var K=0,J=0;for(var G=0;G<3;G++){K=parseInt(I[G],10);J=parseInt(H[G],10);if(K!==J){return(K>J)?1:-1;}}return 0;},tryProp:function(L,M,I){var K=M.split(".");for(var J=0,G=K.length;J<G;J++){var H=K[J];if(L!==null&&typeof L==="object"&&H in L){L=L[H];}else{return I;}}return L;},getObjSize:function(I){var G=0,H;for(H in I){if(I.hasOwnProperty(H)){G++;}}return G;},getAppSignature:D,getViewport:(function(){var G=true;var H;F.on("resize",function(){G=true;});F.on("scroll",function(){G=true;},window);return function(){if(G){H={width:F.DOM.winWidth(),height:F.DOM.winHeight(),scrollX:F.DOM.docScrollX(),scrollY:F.DOM.docScrollY()};G=false;}return H;};})(),md5:B(),onIdle:(function(){var H={};var G=0;return function(J,I){var K=G++;I=I||150;return function(){if(H[K]){H[K].cancel();
}H[K]=F.later(I,this,function(){J();});};};})(),LookupList:function(){for(var G=arguments.length;G--;){this[arguments[G]]=1;}},log:(function(){var G=NeoConfig&&NeoConfig.om&&NeoConfig.om.debug,H;return function(I,J){var K;if(G){if(!H){H=F.comms.log4js.getLogger("openMailLogger");F.use("comms-log4js-appenders-console",function(){H.useAppender("console").show();});}H.log("["+(J||"Openmail")+"] "+I);}};})(),range:function(H,I,G){return Math.max(Math.min(G,I),H);},getImageUrl:function(I,H,G){return NeoConfig.launch_protocol+NeoConfig.om.webcacheHostCom+"/om/image.appid."+I+".type."+H+".v."+G+".intl."+NeoConfig.om.intl+".lang."+NeoConfig.lang;},createLogger:function(G){return function(H){C.log(H,G);};}});},"1.0.0",{requires:["common-utils"]});YUI.add("om-common-net-session",function(F){F.namespace("om.common.net");var D=F.common.net,B=D.Error,A=D.SessionMgr,E=F.Lang,C={"100":[100,false,"",2],"200":[100,false,"",2],"201":[100,false,"",2],"202":[100,false,"",2],"203":[100,false,"",2],"300":[100,false,"",2],"301":[100,false,"",2],"302":[100,false,"",2],"400":[100,false,"",2],"401":[100,false,"",2],"408":[100,false,"",2],"409":[100,false,"",2],"410":[100,false,"",2],"500":[100,false,"",2],"503":[100,false,"",2],"504":[100,false,"",2],"506":[100,false,"",2],"507":[100,false,"",2],"510":[100,false,"",2],"600":[100,false,"",2],"604":[100,false,"",2],"1101":[100,false,"",2],"1102":[100,false,"",2],"1201":[100,false,"",2],"1204":[100,false,"",2],"1301":[100,false,"",2],"1303":[100,false,"",2],"1401":[100,false,"",2],"1402":[100,false,"",2],"1403":[100,false,"",2]};F.om.common.net.session=function(){var H={getUrlForModule:function(I){return"/om/api/1.0/"+I;},getBaseCallback:function(L,I,K){var J=H.session,M={service:"om",responseType:"json",formatter:J.formatResponse,success:J.callback,failure:J.callback,method:L,suppressWssid:true,suppressCodes:["*"],suppressLogs:["*"],timeout:5000,args:{success:I,failure:K}};return M;},formatResponse:function(J,K){var L=K.status,N=K.callback,M;switch(L){case 200:break;case 500:var I=K.body;if(I){K.fault=H.makeFault(I.status,I.message,I.context);}else{K.fault=H.makeFault(L.toString(),B.http);}break;default:K.fault=H.makeFault(L.toString(),B.http);}},getErrorMap:function(J,I){if(J==null||I==null||!E.isString(J)||!E.isString(I)){return{};}return C[I]||{};},isHttpError:B.isHttp,makeFault:A.makeFaultObject};H.session={formatResponse:function(I,J){H.formatResponse(I,J);},callback:function(I){if(I.fault){H.session.handleFailure(I);}else{var J=I.callback.args;if(E.isFunction(J.success)){J.success.apply(null,[I,J]);}}},handleFailure:function(N){var K=E.trim(N.getResponseHeader("crumb")),O,I,M;if(K){O=N.request;I=O.url;M=O.urlparams||{};if(O&&I){if(O.mthd=="GET"){M["crumb"]=K;}else{I=O.url.replace(/crumb=([^&]*)/,"crumb="+K);M=O.post;}NeoConfig.om.crumb=K;F.fire(F.om.common.Utils.getEventName("","crumb.update"),{"crumb":K});A.request(I,M,N.callback,O.mthd,O.enc,true);return;}}var P=N.fault||{},T=P.message,R=!P.code||H.isHttpError(P.code)?N.status+"":P.code,L=(P.detail&&P.detail.operation)?P.detail.operation:"",S=H.getErrorMap(T,R),J=S[1]||false,Q=N.callback.args;if(E.isFunction(Q.failure)){Q.failure.apply(null,[N,Q]);}}};function G(N,O,M){if(M.callback&&M.callback.service=="om"){var K,L=M.fault.code,J=M.status,I=!(J==401||J==402||J==302||J==13030);if(L==1401){N.callDefault(402);}return I;}}B.onError(G);return H;}();},"1.0.0",{requires:["event-custom","common-utils","common-net-session","common-net-sessionmgr","om-common-utils"]});YUI.add("om-model-datastore",function(C){C.namespace("om.model");var J=C.om,D=C.Array,E=C.Object,F=C.Lang,G=C.om.common.Utils.tryProp,H=J.model.DataStore={},I={NEO_SANDBOX:"Message Sandbox",QUICKREPLY:"QuickReply",FLIXY:"Flixy Browse",SHORTCUTS:"Yahoo! Shortcuts",QUICKRSVP:"QuickRSVP"},B={PUBLIC:1,REVOKED:2,HASPUBLISHED:8,DEVELOPER:16,MODIFIED:32,IN_DB:64,OMIT_DISCLAIMER:128,INTERNAL:256,SICK:512,IN_DEVELOPMENT:1024,UDBLESS_INSTALL:2048,CG_HIDDEN:4096,SANDBOXED:8192,SMART_FOLDER:16384,READONLY:32768,PRELOAD:65536,PERMANENT:131072,NO_GALLERY:262144,NO_APPLIST:524288,LARGE_FILER:1048576};C.mix(H,{Loading:(function(){var L=false;function A(M){L=M;if(M===false){C.fire("om:updateFolders",true);C.fire("om:datastoreLoaded",true);}}function K(){return(L===true);}return{set:A,isLoading:K};})(),currentVersions:[],currentProfile:{},updateList:[],removeList:[],folderConfigs:{},wsObject:null,wsCallMap:{},APP_FLAGS:B});C.mix(H,{ApplicationList:(function(){var Q=[],R=null;function P(T,U){Q=T;R=U;C.fire("om:applistupdate");}function S(){return Q;}function L(){Q={};}function A(T,U){Q[T]=U;}function O(T){return Q[T];}function K(T){return C.Array.find(Q,function(U){return U.app==T;});}function N(U){var T=K(U);return(T&&C.Lang.isNumber(T.version))?T.version:0;}function M(T){delete Q[T];}return{setAll:P,getAll:S,delAll:L,set:A,get:O,getByAppId:K,getAppVersion:N,del:M,getSpriteURL:function(){return R;}};})()});C.mix(H,{ApplicationConfig:(function(){var M={message_read:["header","flags","annotation"],attachment:["content_type"]},N=[];function A(P){var Q=P&&P.config&&P.config.events,O;if(Q&&Q.message_read&&(O=Q.message_read.match)){if(!O["@attributes"]){O["@attributes"]={};}if(!O["@attributes"].mode){O["@attributes"].mode="or";}D.each(D.filter(M.message_read,function(S){return !!O[S];}),function(S){O[S]=D(O[S]);O[S]=D.filter(D.map(O[S],function(W){var V,U,T;if((V=W.name)){W.name=V.toLowerCase();}if((U=W.regex)){T=/^\/(.*)\/(.*)$/.exec(U);if(!T){return null;}W.regex=new RegExp(T[1],T[2]);}return W;}),function(T){return T!==null;});});}if(Q){E.each(Q,function(T,S){if(S.indexOf("attachment_")!==0){return;}O=T.match;D.each(M.attachment,function(U){O[U]=D(O[U]);});});}if(P.settings&&F.isString(P.settings)){try{P.settings=C.JSON.parse(P.settings);}catch(R){}}return P;}function K(O){N=D.map(O,A);}function L(){return N;}return{MATCH_CATEGORIES:M.message_read,setAll:K,getAll:L};})()});C.mix(H,{Registry:(function(){var b={},R={"3id1k74o3ic9k":1,"3aophcopmae1m":1,"36or471hmce9m":1,"3copmchj36d1m":1,"30db665j3ge9n":1,"32p326himcdpg":1,"3cp9lcoq32dpn":1},n={"34o9m69ij8e9m":1,"62pb5c4p32c33":1,"30eb260pjiphl":1},i={},k={"_default":function(q,r){return q===r;},"content_type":function(q,r){return q.toLowerCase()===r.toLowerCase()||q==="*";}};function h(q,r){b[q]=r;if(T(q)){i[q]=1;}C.fire("om:register_app",r,q);}function a(q){b=q;E.each(q,function(r,s){if(T(s)){i[s]=1;}});}function K(q){return b[q]||null;}function p(){return b;}function M(s,q){var r=b[s];if(r&&r[q]){return r[q];}}function c(q){delete b[q];if(q in i){delete i[q];}}function W(){b={};}function L(){var t,s,q=false,r=false;for(t in b){s=b[t];if(N(s)){r=true;}else{if(j(s)){q=true;}}if(r&&q){return true;}}return false;}function N(q){var r=C.Object.getValue(q,["config","events","click","action","launch"]);return(r&&r.target_zone=="tab"&&r.context=="http://calendar.yahoo.com")||H.Registry.isInDevelopment(q.app);}function j(q){var r=C.Object.getValue(q,["config","events","click","action","launch"]);return r&&r.target_zone=="window"&&r.view=="http://calendar.yahoo.com/";}function V(){var s,q,r;for(s in b){q=b[s];if(q&&q.config){for(r in q.config.events){if((r==="click-gallery")&&(q.status&B.INTERNAL)){return q;}}}}}function m(){var s,q,r=[];for(s in b){if(Z(s)){q=b[s];r.push(q);}}if(r.length>0){if(r.length>1){for(s=0;s<r.length;++s){if(!(r[s].status&B.PUBLIC)){return r[s];}}}return r[0];}}function d(q){return function(r){if(!F.isObject(r)){r=b[r];}return !!(r&&(r.status&q));};}function S(r){var q=b[r];return q&&q.name||"";}function U(q){return R[q];}function O(q){return n[q];}function Z(u){var t=b[u],r,s,q;return(t&&t.name===I.NEO_SANDBOX&&(t.status&B.INTERNAL)&&(t.status&B.SANDBOXED)&&!(t.status&B.SICK)&&(r=t.config)&&(s=r.events)&&(q=s.message_render)&&q);}function Y(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKREPLY||q===I.FLIXY||q===I.SHORTCUTS);}function l(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKRSVP);}function P(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKREPLY);}function A(t){var s,q,u,r;return t&&(r=t.config)&&(s=r.events)&&(q=s.message_read)&&(u=q.match);}function T(q){var r=b[q];if(!r||!r.config||!r.config.events){return false;}return E.some(r.config.events,function(t,s){return s.indexOf("attachment_")===0;});}function o(r){var u,q,s,t=false;if(!F.isObject(r)){C.log("Malformed attachment handler search: "+C.JSON.stringify(r)+"; expected an object","error");return -1;}t=E.some(i,function(w,x){u=b[x];if(!u.config.events.attachment_view){return;}q=u.config.events.attachment_view.match;return E.some(r,function(y,v){if(!(v in q)){return;}s=k[v]||k._default;return D.find(D(y),function(z){return D.find(q[v],function(AA){return s(AA,z);});});});});return t&&{handlerId:u.app,name:u.name||""};}function Q(v,t,s){var u=["config.events.attachment_",t,".match.content_type"].join(""),r=G(v,u),q=k["content_type"];if(!F.isArray(r)){return false;}return D.some(r,function(w){return q(w,s);});}function f(t,r){var s="config.events.attachment_"+r+".@attributes",q=G(t,s);return q&&q.global==="true";}function e(s){var u,t=s.content_type,q=["view","sign","save"],r={};if(!F.isObject(s)||!F.isString(s.content_type)){C.log("Malformed attachment handlers search: "+C.JSON.stringify(s)+"; wanted args.content_type string","error");return -1;}E.each(i,function(w,x){u=b[x];D.each(q,function(v){if(!Q(u,v,t)){return;}r[v]={handlerId:x,name:u.name};if(f(u,v)){r[v].global=true;}});});return E.isEmpty(r)||r;}function g(q){return q.length?"/om/combo/"+q.join("/"):null;}function X(){var z,w,AH,y,AB,q,AD,v=false,u=[],AE=[],AI={},AF=[],r=[],x=[],AG=[],s=[],t=[],AA=[],AC=H.Registry;
E.each(b,function(AJ){if(NeoConfig.isFullSSL&&AJ.name==I.SHORTCUTS){return;}if(AJ.config&&AJ.config.events&&AJ.config.events.message_read&&AJ.config.events.message_read.message_actions&&(z=AJ.config.events.message_read.message_actions.enhance_message)){w=AJ.app;v=AC.isPreload(w)&&!AC.isSick(w);x=[];AG=[];s=[];t=[];AA=[];y=AC.isInternal(w)?NeoConfig.om.webcacheHostCom:NeoConfig.om.webcacheHostNet;AB=(y.indexOf("yahoo.com")!==-1&&y.indexOf(".corp.")!==-1);AH=(y.indexOf(".c.yom.mail.yahoo.")!==-1)?"-":".";if(z.css){q=z.css.path;u=F.isArray(q)?q:[q];D.each(u,function(AK){if(strings&&strings.str_tog_loadRTLCss){AK=AK.replace(/\.css$/,"-rtl.css");}if(AK.match(/http(?:s)?:\/\//)){AG.push(AK);}else{(v?r:x).push("f."+AK.replace(/^\/om\/assets\//,""));}});}if(z.js){AD=z.js.path;AE=F.isArray(AD)?AD:[AD];D.each(AE,function(AK){if(AK.match(/http(?:s)?:\/\//)){AA.push(AK);}else{(v?s:t).push("f."+AK.replace(/^\/om\/assets\//,""));}});}AI[w]={app:w,name:AJ.name,msg_read_data:{preload:v,cssCombo:g(x),css:AG,preloadJsCombo:g(s),jsCombo:g(t),js:AA,context:{appId:w,instanceId:AC.get(w).instance,invokePrefix:NeoConfig.launch_protocol+(AB?y:[w,AH,y].join(""))}}};AF.push(w);}});return{msgReadAppIdList:AF,msgReadAppConfigs:AI,preloadCssCombo:g(r)};}return{set:h,setAll:a,get:K,getAll:p,getProperty:M,del:c,delAll:W,getGalleryData:V,getSandboxData:m,getAppName:S,getAttachmentHandlerInfo:o,getAttachmentHandlers:e,isPublic:d(B.PUBLIC),isRevoked:d(B.REVOKED),isInDb:d(B.IN_DB),isNoDisclaimer:d(B.OMIT_DISCLAIMER),isInternal:d(B.INTERNAL),isSick:d(B.SICK),isInDevelopment:d(B.IN_DEVELOPMENT),isSmartFolder:d(B.SMART_FOLDER),isPreload:d(B.PRELOAD),isPermanent:d(B.PERMANENT),isNoAppList:d(B.NO_APPLIST),isLargeFiler:d(B.LARGE_FILER),isMessenger:U,isAttachLargeFiles:O,isSandbox:Z,isMsgReadRtbApp:Y,isNewCalendarApp:N,isOldCalendarApp:j,isAttachmentHandler:T,isCorpmailDisabledApp:l,isFreshDisabledApp:P,hasMessageReadEvents:A,hasOldAndNewCalendarApps:L,getSandboxMsgReadConfig:X};})()});C.mix(H,{ViewRegistry:(function(){var L={};function A(O,P){L[O]=P;}function M(O){return L[O]||null;}function N(){return L;}function K(O){delete L[O];}return{set:A,get:M,getAll:N,del:K};})()});C.mix(H,{OpenViewLog:(function(){var M={};function A(N,O){M[N]=O;}function L(N){return M[N]||null;}function K(N){delete M[N];}return{set:A,get:L,del:K};})()});C.mix(H,{EventRegistry:(function(){var L={};function A(S,R,U,Q,T){if(!L[U]){L[U]={};}if(!L[U][Q]){L[U][Q]={};}L[U][Q][T]=S;L[U][Q][T].listenerFn=R;}function P(Q){return L[Q]||null;}function N(R,Q){try{return L[R][Q]||null;}catch(S){return null;}}function O(S,Q,R){try{return L[S][Q][R]||null;}catch(T){return null;}}function M(){return L||null;}function K(S,Q,R){delete L[S][Q][R];var T;for(T in L[S][Q]){return;}delete L[S][Q];for(T in L[S]){return;}delete L[S];}return{set:A,getByInstId:P,getByViewId:N,getByEventName:O,getAll:M,del:K};})()});C.mix(H,{ApplicationSubFolderList:(function(){var K={};function A(N,O){K[N]=O;}function M(N){return K[N]||null;}function L(N){K[N]=[];}return{set:A,get:M,del:L};})()});C.mix(H,{MessageReadRunList:(function(){var M={};function A(O,P){M[O]=P;}function L(O){return M[O]||null;}function K(O){delete M[O];}function N(){return M;}return{set:A,get:L,del:K,getAll:N};})()});},"1.0.0",{requires:["array-extras","om-common-utils"]});YUI.add("om-controller-applicationlist",function(D){var K=D.om,L=K.Controller,W=L.extend("ApplicationList"),Z=K.common.net.session,b=K.common.Utils,B=K.model.DataStore,T=B.Registry,A=B.ApplicationList,V=D.common.net,P=D.Lang,G=D.common.Utils.rocketstats,F=V.SessionMgr,X=B.APP_FLAGS,R="YahooMailNeoOM";function E(){function Y(e){G.stat("OM","ERR:uninstallCleanup:_onFailure");}if(Math.random()>=(1/100)){return;}var c={crumb:NeoConfig.om.crumb,cleanup:1},d=Z.getBaseCallback("openmail.app.instance.uninstall",null,Y);F.request(Z.getUrlForModule(d.method),c,d,"GET",null,true);}function N(){var c=A.getAll(),Y=B.folderConfigs;B.removeList=b.getDiffList(c,Y);B.updateList=b.getDiffList(Y,c);}function a(){var f=A.getAll(),d=B.folderConfigs,h=B.removeList,c=B.updateList,g,e,Y;if(!f){return;}for(e in h){delete d[h[e]];}for(e in c){for(Y in f){g=f[Y];if(c[e]===g.app){d[g.app]={app:g.app,instance:g.instance,label:g.label,tooltip:g.tooltip||"",image_url:g.image_url||"",status:g.status,count:-1,subFolders:[]};break;}}}}function M(d){var Y={},c=d.split(",");D.Array.each(c,function(e){e=e.split(":");if(e.length===2){Y[e[0]]=e[1];}});return Y;}function O(){if(window.om&&D.Object.getValue(om,["appProfile","data","length"])){D.Array.each(window.om.appProfile.data,function(Y){if(Y.value){B.currentProfile[Y.extensionId+"."+Y.instanceId]=M(Y.value);}});}}function I(){function d(g){var i=(g.fault?g.fault:g.body.error)||{},h=i.code;h=(!h||Z.isHttpError(h))?g.status+"":h;G.stat("OM","ERR:getAppVer:"+h);B.currentVersions=[];S();}function Y(h){var k=h.body?h.body.error:h.fault;if(k){d(h);return;}var m={},g,l,j=h.body.result.data;for(l in j){g=parseInt(j[l].value,10);m[j[l].extensionId+"."+j[l].instanceId]=isNaN(g)?0:g;}B.currentVersions=m;S();}function c(){var k,m,l,j=[],n,g,h="/ws/mailPreferences/v1/jsonrpc";for(k in e){m=e[k].instance.split(".");j.push({key:"_CG_ver",extensionId:m[0],instanceId:m[1]});}l={method:"GetExtensionData",params:[{query:j}],id:"123456789"};n={success:Y,failure:d,responseType:"json",exceptCodes:[401,402,999],suppressCodes:["*"]};g=F.request(h,D.JSON.stringify(l),n,"POST");g.addUrlParam("appid",R);g.send();}var e=A.getAll(),f;if(!e||e.length===0){return;}if(window.om&&D.Object.getValue(om,["appVersion","data","length"])){f={body:{result:window.om.appVersion}};Y(f);return;}c();}function Q(c){function h(i){}function l(i){}if(c.length===0){return;}var e,d,j=[],f,k,m,g,Y="/ws/mailPreferences/v1/jsonrpc";for(g in c){e=c[g];d=P.isString(e.value)?e.value:D.JSON.stringify(e.value);j.push({key:"_CG_ver",value:d,extensionId:e.extensionId,instanceId:e.instanceId,version:0,expiration:0});}f={method:"SetExtensionData",params:[{setdata:j}],id:"123456789"};k={success:l,failure:h,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};m=F.request(Y,D.JSON.stringify(f),k,"POST");m.addUrlParam("appid",R);m.send();}function C(){var g=A.getAll(),h=B.removeList,c=B.updateList,f,e,d,Y;for(d in h){T.del(h[d]);}for(d in c){f=c[d];for(Y in g){e=g[Y];if(f===e.app){T.set(f,e);break;}}}}function H(r){var n=A.getAll(),e=B.ApplicationConfig.getAll(),o={},m={},h,s,p=[],d,x,w,v=[],u=[],y=NeoConfig.om.isSandboxEnabled,g=T.isSandbox,t,j,z,k,f,q,l,Y,c;o=b.convertArrayIndex(e,"app");for(s in n){h=n[s].app;w=n[s].instance;if(o[h]){l=B.Loading.isLoading()?D.merge(o[h],n[s]):D.merge(n[s],o[h]);if(P.isString(l.omprofile)){Y=M(l.omprofile);l.omprofile=Y;if(!B.Loading.isLoading()){c=n[s].main_id;w=c?c+"."+w.split(".")[1]:w,B.currentProfile[w]=Y;}}A.set(s,l);m[h]=n[s];}}a();C();for(h in m){w=m[h].instance;d=m[h].version;x=B.currentVersions[w]||0;if(m[h].needsAck){continue;}if(d>x){B.currentVersions[w]=d;w=w.split(".");p.push({value:d,extensionId:w[0],instanceId:w[1]});}else{if(d<x){G.stat("OM","ERR:version_toolarge:"+h);delete m[h];}}}if(p.length>0){Q(p);}for(h in m){if(!T.isSick(h)&&(t=m[h])&&(j=t.config)&&(z=j.events)&&(!t.needsAck||(t.needsAck&&T.isNoDisclaimer(h)))){if((k=z.load)&&k.action&&(y||!g(h))){v.push(t);}if(y&&T.isPreload(h)&&(f=z.message_read)&&(q=f.action)&&q.launch&&q.launch.target_zone&&(q.launch.target_zone=="hidden")){u.push(t);}if(NeoConfig.isCorpmail&&T.isCorpmailDisabledApp(h)){T.del(h);}if(NeoConfig.isFresh&&T.isFreshDisabledApp(h)){T.del(h);}}}if((v.length>0)||(u.length>0)){D.use("om-controller-views",function(i){for(s in v){b.log("LOAD event: launching '"+v[s].name+"'");L.Views.runActions(v[s],"events","load",null,null,null,null,true);}for(s in u){b.log("ONREAD: PRELOAD: launching '"+u[s].name+"'");L.Views.runActions(u[s],"events","message_read",null,null,null,null,true);}});}if(r&&P.isFunction(r)){r(true);}if(B.Loading.isLoading()){B.Loading.set(false);D.later(5000,this,E);}}function S(m){function v(i){a();D.fire("om:updateFolders");if(m){m(0);}}function k(j){var x=j.body,p,w;if(!x){v(j);return;}for(p in x){try{if(P.isString(x[p].config)){x[p].config=D.JSON.parse(x[p].config);}}catch(w){G.stat("OM","ERR:Config_Invalid:"+x[p].app);x[p].config={};}}B.ApplicationConfig.setAll(x);H();if(m){m(1);}}var o=A.getAll(),Y=B.updateList,t=B.currentVersions,u=false,c=[],l=[],h,e,s,d,g,r,q,n,f;for(r in Y){d=Y[r];for(q in o){s=o[q];if(d===s.app){g=t[s.instance]?t[s.instance]:(s.version?parseInt(s.version):0);c.push(d+"_"+g);u=true;break;}}}c=c.sort();for(r in c){n=c[r].split("_");l.push("app."+n[0]);if(n.length>1){l.push("ver."+n[1]);}}if(u){h=Z.getBaseCallback("openmail.app.list",k,v);h.cache=true;f=[Z.getUrlForModule(h.method),".lang.",NeoConfig.lang,".intl.",NeoConfig.om.intl,".",l.join(".")].join("");D.common.net.SessionMgr.request(f,null,h,"GET",null,true);}else{e={body:[]};k(e);}}function U(){function c(f){a();D.fire("om:updateFolders",undefined,true);}function Y(f){if(!f.body){c(f);return;}if(P.isArray(f.body)){A.setAll(f.body);}else{A.setAll(f.body.apps,f.body.spriteURL);}if(NeoConfig.om&&!NeoConfig.om.isMiMEnabled){var h=A.getAll();for(var g=0;g<h.length;){if(T.isMessenger(h[g].app)){h.splice(g,1);}else{g++;}}}N();I();O();}var d,e;if(!window.om||!window.om.appData||(P.isArray(window.om.appData)&&!window.om.appData.length)||(window.om.appData.apps&&!window.om.appData.apps.length)){d={"crumb":NeoConfig.om.crumb,".intl":NeoConfig.om.intl,".lang":NeoConfig.lang};
e=Z.getBaseCallback("openmail.app.instance.list",Y,c);F.request(Z.getUrlForModule(e.method),d,e,"GET",null,true);}else{Y({body:window.om.appData});}}function J(){B.Loading.set(true);U();}D.mix(W,{loadApplication:J,updateAddRemoveList:N,mergeApplicationConfigs:H,getApplicationConfigs:S,updateFolderConfig:a,parseOmProfile:M},true);},"1.0.0",{requires:["om-controller-base","om-common-net-session","om-model-datastore","rocket-stats"]});YUI.add("om-common-errors",function(A){A.namespace("om.common.Errors");A.mix(A.om.common.Errors,{ERR_NONE:0,ERR_BAD_ARG:1,ERR_DEPRECATED:2,ERR_DELETED:3,ERR_XFRAME:4,ERR_UNSUPPORTED_BY_HOST:5,ERR_VIEW_NOT_FOUND:1000,ERR_INVALID_TARGET:1001,ERR_VIEW_EXISTS:1002,ERR_NOT_ATTACHMENT_URL:1003,ERR_SET_DATA:1004,ERR_GET_DATA:1005,ERR_KEY_NOT_SET:1006,ERR_KEY_EXPIRED:1007,ERR_KEY_FAILURE:1008,ERR_KEY_INVALID:1009,ERR_REMOVE_DATA:1010,ERR_VALIDATION_FAILURE:2000,ERR_AUTH:3000,ERR_FLASH_REQUIRED:3001,ERR_FLASH_ERR:3002,ERR_FLASH_LAUNCH_ERR:3003,ERR_API_UNAVAILABLE:3004,ERR_UNDEFINED:-1});},"1.0.0");YUI.add("_shared_module_open_mail_application_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_application_list={base:'<div class="items items-nav items-nav-applications collapsed" {{om_hide_app_until_bidi_ready}} data-action="collapsable"> <h2 role="toolbar" aria-labelledby="apps-toggle-btn" id="nav-applications" class="legend"><span id="apps-toggle-btn" role="button" tabindex="0" aria-controls="app-list" aria-expanded="true" class="label">{{str_nav_applications}}</span> <span class="rht"><span class="btn small left right hidden neo-tooltip" title="{{str_nav_applications_btn_edit_attr}}"><input tabindex="-1" class="icon edit" type="button" value="{{str_nav_applications_btn_edit}}"></span></span></h2> <ul id="app-list" class="hidden" role="listbox" aria-labelledby="apps-toggle-btn" aria-describedby="list-instr"> {{application_list}} </ul></div>',application_refresh:'<span class="rht" id="{{app_refblock_id}}"> <span class="btn small left right"><input id="{{app_ref_id}}" type="button" class="icon check-mail" value=" "></span> </span> ',application_count_markup:'<span class="unread-count" title="{{app_folder_count}}">{{app_folder_count}}</span> ',application_count:'<span class="rht"> {{application_count_markup}} </span> ',application_list_subfolder_count:'<span class="rht"> <span class="unread-count" title="{{app_sub_folder_count}}">{{app_sub_folder_count}}</span> </span> ',application_list_subfolder_row:'<li role="presentation" id="{{app_sub_folder_row_id}}"> <a role="option" tabindex="-1" href="#" title="{{app_sub_folder_tooltip}}">{{app_sub_folder_label}} {{application_list_subfolder_count}} </a> </li> ',application_list_subfolder:'<div role="presentation" id="{{app_subfolder_div_id}}"> <ul role="group"> {{application_list_subfolder_row}} </ul> </div> ',application_list:'<li role="presentation" data-action="application" id="{{app_row_id}}" class="btn-apps"> <a id="{{app_row_info_id}}" href="#" role="option" tabindex="-1" title="{{app_name}}"> <i id="{{app_row_name_id}}" style="background:url({{app_icon_url}}){{app_icon_pos}} no-repeat;">{{app_name}}</i> {{application_refresh}} {{application_count}} </a> {{application_list_subfolder}} </li> '};},"1.0.0");YUI.add("_shared_module_open_mail_webservice_container",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_webservice_container={base:"<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' id='{{flash_id}}' width='1' height='1'> <param name='movie' value='{{flash_src}}'/> <param name='allowScriptAccess' value='always'/> <embed src='{{flash_src}}' width='1' height='1' name='{{flash_id}}' allowScriptAccess='always' type='application/x-shockwave-flash'> </embed></object>"};},"1.0.0");YUI.add("om-controller-webservice",function(B){var L=B.om,F=L.Controller,H=F.extend("Webservice"),E=L.common.Errors,I=L.common.Utils,G=L.model.DataStore,K=B.common.Utils,A=K.rocketstats;function D(N,M){var T="omapiwsobj",S="http://l.yimg.com/nq/ued/assets/flash/wsclient_12.swf",R=null,Q=null,P,O;if(NeoConfig.isFullSSL&&S.match(/^http:\/\/l.yimg.com\/nq/)){S=S.replace(/^http:\/\/l/,"https://s");}P=K.substitute(B.ui.Templates._shared_module_open_mail_webservice_container.base,{flash_id:T,flash_src:S});window.wsclientFlashReady=function(){if(B.UA.ie===9){G.wsObject=document.getElementById(T);}else{G.wsObject=document[T]||window[T];}if(G.wsObject&&NeoConfig.om.wsdebug){G.wsObject.setDebug(true);}if(M){clearTimeout(R);clearTimeout(Q);M(true);}};window.wsclientReceive=function(Y,X,V,U){var W={data:(U==="text")?decodeURIComponent(X):X,httpStatus:V||null};N(G.wsCallMap[Y],W);delete G.wsCallMap[Y];};window.wsclientError=function(X,V,U){var W={error:E.ERR_FLASH_ERR,flashError:V.text,errorMsg:"Flash returned error "+V.text,httpStatus:U||null,errorDetail:{data:decodeURIComponent(V.data||""),errorID:V.errorID,type:V.type,text:V.text}};N(G.wsCallMap[X],W);delete G.wsCallMap[X];};window.wsclientLog=function(U){if(window.console){console.log("OM:WSClient",U);}};if(M){R=setTimeout(function(){M(false);},10000);}Q=setTimeout(function(){B.use("swfdetect",function(U){if(!U.UA.flashMajor){if(K.isBrowserCORSCapable()){U.use("io",function(V){V.io.header("X-Requested-With");G.wsObject={fetch:C};});clearTimeout(R);}}});},1500);O=document.createElement("DIV");O.style.position="absolute";O.style.top="-5000px";document.body.appendChild(O);O.innerHTML=P;}function C(O,N,M,R,Q,U){var V,S;function T(Y,W){var X="callWebService:"+(G.wsCallMap[O].appid)+":CORS:success:"+W.status;if(U==="binary"){receivedData=W.responseText;}else{receivedData=W.responseText;}window.wsclientReceive(O,receivedData,W.status,U);I.log(X);B.log(X);A.stat("OM","WS:CORS:success");}function P(Y,W){var X="callWebService:"+(G.wsCallMap[O].appid)+":CORS:failure:"+W.status;if(!W.status){V=G.wsCallMap[O],S=V.parameters.reason;F.Openapi.handleFlashRequired(V,S);}else{window.wsclientError(O,{data:W.responseText,type:"",text:W.statusText||"",errorID:""},W.status);}I.log(X);B.log(X);A.stat("OM","WS:CORS:failure");A.stat("OM","WS:CORS:failure:"+W.status);if(NeoConfig.log_error_yapache==1){B.use("common-utils-error",function(Z){Z.common.Utils.error.report("OM:"+X+":url:"+N);});}}B.io(N,{method:M||"GET",data:R||"",headers:J(Q),xdr:{use:"native"},on:{success:T,failure:P}});}function J(P){var Q={},O;if(!P){return Q;}for(var N=0,M=P.length;N<M;N++){O=(""+P[N]).match((/\s*([^:\s]*)\s*:\s*(.*)\s*/));if(O&&O[1]){Q[O[1]]=O[2];}}return Q;}B.mix(H,{createWebServiceObject:D},true);},"1.0.0",{requires:["om-controller-base","om-model-datastore","om-common-errors","om-common-utils","common-utils","_shared_module_open_mail_webservice_container"]});YUI.add("om-common-constants",function(A){A.mix(A.namespace("om.common.Constants"),{DIALOG_CANCEL:0,DIALOG_OK:1,OK:1,FAIL:0,UNDEFINED:2});},"1.0.0");YUI.add("om-controller-openapi",function(AA){var AK=AA.om,r=AK.Controller,w=r.extend("Openapi"),Aa=AK.model.DataStore,AG=Aa.Registry,n=Aa.ViewRegistry,e=Aa.EventRegistry,U=Aa.OpenViewLog,AN=Aa.APP_FLAGS,W=AK.common.Utils,AS=AK.common.Errors,AL=AK.common.net.session,y={error:AS.ERR_NONE},AH=AA.Lang,p=AA.common.Utils,AZ=AA.common.net.SessionMgr,C=AA.common.Utils.rocketstats,k="YahooMailNeoOM",Al=false,AE=[],F=100-Math.min(AA.config.windowResizeDelay||40,100),t={getParameters:u,setListener:AF,callWebService:h,setRecipients:AP,logMessage:A,loadAutoSuggest:x,getViewport:Ad,autoSuggestKeepOpen:AI,resizeAutoSuggestWindow:o,search:An,compose:AC,draft:I,openView:j,closeView:AD,openMessage:Z,setFolderConfig:AU,getAttachmentUrl:K,upgradeApplication:Ak,upgradeIfNecessary:a,filterHTML:R,setData:D,getData:N,removeData:Q,getAuthStatus:X,getUserAuthorizationUrl:H,notifyAuthorizationComplete:S,removeAuthorization:G,callAuthWebService:c,getAuthParameters:Ai,reportJSError:AY,setTabCloseMessage:Ag},z={SCOPE_MISMATCH:1,SCOPE_NOT_EXIST:2},b={OMXDB_SUCCESS:0,OMXDB_FAILURE:-1,OMXDB_KEY_DOES_NOT_EXIST:-2,OMXDB_INSTANCE_DOES_NOT_EXIST:-3,OMXDB_EXPIRED:-4,OMXDB_LOWER_VERSION:-5,OMXDB_INVALID_KEY:-6,OMXDB_BUSY:-7};function u(Y,Ap,As){var Ar=Y.parameters;if(Ar.reason==="data/message"&&Ar.data.from.name===undefined){if(W.compareVer(Y.apiVersion,"0.1.6")===-1){Ar.data.from=Ar.data.from[0];}}if(AA.Lang.isObject(Ar.user)){if(NeoConfig.isFresh&&NeoConfig.theme){var Aq=yui&&yui.config&&yui.config.groups&&yui.config.groups.mail_css;if(Aq){NeoConfig.theme.url=Aq.comboBase+Aq.root.replace(/css/,"theme")+NeoConfig.theme.id+"/"+NeoConfig.theme.id+"-fresh"+Aq.suffix+".css";}}Ar.user.themeinfo=NeoConfig.theme?{name:NeoConfig.theme.id,css:NeoConfig.theme.url}:{};}As&&As(Y,Ar);}function Ak(Y,Ap){AA.use("om-controller-views",function(As){var Aq=Y.id,Ar=U.get(Aq);r.Views.closeView(Aq);AT(Y.appid,Y.instanceid,Ar,false);});}function a(Ap,Ar){if(Ar.error){Ar.ctx=Ap;return;}var Y=Ap.id,Aq=U.get(Y);Ah(Ap,Aq,Ar.suppressMessaging);}function K(Aw,Ar){var Ap=Ar.url,At,Aq,Av,Ay,Az={mimeurl:Ap},Y=0,Au="&giveurl=1";if(Ar.hasOwnProperty("longtimeout")){Y=Ar.longtimeout;}function Ax(A1){try{return A1.match(/^https?:\/\/.*\.yahoo\.com\/(proxy\/)?ya\/download\?.*/);}catch(A0){}return false;}try{if(!Ax(Ap)){Az.error=AS.ERR_NOT_ATTACHMENT_URL;L(Aw,Az,true);return;}At=function(A1,A0){Az.url=A1.responseText;L(Aw,Az);};Aq=function(A1,A0){var A2=A1.body?A1.body.error:{code:-1};Az.error=AS.ERR_UNDEFINED;Az.errorMsg=A2.code;L(Aw,Az,true);};Av={success:At,failure:Aq,responseType:"text",suppressWssid:true,suppressCodes:["*"],exceptCodes:[401,402,999],timeout:5000,args:{}};if(Y==1){Au+="&longtimeout=1";}Ay=AZ.request(Ap+Au,null,Av,"GET");Ay.send();}catch(As){Az.error=AS.ERR_UNDEFINED;L(Aw,Az,true);}}function AO(Ar,Ax,Y,Ay,Au){var At,Az,As,Aq,Av,A1,Ap,A0;try{if(!Ar){if(Y){Y(null);}return;}As="content="+encodeURIComponent(Ar);if(Au){As+="&restrictOff=true";}Aq=function(A4,A3){var A2;if(Ax){A2=A4.responseText;At=2;while(At--){Az=A2.lastIndexOf("-->");if(Az===A2.length-4){Az=A2.lastIndexOf("<!--");if(Az!==-1){A2=A2.slice(0,Az);}}}Ax(A2);}};Av=function(A3,A2){if(A3.fault){C.stat("OM","ERR:yivValidate");C.stat("OM","ERR:yivValidate:"+A3.fault.code);}if(Y){Y("YIV validation failed ."+(A3&&A3.responseText?A3.responseText:""),Ar);}};A0={success:Aq,failure:Av,responseType:"x-www-form-urlencoded",suppressWssid:true,suppressCodes:["*"],exceptCodes:[401,402,999],timeout:5000,args:{}};Ap=A0.args;if(Ay){Ap.argument=Ay;}A1=AZ.request("/om/yiv/om_yiv.php",As,A0,"POST");A1.setHeader("Content-length",String(As.length));A1.setHeader("Connection","close");A1.send();}catch(Aw){C.stat("OM","ERR:YIVValidation:"+AA.JSON.stringify(Aw));Y("YIV Validation of message failed : "+Aw.description,Ar);}}function R(Y,Ap){function Ar(As){L(Y,{html:As});}function Aq(As,At){L(Y,{error:AS.ERR_UNDEFINED,errorMsg:As});}AO(Ap.html,Ar,Aq,null,true);}function Ah(Ap,Aq,Ar){var Y=AG.get(Ap.appid).version;function Av(Ax,Aw){L(Ap,{error:AS.ERR_UNDEFINED,errorMsg:"Couldn't fetch version"});}function At(Ax,Aw){var A0,Ay;try{A0=Ax.body;Ay=A0[0].version;if(Ay===undefined){L(Ap,{error:AS.ERR_UNDEFINED,errorMsg:"couldn't retrieve server version"});return;}if(Y>=Ay){L(Ap,{data:"app up to date (ver "+Ay+")"});return;}AT(Ap.appid,Ap.instanceid,Aq,Ar);}catch(Az){L(Ap,{error:AS.ERR_UNDEFINED,errorMsg:"exception during upgrade"});return;}}var As={app:Ap.appid,ver:Y,lang:NeoConfig.lang,intl:NeoConfig.om.intl},Au=AL.getBaseCallback("openmail.app.list",At,Av);AZ.request(AL.getUrlForModule(Au.method),As,Au,"GET",null,true);}function AT(Ar,Ap,Y,Aq){AA.use("om-controller-views",function(At){var Au=Aa.ViewRegistry.getAll(),Av=r.Views,As=false,Aw=AG.isSandbox(Ar)||AG.isMessenger(Ar),Ay,Ax;function A0(){if(Y){Av.openView.apply(this,Y);}}function Az(){if(!Aw){Av.closeApplication(Ar,Ap);}Aa.removeList=[];Aa.updateList=[Ar];var A1=Y?A0:null;At.use("om-controller-applicationlist",function(A2){r.ApplicationList.getApplicationConfigs(A1);});}for(Ax in Au){Ay=Au[Ax];if(Au.hasOwnProperty(Ax)&&Ar===Ay.get("appId")){if(Ay.name&&Ay.name==="omHiddenView"||Ay.get("closing")){continue;}As=true;break;}}if(Aq||!As||Aw){Az();return;}At.use("common-ui-dialog-helper",function(A3){var A2={hd:strings.str_om_tou_title,bd:strings.str_om_upgrade_choice};function A1(A4){if(A4.dataAction==="ok"){Az();}}A3.common.ui.DialogHelper.confirm(A2,{ok:{handler:A1},cancel:{handler:A1}});});});}function h(Y,Ap){T(Y,Y.cbid,Ap.url,Ap.method,Ap.parameters,Ap.headers,Ap.dataformat);}function x(Y,Ap){AA.fire("om:loadautosuggest",{context:Y,data:Ap});}function Ad(Ap,Aq){var Y=W.getViewport();L(Ap,Y);}function o(Y,Ap){AA.fire("om:resize",{context:Y,data:Ap});}function AI(Y,Ap){AA.fire("om:autoSuggestKeepOpen",{context:Y,data:Ap});}function AP(A1,Aw){var Av=Aw.emailIds||[],Ax,Aq,Ar=Av.length,As,Ay="";for(var At=0;At<Ar;At++){emailId=Av[At];Ax=emailId.email;Aq=emailId.name;if(Ax){Ay+=(Aq?Aq:"")+"<"+Ax+">,";}}var Ap=AA.mail.Tabs.getActiveTab(),Au=Ap.widget;if(Au&&Au.NAME==="AuthorView"){As=Au.get("focusNode");
As.set("value",Ay);Au.composeView.header._lozengeIt(As);return As.focus();}var Az=function(A2,A3){if(A2.NAME==="AuthorView"){return true;}};var A0=AA.mail.Tabs.getTab(Az);if(A0&&A0.widget){var Y=A0.widget;As=Y.get("focusNode");As.set("value",Ay);Y.composeView.header._lozengeIt(As);return As.focus();}}function Ab(Ap){for(var Y in Ap){if(Ap[Y].match(/^content-type:\s*application\/json/i)||Ap[Y].match(/^content-type:\s*multipart\/form-data/i)){return true;}}return false;}function Ao(Ap){for(var Y in Ap){if(Ap[Y].match(/^content-type:\s*application\/json/i)){return true;}}return false;}function g(Aq){var Ap={},Ar,As;for(var Y in Aq){Ar=encodeURIComponent(Y);As=encodeURIComponent(Aq[Y]);Ap[Ar]=As;}return Ap;}function AR(Aq,Ar){var Y=Aq,As=[];if(Ar&&!p.isEmpty(Ar)){if(Aq.search(/\?/)===-1){Y+="?";}if(Aq.search(/[\&=]/)!==-1){Y+="&";}for(var Ap in Ar){As.push(Ap+"="+Ar[Ap]);}Y+=As.join("&");}return Y;}function AB(Y){if(Y!=="events/load"&&Y!=="events/message_read"&&Y!=="events/message_render"){AA.use("common-ui-dialog-helper",function(Ap){Ap.common.ui.DialogHelper.alert({hd:strings.str_om_error_flash_unavailable_title,bd:strings.str_om_error_flash_unavailable_body});});}C.stat("OM","Noflash_appinvoke");}function P(Y,Ap){var Aq;Aq={error:AS.ERR_FLASH_REQUIRED,errorMsg:"callWebService requires the client to have Flash installed."};AB(Ap);L(Y,Aq,true);}function V(Y,Ap){var Aq;Aq={error:AS.ERR_FLASH_LAUNCH_ERR,errorMsg:"callWebService was unable to launch Flash.  Flash may be blocked or a Flash error may have occurred."};AB(Ap);L(Y,Aq,true);}function Ae(Y,Ap){return function(){T.apply(Y,Ap);};}function f(A0,Ar,Ap,Y,Au,At,Aw){var Ay=Aa.wsObject,Ax=Ap,As,Az,Aq=(Y.search(/GET/i)!==-1)?true:false,Av=Ao(At);Aw=Aw||"text";Aa.wsCallMap[Ar]=A0;W.log("callWebService",AG.getAppName(A0.appid)+".API");if(Aq){Ax=AR(Ap,g(Au));}else{if(Av){As=Au;}else{Az=p.parseQueryString(Ap);if(Az&&Au){As=p.merge(Az,Au);}else{if(Au){As=Au;}else{As=Az;}}}}if(Aq){Ay.fetch(Ar,Ax,Y,null,null,Aw);}else{Ay.fetch(Ar,Ax,Y,As,At,Aw);}}function T(Aw,Aq,Ap,Y,As,Ar,Av){var At=Ap.substring(0,Ap.indexOf(":")),Au;if(At==="apps"){if(!(r.Internalapi&&r.Internalapi.internalAPI)){AA.use("om-controller-internalapi",function(Ax){r.Internalapi.internalAPI(Aw,As);});}else{r.Internalapi.internalAPI(Aw,As);}return;}if(Aa.wsObject){f(Aw,Aq,Ap,Y,As,Ar,Av);}else{AA.use("swfdetect",function(Ax){if(!Ax.SWFDetect.isFlashVersionAtLeast(9,0,115)){Au=Aw.parameters.reason;P(Aw,Au);}else{if(Al){Au=Aw.parameters.reason;V(Aw,Au);}else{AE.push(Ae(this,[Aw,Aq,Ap,Y,As,Ar,Av]));}}});}}function An(Y,Ap){AA.fire("search:input",{query:p.escapeHtml(Ap.query)});L(Y,y,true);}function D(Y,Ap){var Ar,Aq;if(W.compareVer(Y.apiVersion,"0.1.7")===-1){Ar=Ap.data;Ap.keys=[];Ap.ttl=[];for(Aq in Ar){Ap.keys[Ar[Aq][0]]=Ar[Aq][1];if(Ar[Aq][2]){Ap.ttl[Ar[Aq][0]]=Ar[Aq][2];}}delete Ap.data;}Aj(Y.instanceid,Y,Ap);}function Aj(A2,A0,A5){function Ay(A7){L(A0,y,true);}function A6(A7){var BA=(A7.fault?A7.fault:A7.body.error)||{},A9=BA.code;A9=!A9||AL.isHttpError(A9)?A7.status:A9;C.stat("OM","ERR:setAppData:"+A9);var A8={error:AS.ERR_SET_DATA,errorMsg:BA.message||""};L(A0,A8,true);}var Ap=A2.split("."),Y=AG.getProperty(Ap[0],"main_id"),Az=B(Ap[0]),Au="",Av="",As=0,A4,At=[],Ax,A3,Aw="/[?|*]/";Aw=new RegExp(Aw.substr(1,(Aw.length-2)),"g");for(A3 in A5.keys){Au="_APP_"+A3.replace(Aw,"");Av=A5.keys[A3];Av=AA.JSON.stringify(Av);As=A5.ttl?(A5.ttl[A3]||0):0;if(As!==0){A4=new Date();As+=Math.round(A4.getTime()/1000);}At.push({key:Au,value:Av,extensionId:Y||Ap[0],instanceId:Ap[1],version:Az,expiration:As});}var A1={method:"SetExtensionData",params:[{setdata:At}],id:"123456789"},Aq="/ws/mailPreferences/v1/jsonrpc",Ar={success:Ay,failure:A6,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};Ax=AZ.request(Aq,AA.JSON.stringify(A1),Ar,"POST");Ax.addUrlParam("appid",k);Ax.send();}function N(Y,Ap){AM(Y.instanceid,Y,Ap);}function AM(Aq,A1,Ax){var Aw=Ax.keys,A0=Aq.split("."),Ap=AG.getProperty(A0[0],"main_id"),Au=0,As=[],A2,Ar,At,Y,Az;if(!AH.isUndefined(Ax.pageInfo)){Au=Ax.pageInfo.iOffset;}function Ay(A9){var BB={},BC={},A7={},BE=[];if(!AH.isUndefined(Ax.pageInfo)){BB=Ax.pageInfo.oPagedData;BC=Ax.pageInfo.oPagedVer;A7=Ax.pageInfo.oPagedErr;BE=Ax.pageInfo.keyErrors;}var A3=A9.body,A5=A3.result.data,BF="",A8=null,BA;for(BA in A5){BF=A5[BA].key.substr("_APP_".length);A8=A5[BA].value;try{BB[BF]=A8?AA.JSON.parse(A8):A8;}catch(BD){BB[BF]=A8;}BC[BF]=A5[BA].version;switch(A5[BA].errorCode){case b.OMXDB_SUCCESS:A7[BF]=AS.ERR_NONE;break;case b.OMXDB_EXPIRED:A7[BF]=AS.ERR_KEY_EXPIRED;break;case b.OMXDB_KEY_DOES_NOT_EXIST:case b.OMXDB_INSTANCE_DOES_NOT_EXIST:A7[BF]=AS.ERR_KEY_NOT_SET;break;case b.OMXDB_INVALID_KEY:A7[BF]=AS.ERR_KEY_INVALID;break;case b.OMXDB_FAILURE:case b.OMXDB_LOWER_VERSION:case b.OMXDB_BUSY:A7[BF]=AS.ERR_KEY_FAILURE;break;default:A7[BF]=AS.ERR_KEY_FAILURE;break;}if(A5[BA].errorCode!==b.OMXDB_SUCCESS){C.stat("OM","ERR:getAppData:"+A5[BA].errorCode);BE.push(BF);}}var A6=A3.result.totalCount,A4=A3.result.returnCount;if((A4+Au)<A6){Ax.pageInfo={oPagedData:BB,oPagedVer:BC,oPagedErr:A7,iOffset:Au+A4,keyErrors:BE};d(Ax.$cmd,A1,Ax);return;}var BG={data:BB,version:BC,errorCode:A7,totalCount:A6};if(BE.length){BG.warn=AS.ERR_GET_DATA;BG.errorMsg="Errors in key(s): "+BE.join(", ");}L(A1,BG);}function Av(A3){var A6=(A3.fault?A3.fault:A3.body.error)||{},A5=A6.code;A5=!A5||AL.isHttpError(A5)?A3.status:A5;C.stat("OM","ERR:getAppData:"+A5);var A4={error:AS.ERR_GET_DATA,errorMsg:A6.message||""};L(A1,A4,true);}for(At in Aw){As.push("_APP_"+Aw[At]);}Ar={method:"GetExtensionData",params:[{query:{key:As,extensionId:Ap||A0[0],instanceId:A0[1]},maxReturn:Number(20),offset:Au}],id:"123456789"};Y="/ws/mailPreferences/v1/jsonrpc";Az={success:Ay,failure:Av,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};A2=AZ.request(Y,AA.JSON.stringify(Ar),Az,"POST");A2.addUrlParam("appid",k);A2.send();}function Q(Y,Ap){Ac(Y.instanceid,Y,Ap);}function Ac(Ap,Az,Av){var At=Av.keys,Ay=Ap.split("."),Au=[],A0,Ar;function Ax(A1){L(Az,y,true);
}function As(A1){var A4=(A1.fault?A1.fault:A1.body.error)||{},A3=A4.code;A3=!A3||AL.isHttpError(A3)?A1.status:A3;C.stat("OM","ERR:removeAppData:"+A3);var A2={error:AS.ERR_REMOVE_DATA,errorMsg:A4.message||""};L(Az,A2,true);}for(Ar in At){Au.push("_APP_"+At[Ar]);}var Aq={method:"DeleteExtensionData",params:[{query:{key:Au,extensionId:Ay[0],instanceId:Ay[1]}}],id:"123456789"},Y="/ws/mailPreferences/v1/jsonrpc",Aw={success:Ax,failure:As,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};A0=AZ.request(Y,AA.JSON.stringify(Aq),Aw,"POST");A0.addUrlParam("appid",k);A0.send();}function X(Y,Ap){Af(Y.instanceid,Y,Ap.profile);}function H(Y,Ap){AX(Y.instanceid,Y,Ap.profile,Ap.params);}function S(Y,Ap){AW(Y.instanceid,Y,Ap.profile);}function G(Y,Ap){Am(Y.instanceid,Y,Ap.profile);}function s(Ay,Ar,Aq){var Aw,As,Ax=Ay.appid,Ap=AG.getProperty(Ay.appid,"main_id"),At=Ap?Ap+"."+Ay.instanceid.split(".")[1]:Ay.instanceid,Av=O(At,Ar);function Au(Az,A2){var A1=AG.getProperty(Ax,"omprofile"),A0=r.ApplicationList.parseOmProfile(Az.body.cache);if(A1[Aq]===A0[Aq]){if(!Aa.currentProfile[At]){Aa.currentProfile[At]={};}Aa.currentProfile[At][Aq]=A1[Aq];}Av.refresh=false;AA.Array.each(Av.backlog,function(A3){Ai.apply(this,A3);});Av.backlog=[];}function Y(Az,A0){AA.Array.each(Av.backlog,function(A1){L(A1[0],i(Az));});Av.refresh=false;Av.backlog=[];}Aw=AL.getBaseCallback("openmail.app.auth.login.complete",Au,Y);As={crumb:NeoConfig.om.crumb,instance:At,profile:Ar};AZ.request(AL.getUrlForModule(Aw.method),As,Aw,"GET",null,true);}function AQ(Y,Ap){var Au=Ap.appid,Aq=AG.getProperty(Au,"main_id"),As=Aq?Aq+"."+Ap.instanceid.split(".")[1]:Ap.instanceid,Ar=AG.getProperty(Au,"omprofile"),At=Aa.currentProfile[As];if(!(Ar&&Ar[Y])){return z.SCOPE_NOT_EXIST;}if(!(At&&At[Y])){return z.SCOPE_MISMATCH;}if(Ar[Y]!==At[Y]){return z.SCOPE_MISMATCH;}return;}function Ai(Ay,Au){var Aq=Au.profile,Y=AG.getProperty(Ay.appid,"main_id"),At=Y?Y+"."+Ay.instanceid.split(".")[1]:Ay.instanceid,Av=O(At,Aq),Az,A0,As;if(Aq!=="_openmail_internal"){return;}if(Av.refresh){Av.backlog.push([Ay,Au]);}As=AQ("email-r",Ay);if(As===z.SCOPE_MISMATCH){function Aw(){Av.backlog.push([Ay,Au]);Av.refresh=true;s(Ay,Aq,"email-r");}function Ax(A1){var A3="User authorization denied",A2={error:AS.ERR_AUTH,errorMsg:A3};L(Ay,A2);}Az={source:"getauthparameters",callback:Ax};if(AG.isNoDisclaimer(Ay.appid)){s(Ay,Aq,"email-r");}else{AA.use("om-controller-addremoveapp",function(A1){r.AddRemoveApp.showLegal(Ay.appid,Az,Aw);});}return;}if(As===z.SCOPE_NOT_EXIST){var Ap="Authorization service ["+Aq+"] does not exist for this application",Ar={error:AS.ERR_AUTH,errorMsg:Ap};L(Ay,Ar);return;}A0={user:{email:NeoConfig.userDataObj.userSendPref.defaultFromAddress,name:NeoConfig.userDataObj.userSendPref.defaultFromName}};L(Ay,A0);}function c(Y,Ap){J(Y,Y.cbid,Ap.profile,Ap.url,Ap.method,Ap.parameters,Ap.body,Ap.headers,Ap.dataformat,Ap.rewrite);}var v={},m={error:AS.ERR_AUTH};function O(Y,Aq){var Ap=Y+"_"+Aq;if(undefined===v[Ap]){v[Ap]={backlog:[],refresh:false};}return v[Ap];}function Af(Y,Ap,Aq){var Av,At,Ar=O(Y,Aq);function As(Ax,Az){var A1,Aw,Ay;try{A1=Ax.body;if(A1.cache!==undefined){Ar.cache=A1.cache;if(A1.version!==undefined){Ar.version=A1.version;}}else{delete Ar.cache;delete Ar.version;}Aw={status:A1.status};if(A1.data){Aw.info=A1.data;}L(Ap,{data:Aw});}catch(A0){Ay={error:AS.ERR_AUTH,errorMsg:A0.toString()};L(Ap,Ay);}}function Au(Aw,Ax){L(Ap,i(Aw));}Av=AL.getBaseCallback("openmail.app.auth.status",As,Au);At={crumb:NeoConfig.om.crumb,instance:Y,profile:Aq};AZ.request(AL.getUrlForModule(Av.method),At,Av,"GET",null,true);}function i(Y){var Aq=Y.fault,Ap={error:AS.ERR_AUTH,errorMsg:Aq.message,errorDetail:{errorCode:Aq.code,detail:Aq.detail,httpStatus:Y.status,httpStatusTxt:Y.statusText}};return Ap;}function AX(Au,Aw,Aq,Ar){var Av,Ap,At=O(Au,Aq);if(!Ar){Ar={};}function As(Ay,A0){var A2,Ax,Az;try{A2=Ay.body;if(A2.cache!==undefined){At.cache=A2.cache;if(A2.version!==undefined){At.version=A2.version;}}else{delete At.cache;delete At.version;}Ax={};Ax.data={url:A2.data};L(Aw,Ax);}catch(A1){Az={error:AS.ERR_AUTH,errorMsg:A1.toString()};L(Aw,Az);}}function Y(Ax,Ay){L(Aw,i(Ax));}Av=AL.getBaseCallback("openmail.app.auth.login.url",As,Y);Ap={crumb:NeoConfig.om.crumb,instance:Au,profile:Aq,params:AA.JSON.stringify(Ar)};AZ.request(AL.getUrlForModule(Av.method),Ap,Av,"GET",null,true);}function AW(Y,Ap,Aq){var Av,At,Ar=O(Y,Aq);function As(Aw,Ay){var A2,A0,Az,Ax;try{A2=Aw.body;if(A2.cache!==undefined){Ar.cache=A2.cache;if(A2.version!==undefined){Ar.version=A2.version;}}else{delete Ar.cache;delete Ar.version;}A0={};if(A2.data){A0.info=A2.data;}Az={};Az.data=A0;L(Ap,Az);}catch(A1){Ax={error:AS.ERR_AUTH,errorMsg:A1.toString()};L(Ap,Ax);}}function Au(Aw,Az){var A1,A3,Ax={},A0,Ay,A2;if(Aq==="_yahoo_internal"){A1=Y.split(".")[0];A3=AG.get(A1);Ax.appName=A3.name;}L(Ap,i(Aw));}Av=AL.getBaseCallback("openmail.app.auth.login.complete",As,Au);At={crumb:NeoConfig.om.crumb,instance:Y,profile:Aq};if(Ar.cache){At.cache=Ar.cache;}if(Ar.version){At.version=Ar.version;}AZ.request(AL.getUrlForModule(Av.method),At,Av,"GET",null,true);}function Am(Y,Ap,Aq){var Av,At,Ar=O(Y,Aq);function As(Aw,Ax){delete Ar.cache;delete Ar.version;L(Ap,{});}function Au(Aw,Ax){L(Ap,i(Aw));}Av=AL.getBaseCallback("openmail.app.auth.revoke",As,Au);At={crumb:NeoConfig.om.crumb,instance:Y,profile:Aq};AZ.request(AL.getUrlForModule(Av.method),At,Av,"GET",null,true);}function q(Av,Ap,As,Aq){var Aw,Ar,Au=O(Av,Ap);function At(Ax,A0){var Az,Ay,A2,A1=Ax.body;if(A1.cache!==undefined){Au.cache=A1.cache;if(A1.version!==undefined){Au.version=A1.version;}}else{delete Au.cache;delete Au.version;}Au.refresh=false;Az=Au.backlog;for(Ay in Az){A2=Az[Ay];J.apply(this,A2);}Au.backlog=[];}function Y(Ax,A1){var A0,Az,A3,Ay={},A2;if(Ap==="_yahoo_internal"){A2=Av.split(".")[0];A3=AG.get(A2);Ay.appName=A3.name;}A0=Au.backlog;for(Az in A0){L(A0[Az][0],m);}Au.backlog=[];Au.refresh=false;}Aw=AL.getBaseCallback("openmail.app.auth.login.complete",At,Y);Ar={crumb:NeoConfig.om.crumb,instance:Av,profile:Ap};
if(!As){if(Au.cache){Ar.cache=Au.cache;}if(Au.version){Ar.version=Au.version;}}if(Aq){Ar.install_token=Aq;}AZ.request(AL.getUrlForModule(Aw.method),Ar,Aw,"GET",null,true);}function J(A3,Ar,Au,Aq,Y,Av,Aw,At,Ax,A0){var A2,As,A1=A3.instanceid,Az=O(A1,Au);if(Az.refresh){Az.backlog.push([A3,Ar,Au,Aq,Y,Av,Aw,At,Ax,A0]);}function Ay(A5,A7){var A9,A4,A6;try{A9=A5.body;if(A9.cache!==undefined){Az.cache=A9.cache;}if(A9.status==="complete"){L(A3,{data:A9.data});return;}A4=A9.data;if(Ab(At)){A4.url=AR(A4.url,g(A4.params));f(A3,Ar,A4.url,Y,Aw,At,Ax);}else{f(A3,Ar,A4.url,Y,A4.params,At,Ax);}}catch(A8){A6={error:AS.ERR_AUTH,errorMsg:A8.toString()};L(A3,A6);}}function Ap(A8,BA){var A4=A8.body,A6,BC={},BB,A9,A5,A7;if(A4&&A4.status==="408"){Az.backlog.push([A3,Ar,Au,Aq,Y,Av,Aw,At,Ax,A0]);if(!Az.refresh){Az.refresh=true;setTimeout(function(){q(A1,Au);},500);}}else{if(Au==="_yahoo_internal"&&A4&&(A4.status==="407"||A4.status==="410")){A6=function(BD){var BF="User authorization denied",BE={error:AS.ERR_AUTH,errorMsg:BF};C.stat("OM","ERR:callAuthWebService:"+BF);L(A3,BE);};BC={source:"signcall",callback:A6};BB=function(BD){Az.backlog.push([A3,Ar,Au,Aq,Y,Av,Aw,At,Ax,A0]);Az.refresh=true;var BE=true;setTimeout(function(){q(A1,Au,BE,BD);},500);};if(AG.isNoDisclaimer(A3.appid)){BB(null);}else{AA.use("om-controller-addremoveapp",function(BD){r.AddRemoveApp.showLegal(A3.appid,BC,BB);});}}else{C.stat("OM","ERR:callAuthWebService:"+A8.fault.message);L(A3,i(A8));}}}A2=AL.getBaseCallback("openmail.app.auth.sign",Ay,Ap);As={crumb:NeoConfig.om.crumb,instance:A1,profile:Au,url:Aq,method:Y,params:AA.JSON.stringify(Av),body:Aw||""};if(At){As.headers=AA.JSON.stringify(At);}if(Az.cache){As.cache=Az.cache;}if(A0&&A0.proxy&&A0.url){As.rewrite=AA.JSON.stringify(A0);}if(Az.version){As.version=Az.version;}AZ.request(AL.getUrlForModule(A2.method),As,A2,"GET",null,true);}function AC(Y,Ar){var Aq={warn:"openmail.Errors.ERR_VALIDATION_FAILURE"};var As=function(){AA.fire("newMessage",{forceNew:true,cbfn:function(A1,Au){var Ax,Az=A1.get("isRichText");if(Ar.appid){A1.appid=Ar.appid;}var Aw=function(A4){var A5=[],A3=[];if(AH.isArray(A4)){A3=AA.clone(A4);}else{A5=A4.split(",");AA.Array.each(A5,function(A7,A6,A8){if(A7){A3.push({email:A7});}});}return A3;};var Ay=function(A4,A5){A1.set("content",A4);var A3=y;if(A5){A3={warn:AS.ERR_VALIDATION_FAILURE};}A3.instance=A1._yuid;L(Y,A3,true);};var A2=function(A4,A3){var A5=p.escapeHtml(A3||"")||"";Ay(A5,true);};var Av=function(A3){Ar.to=Ar.to||"";Ar.cc=Ar.cc||"";Ar.subject=Ar.subject||"";A3.to=Aw(Ar.to);A3.cc=Aw(Ar.cc);if(!AA.Lang.isUndefined(Ar.bcc)&&!AA.Lang.isNull(Ar.bcc)){A3.bcc=Aw(Ar.bcc);}A3.subject=Ar.subject;return A3;};var A0=Av(A1.get("header"));A1.set("header",A0);if(Ar.html&&Az){AO(Ar.body,Ay,A2,Ar,true);}else{Ax=p.escapeHtml(Ar.body||"");Ay(Ax||"");}},postRender:function(Au,Aw){var Av=Ar.attachments;if(Av&&Av.length){At(Av,Au);}}});};var At=function(Ax,Ay){var A2=[],A0,A1=AA.Lang.isObject;function Az(A4){var A3={filename:A4.filename||"",size:{original:Math.max(0,parseInt(A4.size||0,10))},state:{uploaded:true,processed:true},original:{partId:A4.partId,mid:A4.mid,fid:A4.fid,tnef:A4.tnef||""}};return A3;}function Av(A3){return A1(A3)&&A3.mid&&A3.fid&&A3.partId;}for(var Aw=0,Au=Ax.length;Aw<Au;Aw++){Av(Ax[Aw])&&A2.push(Az(Ax[Aw]));}if(A2.length){Ay.cdo._addAttachments(A2);A0=Ay.cdo.get("origin");A0.action="om:app";Ay.cdo.set("origin",A0);}};var Ap=AA.common.persist.UserData.get("userUIPref.useRichText");if((Ap==="plain")&&Ar.html){AA.use("common-ui-dialog-helper",function(Au){Au.common.ui.DialogHelper.confirm({hd:strings.str_om_switch_to_rich_text_title,bd:strings.str_om_switch_to_rich_text_body,suppressActive:true},{ok:{handler:function(){Au.common.persist.UserData.set("userUIPref.useRichText","dynamic");As();}},cancel:{handler:function(){Ar.body=Au.mail.Controller.Compose.convertHTMLToPlain(Ar.body);As();}}});});}else{As();}}function j(Y,Ap){var Aq={warn:"openmail.Errors.ERR_VIEW_EXISTS"};AA.use("om-controller-views",function(Au){var Av=r.Views,As=Av.getInternalUserViewId(Y.appid,Ap.id),Ar=n.get(As),At=Ar?Aq:y;Av.openView(Y.appid,Y.instanceid,As,Ap.view,Ap.viewType,Ap.target,Ap.context||null,Ap.parameters||null,Ap.width,Ap.height,Ap.ttl||0,Ap.title||"","api/openView",Y,null,null,null,Ap.options||{},function(Aw){L(Y,Aw,true);});});}function AD(Y,Ap){AA.use("om-controller-views",function(At){var Au=r.Views,As={},Ar=Ap.id?Au.getInternalUserViewId(Y.appid,Ap.id):Y.id,Aq=n.get(Ar);if(Aq){Au.closeView(Ar);L(Y,y,true);}else{As.error=AS.ERR_VIEW_NOT_FOUND;As.errorMsg="The application does not have a view named '"+Ar+"'";L(Y,As,true);}});}function I(Y,Ap){Ap=Ap||{};Ap.folderId="Draft";Z(Y,Ap);}function Z(Ax,As){var Aq=AA.mail.model.DataStore,Y=AA.mail.Controller.Messages,Au=Aq.Messages,Av,Ap;As=As||{};Av=As.messageId;Ap=As.folderId;try{if(!Aq.Folders.getByName(Ap)){L(Ax,{error:AS.ERR_UNDEFINED,errorMsg:"Invalid folder id"});}else{function Aw(){L(Ax,{error:AS.ERR_UNDEFINED,errorMsg:"Unable to load message"});}function At(){Y.get({fid:Ap,msg:Au.get(Ap,Av)},{success:function(){AA.fire("openMessage",{fid:Ap,msg:Av});},failure:Aw});}if(Au.get(Ap,Av)){At();}else{Y.list({fid:Ap,offsetMid:Av,numInfo:1,startInfo:0},{success:function(Ay){Au.set(Ap,Ay.messageInfo);At();},failure:Aw});}}}catch(Ar){L(Ax,{error:AS.ERR_UNDEFINED});}}function AV(As,Y,Ap,Ar){function Au(Av){As.label=encodeURIComponent(Av);delete As.htmlLabel;Aq();}function Aq(){Y.asyncCount--;if(!Y.asyncCount){AA.fire("om:updateSingleFolder",{ctx:Ap,config:Ar});L(Ap,y,true);}}var At=false;if(As.label){As.label=p.escapeHtml(As.label);}else{if(As.htmlLabel){As.label=p.escapeHtml(As.htmlLabel);At=true;Y.asyncCount++;AO(As.htmlLabel,Au,Aq);}}if(As.icon){delete As.icon;}if(As.tooltip){As.tooltip=p.escapeHtml(As.tooltip);}return At;}function M(Ap,Aq){var Ar,At,As=false;var Y={asyncCount:0};As|=AV(Aq,Y,Ap,Aq);if(Aq.subFolders){for(Ar=0,At=Aq.subFolders;Ar<At.length;Ar++){As|=AV(At[Ar],Y,Ap,Aq);}}return As;}function AU(Y,Ap){if(!M(Y,Ap)){AA.fire("om:updateSingleFolder",{ctx:Y,config:Ap});
L(Y,y,true);}}function AY(A1,Aw){var A0=A1.appid,Aq=A1.instanceid,Az=A1.id,Ax=AG.get(A0).name,Au=W.getEventName(Aq,"app.jserror",Az),As=Aw.message,Ap=Aw.url||Aw.pageurl,Ar=Aw.linenumber||Aw.errorcode,Y=Aa.MessageReadRunList.getAll(),Ay,At,Av=false;C.stat("OM","API:JSERROR");C.stat("OM","API:JSERROR:"+A0.toLowerCase());for(Ay in Y){AA.fire("message.read.jserror"+Ay);}if(e.getByEventName(Aq,Az,Au)){AA.fire(Au,{app:A0,instance:Aq,appName:Ax,message:As,url:Ap,lineno:Ar});Av=true;}At=['openapi: app "',Ax,'" ',(Av?"handled":"didn't handle")," a JS error. ","line:",Ar,"/ msg:",As,"/ url: ",Ap].join("");W.log(At);if(NeoConfig.log_error_yapache==1){AA.use("common-utils-error",function(A2){A2.common.Utils.error.report(At,1);});}}var AJ=new W.LookupList("crumb.update","app.uninstalled","mail.signout","contacts.sendsms","contacts.sendim","contacts.changed","tab.changed","social.statuschanged","chats.sendim","chats.sendsms");function AF(Av,Ar){var Ax=Av.appid,Y=Ar.event,Au=Ar.crumb,Aq=Av.instanceid,Ap=Av.id,At=W.getEventName(Aq,Y,Ap),Aw=(Y===At);if((Y in AJ||W.Event.isMailEvent(Y))&&NeoConfig.om.crumb!==Au){return;}function As(Az){Az.$keep=true;try{for(var Ay in e.getByInstId(Aq)){L(e.getByEventName(Aq,Ay,At),Az);}}catch(A0){return;}Az.handled=true;}if(!Aw){AA.detachAll(At);}e.set(Av,As,Aq,Ap,At);AA.on(At,As);AA.fire(At+"registered",At,Ar);}function A(Y,Ap){var Aq=Ap.logs||[];if(Aq.length){AA.fire("om:logStats",{appid:Y.appid,logs:Aq});}}function Ag(Y,Ap){AA.use("om-controller-views",function(At){var Au=r.Views,Aq=Au.getInternalUserViewId(Y.appid,Ap.id),As=Aq&&n.get(Aq),Ar=As&&As.get("tab");if(As&&Ar){As.set("tabCloseMessage",Ap.msg);Ar.cfg.widget.set("canClose",!Ap.msg);}});}function B(Y){return Number(AG.get(Y).config["@attributes"].version);}function E(Y,Ap,Ar,As){As=As||AA.JSON.stringify(Ap);try{return YUI.om.Iframe.send(Y.proxy,Ar,["cmd=",Y.skipURIEncode?As:encodeURIComponent(As)].join(""),W.getAppSignature(Y.appid),Y.version,Y.id);}catch(Aq){W.log("returnSend:YUI.om.Iframe.send error:"+Aq.message||"unknown");C.stat("OM",["ERR:returnSend:",Y.appid,":",Aq.message||"unknown"].join(""));}}function L(Y,Ap,Ar,As){var Aq;if(!Y){return;}if(Y.restoreCallerContext){Y.restoreCallerContext();}if(Ap){if(Y.cbid===null){if(Ar){return;}else{throw new Error("returnAPI: cannot return value, no callback id set.");}}Ap.$cbid=Y.cbid;Ap.$apiVersion=Y.apiVersion;if(!AA.UA.gecko&&Y.id&&frames[Y.id]){return w.returnSend(Y,Ap,"frames['"+Y.id+"']",As);}else{for(Aq=frames.length-1;Aq>=0;--Aq){if(frames[Aq]===Y.iframe.contentWindow){return w.returnSend(Y,Ap,"frames["+Aq+"]",As);}}}W.log("returnAPI: couldn't find return context iframe");C.stat("OM","ERR:returnAPI:"+Y.appid);}}function l(Aq,Y,Ap){switch(Aq){case"getParameters":t[Aq](Y,Ap,L);break;default:t[Aq](Y,Ap);}}function d(Aq,Y,Ap){var At,Ar,As=Aq;Aq=Aq.toLowerCase();if(!((Aq==="callwebservice")&&Ap&&Ap.url&&(Ap.url==="apps://"))){At="API:"+Aq;Ar=At+":"+(Y.appid||"gallery").toLowerCase();C.stat("OM",At);C.stat("OM",Ar);}W.log(Aq,AG.getAppName(Y.appid)+".API");l(As,Y,Ap);}AA.on("windowresize",W.onIdle(function(){AA.fire(W.getEventName(null,"browser.resize"),{});},F));AA.mix(w,{returnAPI:L,returnSend:E,publicAPIs:t,enforceRules:d,setListener:AF,logMessage:A,upgrade:AT,validateFolderConfig:M,handleFlashRequired:P},true);r.Webservice.createWebServiceObject(L,function(Y){if(!Y){Al=true;}while(AE.length>0){(AE.shift())();}});},"1.0.0",{requires:["om-controller-base","om-controller-webservice","om-common-constants","om-common-net-session","om-common-utils","om-model-datastore","om-common-errors","common-net-sessionmgr","common-utils","json","rocket-stats"]});var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var YUI;if(typeof YUI==="undefined"){(function(){var e=".",b=Object.prototype.hasOwnProperty,d=Object.prototype.toString,c={"undefined":"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},f,a=function(j,i){var h=typeof j;return(j&&(h==="object"||(!i&&(h==="function"||f.Lang.isFunction(j)))))||false};f={namespace:function(){var k=arguments,q=this,n=0,m,p,h;for(;n<k.length;n++){h=k[n];if(h.indexOf(e)){p=h.split(e);for(m=(p[0]=="YAHOO")?1:0;m<p.length;m++){q[p[m]]=q[p[m]]||{};q=q[p[m]]}}else{q[h]=q[h]||{}}}return q},add:function(h,i){if(i){i(f)}},use:function(){var h=arguments[arguments.length-1];if(typeof h==="function"){h(f)}},log:function(){},merge:function(){var k=arguments,m=0,j=k.length,h={};for(;m<j;++m){f.mix(h,k[m],true)}return h},Object:{_hasEnumBug:!{valueOf:0}.propertyIsEnumerable("valueOf"),_forceEnum:["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"]},mix:function(h,j,q,k,n,r){var o,u,t,m,v,p,s;if(!h||!j){return h||f}if(n){if(n===2){f.mix(h.prototype,j.prototype,q,k,0,r)}t=n===1||n===3?j.prototype:j;s=n===1||n===4?h.prototype:h;if(!t||!s){return h}}else{t=j;s=h}o=q&&!r;if(k){for(m=0,p=k.length;m<p;++m){v=k[m];if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}}else{for(v in t){if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}if(f.Object._hasEnumBug){f.mix(s,t,q,f.Object._forceEnum,n,r)}}return h},Lang:{isString:function(h){return typeof h==="string"},isFunction:function(h){return f.Lang.type(h)==="function"},type:function(h){return c[typeof h]||c[d.call(h)]||(h?"object":"null")}}};YUI=function(){return f};for(var g in f){if(f.hasOwnProperty(g)){YUI[g]=f[g]}}})()}if(typeof YAHOO==="undefined"||!YAHOO){var YAHOO={util:{}}}if(typeof YAHOO.util==="undefined"||!YAHOO.util){YAHOO.util={}}if(!YAHOO.util.CrossFrame){YAHOO.util.CrossFrame=(function(){var k=/^frames\[(\d+)\]$/,h=/^frames\[['"]([a-zA-Z0-9-_]+)['"]\]$/;var m,e,g,o,i,f,c,b,n,a=YUI;if(window.postMessage||document.postMessage){c=function(p,s,q){var r;if(n(q||"1.0.15","1.0.15")<1){r=[i(s),i(p)].join("|")}else{r=[i(q),i(s),i(p)].join("|")}return r};b=function(r){var q=r.split("|"),p;for(p=q.length-1;p>=0;--p){q[p]=f(q[p])}if(q.length==2){return{sig:q[0],body:q[1]}}else{if(q.length==3){return{version:q[0],sig:q[1],body:q[2]}}else{return null}}};i=function(p){return p.replace(/\|/g,"&c124;")};f=function(p){return p.replace(/&c124;/g,"|")}}else{c=function(p,u,q,s,r){var t;q=q||"1.0.15";if(n(q,"1.0.15")<1){t=[u,p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;")].join("|")}else{if(n(q,"1.1.9")<0){t=[i(q),i(u),i(p)].join("|")}else{t=[i(q),i(u),i(p),i(s),i(r)].join("|")}}return t};b=function(q){var p=q.split("|");if(p.length===2){return{sig:p[0],body:p[1].replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}else{if(p.length===3){return{version:f(p[0]),sig:f(p[1]),body:f(p[2])}}else{if(p.length===5){return{version:f(p[0]),sig:f(p[1]),body:f(p[2]),target:f(p[3]),url:f(p[4])}}else{return null}}}};i=function(p){return escape(p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;").replace(/\//g,"&c47;").replace(/\@/g,"&c64;").replace(/\+/g,"&c43;"))};f=function(p){return unescape(p).replace(/&c43;/g,"+").replace(/&c64;/g,"@").replace(/&c47;/g,"/").replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}n=function(t,r){var s=typeof t==="string",q=typeof r==="string";if(!s||!q){return s&&!q?1:(!s&&q?-1:0)}t=t.split(".");r=r.split(".");if(t.length!==3||r.length!==3){throw new Error("Invalid version format")}var v=0,u=0;for(var p=0;p<3;p++){v=parseInt(t[p],10);u=parseInt(r[p],10);if(v!==u){return(v>u)?1:-1}}return 0};e=function(p,q){if(Object.prototype.hasOwnProperty){return p.hasOwnProperty(q)}return typeof p[q]!=="undefined"&&p.constructor.prototype[q]!==p[q]};g=function(v){var w,t,y,x,u,q;w={};t=v.split("&");for(u=0,q=t.length;u<q;u++){x=t[u].indexOf("=");w[t[u].substr(0,x)]=decodeURIComponent(t[u].substr(x+1))}return w};m=function(v){var s=v.split("."),t,r,q,u;v=window;for(r=0,q=s.length;r<q;r++){u=s[r];if(u==="parent"){v=v.parent}else{if(u==="opener"){v=v.opener}else{if(u==="top"){v=v.top}else{if((t=k.exec(u)||h.exec(u))){v=v.frames[t[1]]}else{throw new Error("Invalid Target: "+v)}}}}}return v};o=function(){var u,t,r,q,p,w=g(window.location.hash.substr(1)),v=b(window.name);if(w.target){t=m("parent."+w.target);q=w.url}else{t=m("parent.opener."+v.target);q=v.url}if(v&&t&&q){r=q.split("/")[2];p=v.version;u=(t.YUI&&t.YUI.util&&t.YUI.util.CrossFrame)?t.YUI.util.CrossFrame:t.YAHOO.util.CrossFrame;try{if(navigator.userAgent.indexOf("Firefox")>-1){t.setTimeout(function(){u._receive([v.sig,v.body].join("|"),r,q,p)},0)}else{u._receive([v.sig,v.body].join("|"),r,q,p)}}catch(s){}}else{throw new Error("Missing required params")}};function d(r,s,q,p){a.util.CrossFrame._receive(r,s,q,p)}var j;j={proxyReceive:o,parseTarget:m,constructMessage:c,deconstructMessage:b,escapeAttr:i,unescapeAttr:f,compareVer:n,_receive:d};return j})();if(typeof YUI!=="undefined"&&YUI){YUI.namespace("util.CrossFrame");YUI.add("omCrossframe",function(a){},"1.0.0",{requires:[]});(function(d){var u="1.1.16",p=YUI.util.CrossFrame;var h="OM_VBS_Wrapper",b="OM_VBS_GetWrapper",s="OM_VBS_HandleMessage",m="OM_VBS_CreateChannel",j,v=window.location.toString(),i,x,n,y;i=YAHOO.util.CrossFrame.parseTarget;x=YAHOO.util.CrossFrame.compareVer;function o(D,C,B,e){if(D&&D.addEventListener){D.addEventListener(C,B,e)}else{if(D&&D.attachEvent){D.attachEvent("on"+C,B)}}}function g(e){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{if(e.stopPropagation){e.stopPropagation()}}e.cancelBubble=true}n=function(D){var e=(d.Lang.isString(D))?D.replace(/#$/,""):false,C=document.getElementsByTagName("iframe"),B;for(B=0,l=C.length;B<l;B++){if(C[B].src.replace(/#$/,"")===e||C[B].contentWindow.location===D){return C[B]}}return null};y=function(D){var B=(typeof D==="object")&&(D!==null)&&(typeof D.sig==="string")&&(typeof D.body==="string")&&(D.sig.length>2)&&(D.body.length>0);if(B){try{if(x(D.version||"1.0.15","1.0.15")<1){}else{B=(x(D.version,D.version)===0)}}catch(C){B=false}}return B};var z,q,k,a,t,A,r,f,c;k=YAHOO.util.CrossFrame.constructMessage;a=YAHOO.util.CrossFrame.deconstructMessage;t=YAHOO.util.CrossFrame.escapeAttr;A=YAHOO.util.CrossFrame.unescapeAttr;if(window.postMessage||document.postMessage){r=!window.postMessage;o(window,"message",function(B){var C,D,E,G;B=B||window.event;try{G=a(B.data);if(y(G)){D=B.origin;E=D.split("/")[2];C=n(B.source.location);if(self===top){g(B)}p.fire("receiveMessage",[G.sig,G.body].join("|"),E,D,C,G.version)}else{}}catch(F){d.log("crossframe.js:onMessageListener: error msg["+F.message+"]")}},false);z=function(E){var B,D,C=i(E.target),e=E.version||u;if(!C){return false}if(r){C=C.document}D=k(E.message,E.sig||"",e);C.postMessage(D,E.proxy);E.handler.call(window);return true}}else{if(window.ActiveXObject){j={};window[s]=function(e,H,I,F){var E=arguments.length,D,C,B,G;window.setTimeout(function(){try{if(E===1){D=JSON.parse(e);e=D.uri;H=D.sig;I=D.message;F=D.version}else{e+="";H+="";I+="";F+=""}C=n(e);B=e.split("/")[2];p.fire("receiveMessage",[H,I].join("|"),B,e,C,F)}catch(J){}},0)};window[m]=function(e,B){j[e]=B};vbscript=["Class "+h+"\n ","Private m_Intended\n","Public Sub SetIntendedName(name)\n ","If isEmpty(m_Intended) Then\n","m_Intended = name\n","End If\n","End Sub\n","Public Sub SendMessage(data)\n ",s+"(data)\n","End Sub\n","Public Sub SendMessage2(uri, sig, message, version)\n ","Call "+s+"(uri, sig, message, version)\n","End Sub\n","Public Sub CreateChannel(channel)\n ","Call "+m+"(m_Intended, channel)\n","End Sub\n","End Class\n","Function "+b+"(name)\n","Dim wrap\n","Set wrap = New "+h+"\n","wrap.SetIntendedName name\n","Set "+b+" = wrap\n","End Function"].join("");try{window.execScript(vbscript,"vbscript")}catch(w){}}z=function(E){var B,C;E.version=E.version||u;E.sig=E.sig||"";E.uri=v;try{B=E.targetId||"parent";if(B=="parent"){C=j.parent;if(!C&&window.opener&&"CreateChannel" in window.opener){C=window.opener;C.CreateChannel(window[b]("parent"));j.parent=C;window.opener=null}if(C){if("SendMessage2" in C){C.SendMessage2(E.uri,E.sig,E.message,E.version)}else{C.SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}else{if(j[B]){if("SendMessage2" in j[B]){j[B].SendMessage2(E.uri+"",E.sig+"",E.message+"",E.version+"")}else{j[B].SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}}catch(D){}c.send(E)};c=(function(){var e=(function(){var C=0;return function(){return"om_xdm_proxy"+C++}})();q=function(D){function C(){var E=document.getElementById(D);E.getElementsByTagName("iframe")[0].onload=null;if(E.parentNode){E.parentNode.removeChild(E)}E=null}p.mapHandlers[D].call(window);delete p.mapHandlers[D];if(navigator.userAgent.indexOf("Firefox")>-1){setTimeout(C,0)}else{C()}};var B=function(E){if(!document||!document.body){setTimeout(function(){z(E)},20);return}var I=E.proxy,G=E.target,O=E.message,L=E.handler,N=E.sig||"",H=E.version||u;if(!i(G)){L();return false}if(window.ActiveXObject&&x(H,"1.1.9")>=0){var J=new ActiveXObject("htmlfile");J.open();J.parentWindow.opener=window;J.parentWindow.callback=function(){J=null;L()};J.write(["<html><head></head><body>",'<iframe src="',I,'" name="',k(O,N,H,G,v),'"></iframe>',"<script>onload = callback;<\/script>","</body></html>"].join(""));J.close()}else{var K=[I,"#","target=",encodeURIComponent(G)+"&url=",encodeURIComponent(v)].join(""),F,D,C=document.createElement("div"),M=C.style;D=e();p.mapHandlers[D]=L;F=["<iframe onload=\"YAHOO.util.CrossFrame.iframeOnload('",D,'\');" name="',k(O,N,H),'" src="',K,'"></iframe>'].join("");M.width=M.left=M.top=M.height="0";M.overflow="hidden";M.position="absolute";C.id=D;document.body.appendChild(C);C.innerHTML=F}return true};return{send:B}})()}d.mix(p,{_events:{},on:function(e,C){var B=this._events;if(!B[e]){B[e]=[C]}else{B[e].push(C)}},fire:function(C){var E=this._events[C]||[],B=Array.prototype.slice.apply(arguments,[1]);for(var D=E.length;D--;){try{E[D].apply(null,B)}catch(F){}}},send:z,mapHandlers:{},_receive:function(D,E,C,e){var B=n(C);p.fire("receiveMessage",D,E,C,B,e)},initIEFrameTransport:function(e,C){var B;if(window.ActiveXObject&&!window.postMessage){B=window[b](C);e.contentWindow.opener=B}},proxyReceive:YAHOO.util.CrossFrame.proxyReceive},true);YAHOO.util.CrossFrame.iframeOnload=q})(YUI())}}if(typeof YUI!=="undefined"&&YUI&&!(YUI.om&&YUI.om.Iframe)){YUI.namespace("om.Iframe");(function(b){var d=[],f=[],j,c,g,i,e=true,h=YUI.util.CrossFrame;j=function(v,o,m,p,s){var k=v.indexOf("|"),u=v.substr(0,k),t,q,n;v=v.substr(k+1);for(q=0,n=d.length;q<n;q++){t=d[q];if(t.sig){if(!u||(t.sig!==u)){continue}}if(t.filter&&((t.filter.exec&&!t.filter.exec(m))||(t.filter.call&&!t.filter.call(null,m)))){continue}if(t.handler){try{t.handler.apply(t.scope,[{iframe:p,version:s},v.substr(4)])}catch(r){b.log("Exception in user defined handler","om.Iframe","iframe.js")}}}};h.on("receiveMessage",j);c=function(k){if(!k.pattern||!k.pattern.test||!k.handler||!k.handler.call){return false}d.push(k);return true};i=function(o,q,p,m,k,n){f.push({proxy:o,target:q,message:p,handler:g,sig:m,version:k,targetId:n});if(!e){g()}};g=function(){if(!f.length){e=false;return}e=true;h.send(f.shift())};YUI.om.Iframe={listen:c,send:i};function a(k){if(/in/.test(document.readyState)){setTimeout(function(){a(k)},9)}else{k()}}if(window.postMessage||document.postMessage||(top==self)){g()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false)}else{a(g)}}})(YUI())};YUI.add("om-controller-crossframe",function(C){var M=C.om,E=M.Controller,N=E.extend("Crossframe"),L=E.Openapi,D=M.common.Errors,K=M.common.Utils,F=M.model.DataStore,H=F.Registry,A=false,B=C.common.Utils.rocketstats;function G(R,S,T,P){var O=R.iframe,W=null,V={},Q,U=R.version||"1.0.15";if(K.compareVer(U,"1.0.16")<0&&P){throw new Error("initAPI: bad API, crossframe version");}if(O!==null){W=F.ViewRegistry.get(O.id);V={cbid:S||null,apiVersion:T,version:U,skipURIEncode:P,iframe:O,proxy:O.src.split("/").slice(0,3).join("/")+"/om/xdm_proxy?bn="+NeoConfig.om.xdmproxyVer,widget:W,appid:W&&W.get("appId"),instanceid:W&&W.get("instanceId"),id:W&&W.get("viewId"),parameters:W&&W.get("params")};for(Q=frames.length-1;Q>=0;--Q){if(frames[Q]===O.contentWindow){return V;}}}throw new Error("initAPI: invalid message origin");}function I(V,T){var Q,P,S=false;try{Q=C.JSON.parse(T);S=true;}catch(U){}if(C.Lang.isUndefined(Q)){Q=C.JSON.parse(decodeURIComponent(T));}var O=G(V,Q.$cbid,Q.$apiVersion,S),R=L.publicAPIs[Q.$cmd];if(R){if(!A&&H.isMessenger(O.appid)){A=true;C.fire("Y.om.controller:launchIM:complete");}L.enforceRules(Q.$cmd,O,Q);}else{P={error:D.ERR_UNSUPPORTED_BY_HOST};L.returnAPI(O,P,true);}}function J(R){var P="https?://(?:[a-z0-9]+(-|\\.))?",O="(?:"+K.escapeDots(NeoConfig.om.webcacheHostNet)+")",S="(?:"+K.escapeDots(NeoConfig.om.webcacheHostCom)+")";try{YUI.om.Iframe.listen({pattern:/^cmd=([\s\S]*)$/,handler:R,filter:new RegExp(["^",P,"(?:",O,"|",S,")","(?:/|$)"].join(""))});K.log("INIT Crossframe handler");}catch(Q){K.log("neo:OM:crossframe:setListenerHandler: YUI.om.Iframe missing, check if neo loaded openmail crossframe correctly. message=["+(Q.message||"")+"]");B.stat("OM",["OM:ERR:setListenerHandler",Q.message].join(":"));}}J(I);C.mix(N,{publicHandler:I,setListenHandler:J},true);},"1.0.0",{requires:["om-controller-base","om-common-utils","om-controller-openapi","omCrossframe","rocket-stats"]});YUI.add("om-controller-views",function(E){var e=E.om,L=e.Controller,s=e.common.Errors,g=L.extend("Views"),t=e.common.Utils,v=e.model.DataStore,n=v.Registry,f=v.ViewRegistry,G=v.EventRegistry,U=v.OpenViewLog,j=v.APP_FLAGS,T=E.common.Utils,r=T.substitute,W="om_user_view_id_",l="om_default_view_id_",A=E.Lang,c=E.Array,H=T.rocketstats,K=[NeoConfig.lang?NeoConfig.lang.replace(/-x-.*$/,""):"en-US"],k=NeoConfig.om.intl?NeoConfig.om.intl.replace(/_.*$/,""):"us",N=NeoConfig.om.intl?NeoConfig.om.intl.replace(/^.*_|^.*$/,""):"";function O(w,Y){return W+w+"-"+Y;}function h(w,Y){return l+w+"-"+Y;}function F(w,Y){return h(w,Y)+"_"+new Date().getTime();}function B(w,Y,x){if(x.target_zone==="messagepane"){return F(w,Y);}return x.id?O(w,x.id):h(w,Y);}function b(w){var Y="";if(w.indexOf(W)===0){Y=w.indexOf("-")+1;return w.substring(Y);}return w;}function d(){return"&cb="+(new Date()).getTime();}function J(x,w){var Y=n.get(x);if(Y&&Y[w]){return Y[w];}}function m(AA,x){var Y=n.isInternal(AA),y=J(AA,"status")&j.SANDBOXED,w=(Y&&!y)?NeoConfig.om.webcacheHostCom:NeoConfig.om.webcacheHostNet,AB=(NeoConfig.om.webcacheHostCom.indexOf("yahoo.com")!==-1&&NeoConfig.om.webcacheHostCom.indexOf(".corp.")!==-1),z="-";return NeoConfig.launch_protocol+(!AB?[AA,z,w].join(""):w);}function u(AF,AD,AH,AG){var x,w=NeoConfig.farm?NeoConfig.farm.substring(1):"",z=c.hash(["9323","323","372","6193"]),y=NeoConfig.om.xdmproxyVer,AB=NeoConfig.isFullSSL,AC=n.isInternal(AH),AA=[m(AH,AB),"/om/api/1.0","/openmail.app.invoke"].join(""),AE=[AH,J(AH,"version"),y,NeoConfig.om.intl,NeoConfig.lang,AF,AB?"1":"0"],Y={bn:y,".lang":NeoConfig.lang,".intl":NeoConfig.om.intl,rtl:NeoConfig.isRTL?"1":"0",proxyhost:NeoConfig.servername,sig:t.getAppSignature(AH),vid:b(AG),app:AH,mailver:"neo"};if(w in z){Y.farm=w;}if(AB){Y.proxyssl=1;}x=[AA,"/",AE.join("/"),"#",E.QueryString.stringify(Y),AC?"&crumb="+NeoConfig.om.crumb:""].join("");return x;}function P(Y){var w=f.get(Y);if(w){t.log("openview: view["+w+"] already running, no need to openView");}return !!w;}function C(AC,AF,AA,AB,z,w,AE,x,Y,y,AD){E.use("om-ui-views-hidden",function(AI){if(P(AC)){return;}var AH=u(AB,z,AF,AC),AG=new AI.om.ui.views.Hidden({appId:AF,instanceId:AA,viewId:AC,params:AE,url:AH,elementAttributes:y});f.set(AC,AG);AG.on("load",function(){if(AD){AD(AG);}});AG.render();});}function D(AC,AF,AA,AB,z,w,AE,x,Y,y,AD){E.use("om-ui-views-simple","_shared_module_open_mail_application_messagepane",function(AI){if(P(AC)){return;}var AH=u(AB,z,AF,AC),AG=new AI.om.ui.views.Simple({template:AI.ui.Templates._shared_module_open_mail_application_messagepane,appId:AF,instanceId:AA,viewId:AC,params:AE,url:AH,elementAttributes:y});f.set(AC,AG);if(AD){AD(AG);}});}function X(Y,AA,y,x,w,z,AB){E.use("om-ui-views-folderpane",function(AD){if(P(Y)){return;}var AC=new AD.om.ui.views.FolderPane({appId:AA,instanceId:y,viewId:Y,params:w.parameters,url:x,height:w.height,hidden:w.hidden,elementAttributes:z});f.set(Y,AC);AC.on("load",function(){if(AB){AB(AC);}});AC.render();AD.on("scroll",t.onIdle(function(){AD.fire(t.getEventName(null,"folderpane.scroll"),{});},200),(NeoConfig.fullPage)?window:"#shellnavigation");});}function V(AC,AG,z,AA,y,w,AF,Y,AE,AB,AH,x,AD){E.use("om-ui-views-alignedoverlay",function(AJ){if(P(AC)){return;}var AI=new AJ.om.ui.views.AlignedOverlay({appId:AG,instanceId:z,viewId:AC,params:AF,url:AA,width:Y,height:AE,elementAttributes:x,options:AH||{}});f.set(AC,AI);AI.on("load",function(){if(AD){AD(AI);}});AI.render.apply(AI,AH.renderParams||[]);});}function R(AC,AG,z,AA,y,w,AF,Y,AE,AB,AH,x,AD){E.use("om-ui-views-panel",function(AJ){if(P(AC)){return;}var AI=new AJ.om.ui.views.Panel({appId:AG,instanceId:z,viewId:AC,params:AF,url:AA,width:Y,height:AE,elementAttributes:x,options:AH||{}});f.set(AC,AI);AI.on("load",function(){if(AD){AD(AI);}});AI.render.apply(AI,AH.renderParams||[]);});}function S(y,Y,x){var w=G.getByEventName(y,Y,x);if(w){E.detach(x,w.listenerFn);G.del(y,Y,x);}}function I(x,Y){var y=G.getByViewId(x,Y),w;if(y){for(w in y){S(x,Y,w);}}}function Q(w){if(!w){T.assert(false);return;}var Y=w.get("viewId"),x=w.get("instanceId");U.del(Y);f.del(Y);I(x,Y);}function q(z,AP,AR,AK,AQ,AT,x,AB,AL,AI,AF,AU,AD,AM,Y,AG,AC,y,AA){H.stat("OM","APP:INVOKE:"+z);U.set(AR,arguments);AP=AP||J(z,"instance");y=y||{};function AS(AV){if(AA){AA(AO);}}var AJ={title:y.elementTitle?T.escapeHtml(y.elementTitle):n.getAppName(z)},AO={},w=[AT],AE=[],AH={appId:z||null,context:x||null,data:AB||{},reason:AD||null,theme:"",user:{cobrand:N,guid:NeoConfig.neoguid,intl:k,lang:K.slice(),bidi:!!NeoConfig.bidi,isRTL:!!NeoConfig.isRTL,useRichText:E.common.persist.UserData.get("userUIPref.useRichText"),theme:"",themeinfo:NeoConfig.theme?{name:NeoConfig.theme.id,css:NeoConfig.theme.url}:{}},version:"2"};if(n.isInternal(z)){AH.fullPage=NeoConfig.fullPage;AH.isFresh=NeoConfig.isFresh;AH.instanceId=AP||null;AH.isAMT=NeoConfig.isAMT;AH.urlParams=T.parseQueryString();AH.wssid=NeoConfig.wssid;if(N&&!c.some(AH.user.lang,function(AV){return AV===NeoConfig.lang;})){AH.user.lang.unshift(NeoConfig.lang);}}if(AG){AH.actionType=AG;}try{if(Y&&Y.className&&(Y.className.indexOf("subAppRow")>-1)){AE=Y.id.split("_");AH.index=AE[AE.length-1];}}catch(AN){}switch(AT){case"alignedoverlay":V(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,y,AJ,AS);break;case"panel":R(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,y,AJ,AS);break;case"folderpane":y.parameters=AH;X(AR,z,AP,u(AK,AQ,z,AR),y,AJ,AS);break;case"overlay":y.parameters=AH;w.push(AR,z,AP,u(AK,AQ,z,AR),y,AJ,AS);break;case"tab":w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AU,AD,AJ,AS,y);break;case"lightbox":w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,AH,AJ,AS);break;case"bubble":case"dialog":if(!AL){AL=400;AO={errorMsg:"No width specified - defaulting to 400",warn:s.ERR_BAD_ARG};}if(!AI){AI=400;AO={errorMsg:"No height specified - defaulting to 400",warn:s.ERR_BAD_ARG};}w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,AJ,AS);break;case"hidden":C(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AS);break;case"uninstall":C(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AA);break;case"messagepane":if(NeoConfig.om.isSandboxEnabled){D(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AA);
}break;default:AO={error:s.ERR_INVALID_TARGET,errorMsg:"Target '"+AT+"' not supported."};AS();}if(w.length>1){E.use("om-controller-views-other",function(AV){g.handleView.apply(null,w);});}}function p(w,x,AA,Y){T.assert(x==="data"||x==="events");var z;try{z=w.config[x][AA].action;}catch(y){if(Y){z={launch:{view:"full",target_zone:"tab",context:null}};}}return z;}function Z(Y){Y.close();Q(Y);Y.destroy();}function a(w){var Y=f.get(w),x=Y&&Y.get("instanceId"),w=Y&&Y.get("viewId");if(!Y||Y.get("closing")){return;}Y.set("closing",true);Z(Y);}function M(w,x){var Y;if(!n.isInDb(w)){if(!x){E.use("common-ui-dialog-helper",function(AA){var z={hd:strings["str_om_error_app_not_found_title"],bd:strings["str_om_error_app_not_found_body"]};function y(){AA.use("om-controller-addremoveapp",function(AB){L.AddRemoveApp.uninstallApp(w.app);});}AA.common.ui.DialogHelper.confirm(z,{ok:{handler:y}});});}return false;}if(n.isRevoked(w)){if(!x){Y={source:"unpublish",noConfirmDialog:true};E.use("common-ui-dialog-helper",function(z){function y(){z.use("om-controller-addremoveapp",function(AA){L.AddRemoveApp.uninstallApp(w.app,Y);});}z.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_nonexistant_title"],bd:strings["str_om_error_app_nonexistant_body"]},{ok:{handler:y}});});}return false;}if(n.isSick(w)){if(!x){E.use("common-ui-dialog-helper",function(y){y.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_unavailable_title"],bd:r(strings["str_om_error_app_unavailable_body"],{app_name:w.label})});});}return false;}return true;}function i(AG,AE,AJ,y,w,Y,AA,AC,z,AD){T.assert(!AA);if(!AG||!AG.config||AG.app=="retry"){E.use("om-controller-applicationlist",function(AN){if(AG.app=="retry"){L.ApplicationList.loadApplication();}else{L.ApplicationList.getApplicationConfigs(function(AO){if(AO){i(n.get(AG.app),AE,AJ,y,w,Y,AA,AC,z,AD);}else{return;}});}});return;}if(!M(AG,AC)){return;}var x={};if(AG.needsAck){t.log("preinstall: "+AG.name);x={callback:function(AN){if(!AN.error){i(n.get(AG.app),AE,AJ,y,w,Y);}},appStatus:AG.status,appName:AG.name,developerName:AG.developer_name,description:AG.description,source:"preinstall"};E.use("om-controller-addremoveapp",function(AN){L.AddRemoveApp.installApp(AG.app,x);});return;}var AB=p(AG,AE,AJ,y),AF,AL,AK,AM,AI,AH=(AE==="data")?"data/message":(AE+"/"+AJ);for(AF in AB){AL=AB[AF];T.assert(AF=="launch");if(!AG.views[AL.view]){E.use("common-ui-dialog-helper",function(AN){AN.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_unavailable_title"],bd:r(strings["str_om_error_app_unavailable_body"],{app_name:AG.label})});});return false;}AI=w;AK=B(AG.app,AJ,AL);AM=(AL.target_zone==="uninstall")?AG.label:(AL.title||AG.label);if(n.isMessenger(AG.app)){if(!NeoConfig.isCorpmail){E.fire("Y.om.controller:launchIM:start");}}E.each(AL.options,function(AP,AO){var AQ=(AP==="true"||AP==="1"),AR=(AP==="false"||AP==="0"),AN=AQ||AR;x[AO]=AN?(AQ||!AR):AP;});q(AG.app,AG.instance,AK,AL.view,AG.views[AL.view].type,AL.target_zone,AL.context,AI||null,AL.width,AL.height,AL.ttl,AM,AH,null,Y,AJ,z,x,AD);}}function o(z,y){var x=f.getAll(),w,Y;for(w in x){Y=x[w];if(z===Y.get("appId")&&y===Y.get("instanceId")&&!Y.get("closing")){a(w);}}E.fire("om:close_application"+y,y);}E.mix(g,{openView:q,closeView:a,closeApplication:o,getInternalViewId:B,getInternalUserViewId:O,getInternalDefaultViewId:h,isOpened:P,runActions:i},true);},"1.0.0",{requires:["common-utils","om-controller-base","om-common-utils","om-model-datastore","om-controller-crossframe","om-common-errors","querystring-stringify-simple"]});YUI.add("_shared_module_open_mail_application_list_menu",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_application_list_menu={base:'<div id="menu-applist" class="optionMenu"> <ul> <li data-action="app-remove"><a href="#"><span>{{str_menu_remove}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("om-ui-applicationlist-base",function(F){var E=F.common.Utils,D=F.Lang,A=E.substitute,C=F.common.persist.getCookie();var B=function(){var W=this,M=F.om,g=M.common.Utils,H=M.model.DataStore,Y=H.ApplicationList,S=H.ApplicationSubFolderList,U=H.Registry,P=H.APP_FLAGS,c=F.ui.Templates._shared_module_open_mail_application_list,L=F.one("#nav-applications"),T=F.one("#app-list"),X="om.applex",K=F.common.Utils.rocketstats,N=M.Controller,f=true,b={appList:function(h){if(h){var o={app_id:"retry",app_status:P.PUBLIC,app_row_id:"_app_retry",app_icon_url:"",app_name:strings["str_om_app_list_retry"]},r=A(c.application_list,o,b);return r.replace(/<img [^>]*>/i,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");}var m,p="",t,o,k=Y.getAll(),q=Y.getSpriteURL(),n,l,j=H.Registry.hasOldAndNewCalendarApps();q=V(q);for(m in k){t=k[m];if(typeof t.image_url=="number"){l=t.image_url*16;n=true;}else{l=0;n=false;if(t&&t.image_url){t.image_url=V(t.image_url);}}o={app_id:t.app,app_status:t.status,app_row_id:"_app_"+t.app,app_name:t.label+(!(t.status&P.PUBLIC)?" (Private)":""),app_icon_url:n?q:t.image_url.replace(/<!--IMAGE_TYPE-->/,"icon"),app_icon_pos:(NeoConfig.isRTL?" 100%":" 0px ")+" -"+l+"px",app_row_name_id:"_app_name_"+t.app,app_row_info_id:"_app_info_"+t.app};if(H.Registry.isNoAppList(t)&&H.Registry.isPublic(t)){continue;}if(j&&H.Registry.isOldCalendarApp(t)){continue;}p+=A(c.application_list,o,b);}return p;},application_refresh:function(i){var k=i.app_id,h,j="";if(!(i.app_status&H.APP_FLAGS.PUBLIC)){h={app_ref_id:"_ref_"+k,app_refblock_id:"_refblock_"+k};j=A(c.application_refresh,h,b);}return j;},application_list_subfolder:function(i){var l=i.app_id,h,j,k="";j=S.get(l);if(j&&j.length>0){h={app_id:l,app_subfolder_div_id:"_sub_container_"+l};k=A(c.application_list_subfolder,h,b);}return k;},application_list_subfolder_row:function(k){var m,o=k.app_id,j,p,l,n="";l=S.get(o);for(m in l){var h=l[m];j={app_sub_folder_row_id:"_sub_"+o+"_"+m,app_sub_folder_label:"- "+h.label,app_sub_folder_tooltip:h.tooltip||h.label,app_sub_folder_count:typeof(h.count)!="undefined"?h.count:null};n+=A(c.application_list_subfolder_row,j,b);}return n;},application_list_subfolder_count:function(i){var k=i.app_sub_folder_count,h,j="";if(k!=null){h={app_sub_folder_count:k};j+=A(c.application_list_subfolder_count,h,b);}return j;},application_count:function(i){var h,k="",j=i.count;if(typeof(j)!="undefined"){h={app_folder_count:j,count:j};k+=A(c.application_count,h,b);}return k;},application_count_markup:function(i){var h,k="",j=i.count;if(typeof(j)!="undefined"){h={app_folder_count:j};k+=A(c.application_count_markup,h,b);}return k;}};function G(k,l){var j,i="subfolder.click",h={};j=H.Registry.get(k).instance;h={app:k,index:l,instance:j};F.fire(g.getEventName(j,i),h);}function J(){var h;if(!T.one('a[tabindex="0"]')&&(h=T.one("a[role=option]"))){h.set("tabIndex",0);}return h;}function a(){var h=F.one("doc").get("activeElement");return(T.contains(h)?T.all("a[role=option]").indexOf(h):-1);}function I(k){var j=T.all("a[role=option]"),i=j.item(k),h;if(!i){h=k+1;if(h>j.size()){h=k-1;}i=j.item(h);}if(i){i.set("tabIndex",0);i.focus();}}function Z(){var h=F.one("#apps-toggle-btn");F.on("om:updateFolders",function(m,l){var n=L.ancestor("div"),p,k=a(),o;o=C.get(X);if(!NeoConfig.isFresh){p=o>0?1:0;}else{p=o<2?0:1;}m=m?m:false;if(p==1){n.removeClass("collapsed");n.addClass("expanded");h.set("aria-expanded",true);e(l);f=false;}else{n.removeClass("expanded");n.addClass("collapsed");h.set("aria-expanded",false);if(!m){e(l);}}if(k>=0){I(k);}else{J();}F.one("#nav-applications span.btn").removeClass("hidden");T.removeClass("hidden");});F.on("om:updateSingleFolder",function(p){var w=a(),z,t,y,n,u,o="";if(t=p.config.label){var x=F.one("#_app_name_"+p.ctx.appid),s;if(x){u=x.getContent();s=u.indexOf("(Private)");o=(s>-1)?u.substring(0,s)+t+" "+u.substring(s):u+t;x.setContent(o);}}var l=F.one("#_app_info_"+p.ctx.appid);if(l){if(y=p.config.tooltip){l.setAttribute("title",y);}else{if(o){l.setAttribute("title",o);}}if(n=p.config.count){var r=F.one("#_refblock_"+p.ctx.appid),q;if(r){q=b.application_count_markup({"count":n});q+=r.getContent();r.setContent(q);}else{q=l.getContent();q+=b.application_count({"count":n});l.setContent(q);}}}if(z=p.config.subFolders){var v=p.ctx.appid,k,m=F.one("#_sub_container_"+v);if(m){m.get("parentNode").removeChild(m);}S.set(v,z);d(v);}else{S.del(v);}if(w>=0){I(w);}else{J();}});if(!L){return;}function j(m){var k=L.ancestor("div"),l;if(k){k.toggleClass("collapsed").toggleClass("expanded");if(f){T.set("aria-live","polite");l='<li role="presentation"><span style="padding-left:20px;margin-left:8px;">'+strings["str_om_loading"]+"</span></li>";T.setContent(l);e();f=false;}if(k.hasClass("collapsed")){C.set(X,0);h.set("aria-expanded",false);F.fire("om:list:collapse");F.fire("mt:click",{action:"toggle_applications",append:{ltxt:"collapse"}});}else{NeoConfig.isFresh?C.set(X,2):C.set(X,1);h.set("aria-expanded",true);F.fire("om:list:expand");F.fire("mt:click",{action:"toggle_applications",append:{ltxt:"expand"}});}}}h.on("click",j);h.on("keydown",function(k){switch(k.keyCode){case 13:j(k);break;case 37:k.halt();break;case 38:k.halt();break;case 39:k.halt();L.one(".btn input").focus();break;case 40:k.halt();T.one("li a").focus();break;}});T.delegate("keydown",function(q){var r=q.target,s=q.keyCode,k,m,p,o,t,n,l=F.UA.os;if((l=="macintosh")&&(s==8)){s=46;}switch(s){case 38:if(r===T.one("li a")){q.halt();h.focus();break;}case 40:q.halt();k=q.container.all("a[role=option]");p=k.indexOf(this);o=q.keyCode===40?p+1:p-1;if((m=k.item(o))){r.set("tabIndex",-1);m.set("tabIndex",0);m.focus();}break;case 46:q.halt();t=r.ancestor("li").get("id");if(t.indexOf("_app_")>=0){t=t.slice(5);if(!(H.Registry.isPermanent(t))){F.use("om-controller-addremoveapp",function(u){N.AddRemoveApp.uninstallApp(t);});}}break;case 121:case 77:n=(l=="windows"||l=="win");if((n&&q.shiftKey&&s==121)||(!n&&q.ctrlKey&&q.shiftKey&&q.altKey&&s==77)){q.preventDefault();E.simulateContextMenu(q.target,false);
}break;}},"a[role=option]");T.delegate("click",function(l){var n=l.currentTarget,k,m;l.halt();m=l.currentTarget.getAttribute("id");k=m.slice(5);appData=U.get(k);O(m);R(k);F.fire("om:refreshApp",appData);O(m);},"li input");function i(o){o.halt();var s,u,n,v,t,m,r,p,l,k;n=(o.currentTarget).one("a");s=(o.currentTarget.getAttribute("id")).slice(5);v=U.get(s);K.stat("OM","APPLIST:clickApp");K.stat("OM","APPLIST:clickApp:"+s);m=v&&v.config;t=m&&m.events;r=t&&t["click"];p=r&&r.action;l=p&&p.launch.target_zone;if(l=="window"){K.stat("OM","APP:INVOKE:"+s);k=s;window.open(p.launch.view,k);o.stopPropagation();return;}var q=(o.target).getAttribute("id");if(q.indexOf("_ref_")>=0){return;}u=s.split("_");if(u.length==1){F.fire("om:appclicklaunch",s);F.fire("mt:click",{action:"launch_app",append:{ltxt:s},spid:"om_app_click"});}else{G(u[0],u[1]);}}T.delegate("click",i,"li");F.on("om:appclick",i);T.delegate("contextmenu",function(m){var n=m.currentTarget,l=m.target;if(!n.menu){var k=n.get("id");if(k.indexOf("_app_")>=0){k=k.slice(5);if(!(H.Registry.isPermanent(k))){F.use("om-ui-applicationlistmenu-base","common-ui-menu-helper",function(p,o){p.om.ui.ApplicationListMenu.insert("menu-applist",function(){var q=p.one("#menu-applist");p.common.ui.MenuHelper.create(n,{menu:q,isContext:true,xy:[m.clientX,m.clientY],contextTarget:m.target},function(){q.on("menuSelected",Q,null,k);q.on("menu:state",function(r){if(r.state=="hide"){l&&l.focus();}});});});});}}}m.halt();},"li");L.delegate("click",function(l){var k=U.getGalleryData();if(k&&k.app){F.fire("om:appclicklaunch",k.app);}else{}F.fire("mt:click",{action:"open_gallery",spid:"om_app_click"});l.halt();},"input");L.delegate("keydown",function(k){switch(k.keyCode){case 37:k.halt();h.focus();break;case 38:k.halt();break;case 39:k.halt();break;case 40:k.halt();T.one("li a").focus();break;}},"input");}function Q(i,h){if(i.dataAction&&i.dataAction=="app-remove"){F.use("om-controller-addremoveapp",function(j){N.AddRemoveApp.uninstallApp(h);});}}function O(i){i="#"+i;var h=F.one(i);if(!h.hasClass("loading")){h.addClass("loading");}else{h.removeClass("loading");}}function R(i){var h=H.Registry.get(i).instance;N.Views.closeApplication(i,h);N.Openapi.upgrade(i,h,null,null,true);}function e(h){var i=b.appList(h);T.setContent(i);T.setAttrs("aria-live","off");}function d(j){var h=F.one("#_app_"+j),i=b.application_list_subfolder({app_id:j});h.append(i);}function V(h){if(F.Lang.isString(h)&&!h.match(/^https?:\/\/image-/)){return h.replace(/^https?:\/\//,NeoConfig.launch_protocol+"image-");}return h;}Z();F.mix(W,{render:e});F.om.Controller.ApplicationList.loadApplication();};F.namespace("om.ui");F.om.ui.ApplicationList=new B();},"1.0.0",{requires:["common-utils","_shared_module_open_mail_application_list","om-model-datastore","om-controller-applicationlist","om-controller-views","_shared_module_open_mail_application_list_menu","common-persist-cookie-data"]});YUI.add("om-controller-messageread",function(D){var T=D.om,I=T.Controller,i=I.extend("Messageread"),k=T.common.Utils,m=T.model.DataStore,h=m.Registry,U=m.ViewRegistry,F=m.EventRegistry,J=m.ApplicationConfig,L=D.common.Utils,n=D.mail,B=n.model.DataStore.Messages,K=n.Controller.Messages,Q=D.Array,A=D.Lang,a=D.Object,R=A.isUndefined,d="message.read",Z=k.createLogger("ONREAD");function H(u,AA,t){var z=null,w=u.extend,o=w.openmail,Y=(AA.cbk&&AA.cbk.args&&AA.cbk.args.stopwatch)||null,r=u.mid,p="FILTER: "+r+": ",y=new L.Stopwatch("OMMessageGetPostHook"),x;if(o&&o.isProcessed){Z(p+"This message was already processed");return u;}if(o&&o.onEnhanced){Z(p+"This message is already enhancing by another runningQ. Wait until it's done");x=t(function(){});o.onEnhanced.push(x);return;}Y&&Y.start(1,"MatchOnRead");try{z=C(u);if(!o){o=w.openmail={isProcessed:false,isBodyModified:false,flags:{suppressAttachments:z.suppressAttachments}};}o.context=z;}catch(v){Z(p+"Error Message:"+v.message||"");}if(z&&z.filtersMatched){try{Z(p+"This message can be enhanced. start enhancing");o.onEnhanced=[];function s(){}function q(AC){x(AC);for(var AB in o.onEnhanced){o.onEnhanced[AB](AC);}delete o.onEnhanced;y.stop();}x=t(s);u.inboxservices=AA.origParms.msg.inboxservices||[];f(u,q,Y);}catch(v){Z(p+"JS Error occured, show the original message");x(u);}}else{if(!m.Loading.isLoading()){o.isProcessed=true;Z(p+"This message is not interested by any onRead app. Show the original message");}else{Z(p+"Openmail is still loading.  Result not cached.  Show the original message");}}}function f(w,u,Y){Y&&Y.start(1,"LoadAppsOnRead");var p=w.extend.openmail.context,s=p.msgReadAppData,y=p.launchAppIds,q=k.getObjSize(y),t=w.mid,r="LOADQ: "+t+": ",v,AB,AA,o,x;if(q>0){function z(AF){var AD=NeoConfig.om.onReadAppLaunchTimeout.split("."),AC=q*parseInt(AD[2]),AE;AC=Math.max(AC,parseInt(AD[0]));AC=Math.min(AC,parseInt(AD[1]))*1000;AE=AF.later(AC,this,function(){Z(r+"launch timeout. but let's move to runQ");AF.detach("om:message.read:loadQ|*");j(w,u,Y);return;});Z(r+"# of launch apps("+q+") / total launch timeout("+AC+"ms)");for(o in y){v=s[o];AB=v.appData;AA=AB.app;x=k.getEventName(o,d,null);I.Views.runActions(AB,"events","message_read",true,null);Z(r+AB.name+"("+AB.app+"): launching");AF.once("om:message.read:loadQ|"+x+"registered",function(AG){Z(r+AB.name+"("+AB.app+"): event registered "+AG);q--;if(q===0){AE.cancel();j(w,u,Y);}});}}if(I.Views&&I.Views.runApps&&I.Internalapi){z(D);}else{D.use("om-controller-views","om-controller-internalapi",z);}}else{Z(r+"All apps are already launched");j(w,u,Y);}}function j(AL,AB,w){w&&w.start(1,"RunAppsOnRead");var AH=AL.extend,q=AH.openmail,p=q.context,o=p.msgReadAppData,u=p.matchedAppIds,AJ=l({data:c(AL)},d),y=new D.AsyncQueue(),AC=AL.mid,z="RUNQ: "+AC+": ",s="om:message.read:runQ:"+AC+"|",Y,v,AG,r,AF,t,AI,x=false,AA=false,AK,AD=(document.location.host.indexOf("corp.yahoo.com")!==-1);for(AK in m.MessageReadRunList.getAll()){if(AC!=AK){Y=m.MessageReadRunList.get(AK);if(Y){Y.queue.stop();delete Y.omExtend.onEnhanced;D.detach("om:message.read:runQ:"+AK+"|*");m.MessageReadRunList.del(AK);Z(z+"STOP runningQ for message(mid:"+AK+"), another runningQ for the current message has started");}}else{Z(z+"There is already runningQ for the same message (mid:"+AK+")");}}m.MessageReadRunList.set(AC,{queue:y,omExtend:q});function AE(AM){y.add(function(){y.pause();var AN=D.later(parseInt(NeoConfig.om.onReadAppRunTimeout)*1000,this,function(){Z(z+"TIMEOUT "+AM);D.fire(d+AC,AJ);});D.once(s+d+AC,function(AR,AS,AP){AN.cancel();if(AR.returnCode==="success"){V(AR.data,AS);Z(z+"RETURN: SUCCESS "+AM);if(AR.data.data){q.isBodyModified=true;AJ.data.body.content=AR.data.data;}if(A.isUndefined(AJ.data.om_flags)){AJ.data.om_flags={};}if(AR.data.suppressAttachments){AJ.data.om_flags.suppressAttachments=AR.data.suppressAttachments;}if(AR.data.imagesBlocked){AA=true;}if(AA){AJ.data.imagesBlocked=true;}if(!AJ.data.onreadScripts){AJ.data.onreadScripts=[];}var AO=h.isInternal(AS)?NeoConfig.om.webcacheHostCom:NeoConfig.om.webcacheHostNet,AQ={context:{appId:AS,instanceId:AP,invokePrefix:("http://"+(AD?AO:([AS,".",AO].join(""))))},scripts:AR.data.scripts||[],css:AR.data.css||[]};AJ.data.onreadScripts.push(AQ);}else{Z(z+"RETURN: OTHERS "+AM);}y.run();});D.fire(AM,AJ);Z(z+"FIRE "+AM);});}for(AF in u){v=o[AF];AG=v.appData;r=AG.app;AI=v.viewId;t=k.getEventName(AF,d,null);x=U.get(AI)&&F.getByEventName(AF,AI,d+r);if(x){AE(t);Z(z+"ADD "+t);}}D.once(s+d+".jserror"+AC,function(){Z(z+"JSERROR");D.fire(d+AC,AJ);});y.on("complete",function(){if(AH&&q){if(q.isBodyModified){q.enhancedBody=AJ.data.body.content;}q.onreadScripts=AJ.data.onreadScripts;if(!A.isUndefined(AJ.data.om_flags)){q.flags.suppressAttachments=!!(AJ.data.om_flags.suppressAttachments||q.flags.suppressAttachments);}if(!A.isUndefined(AA)){q.imgBlocked=AA;AA=false;}q.isProcessed=true;m.MessageReadRunList.del(AC);D.detach(s+"*");y.stop();AB(AL);Z(z+"ALL DONE!");}});y.run();}function V(o,q){var Y="returnMessage: data type error, appId="+q,p=(A.isObject(o)&&!a.isEmpty(o)&&((R(o.scripts)||A.isArray(o.scripts))&&(R(o.css)||A.isArray(o.css))&&(R(o.suppressAttachments)||A.isBoolean(o.suppressAttachments))&&(R(o.imagesBlocked)||A.isBoolean(o.imagesBlocked))));if(!R(o.data)&&!A.isString(o.data)){p=false;delete o.data;}if(!p){Z(Y);}return p;}function c(q){var u={},Y={},s=K.getQueryParams(q),p=q.extend.openmail.context,o=!K.isCertified(q.inboxservices||[]),t=(s.midRequest.blockImages=="all")&&o;L.merge(u,q.header);L.merge(Y,q.flags);var r={from:u.from,to:u.to,cc:u.cc,replyto:u.replyto,subject:u.subject,date:u.sentDate,messageid:q.mid,folderid:s.fid,sourceFolderid:q.sourceFolderInfo&&q.sourceFolderInfo.fid||null,body:{content:q.body.display},flags:Y,annotation:p.scAnnotation||{},attachment:X(s.fid,q.mid,q.attachments),imagesBlocked:!!((q.hasBlockedImages&&o)||(q.imgAttachments&&q.imgAttachments.length&&t)),suppressImages:t,truncated:q.isTruncated,sandboxPrefix:q.yivPrefixNumber};return r;}function N(p,Y,o){var q=p.header;
return{header:{from:q.from,to:q.to,cc:q.cc,bcc:q.bcc,replyto:q.replyto,inReplyTo:q.inReplyTo,sentDate:q.sentDate,receivedDate:q.receivedDate,subject:L.escapeHtml(q.subject)},body:p.body,hasForwardedMsg:p.hasForwardedMsg,isTruncated:p.isTruncated};}function X(p,r,o){var s=[];for(var Y in o){var t=o[Y],q={partId:L.escapeHtml(t.partId),type:L.escapeHtml(t.type),tnefId:L.escapeHtml(t.tnefId),subtype:L.escapeHtml(t.subtype),typeParams:L.escapeHtml(t.typeParams),disposition:L.escapeHtml(t.disposition),dispParams:L.escapeHtml(t.dispParams),size:t.size,encoding:L.escapeHtml(t.encoding),filename:L.escapeHtml(t.filename),contentId:L.escapeHtml(t.contentId),thumbnailurl:t.thumbnailurl};q.url=D.mail.Controller.Messages.getAttachmentUrl(p,r,t.partId,t.tnefId,t.filename,t.subtype);if(q.type=="message"){q.message=N(t.message,p,r);}s.push(q);}return s;}function l(p,Y){var q=D.merge(p),o=q.data.messageid,r=q.data.folderid;switch(Y){case d:q["returnMessage"]=["function( obj ) {",'var _context = { eventName: "',d,'", mid:"',o,'", fid:"',r,'" };','openmail.Application.callWebService( { url:"apps://", method:"GET", parameters:{ cmd:"returnEvent",args:{ ctx:_context, returnCode:"success", data:obj } } } );}'].join("");q["cancel"]=["function( obj ) {",'var _context = { eventName: "',d,'", mid:"',o,'", fid:"',r,'" };','openmail.Application.callWebService( { url:"apps://", method:"GET", parameters:{ cmd:"returnEvent", args:{ ctx:_context, returnCode:"cancel", data:obj } } } );}'].join("");break;case"compose.start":break;}return q;}function C(v){var t=["http://","https://","ftp://"];if(v.extend.openmail&&v.extend.openmail.context&&v.extend.openmail.enhancedBody){Z("This message is cached and get the context from cache");return v.extend.openmail.context;}function p(w){return Q.some(t,function(x){return w.substring(0,x.length)===x;});}function u(x){var AB=x.length,y=Math.max(x.search(/<body[^>]*>/i),0),w=Math.max(x.search(/<\/body>/i),AB),AA=(y!==0||w!==AB?x.substring(y,w):x).replace(/<script[^>]*>[\s\S]*?<\/script>/mig,""),z=AA.match(/<a\s[^>]*href\s*=\s*"[^"]*|\b(ftp|https?):\/\/[^\s<]+/mig)||[],AC=Q.filter(Q.map(z,function(AD){return A.trim(L.unescapeHtml(AD.replace(/^<a\s[^>]*href\s*=\s*"/mi,"").replace(/"[\s\S]*$/mi,"")));}),p);return AC;}function r(){var AC=v.body.display,w=W(AC),x=w?G(w):{filterInfo:{},scAnnotation:{}},AD=x.filterInfo,AA=x.scAnnotation,AB=Q.hash((AD.url||[]).concat(AD.http||[])),z=Q.unique(u(AC)),y=Q.filter(z,function(AE){return !(AE in AB);});Q.each(y,function(AE){if(!AD.url){AD.url=[];AA.url=[];}AD.url.push(AE);AA.url.push({id:D.guid(),text:AE,context:""});});return x;}var o=null,s=r(),q={annotation:s.filterInfo||{},flags:v.flags,fid:K.getQueryParams(v).fid,header:{from:v.header.from.email,to:Q.map(v.header.to,function(w){return w.email;}),subject:v.header.subject,"attachment.type":Q.map(v.attachments,function(w){return w.type;}),"attachment.subtype":Q.map(v.attachments,function(w){return w.subtype;}),"attachment.filename":Q.map(v.attachments,function(w){return w.filename;})}},Y={domainKeyOk:!v.header.domainkey||(new RegExp(v.header.domainkeyname+"$","i")).test(v.header.from.email),isSpam:q.fid==="%40B%40Bulk"};o=P(v,q,Y);o.scAnnotation=s.scAnnotation||{};return o;}function P(x,AI,AA){var p={},o={},u={},v={},AE=h.getAll(),w=false,AB=false,AH,AF,s,AD,AJ,Y,y,q,AG,AC,t,z=0;function r(AL,AK){return Q.some(Q(AL),function(AM){try{return AK.test(AM);}finally{AK.lastIndex=0;}});}if(!AA.isSpam){for(s in AE){AF=AE[s];if(!AF){continue;}AD=AF.instance;if(AF.needsAck&&!h.isNoDisclaimer(AF)){continue;}if(h.isSick(AF)){continue;}if(NeoConfig.isFullSSL&&AF.name=="Yahoo! Shortcuts"){continue;}if(!AA.domainKeyOk&&!h.isInternal(AF)){continue;}if((AJ=AF.config)&&(Y=AJ.events)&&(y=Y.message_read)&&(q=y.match)){AH=(y.action&&y.action.launch&&y.action.launch.id)?M(s,y.action.launch.id):e(s,"message_read");w=U.get(AH)&&F.getByEventName(AD,AH,d+s);AG=q["@attributes"].mode;AC=t=0;Q.each(J.MATCH_CATEGORIES,function(AK){var AM=q[AK]||[],AL=Q.filter(AM,function(AP){var AO=AI[AK][AP.name],AN=!A.isUndefined(AO)&&r(AO,AP.regex);Z("FILTER: "+AF.name+" ("+AF.app+"): ["+AK+"/"+AP.name+"]"+(AN?"":" NOT")+" MATCH for "+AP.regex);return AN;});AC+=AM.length;t+=AL.length;});Z("FILTER: "+AF.name+" ("+AF.app+"): "+"matched "+t+" of "+AC+" filters; mode="+AG);o[AD]={appData:AF,totalNumFilters:AC,numFiltersSatisfied:t,viewId:AH};if(((AG==="or")&&(t>0))||((AG==="and")&&(t>0)&&(AC==t))){v[AD]=AD;if(y.message_actions&&y.message_actions.suppress_attachments=="true"){AB=true;}if(!w&&y.action){u[AD]=AD;}if(NeoConfig.om.isMsgReadAppRTB&&h.isMsgReadRtbApp(s)){z++;}}}}}p=k.getObjSize(o)>0?{filterInfo:AI,filtersMatched:k.getObjSize(v)>0?true:false,launchAppIds:u,matchedAppIds:v,autoRun:true,suppressAttachments:AB,msgReadAppData:o}:{filtersMatched:false,launchAppIds:{},matchedAppIds:{},autoRun:true,msgReadAppData:null};if(NeoConfig.om.isMsgReadAppRTB){p.msgReadRtbApps=z;}return p;}function b(o,Y){var q=parseInt(o.split("_").pop(),10),p=parseInt(Y.split("_").pop(),10);return q<p?-1:p<q?1:o.localeCompare(Y);}var E=[{include:/shortcuts:\/us\/(instance)\/(identifier)\/(URL|phone_number|email_address|date_only|date_time|day_of_week|day_of_week_time|month_only|month_year|time_only|vin|.+_tracking|isbn|hyperlink\/http)(\/([\w\W]+))*$/i,exclude:/(other\/health\/drug|organization\/company\/ticker)/},{include:/shortcuts:\/us\/(instance)\/(place|person|organization|event|animal\/fictional|other)(\/([\w\W]+))*/i,exclude:/(other\/health\/drug|organization\/company\/ticker)/i},{include:/shortcuts:\/us\/(tag)\/(other\/technology|news|celebrity|finance\/glossary_mail|other\/wiki)(\/([\w\W]+))*/i,exclude:/(small_business|health\/yahoo_health)/i},{include:/shortcuts:\/us\/(place\/virtual\/web_site)(\/([\w\W]+)*)/i},{include:/shortcuts:\/us\/(class)(\/([\w\W]+))*/i},{include:/shortcuts:\/(concept)(\/([\w\W]+))*/i},{include:/shortcuts:\/(abstract)\/(other|organization|event)(\/([\w\W]+))*/i}];function S(o){var q,r=Q.some(E,function(s){var u=s.include,t;try{if(!(q=u.exec(o))){return false;
}}finally{u.lastIndex=0;}if((t=s.exclude)){try{if(t.test(o)){return false;}}finally{t.lastIndex=0;}}return true;}),p,Y;if(!r){return null;}p=q[2]==="identifier"?q[3]:q[2];Y=q[Math.floor(q.length-1,5)];return{text:o,category:q[1],type:p,subtype:p!==Y?Y:""};}function G(Y){var p=a.keys(Y).sort(b),o=Q.hash(["class","concept"]);return Q.reduce(p,{filterInfo:{},scAnnotation:{}},function(q,s){var t=Y[s],r=a.keys(Q.reduce(t.type,{},function(x,u){var v=S(u),w;if(v){if(v.type&&v.category&&!o[v.category]){w=v.type.replace(/^.*\//,"");}else{w=v.category||v.subtype;}if(w){x[w.toLowerCase()]=true;}}return x;}));Q.each(r,function(u){var v;if(u==="http"){v=L.unescapeHtml((t.metaData||{}).linkHref)||t.text||"";}else{v=t.text||"";}Q.each(a.keys(q),function(w){if(!q[w][u]){q[w][u]=[];}});q.filterInfo[u].push(v);q.scAnnotation[u].push({id:s,text:v,context:t.context});});return q;});}function W(r){var o=r.search(/<script[^>]*>/i),t,Y,q,p;if(o>=0){t=r.length;Y=Math.max(r.search(/<\/script>/i),t);q=o!==0||Y!==t?r.substring(o,Y):r;p=/\bYAHOO\.Shortcuts\.annotationSet\s*=\s*({[\s\S]*?})\s*;/.exec(q);if(p&&p[1]){try{return D.JSON.parse(p[1]);}catch(s){return null;}}}return null;}var O="om_user_view_id_",g="om_default_view_id_";function M(o,Y){return O+o+"-"+Y;}function e(o,Y){return g+o+"-"+Y;}D.mix(i,{postHookMessageGet:H,runMessageReadAppFilters:P,repackageData:c,canEnhanceMessage:C,validateReturnData:V},true);},"1.0.0",{requires:["om-controller-base","om-common-utils","async-queue","mail-controller-messages","common-utils-stats"]});YUI.add("om-ui-messagepane-base",function(G){var d=G.common.Utils,M=G.om,F=M.model.DataStore,a=F.Registry,J=F.ApplicationConfig,O=M.Controller,i=M.common.Utils,f=NeoConfig.om.isSandboxEnabled,L=NeoConfig.servername,b=d.substitute,A=d.onDemand,N=G.ui.Templates,W=(G.UA.ie&&G.UA.ie<8),B=W?6000:4000,R=500,h=W?11000:6000,U=3,c=0,V=["comms-log4js","common-utils-stats","mail-ui-messagepane-utils-shared","openmail_strings","om-ui-messagepane-sandbox-controller","om-ui-sandbox-view","om-ui-sandbox-datastore","om-ui-sandbox-messageread","om-ui-sandbox-utils","common-utils","mail-ui-messagepane-warnings"],T=["attachments_css","mod-conversation-history_css","mod-shortcuts_css"],K=null,D=null,I=d.rocketstats,g=null,C=null;function Z(Y){i.log(Y,"SANDBOX");}function Q(j,Y){return i.getEventName(j,Y);}G.on("om:msg:registerSandboxController",function(Y){if(!g){Z("Controller registered");g=F.ViewRegistry.get(Y.id);G.fire("readpool:check");}});function E(){var m=["launch_css","vitality_css"],k=[],j;for(var n=0,Y=m.length;n<Y;++n){j=G.one("#"+m[n]);if(j){k.push(j.get("href"));}}return k;}function P(){var Y={isRTL:NeoConfig.isRTL,fullPage:NeoConfig.fullPage,hasConv:NeoConfig.hasConv,isFresh:NeoConfig.isFresh,bidi:NeoConfig.bidi,ieCompatibleMode:{ie8_ie7compatible:NeoConfig.ieCompatibleMode.ie8_ie7Compatible,ie9_ie8compatible:NeoConfig.ieCompatibleMode.ie9_ie8Compatible},livewordEventEnabled:NeoConfig.livewordEventEnabled};return{NeoConfig:Y,cssLinks:E(),appConfig:F.Registry.getSandboxMsgReadConfig(),NeoUrlParams:d.parseQueryString()};}G.on("om:msg:getSandboxPostLaunchConfig",function(Y){if(!D){D=P();}O.Openapi.returnAPI(Y,D);});function H(){function Y(l){return l.slice(0,4)=="http";}var k=G.merge(YUI_config.groups.mail_css),j=G.merge((yui.Env._loader||YUI_config).groups.mail);k.modules=G.mix({},k.modules,false,T);j.modules=G.mix({},j.modules,false,V);if(!Y(k.comboBase)){k.comboBase=NeoConfig.launch_protocol+L+k.comboBase;}if(!Y(j.comboBase)){j.comboBase=NeoConfig.launch_protocol+L+j.comboBase;}return{css:k,js:j,strings:strings,mailYUIURL:NeoConfig.yuiURL,mailBase:YUI_config.base,mailComboBase:YUI_config.comboBase,mailLoaderPath:YUI_config.loaderPath,mailModuleRoot:YUI_config.root};}G.on("om:msg:getConf",function(Y){if(!C){C=H();}O.Openapi.returnAPI(Y,{data:C});});function e(Y){if(g&&a.hasMessageReadEvents(Y)){G.fire(Q(g.get("instanceId"),"sandbox.controller"),{cmd:"apprefresh",args:{appConfig:a.getSandboxMsgReadConfig()}});}}G.on("om:refreshApp",e);G.on("om:installApp",e);G.on("om:uninstallApp",e);var S=function(Y,j,k){var l=this;S.superclass.constructor.apply(l,arguments);l.handleContactChanged=G.on("contacts:api:contactChanged",l.updateLozenges,l);if(!f){return;}l.launchStatus="INIT";l.msgRenderTimer=null;l.isSandboxViewReady=false;l.heightUpdateTimer=null;l.sandboxStartTime=null;l.firstRender=1;l.firstMsgDisplayed=false;l.RSstopwatch=null;l.msgReadRtbApps=0;!l.fullView&&G.once("om:msg:registerSandboxController",function(){if(!l.message){l.render();}});l.modifyAttr("scrollWidthActive",{getter:function(){return !l.isSandboxActive();}});};G.extend(S,G.mail.ui.MessagePane);S.prototype.NAME="OMMessagePane";S.prototype.hasOMFlag=function(j,Y){return j.extend&&j.extend.openmail&&j.extend.openmail.flags&&j.extend.openmail.flags[Y];};S.prototype.isSandboxActive=function(){return f&&g&&c<U&&this.launchStatus!=="TIMEOUT";};S.prototype.getEnhancedBody=function(){var k=this,j=k.message,Y=k.isSandboxActive()&&j.extend&&j.extend.openmail&&j.extend.openmail.enhancedBody;return Y||"";};S.prototype.setFullFormatters=function(){var m=this,l=null,j=null,Y=null,k=function(o){var s=o.s||"",q=o.o||0,n=o.f||m.readFormatters,r=o.a||0,p=o.strs||strings;return b(s,q,n,r,p);};if(S.superclass.setFullFormatters){S.superclass.setFullFormatters.apply(m,arguments);l=m.readFormatters.msg_has_attachment;j=m.readFormatters.msg_has_photo_attachment;m.readFormatters.msg_has_photo_attachment=function(){var n=m.message;return m.isSandboxActive()&&(!G.Lang.isUndefined(n.body)&&m.hasOMFlag(n,"suppressAttachments"))?"":j();};m.readFormatters.msg_has_attachment=function(){var n=m.message;return m.isSandboxActive()&&(!G.Lang.isUndefined(n.body)&&m.hasOMFlag(n,"suppressAttachments"))?"":l();};Y=m.readFormatters.msg_blocked;m.readFormatters.msg_blocked=function(){var n=m.message,o=NeoConfig.isFresh?"_shared_module_message_display_fresh_rollup":"_shared_module_message_display_rollup";return(m.isSandboxActive()&&n.extend&&n.extend.openmail&&n.extend.openmail.imgBlocked)?k({s:N[o].msg_blocked,o:n}):Y();};}};S.prototype.isPreviewPane=function(){return !this.fullView;};S.prototype.getTotalRetryCount=function(){return c;};S.prototype.createSandbox=function(){var j=this,Y=a.getSandboxData();if(!Y){Z("Sandbox app not found.  Switching to message pane.");return;}j.launchStatus="CREATE";O.Views.runActions(Y,"events","message_render",false,null,null,null,null,null,function(k){j.viewObj=k;j.initSandboxIframe();});};S.prototype.sendSandboxControllerEvent=function(j,Y){if(!this.viewObj){return;}G.fire(Q(this.viewObj.get("instanceId"),"sandbox.controller"),{cmd:j,args:Y});};S.prototype.render=function(Y){var j=this;j.firstActive&&j.firstActive.detach();j.firstActive=null;Y=Y||j.parentNode;if(j.firstRender&&!(Y&&Y.inDoc())){j.firstActive=j.once("activeChange",function(k){if(k.newVal){j.firstRender=0;S.superclass.render.apply(j,[Y]);j.firstActive=null;}});}else{S.superclass.render.apply(j,[Y]);}};S.prototype.scrollWidthReset=function(){var Y=this;S.superclass.scrollWidthReset.apply(Y);if(Y.isSandboxActive()){Y.sendSandboxControllerEvent("resetwidth",{"viewId":Y.viewObj.get("viewId")});}};S.prototype.initSandboxIframe=function(){var m=this,j;if(!m.viewObj){Z("viewObj is not available.  Use default appendMarkup.");S.superclass.appendMarkup.apply(m);return;}if(m.launchStatus=="CREATE"){m.startStopwatch(1,"LoadSandbox");m.sandboxStartTime=new Date();m.RSstopwatch=new d.Stopwatch("LoadSandbox");Z("Waiting for sandbox to register.");j=m.message;if(j){m.message={flags:j.flags,header:j.header,mid:j.mid};
}S.superclass.appendMarkup.apply(m);m.message=j;var Y=m.get("parentNode"),l=Y.one(".tripane.content")||Y.one(".message.content"),k=setTimeout(function(){if(m.launchStatus!="TIMEOUT"){Z("TIMEOUT: sandbox failed to register!");m.launchStatus="TIMEOUT";m.closeSandbox();if(++c===U){G.mail.Controller.Messages.unhook("get",K);}}S.superclass.appendMarkup.apply(m);I.stat("OM","ERR:registerSandbox");},B);l.append(m.viewObj.getMarkup());m.viewObj.initIframe();m.launchStatus="WAIT";m.applyHandler();m.once("sandboxViewReady",function(){m.RSstopwatch&&m.RSstopwatch.stop&&m.RSstopwatch.stop();if(m.sandboxStartTime){window.rt_LogTime&&rt_LogTime("t2",(new Date())-m.sandboxStartTime,true);m.sandboxStartTime=null;}Z("SUCCESS: registered!");m.launchStatus="REGISTERED";clearTimeout(k);m.isSandboxViewReady=true;});m.viewObj.once("load",function(){m.sendSandboxControllerEvent("initsandboxview",{viewId:m.viewObj.get("viewId"),data:{fullView:m.fullView}});});}};S.prototype.appendMarkup=function(){var Y=this;if(!f||!g){Z("Default appendMarkup");S.superclass.appendMarkup.apply(Y);return;}if(Y.launchStatus=="INIT"||Y.launchStatus=="TIMEOUT"){if(c<U){Y.createSandbox();}}Y.handleSandbox();};S.prototype.applyHandler=function(){var j=this,Y=j.viewObj.get("viewId");j.internalAPIHandler=G.on("om:msg:"+Y,j.handleInternalAPI,j);j.on("activeChange",function(k){j.sendSandboxControllerEvent("activechange",{viewId:Y,newVal:k.newVal});if(k.newVal===1&&NeoConfig.fullPage){j.sendSandboxControllerEvent("updateheight",{"viewId":Y});}});j.on("closeChange",function(k){if(k.newVal===1){j.closeSandbox();}});};S.prototype.closeSandbox=function(){var j=this,Y=(j.viewObj)?j.viewObj.get("viewId"):null;j.isSandboxViewReady=false;j.firstMsgDisplayed=false;j.sandboxStartTime=null;j.RSstopwatch=null;if(Y){j.sendSandboxControllerEvent("closesandboxview",{"viewId":Y});if(j.heightUpdateTimer){j.heightUpdateTimer.cancel();}O.Views.closeView(Y);j.viewObj=null;}if(j.internalAPIHandler){j.internalAPIHandler.detach();j.internalAPIHandler=null;}if(j.handleContactChanged){j.handleContactChanged.detach();j.handleContactChanged=null;}if(j.msgRenderTimer){clearTimeout(j.msgRenderTimer);j.msgRenderTimer=null;}};S.prototype.handleSandbox=function(){try{var p=this,j=p.viewObj,n=p.message,o=!!(n&&!n.body&&!p.loading_slow&&!p.loading_error)||p.outboundReq,Y=p.formatters.page_show_comm_modes()+p.formatters.page_show_comm_modes_else(),l=(n&&n.body)?p.getEnhancedBody()||n.body.display:"";}catch(m){I.stat("OM","ERR:genMarkup");}function k(){try{p.RSstopwatch=new d.Stopwatch("DisplayMessageInSandbox");p.startStopwatch(1,"DisplayMessageInSandbox");p.msgReadRtbApps=n&&n.extend&&n.extend.openmail&&n.extend.openmail.context.msgReadRtbApps;var q=null,w={data:{}},y=n&&n.extend&&n.extend.openmail&&n.extend.openmail.context,t=n&&n.extend&&n.extend.openmail&&n.extend.openmail.onreadScripts||[],x=G.Array.map(y&&G.Object.keys(n.extend.openmail.context.matchedAppIds)||[],function(z){return z.split(".")[0];});if(y){w.data=O.Messageread.repackageData(n);}w.data.loading=o;w.data.matchedAppIdList=x;w.data.appCodes=[];w.data.body={content:Y,msgBody:l,truncated:(n&&n.body&&n.isTruncated),scrollTop:p.scrollTop,href:p.href,isChat:p.isChat(n)};if(n&&n.body){var v=NeoConfig.isFresh?"_shared_module_message_display_fresh_rollup":"_shared_module_message_display_rollup";w.data.body.msgBlockedMarkup=b(N[v].msg_blocked,n,p.readFormatters,0,strings);}for(var s=0,r=t.length;s<r;++s){q=t[s];w.data.appCodes.push({css:q.css,scripts:q.scripts,APIContext:q.context});}Z("Send mesage to Sandbox.");if(n&&n.body){if(p.msgRenderTimer){clearTimeout(p.msgRenderTimer);}p.msgRenderTimer=setTimeout(function(){p.launchStatus="TIMEOUT";p.closeSandbox();S.superclass.appendMarkup.apply(p);I.stat("OM","ERR:sendMessageToSandbox");},h);}p.sendSandboxControllerEvent("render",{viewId:p.viewObj.get("viewId"),data:w});}catch(u){I.stat("OM","ERR:fireRenderEvent");}}if(p.isSandboxViewReady){k();}else{p.once("sandboxViewReady",function(){k();});}};S.prototype.handleSandboxRenderComplete=function(){var m=this,j=m.viewObj?m.viewObj.get("viewId"):null,l=m.viewObj?m.viewObj.getIframe():null,k=function(){var n;S.superclass.renderComplete.apply(m);if(l){if(m.message&&m.message.header){n=m.message.header.subject;}l.set("title",n||strings["str_comp_nosubject"]);}};if(m.msgRenderTimer){clearTimeout(m.msgRenderTimer);m.msgRenderTimer=null;}if(!m.firstMsgDisplayed){m.firstMsgDisplayed=true;var Y=m.get("parentNode");if(Y){Y.all(".message.content > div").remove();}if(l){l.addClass("enabled");}if(NeoConfig.fullPage){m.heightUpdateTimer=G.later(R,m,function(){if(m.get("active")){m.sendSandboxControllerEvent("updateheight",{"viewId":j});}},null,true);}}else{window.rt_LogTime&&rt_LogTime("t2",0,true);}if(!m.outboundReq&&m.message&&m.message.body){G.UA.ie?setTimeout(k,0):k();}};S.prototype.renderProfileImage=function(j){var l=this,Y=l.viewObj?l.viewObj.get("viewId"):null,k;if(G.Lang.isArray(j)&&j.length==1){j=j[0];}if(!l.isSandboxActive()){S.superclass.renderProfileImage.apply(l,[j]);return;}k=S.superclass.getProfileImageMarkup.apply(l,[j]);if(k){l.sendSandboxControllerEvent("updateheaderprofileimage",{"viewId":Y,data:{html:k}});}};S.prototype.renderComplete=function(Y){var j=this;if(!j.isSandboxActive()){S.superclass.renderComplete.apply(j);return;}j.RSstopwatch&&j.RSstopwatch.stop&&j.RSstopwatch.stop();};S.prototype.postRender=function(){var Y=this;if(Y.isSandboxActive()){Y.sendSandboxControllerEvent("resizeSubject",{viewId:Y.viewObj.get("viewId")});}S.superclass.postRender.apply(Y);};S.prototype.handleSandboxDOMSubtreeModified=function(Y){var j=this;i.getIFrameById(j.viewObj.get("viewId")).setStyle("height",Y.height+"px");};S.prototype.handleSandboxDOMSubtreeModifiedWidth=function(Y){var j=this;S.superclass.scrollWidthUpdate.apply(j,arguments);};S.prototype.handleAttachmentDownloadSingle=function(Y){var j=this;j.downloadAttachment(Y.partId,Y.tnefId);};S.prototype.handleAttachmentDownloadAll=function(Y){this.downloadAllAttachments("non-image");
};S.prototype.handleAttachmentDownloadAllPhotos=function(Y){this.downloadAllAttachments("image");};S.prototype.handleAttachmentDownloadEverything=function(Y){this.downloadAllAttachments("all");};S.prototype.handleMessageSetFlag=function(Y){var j=this;G.use("mail-ui-messageevents",function(l){var k=j.message.flags.isFlagged?"unflagged":"flagged";l.mail.ui.MessageEvents.handleUI({action:k},j.fid,null,[j.message]);});};S.prototype.handleMessageSetUnread=function(Y){var j=this;G.use("mail-ui-messageevents",function(l){var k=j.message.flags.isRead?"unread":"read";l.mail.ui.MessageEvents.handleUI({action:k},j.fid,null,[j.message]);});};S.prototype.handleMailTo=function(Y){G.use("mail-ui-shortcuts",function(j){j.mail.ui.ShortCuts.composeMailToMessage(Y.mailto);});};S.prototype.handleMRD=function(Y){G.use("mail-controller-mrd",function(j){j.fire("mrd:launch",Y.mrdLink);});};S.prototype.handleUnblockImages=function(Y){var j=this;j.unblockImages();};S.prototype.handleLoadOptions=function(Y){var j=this;j.loadOptions();};S.prototype.handleRetryLoad=function(Y){var j=this;j.retryLoad();};S.prototype.handleToggleShowDetails=A("toggleShowDetails","mail-ui-messagepane-bind");S.prototype.showMore=function(Y){this.sendSandboxControllerEvent("showMore",{"viewId":this.viewObj.get("viewId"),"markup":this.getAllLozenges(Y.field),"field":Y.field});};S.prototype.updateMessageFlagMarkup=function(Y){if(!f||!this.viewObj){S.superclass.updateMessageFlagMarkup.apply(this);return;}this.sendSandboxControllerEvent("messageflagstatus",{"viewId":this.viewObj.get("viewId")});};S.prototype.updateMessageReadMarkup=function(Y){if(!f||!this.viewObj){S.superclass.updateMessageReadMarkup.apply(this);return;}this.sendSandboxControllerEvent("messagereadstatus",{"viewId":this.viewObj.get("viewId")});};S.prototype.updateLozenges=function(Y){if(!f||!this.viewObj){return;}this.sendSandboxControllerEvent("handleupdatelozenges",{viewId:this.viewObj.get("viewId"),data:{contacts:Y.details[0]}});};S.prototype.convertShortcuts=function(){};S.prototype.setFocusToSandboxElement=function(Y){if(this.viewObj){this.sendSandboxControllerEvent("setfocus",{viewId:this.viewObj.get("viewId"),selector:Y});}};S.prototype.pressLozenge=function(Y){if(this.viewObj){this.sendSandboxControllerEvent("pressLozenge",{viewId:this.viewObj.get("viewId"),selector:Y});}};S.prototype.unpressLozenge=function(Y){if(this.viewObj){this.sendSandboxControllerEvent("unpressLozenge",{viewId:this.viewObj.get("viewId"),selector:Y});}};S.prototype.startStopwatch=function(k,j){var Y=d.Stopwatch.get("MsgInPreview")||this.stopwatch;Y&&Y.start(k,j);};S.prototype.handleInternalAPI=function(j,Y){var k=this;switch(j){case"sandboxStartStopwatch":k.startStopwatch(Y.lv,Y.msg);break;case"sandboxSetFocus":k.setFocusToSandboxElement(Y.selector);break;case"sandboxRenderComplete":k.handleSandboxRenderComplete();break;case"sandboxDOMSubtreeModified":k.handleSandboxDOMSubtreeModified(Y);break;case"sandboxDOMSubtreeModifiedWidth":k.handleSandboxDOMSubtreeModifiedWidth(Y);break;case"sandboxViewReady":k.fire("sandboxViewReady");break;case"downloadSingle":k.handleAttachmentDownloadSingle(Y);break;case"downloadAll":k.handleAttachmentDownloadAll(Y);break;case"downloadAllPhotos":k.handleAttachmentDownloadAllPhotos(Y);break;case"downloadEverything":k.handleAttachmentDownloadEverything(Y);break;case"setFlag":k.handleMessageSetFlag(Y);break;case"setUnread":k.handleMessageSetUnread(Y);break;case"mailto":k.handleMailTo(Y);break;case"mrd":k.handleMRD(Y);break;case"viewFullMsg":k.viewFullMsg(Y);break;case"unblockImages":k.handleUnblockImages(Y);break;case"loadOptions":k.handleLoadOptions(Y);break;case"retryLoad":k.handleRetryLoad(Y);break;case"toggleShowDetails":k.handleToggleShowDetails(Y);break;case"showMore":k.showMore(Y);break;case"message.readAppTime":k.handleMsgReadAppTime(Y);break;case"pressLozenge":k.pressLozenge(Y.selector);break;case"unpressLozenge":k.unpressLozenge(Y.selector);break;}};S.prototype.setDocRole=function(){};S.prototype.setRootNodeTabIndex=function(){this.get("rootNode").set("tabIndex",-1);};S.prototype.setFocusNode=function(){};S.prototype.onFocus=function(){var j=this,Y=j.fullPageView?j.getSubjectFocusNodeSelector():".message.content";if(j.launchStatus=="REGISTERED"&&j.get("active")&&j.message){j.setFocusToSandboxElement(Y);}return 1;};S.prototype.handleMsgReadAppTime=function(l){var o=this,n=o.message,k=n.mid,m=l.time,Y=a.getAppName(l.appId)||"",j=d.Stopwatch.get("MsgInPreview")||o.stopwatch;j&&j.addComment("-AppRender."+Y+":"+m);if(--o.msgReadRtbApps===0){o.fire("msgReadAppComplete");}Z("message.read app time(mid:"+k+" / appName:"+Y+"): "+m);};G.namespace("om.ui");G.om.ui.OMMessagePane=S;if(f){var X={success:function(Y,k,j){O.Messageread.postHookMessageGet(Y,k,j);}};K=G.mail.Controller.Messages.hook("get",X);}},"1.0.0",{requires:["mail-ui-messagepane-base","mail-controller-messages","json-stringify","om-model-datastore","om-controller-messageread","om-controller-views","common-utils-stats","rocket-stats"]});YUI.add("om-ui-workspace-base",function(A){A.namespace("om.ui");A.om.ui.Workspace=new function(){var G=this,D=A.om.model.DataStore.Registry,E=A.om.ui.ApplicationList;function C(H){var J=H.appId,I=H.hiliteAppId,K=H.param;B(J,I,K);}function B(I,H,J){A.use("om-controller-views",function(M){var K,L={};K=I?D.get(I):D.getGalleryData();if(!K){K={app:I};}if(H){L=[H];}else{if(J){L.launchParams=J;}}M.om.Controller.Views.runActions(K,"events","click",true,L);});}function F(){A.on("om:appclicklaunch",B);A.on("om:mrd:gallery",C);A.on("om:mrd:launch",C);}A.augment(G,A.EventTarget);A.augment(G,A.Attribute);F();if(NeoConfig.om.isSandboxEnabled&&A.UA.ie!=7){if(NeoConfig.hasConv){A.use("om-ui-convpane-base",function(H){H.mail.ui.Factory.register("mail.ui.ConvPane",H.om.ui.OMConvPane);});}else{A.use("om-ui-messagepane-base",function(H){H.mail.ui.Factory.register("mail.ui.MessagePane",H.om.ui.OMMessagePane);});}}}();},"1.0.0",{requires:["mail-ui-factory-base","om-model-datastore","om-ui-applicationlist-base","om-ui-messagepane-base"]});