YUI.add("_shared_module_offscreen_bin_compose",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose={base:'<div id="ac-to-results" class="ac-results"></div><div id="ac-cc-results" class="ac-results"></div><div id="ac-bcc-results" class="ac-results"></div>'};},"1.0.0");YUI.add("comms-utils",function(E){E.namespace("comms");var B={},D=E.Object,C=E.Lang,A=C.trim,F=/{{([^{}]*)}}/g;E.mix(B,{substitute:function(M,L,I,H,G,K,J){if(typeof M!=="string"){return;}if(J){M=J.str||M;L=J.obj||L;I=J.formatters||I;H=J.args||H;G=J.strings||G;K=J.templates||K;}return M.replace(F,function(O,N){var Q,P,R=B.substitute;if(I&&(Q=(J&&J.formatters)?J.formatters[N]:I[N])){return(Q(L,H,J))||"";}else{if(L&&N in L){P=L[N];return typeof P==="string"&&P.match(F)?R(P,L,I,H,G,K,J):P;}else{if(G&&N in G){P=G[N];return P.match(F)?R(P,L,I,H,G,K,J):P;}else{if(K&&N in K){return R(K[N].base||K[N],L,I,H,G,K,J);}else{return"";}}}}});},escapeHtml:function(G){if(G===null){return null;}G=""+G;G=G.replace(/&(?!(amp|lt|gt|quot|#39|#92);)/g,"&amp;");G=G.replace(/</g,"&lt;");G=G.replace(/>/g,"&gt;");G=G.replace(/\"/g,"&quot;");G=G.replace(/\'/g,"&#39;");G=G.replace(/\\/g,"&#92;");return G;},unescapeHtml:function(G){if(G===null){return null;}G=""+G;G=G.replace(/&amp;/g,"&");G=G.replace(/&lt;/g,"<");G=G.replace(/&gt;/g,">");G=G.replace(/&quot;/g,'"');G=G.replace(/&#39;/g,"'");G=G.replace(/&#92;/g,"\\");return G;},createAddress:function(M){var G=false,I=null,H=null,K=/(<[^<>]+@[^<>]+\.[^<>]+>)|(\([^\(\)]+@[^\(\)]+\.[^\(\)]+\))|(\[[^\[\]]+@[^\[\]]+\.[^\[\]]+\])/,L,J=M.replace(/\".*\"/g,"");if(!A(J)||J.indexOf("@")<0){return{fail:true,email:M,name:B.escapeHtml(M)};}if(K.test(M)){L=M.match(K);H=L[0];I=A(M.replace(H,""));H=H.substring(1,H.length-1);}else{H=I=A(M);}if(!B.isValidEmail(H)){G=true;}return{fail:G,email:H,name:B.escapeHtml(I)};},isValidEmail:function(R){if(!R){return false;}var N=0,H=R,J=R.lastIndexOf("@"),S=R.substr(0,J),M=S.replace(/\\\\/g,""),I=S.length,L=R.substr(J+1),G=L.length,O=/^(\\.|[A-Za-z0-9!#%&`_=\/$'*+?^{}|~.-])+$/,K=/^"(\\"|[^"])+"$/,Q=/(^\..*)|(.*\.$)/,P=/^[A-Za-z0-9\-]+$/,T=/\.\./;if(!O.test(M)&&!K.test(M)){H=false;}L=L.split(".");G=L.length;if(G<2){H=false;}while(N<G){if(!P.test(L[N++])){H=false;}}return H;},splitName:function(M){var Q={},N,J,L=A(M),R,H,K=[],I=((strings.str_name_format).replace(/\{|\}/g,"")).split(" "),P=/^(?:\w[^\s@]*@[^\s@]+\.[^\s@]{2,})?$/,O=false,G=true;if(I[0]=="family_name"){O=true;}if(I.length<3){G=false;}while(L){R=L.match(/([^\u3000\s]*)[\u3000\s]+/);if(!R||R.length!==2||!R[0]){K.push(L);break;}K.push(R[1]);L=L.substring(R[0].length);}N=K.length;for(J=0;J<N;J+=1){H=K[J];switch(J){case 0:if(H){Q[(O?"familyName":"givenName")]=(N==1&&P.test(H))?"":H;}break;case 1:if(G&&2<N){Q.middleName=H;}else{Q[(O?"givenName":"familyName")]=H;}break;case 2:if(G){Q[(O?"givenName":"familyName")]=H;}else{Q[(O?"givenName":"familyName")]+=" "+H;}break;default:Q[(O?"givenName":"familyName")]+=" "+H;}}return Q;}});E.comms.Utils=B;},"1.0.0",{requires:[]});YUI.add("searchautocomplete",function(B){var C=NeoConfig.uh3Enabled,G=C?NeoConfig.searchField||B.one("#mnp-search_box"):B.one("#yuhead-search")||B.one("#search"),L=NeoConfig.searchField||G.one("input")||B.one("#mnp-search_box"),E=B.contacts,F=E.utils,I=B.common.Utils,H=I.substitute,K=5;B.on("contacts:api:loaded",function(M){A();});L.on("focus",function(M){if(F.areContactsLoaded()){A();}});L.on("keydown",function(M){var N=M.keyCode;M.stopPropagation();switch(N){case 13:if(M.ctrlKey||M.metaKey){return;}var V=this.get("value"),T,W=null,U=null,Q=null,R=false,P=false,S,O;if(C){T=B.ACWidgetInst.get("contentBox");W=T.one(".yui3-acwidget-selected");U=T.one(".ac-search-mail");Q=T.one(".ac-search-web");}if(W){if(U&&U.contains(W)){B.fire("fireSearch",V);B.fire("mt:click",{action:"ml_srch",spid:"search_results"});R=true;S=new B.EventTarget();S.publish("ucs:mailSearch",{broadcast:2,emitFacade:true});S.fire("ucs:mailSearch");}else{if(Q&&Q.contains(W)){S=new B.EventTarget();S.publish("ucs:webSearch",{broadcast:2,emitFacade:true});S.fire("ucs:webSearch",{query:V});B.fire("mt:click",{action:"wb_srch"});R=true;}else{P=true;}}}if(!R){if(B.ACWidgetInst&&B.ACWidgetInst.isVisible()&&B.ACWidgetInst.get("data").length>0&&B.ACWidgetInst.get("selectedIndex")>-1){B.ACWidgetInst.handleEnter(M,B.ACWidgetInst);}else{if(C){B.fire("mt:click",{action:P?"ml_srch_sugg":"ml_srch",spid:"search_results"});}B.fire("fireSearch",V);S=new B.EventTarget();O=P?"ucs:mailSearchSugg":"ucs:mailSearch";S.publish(O,{broadcast:2,emitFacade:true});S.fire(O);}}B.ACWidgetInst.hide();M.halt();break;}});function A(){if(NeoConfig.isCorpmail){B.use("ac-corp-widget",J);}else{J();}}function J(){if(!B.ACWidgetInst){var M=H(B.ui.Templates._shared_module_offscreen_bin_compose.base,{},null,null,strings,B.ui.Templates),N=NeoConfig.isCorpmail?E.ui.ACCorpWidget:E.ui.ACWidget;B.one(document.body).append(M);B.ACWidgetInst=new N({acNode:G,acTarget:L,contentBox:"#ac-to-results",selectFirst:false}).setAlign().render();}else{if(B.ACWidgetInst.get("ac").get("alignNode")!==G){B.ACWidgetInst.get("ac").destructor();B.ACWidgetInst.refresh({acNode:G,acTarget:L,width:G.getStyle("width"),selectFirst:false}).setAlign().render();}}B.ACWidgetInst.get("ac").detach("ac:query");B.ACWidgetInst.get("ac").on("ac:query",function(Q){var W=this,S=Q.value,U,R=this.get("badResult"),P,T,V;if(R){P=I.escapeRegexp(I.escapeHtml(R));T=new RegExp("^"+P,"gi");if(Q.value.match(T)){this.fire("ac:load",{results:[],query:Q.value});D(S);return;}}if(F.areContactsLoaded()){var O=new B.comms.FilterContacts();O.updateFilterItems(S);U=O.fastMatch();U.queryStr=S;if(U.length>K){U.length=K;}V=B.bind(W.reload,W,U);V(U);}D(S);});}function D(P){if(!C){return;}B.ACWidgetInst.setSize();var M=B.ACWidgetInst.get("contentBox"),O='<ul role="presentation" class="ac-search-mail"><li role="option">'+strings.str_uh_searchmail+'<span class="ac-value hidden">'+P+"</span></li></ul>",N='<ul role="presentation" class="ac-search-web"><li role="option">'+strings.str_uh_search_web_for.replace("{{query}}",P)+'<span class="ac-value hidden">'+P+"</span></li></ul>",Q=M.one(".ac-search-mail li");acSearchWeb=M.one(".ac-search-web li");if(NeoConfig&&!NeoConfig.has2ButtonSearch){if(!Q){M.insertBefore(O,M.get("firstChild"));}else{Q.setContent(O);}if(!acSearchWeb){M.appendChild(N);}else{acSearchWeb.setContent(N);}}M.all("span.ac-remove-item").remove();if(B.ACWidgetInst.get("data").length>0){B.fire("mt:view",{action:"hdr_ac_sugg"});}else{B.fire("mt:view",{action:"hdr_ac"});}M.setStyle("display","block");}},"1.0.0",{requires:["ac-widget","filter-contacts","forms_css","autocomplete_css","_shared_module_offscreen_bin_compose","common-utils","comms-utils","mail-ui-searchbar"]});