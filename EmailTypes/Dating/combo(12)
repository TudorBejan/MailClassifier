YUI.add("mail-ui-foldersview-bind",function(A){var N=A.Node.one,U=A.common.Utils,V=A.mail.persist.MetaData,R=strings.str_nav_inbox;var T="#system-folders",P="#custom-folders",G=N(T),F=N(P),H={"in":"Inbox",chats:"%40C%40Chats",drafts:"Draft",sent:"Sent",folder:"%40B%40Bulk",spam:"%40B%40Bulk",trash:"Trash"},b={"Inbox":"str_tabs_inbox","Draft":"str_tabs_drafts","Sent":"str_tabs_sent","%40B%40Bulk":"str_tabs_spam","%40C%40Chats":"str_tabs_conversations","Trash":"str_tabs_trash"},S=NeoConfig.grayoutEnabled,L=A.Lang;var O=function(g,d,e){var Y={"action":e,"args":{}},f={"inbox":"folderview_inbox","drafts":"folderview_draft","sent":"folderview_sent","trash":"folderview_trash","conversations":"folderview_chat","spam":"folderview_bulk","custom_fldr":"folderview_custom"},c;if(e==="sysFldCk"){if(typeof(g)==="string"&&d==="btn"){Y.args.btn=g.replace("btn-","");if(g==="checkmail"){c="inbox";}}else{c=b[g]&&b[g].replace("str_tabs_","");Y.args.id=c;}}if(e==="usr_fldr"){c="custom_fldr";Y.args.id=g||"";}Y.spid=f[c]||"";A.fire("mt:click",Y);return true;};var a=function(f){var g=this,Y=S&&A.mail.ui.ContextButton,d=f.target;f.preventDefault();function c(i){var e=G.menu.getContextTarget(),h;if(e){i.target=e.ancestor(function(j){h=j.getAttribute("data-fid")||null;return h;},true);if(h){g.handleFolderActions(i,h);}}}if(!G.menu){A.use("common-ui-menu-helper",function(h){var e=h.common.ui.MenuHelper;e.createLoadingMenu(G,{isContext:true,xy:[f.clientX,f.clientY]});h.use("mail-ui-inboxmenu-base",function(i){i.mail.ui.InboxMenu.insert("menu-system-folder",function(){var j=N("#menu-system-folder");i.common.ui.MenuHelper.create(G,{menu:j,isContext:true,xy:[f.clientX,f.clientY],contextTarget:f.target,keys:function(k){k(i.mail.ui.InboxMenu.getValidKeys(j));}},function(){j.on("menuSelected",c);j.on("menu:state",function(m){var k=G.menu.getContextTarget().ancestor("li");if(m.state=="show"){var l=this.one("[data-action=folder-allread]");if(k&&"%40C%40Chats"===k.getAttribute("data-fid")){l.addClass("disabled");l.one("a").set("aria-disabled",true);}else{l.removeClass("disabled");l.one("a").removeAttribute("aria-disabled");}}else{if(m.state=="hide"){d&&d.focus();}}if(Y){Y.setNodeFolderMenu(k,j);}J(k,m.state);});});});});});}};function J(Y,c){if(Y){if("show"==c&&!Y.hasClass("selected")){Y.addClass("cntxtmenu");}else{if("hide"==c){Y.removeClass("cntxtmenu");}}}}function B(c,d){var Y;if(c){c=c[d.keyCode==40?"next":"previous"]();if(c&&(c.getStyle("display")!=="none")){Y=c;}else{Y=B(c,d);}}return Y;}var Q=function(c){O("checkmail","btn","sysFldCk");var Y=c.currentTarget,d=Y.getAttribute("data-mboxid");this.checkMail(d);};var E=function(Y){A.fire("#system-folders.li:keydown",Y);};var C=function(f){var g=f.currentTarget,d=f.keyCode,Y,c=A.UA.os;if((c=="macintosh")&&(d==8)){d=46;}switch(d){case 46:if(!g.one("input")){this.handleFolderActions({dataAction:"folder-remove"},g.getAttribute("data-fid"));f.preventDefault();}break;case 67:this.handleFolderActions({dataAction:"folder-rename",target:g});break;case 121:case 77:Y=(c=="windows"||c=="win");if((Y&&f.shiftKey&&d==121)||(!Y&&f.ctrlKey&&f.shiftKey&&f.altKey&&d==77)){f.preventDefault();U.simulateContextMenu(f.target);}break;}};var K=function(f){var d=f.target,c,Y;if(f.keyCode==38||f.keyCode==40){f.halt();c=B(d.ancestor("li"),f);if(c){d.set("tabIndex",-1);Y=c.one("a[role=option]");Y.set("tabIndex",0);Y.focus();}else{if(f.keyCode==38){if(d===A.one("#custom-folders a")){A.one("#custom-folders-btn").focus();f.halt();}}}}};var Z=function(Y){var c=U.getDataAction(Y);this.handleFolderActions({"dataAction":c.action,target:Y.target});};var I=function(d){var c=d.currentTarget,Y=c.one("input.trash"),f;if(Y){d.halt();A.UA.webkit&&d.target.focus();f=U.getDataAction(d);this.handleFolderActions({dataAction:f.action,target:d.target});O(d.currentTarget.get("id"),"btn","sysFldCk");}};var D=function(m){var n=m.currentTarget,f=m.target,l,Y,c,k,d,j,h,i;if(m.target.hasClass("clicker")){if(n.hasClass("open")){n.removeClass("open");}else{n.addClass("open");}return;}function g(){var p=G.all(".inbox-sub"),o=V.get("neo.pref.mboxesState")===1?0:1,e;if(p){p.each(function(q){q.toggleClass("hidden");});}if((e=G.one("#"+(o?"hide":"show")+"-accts"))){e.set("tabIndex",0);e.focus();}NeoConfig.expandEA=o;V.set("neo.pref.mboxesState",o);}if(f.get("nodeName")!=="INPUT"&&!f.hasClass("trash")&&!f.hasClass("check-mail")){O(m.currentTarget.get("id"),"folder","sysFldCk");}if(n.hasClass("in")||n.hasClass("inbox-sub")){i=f.getAttribute("data-action");if(i==="show-accounts"){m.halt();g();}else{if(!f.hasClass("check-mail")){l=L.trim(n.one("input").getAttribute("data-mboxid"));d={fid:"Inbox",name:R,mailboxId:l&&l.length>0?l:"Inbox",smartFolder:m.smartFolder,forceRefresh:m.smartFolder};}}}else{if(m.target.get("type")!="button"){Y=n.get("className").split(" ");c=strings[b[n.getAttribute("data-fid")]];k=H[L.trim(Y[0])];h=k||Y[0];if(h){d={fid:k||Y[0],name:c,mailboxId:null,smartFolder:m.smartFolder,forceRefresh:m.smartFolder};}}}if(d){m.preventDefault();this.set("fid",d);}};var M=function(d){var c=d.currentTarget,f=c.getAttribute("data-fid"),Y=L.trim(c.one("a i").get("text"));if(d.target.hasClass("clicker")){if(c.hasClass("open")){c.removeClass("open");}else{c.addClass("open");}return;}O(f,"folder","usr_fldr");if(this.get("active")&&(f===d.fid)){this.handleFolderActions({dataAction:"folder-rename",target:d.currentTarget});}else{this.set("fid",{fid:f,name:Y,smartFolder:d.smartFolder,forceRefresh:d.smartFolder});}};var X=function(f){var g=this,Y=S&&A.mail.ui.ContextButton,d=f.target;f.preventDefault();function c(i){var e=F.menu.getContextTarget(),h;if(e){i.target=e.ancestor(function(j){h=j.getAttribute("data-fid")||null;return h;},true);if(h){g.handleFolderActions(i,h);}}}if(!F.menu){A.use("common-ui-menu-helper",function(h){var e=h.common.ui.MenuHelper;e.createLoadingMenu(F,{isContext:true,xy:[f.clientX,f.clientY]});h.use("mail-ui-inboxmenu-base",function(i){i.mail.ui.InboxMenu.insert("menu-folder",function(){var j=N("#menu-folder");e.create(F,{menu:j,isContext:true,xy:[f.clientX,f.clientY],contextTarget:f.target,keys:function(k){k(i.mail.ui.InboxMenu.getValidKeys(j));
}},function(){j.on("menuSelected",c);j.on("menu:state",function(l){var k=F.menu.getContextTarget().ancestor("li");if(Y){Y.setNodeFolderMenu(k,j);}J(k,l.state);if(l.state=="hide"){d&&d.focus();}});});});});});}};function W(f){var d=N(P+"-nav"),Y=N("#renamer");f.preventDefault();if(!Y||Y.getStyle("display")=="none"){d.toggleClass("collapsed");d.toggleClass("expanded");var c=d.hasClass("expanded");c?O(d,"folder","fldr_tog"):O(d,"folder","fldr_add");d.one("span").set("title",c?strings.str_nav_left_folders_expanded_attr:strings.str_nav_left_folders_collapsed_attr);d.one(".label").set("aria-expanded",c);V.set("neo.pref.folderState",c?1:0);}}A.mix(A.mail.FoldersView,{contextClick:a,folderHilite:J,checkMailClick:Q,sysFoldersKeyDown:E,usrFoldersKeyDown:C,upDownNavigation:K,newFolderClick:Z,emptyFolderOnClick:I,sysFoldersClick:D,usrFoldersClick:M,usrFoldersContextClick:X,onLabelClick:W});},"1.0.0");