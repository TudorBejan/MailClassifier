YUI.add("mail-ui-searchutils",function(E){var D=E.common.Utils.substitute,A=E.common.persist.UserData,C=NeoConfig.grayoutEnabled,B=E.common.Utils.unescapeHtml;E.namespace("mail.ui");E.mail.ui.SearchUtils={showAlert:function(H,F){var G=F||{};G.hd=G.hd||strings.str_branding_mail;switch(H){case"emptySelection":if(C){return;}G.bd=strings.str_modal_zero_selected;break;case"multipleSelection":if(C){return;}G.bd=strings.str_modal_select_single_message;break;case"fullHeader":G.hd=strings.str_menu_view_full_headers;G.modal_classes="lg";G.focusedNode=".default";break;case"fullHeaderError":G.hd=strings.str_menu_view_full_headers;G.bd=strings.str_error_no_body_returned;break;case"MultiFromRefinement":G.bd=strings.str_modal_multi_from_refinement;break;case"MultiFolderRefinement":G.bd=strings.str_modal_multi_folder_refinement;break;case"SearchPuncError":G.hd=strings.str_srch_punc_header;G.bd=D(strings.str_srch_punc_body,null,null,null,strings);break;case"searchNoChat":G.bd=strings.str_srch_no_chats;break;case"redirectMsgSuccess":G.hd="Redirect Messages";G.bd="Message redirection <b>successful.</b>";break;case"redirectMsgFailure":G.hd="Redirect Messages";G.bd="Message redirection <b>failed.</b>";break;default:return;}E.use("common-ui-dialog-helper",function(I){I.common.ui.DialogHelper.alert(G);});},showConfirm:function(H,F){var K,I,J,G;switch(H){case"removeAll":K="str_modal_message_delete_all_title";I="str_modal_message_delete_all_question";break;case"redirectMsg":J="Redirect messages";G='Redirect to: &nbsp; <input id="redirectMsg" class="field-name " type="text" size="30" value="buggy_messages@yahoo.com" name="redirectMsg">';break;default:return;}E.use("common-ui-dialog-helper",function(L){L.common.ui.DialogHelper.confirm({hd:J||strings[K],bd:G||strings[I]},{ok:{handler:function(N,M){F();M.destroy();},stopDestroy:true}});});},getPaginationControls:function(F,H){if(!NeoConfig.fullPage){return"";}var K=F.cacheIndex+1,G=Math.ceil(F.serverTotal/F.cacheSize),L=(K===1),J=(K===G),I={current:K,total:G,first_class_disabled:L?" disabled":"",first_aria_disabled:L?"true":"false",last_class_disabled:J?" disabled":"",last_aria_disabled:J?"true":"false",get_message_response:H.get_message_response,pagination_inner:H.pagination_inner};return D(H.has_pagination,I,null,null,strings);},getAttachmentProperties:function(I){var G=I?I.split("/"):[""],H=G[0].toLowerCase(),F=G[1]&&G[1].toLowerCase();switch(H){case"image":return{"type":strings["str_srch_photo"],"icon":"img","refineBy":"image"};case"text":case"application":return E.mail.ui.SearchUtils.getAttachmentProperties(F);case"plain":return{"type":strings["str_srch_plain"],"icon":"txt","refineBy":"plain"};case"html":return{"type":strings["str_srch_html"],"icon":"","refineBy":"html"};case"htm":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_html"]+")","icon":"","refineBy":"htm"};case"excel":case"vnd.ms-excel":return{"type":strings["str_srch_excel"],"icon":"xls","refineBy":"excel"};case"mp3":case"audio":case"x-wav":case"x-ms-wma":return{"type":strings["str_srch_music"],"icon":"audio","refineBy":"audio"};case"mspowerpoint":return{"type":strings["str_srch_powerpoint"],"icon":"ppt","refineBy":"mspowerpoint"};case"vnd.ms-powerpoint":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_powerpoint"]+")","icon":"ppt","refineBy":"vnd.ms-powerpoint"};case"mpeg":return{"type":strings["str_srch_video"],"icon":"video","refineBy":"mpeg"};case"mpg":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_video"]+")","icon":"video","refineBy":"mpg"};case"video":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_video"]+")","icon":"video","refineBy":"video"};case"msword":return{"type":strings["str_srch_word"],"icon":"doc","refineBy":"msword"};case"vnd.ms-word":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_word"]+")","icon":"doc","refineBy":"vnd.ms-word"};case"zip":return{"type":strings["str_srch_zip"],"icon":"zip","refineBy":"zip"};case"x-compress":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-compress"};case"x-compressed":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-compressed"};case"x-gzip":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-gzip"};case"x-tar":return{"type":strings["str_srch_other"]+" ("+strings["str_srch_zip"]+")","icon":"zip","refineBy":"x-tar"};case"pdf":return{"type":strings["str_srch_pdf"],"icon":"pdf","refineBy":"pdf"};default:return{"type":strings["str_srch_other"]+" ("+(G[1]||G[0])+")","icon":"","refineBy":G[1]||G[0]};}},isEnableAddToContacts:function(I){var H=this,G;if(I.total!=1){return false;}for(var F in I.hash){G=I.hash[F];return((G&&G.from)?!H.isKnownEmailAddress(G.from[0].address):false);}},isKnownEmailAddress:function(G){if(E.contacts&&E.contacts.utils&&E.contacts.api){var F=E.contacts,H=F.utils,I=F.api;if(!G||G===""){return 1;}if(A.isUsersEmailAddress(G)||H.isEmailKnown(G)){return 1;}if(!H.areContactsLoaded()){I.load();return 1;}return 0;}else{return 1;}},processListData:function(G,F){var H=0,I=G.hits?G.hits.length:0,O,M=[],N=G,K,L=[];for(H=0;H<I;H++){L[H]=[];O=G.hits[H];try{if(O.fromObj){O.from=E.JSON.parse(B(O.fromObj));}L[H][0]={displayname:O.from.name,address:O.from.email};}catch(J){}M[H]={fid:F,mid:O.mid,subject:O.subject?B(O.subject):"",subjectDir:(NeoConfig.bidi&&O.subjectDir)?O.subjectDir:"",xapparentlyto:O.xapparentlyto,date:O.rawDate||O.receivedDate,snippet:(NeoConfig.hasConv&&O.snippet)?O.snippet:"",size:O.size,inboxservices:(O.inboxservices&&E.Lang.isString(O.inboxservices)&&O.inboxservices.match("data-certified"))?[{name:"crt",value:"transactional"}]:[],from:(F=="Sent"||F=="Draft")?[{displayname:O.toEmail}]:L[H],flags:{flagged:(typeof O.flags.isFlagged!="undefined")?O.flags.isFlagged:O.flags.match("flagged"),read:(typeof O.flags.isRead!="undefined")?O.flags.isRead:!O.flags.match("unread"),forwarded:(typeof O.flags.isForwarded!="undefined")?O.flags.isForwarded:O.flags.match("forwarded"),replied:(typeof O.flags.isReplied!="undefined")?O.flags.isReplied:O.flags.match("replied")},msgicon:(O.msgicon?O.msgicon:""),attachments:{length:(typeof O.flags.hasAttachment!="undefined")?O.flags.hasAttachment:((O.hasOwnProperty("hide_attachments_else"))?0:1)}};
}N.hits=M;return N;}};},"1.0.0",{requires:[]});YUI.add("mail-ui-search-model",function(A){var J=A.common.Utils,H=J.escapeHtml,C=J.unescapeHtml,I=A.mail.ui.SearchUtils,L=A.mail.ui.common.StringUtils,B=A.common.persist.UserData,G=A.common.net.SessionMgr,K=A.common.net.Error;var F=function(P){var S,N,Q=/((unflagged|flagged|unread|read|replied|forwarded)\:1)|(attachmenttypes:((\"[^"]+\")|[^ ]+))|(from:((\"[^"]+\")|[^ ]+))/gi,R=P.query.keyword.match(Q),M,O;if(R){P.query.keyword=P.query.keyword.replace(Q," ");P.query.flags={};M=R.length;for(O=0;O<M;O++){S=R[O].split(":");N=S[1].replace(/\"/g,"");switch(S[0]){case"unflagged":P.query.flags.flagged=0;break;case"flagged":P.query.flags.flagged=1;break;case"read":P.query.flags.read=1;break;case"unread":P.query.flags.read=0;break;case"replied":P.query.flags.replied=1;break;case"forwarded":P.query.flags.forwarded=1;break;case"attachmenttypes":P.query.attachmenttypes=N;break;case"from":P.query.from=N;break;}}}return P;};var D=function(M){var P=this,O={},N={start:{value:0},count:{getter:function(){var Q=NeoConfig.pagedResults?B.get("userUIPref.messagesPerPage")*1:10;return(Q<100)?100:Q;}},query:{setter:function(Q){P.set("response","");}},sorting:{setter:function(Q){if(Q.sortKey==="date"){P.sorting=(Q.sortOrder==="up"?"%2B":"%2D")+Q.sortKey;}else{P.sorting=(Q.sortOrder==="up"?"%2B":"%2D")+Q.sortKey+"%2Ddate";}},getter:function(){return P.sorting;}},response:{setter:function(Q){P.response=Q;}}};A.augment(P,A.Attribute);P.addAttrs(N,M||{});A.augment(P,A.EventTarget);P.on("Request:start",function(Q){O=new J.Stopwatch("MSWS-Request");});P.on("Request:complete",function(Q){O.stop&&O.stop();});};A.mix(D.prototype,{req:null,prepareResponse:function(Q){var U=this,T,O,V=5,a,Y=U.get("query"),M=Q.folders,S=Q.fids;a={};if(Y.date&&!Y.date.start){a.date=Y.date;}if(Y.flags){a.flags={};for(var R in Y.flags){if(R=="read"){if(Y.flags[R]==1){a.flags.read=1;}else{a.flags.unread=1;}}else{a.flags[R]=Y.flags[R];}}}if(Y.attachmenttypes){a.attachmenttype=I.getAttachmentProperties(Y.attachmenttypes);}if(Y.from){a.from=Y.from;}if(Y.fnums){a.fnums=[];if(M){for(T=0,O=Y.fnums.length;T<O;T++){a.fnums[T]=M[Y.fnums[T]];}}}Q.refinedby=a;if(Q.hits&&Q.hits.length&&M){for(T=0,O=Q.hits.length;T<O;T++){Q.hits[T].folder=M[Q.hits[T].fnum];Q.hits[T].fid=S[Q.hits[T].fnum];if(!Q.hits[T].flags){Q.hits[T].flags={};}}}Q.grouplist=Q.grouplist||{};if(Y.date&&Y.date.start){delete Q.grouplist.date;}if(Q.grouplist.attachmenttype&&!Y.attachmenttypes){var N={},Z;a=[];for(T=0,O=Q.grouplist.attachmenttype.length;T<O;T++){Z=I.getAttachmentProperties(Q.grouplist.attachmenttype[T].id);if(N[Z.type]){N[Z.type].count=parseInt(N[Z.type].count)+parseInt(Q.grouplist.attachmenttype[T].count);}else{N[Z.type]=A.mix(Z,Q.grouplist.attachmenttype[T]);}}a=A.Object.values(N);a.sort(function(c,b){return(c.type===b.type)?0:((c.type>b.type)?1:-1);});Q.grouplist.attachmenttype=a;}if(Q.grouplist.folder&&M){a=[];var W="";for(T=0,O=Q.grouplist.folder.length;T<O;T++){Q.grouplist.folder[T].folder=M[Q.grouplist.folder[T].id];W=encodeURIComponent(Q.grouplist.folder[T].folder);Q.grouplist.folder[T].displayName=L.getSystemFolderName(W,W);a.push(Q.grouplist.folder[T]);}a.sort(function(c,b){return(c.displayName===b.displayName)?0:((c.displayName>b.displayName)?1:-1);});Q.grouplist.folder=a;}if(Q.grouplist.from){a=[];for(T=V,O=Q.grouplist.from.length;T<O;T++){a.push(Q.grouplist.from[T]);}a.sort(function(c,b){return(c.id===b.id)?0:((c.id>b.id)?1:-1);});Q.grouplist.from=[].concat(Q.grouplist.from.slice(0,V),a);}if(Q.grouplist.date){a=[];for(T=0,O=Q.grouplist.date.length;T<O;T++){a.push(Q.grouplist.date[T]);}a.sort(function(c,b){return(c.id===b.id)?0:((c.id<b.id)?1:-1);});Q.grouplist.date=a;}if(Q.grouplist.flags){a=[];var P,X={id:"unread",count:Q.total};for(T=0,O=Q.grouplist.flags.length;T<O;T++){P=Q.grouplist.flags[T];if(Q.refinedby.flags&&Q.refinedby.flags[P.id]){continue;}if(P.id=="read"){X=null;if((Q.total-P.count)>0){a.push({id:"unread",count:Q.total-P.count});}}else{a.push(P);}}if((Y.flags&&Y.flags.read==0)||(Q.refinedby&&Q.refinedby.flags&&Q.refinedby.flags.unread)){X=null;}X&&a.push(X);Q.grouplist.flags=a;}return Q;},execute:function(N,M){var P=this,Q,R=[],T,U=function(W,Y){var Z={total:0,hits:null},X=(Y)?Y.status:"",V=K.show;P.req=null;switch(X){case 200:try{Z=A.JSON.parse(Y.responseText);break;}catch(a){}case 400:V(null,strings["str_error_BadRequest"],strings["str_error_MailErrorTitle"],{modal_classes:"lg"});break;case 401:case 402:V(null,strings["str_error_MissingCredentials"],strings["str_error_MailErrorTitle"],{modal_classes:"lg"});break;case 500:V(null,strings["str_error_error_searching_messages"],strings["str_error_MailErrorTitle"],{modal_classes:"lg"});break;default:}P.fire("Request:complete");Z.start=P.get("start");Z.count=P.get("count");Z.query=P.get("query");P.set("response",{query:P.get("query"),response:P.prepareResponse(Z)});N&&N.call(M||this,P.get("response"));};if(!P.get("query")||!P.get("query").keyword){U();return;}if(P.get("query").keyword){var O=P.get("query").keyword;if(O.match(/subject:.*/)){O=C(H(O));}P.get("query").keyword=O.replace(/([\#|\%|\&])/g," ");}P.fire("Request:start");var S=new Date().getTimezoneOffset()*60*-1;Q=NeoConfig.launch_protocol+document.location.host+"/mailsearch/v2/search"+"?appid=YahooMailNeo";R.push("appid=YahooMailNeo");R.push("foldername=1");R.push("tzoffset="+S);R.push("start="+P.get("start"));R.push("count="+P.get("count"));P.get("sorting")&&R.push("sorting="+P.get("sorting"));T=A.clone(P.get("query"));if(T&&!T.flags){T.flags={};}A.mix(T.flags,{"softdelete":0},true);R.push("query="+A.JSON.stringify(T));P.req=G.requestProxy(Q,{on:{success:U,failure:U},method:"POST",data:R.join("&"),service:"msws"});},abort:function(){var M=this;M.req&&M.req.abort();}},true);function E(U,O,R){var P=(R)?R.status:"",M=false,T,Q,S,V=[];function N(W){var X,Z,Y=A.common.Utils.rocketstats.stat;if(W){Z=W.length||0;for(X=0;X<Z;X++){Y("mailnet",W[X]);}}return W;}if(R.callback&&R.callback.service=="msws"){T=R.callback.service;Q=R.callback.method;S=R.statusText?R.statusText.replace(/\s/g,"_"):"";
switch(P){case 400:V.push("E_BadRequest400_"+T+"_"+S);M=true;break;case 500:V.push("ue_alert_tae20");break;default:break;}N(V);return M;}return false;}K.onError(E);A.namespace("mail.ui");A.mail.ui.SearchRequest=D;A.mail.ui.parseSearchRequest=F;},"1.0.0",{requires:["mail-ui-searchutils","json","rocket-stats","mail-ui-common-string-utils"]});YUI.add("mail-ui-list-mgr",function(E){var B=E.common.persist.UserData,A="userUIPref.defaultSortOrder",C={};var D=function(){var J=this,f,T,l,M,F,c,d,a,n,s,k,y,I=E.mail.model.DataStore.Messages,x=I.toMessage,R={};function r(){T=[];l={};n=0;c=0;d=0;if(C[f]&&C[f].sortObj){M=C[f].sortObj;}else{M={sortKey:"date",sortOrder:B.get(A)};}s=0;k=NeoConfig.pagedResults?B.get("userUIPref.messagesPerPage")*1:10;V(k);F={all:false,rangeFrom:null,total:0,hash:{}};R={};}function V(z){a=(z<100)?100:z;y=(z<100)?100:z;}function W(){if(!C[f]){C[f]={_sortObj:M};return true;}return false;}function o(AA){var z;f=AA;if(!C[f]){return false;}gSortInfo=C[f]._sortObj;if(gSortInfo){M={sortKey:gSortInfo.sortKey,sortOrder:gSortInfo.sortOrder};}return true;}function q(z){var AA=z.split("_");return AA[AA.length-1];}function G(AC){var z=AC.hits,AE=z.length,AA=0,AD=AC.start||0,AB;c=AC.total||AE;d=AC.start||0;a=AE;for(;AA<AE;AA++){if(!z[AA]||!z[AA].mid){continue;}AB=q(z[AA].mid);l[AB]=AD+AA;n++;z[AA].hashKey=AB;T[AD+AA]=z[AA];j(AB,F.all);}}function w(AA){var AB=false,z=F;if(M.sortKey!==AA.sortKey){O();M.sortKey=AA.sortKey;M.sortOrder=AA.sortOrder;F=z;}if(M.sortOrder!==AA.sortOrder){if(c===n){T.reverse();N();AB=true;}else{O();}F=z;M.sortKey=AA.sortKey;M.sortOrder=AA.sortOrder;}s=0;d=0;C[f]._sortObj=M;return AB;}function N(){var AC,AE,AB,AD=n-T.length,z,AA=F;if(AD>0){d=d-AD;if(d<0){d=0;}if(AD>k){s=(s&&AD/k<=s)?s-(AD/k):s;}else{s=(s&&s*k>=(n-AD))?Math.floor((n-AD)/k)-1:s;}if(c&&AD){c=c-AD;}}AC=T;AE=d;AB=s;z=c;AA.serverTotal=z;O();F=AA;G({hits:AC,total:z});d=AE;s=AB;}function t(AE,z){var AB=(AE*z),AD=(((AE+1)*z)<c)?((AE+1)*z)-1:c-1,AC=[];if(T[AB]){for(var AA=AB;AA<=AD;AA++){if(T[AA]){AC.push(T[AA]);}}}return AC;}function h(z){return l[q(z)];}function S(z){return(z>=0)&&T[z];}function H(AA){var z=l[q(AA)];if(typeof z==="undefined"){return;}return T[z];}function L(AA){var z=l[q(AA)];if(typeof z==="undefined"){return;}return(z===0)?T[z]:T[--z];}function P(AA){var z=l[q(AA)];if(typeof z==="undefined"){return;}return(z===n-1)?T[z]:T[++z];}function Y(AD){var AC={serverTotal:c,serverIndex:d,serverSize:a,cacheIndex:s,cacheSize:k,list:[]},AA,z;switch(AD){case"first":if((s-1)<0&&NeoConfig.pagedResults){AC.cacheIndex=-1;return AC;}s=0;break;case"prev":if((s-1)<0){AC.cacheIndex=-1;return AC;}s=s-1;if((s*k)<d){AA=d-y;d=(AA>0)?AA:0;}break;case"next":if((s+1)>Math.ceil(c/k)-1){AC.cacheIndex=s+1;return AC;}s=s+1;z=s*k;if((z>d)&&!(T[z])){AA=d+y;d=(AA<=c)?AA:d;}break;case"last":if((s+1)*k>=c){AC.cacheIndex=s+1;return AC;}d=((Math.ceil(c/y)-1)*y);s=Math.ceil(c/k)-1;break;default:var AB=parseInt(AD);if(c<1){return AC;}if(!isNaN(AB)){if(AB>0&&AB<=Math.ceil(c/k)){s=AB-1;d=(Math.floor((s*k)/y))*y;break;}}if(R.list&&R.list.length){return R;}break;}AC.cacheIndex=s;AC.serverIndex=d;AC.list=t(s,k);R=AC;return AC;}function Z(){return Y("first");}function Q(AA){var z={serverTotal:c,serverIndex:d,serverSize:a,cacheIndex:s,cacheSize:k,list:t(AA,k)};return z;}function g(){return Y("prev");}function e(){return Y("current");}function m(){return Y("next");}function K(){return Y("last");}function O(){r();}function i(AG,AM,AA){if(AG<=-1){return;}var AF=this,AL=AF.getItemFromIndex(AG),AE=AL?I.isCached(AA,AL.mid):false,AI=((NeoConfig.prefetchMsgsCheckMail==1)?4:(AE?4:2)),AJ=[],AH=1,AB=0,z=0,AD=2,AC=1;function AK(AN){var AO=AF.getItemFromIndex(AN);if(AO&&!I.isCached(AA,AO.mid)){AJ.push(AO);return 1;}return 0;}while(AH){if(z<AD&&!AK(AG-AC)){z++;}if(AB<AD&&!AK(AG+AC)){AB++;}AH=(AJ.length<AI)&&!(z==AD&&AB==AD);AC++;if(AC>100){break;}}for(AC=0;AC<AJ.length;AC++){AM.push(AJ[AC]);}}function b(AA,AB){var z;if(!AA){return;}z=l[q(AA)];if(typeof z!=="undefined"){T[z]=AB;return true;}}function X(AD,AG){AG=(typeof AG!="undefined")?AG:true;var AE,AA,AF,AC=0,AB,z=[];if(!AD){return;}AF=(E.Lang.isArray(AD))?AD:[AD];AB=AF.length;for(;AC<AB;AC++){AE=q(AF[AC]);AA=l[AE];if((typeof AA!=="undefined")&&(AG==true)){T.splice(AA,1);if(NeoConfig.pagedResults){F.all=false;}N();z.push(AE);}else{if(AG===false){c=c-1;}}}return{cacheTotal:n,serverTotal:c,removedItems:z};}function u(AC){var AB=e();F.all=AC;for(var AA=0,z=AB.list.length;AA<z;AA++){AB.list[AA]&&j(q(AB.list[AA].mid),AC);}}function v(AB){F.all=AB;for(var AA=0,z=T.length;AA<z;AA++){T[AA]&&j(q(T[AA].mid),AB);}}function j(AB,AC){var AA=q(AB),z=l[AA];if(typeof z==="undefined"){return;}if(!AC){if(F.hash[AA]){F.total--;if(F.total===0){F.rangeFrom=null;}delete F.hash[AA];}else{return F;}}else{if(T[z]&&!F.hash[AA]){F.total++;if(F.total===1){F.rangeFrom=z;}E.mix(T[z],x(T[z].fid,T[z]));F.hash[AA]=T[z];}else{return F;}}T[z].selected=(AC)?"checked":"";F.allSelected=!NeoConfig.pagedResults?(c===F.total):(R.list&&R.list.length===F.total);F.allCacheSelected=!NeoConfig.pagedResults?(n===F.total):F.allSelected;F.serverTotal=c;F.index=z;J.fire("itemSelect",{key:AB,state:AC,selection:F});return F;}function U(AA){for(var z in AA){switch(z){case"cacheSize":k=(AA[z]<10)?10:AA[z];V(k);break;default:break;}}}function p(){return({sortInfo:M,selection:F,serverTotal:c,serverIndex:d,serverSize:a,cacheTotal:n,cacheIndex:s,cacheSize:k,origServerSize:y});}E.augment(J,E.EventTarget);r();E.mix(J,{generateKey:q,persist:W,warmCache:o,store:G,sort:w,getAllCachedItems:function(){return T;},getItemIndex:h,getItemFromIndex:S,getPrevItem:L,getItem:H,getNextItem:P,getFirstPage:Z,getPrevPage:g,isPageInCache:Q,getCurrentPage:e,getNextPage:m,getLastPage:K,getPage:Y,getNeighbors:i,updateCacheInfo:U,getCacheInfo:p,update:b,remove:X,flush:O,select:j,selectAll:v,selectPage:u,getSelectedItems:function(){return F;},getSortInfo:function(){return M;}});};E.namespace("mail.ui");E.mail.ui.ListMgr=D;},"1.0.0");YUI.add("mail-ui-mailSearchController",function(B){var C=B.common.Utils,G=C.escapeHtml,J=C.unescapeHtml,I=C.Stopwatch,N=B.mail.ui.SearchBar,F=B.common.persist.UserData,K=B.mail.persist.MetaData,P=B.mail.model.DataStore,A=["open","forward","reply_sender","reply_all","edit","fullheader","addcontact","set_encodings","print","quick_filter"],H=B.mail.ui.SearchUtils,O=[48,49,50,51,52,53,54,55,56,57],Q=[strings.str_cfg_sc_keycode_reply_to_all,strings.str_cfg_sc_keycode_movemenu_display,strings.str_cfg_sc_keycode_message_forward,strings.str_cfg_sc_keycode_mark_as_read,strings.str_cfg_sc_keycode_flag_selected_messages,strings.str_cfg_sc_keycode_reply_to_sender,strings.str_cfg_sc_keycode_print,strings.str_cfg_sc_keycode_close_tab],D=[65,68,70,75,76,82,80,220],R={},M=Q.length,L;for(L=0;L<M;++L){R[Q[L]]=D[L];}var E=function(S){var V=this,T,U={fid:{setter:function(W){V.fid=W||"%40S%40Search";V.listMgr.warmCache(V.fid);if(S.type=="list"){V.listMgr.persist();}}},customTitle:{},isSnippet:{setter:function(W){if(NeoConfig.isFresh){K.set("neo.pref.showSnippetsFresh",W);}else{F.set("userUIPref.showSnippets",W);B.later(0,null,function(){F.saveOne("userUIPref.showSnippets");},null,false);}},getter:function(){if(V.type=="list"){return false;}return NeoConfig.isFresh?K.get("neo.pref.showSnippetsFresh"):F.get("userUIPref.showSnippets");}},query:{value:{},setter:function(W){var X=B.Lang.trim(W.keyword);if(typeof X=="undefined"){return;}V.fire("search:start");N.getSearchField().set("value",J(G(X)));V.set("title",strings.str_tabs_search+(X.length?": "+G(X):""));V.abort();V.reset();V.listMgr.flush();}},tabNode:{setter:function(X){var W=(V.type=="list")?strings.str_om_loading:strings.str_srch_searching;X.appendChild(B.Node.create('<h3 class="loading search">'+W+"</h3>"));V.on("closeChange",V.close);},validator:function(W){return W;},writeOnce:true},data:{},stopWatchRT:{},responseTime:{value:0}};E.superclass.constructor.call(V);V.listMgr=new B.mail.ui.ListMgr();V.modules={};V.type=S.type;V.supportPreview=(V.type=="list");V.evt=[];V.bulkThreshold=V.listMgr.getCacheInfo().origServerSize;V.listMgr.on("itemSelect",V.listMgrItemSelectHandler,V);V.on("search:start",V.onSearchStartHandler,V);V.on("search:complete",V.onSearchCompleteHandler,V);V.after("activeChange",V.afterActiveChangeHandler,V);V.requests=[];V.delRequests=[];V.before("titleChange",function(X){var W=V.get("customTitle");if(W){if(W==="#"){X.newVal=strings.str_tabs_search;}else{X.newVal=strings.str_tabs_search+": "+W;}}},V);V.on("search:start",function(){T=(new Date()).getTime();});V.on("darlaEvent",function(){V.set("responseTime",(new Date()).getTime()-T);});V.on("darlaEvent",function(){var Y=this,W=Y.listMgr.getCurrentPage(),X=Y.listMgr.isPageInCache(W.serverSize/W.cacheSize+W.cacheIndex);if(!X.list.length){if((W.cacheIndex+1)*W.cacheSize<W.serverTotal&&W.serverIndex+W.serverSize<W.serverTotal){param={query:Y.get("query"),startMid:W.serverIndex+W.serverSize};cbk=function(Z){if(Y.type=="list"){Z.hits=Z.messageInfo;Z.count=Z.numInfo;Z.total=Z.folder.total;Z.fid=Y.fid;Z=H.processListData(Z,Y.fid);}if(Z.hits||Z.response){Z.start=Z.startInfo;Y.listMgr.store(Z.response||Z);}};if(Y.type=="search"){}else{B.Lang.later(100,Y,function(){Y.makeRequest("list",param,cbk);});}}}});V.evt.push(B.on("ds:msg:remove",V.removeMsgHandler,V));V.evt.push(B.on("ds:msg:change",V.changeMsgHandler,V));V.evt.push(B.on("ds:msg:add",V.addMsgHandler,V));V.evt.push(B.on("ds:folder:change",function(c,a,Z,b){if(V.type!="list"){return;}if(b=="ds:msg:"){var Y;for(W=0;W<a.length;W++){if(a[W].folderInfo.fid==V.fid){Y=" <i>("+a[W].total+")</i>";break;}}Y&&V.set("title",V.fid+Y);return;}var X,W;for(W=0;W<a.length;W++){if(a[W].folderInfo.fid=="Inbox"){X=true;break;}}if(b=="checkmail"&&V.fid=="Inbox"&&X){V.fire("search:start");V.listMgr.flush();V.abort();V.makeRequest("list",{fid:"Inbox"});}},V));V.evt.push(B.on("msgsview:movetonewfolder",function(X){var W=B.mail.Tabs.getActiveTab();if(W&&W.widget&&W.widget==V){V.toolbarHandler.call(V,{dataAction:"folder-new"});}},V));V.evt.push(B.on("ds:msg:remove",function(X,W){if((X=="Trash"||X=="%40B%40Bulk")&&W==0){C.rocketstats.stat("msearch","TAE4:EmptyFolder:"+X);}},V));V.addAttrs(U,S||{});V.listMgr.persist();B.augment(V,B.EventTarget);V.set("charCodes","13,27,33,34,37,38,39,40,46,188,190,"+O.join(",")+","+Q.join(","));};B.extend(E,B.mail.ui.BaseWidget);B.mix(E.prototype,{NAME:"MailSearch",type:"searchlist",reset:function(){var U=this,T=U.modules;if(T){for(var S in T){if(T[S]){if(typeof T[S].close==="function"){T[S].close();T[S]=null;}}}T={};}},render:function(S){var T=this;T.set("tabNode",B.Node.one(S));if(T.type=="list"){T.listMgr.flush();T.renderLaunchToInbox();}},renderLaunchToInbox:function(){var Z=this,S=Z.listMgr.getSortInfo(),Y=NeoConfig.pagedResults?B.common.persist.UserData.get("userUIPref.messagesPerPage")*1:10,X,U,T=NeoConfig.folders.numberOfFolders,W={fid:"Inbox",numInfo:(Y<100)?100:Y,bidiDetection:NeoConfig.bidi,sortKey:(S.sortKey=="from")?"sender":S.sortKey,sortOrder:S.sortOrder},V={hits:NeoConfig.msgListObj,count:NeoConfig.msgListObj.length,type:"list",fid:"Inbox",sortOrder:S.sortOrder};Z.set("fid","Inbox");for(U=0;U<T;U++){if(NeoConfig.folders.folder[U].folderInfo.fid==W.fid){V.total=NeoConfig.folders.folder[U].total;break;}}V.start=(S.sortOrder=="up")?(V.total-NeoConfig.msgListObj.length):0;Z.set("searchRequest",W);Z.searchResponseHandler({response:V,rendered:(S.sortOrder=="up")?false:true});},sync:function(){var T=this,S=B.Lang.trim(T.get("query").keyword);T.stopWatchRT=T.getStopwatch({source:"workspace"});T.set("title",strings.str_tabs_search+(S.length?": "+G(S):""));T.makeRequest("search",{query:T.get("query")},T.searchResponseHandler);T.preloadDependencies();},getStopwatch:function(T){var U=this,S={};if(T.source=="workspace"){S=U.get("stopWatchRT");}else{S=new C.Stopwatch("Search","start");}S.source=T.source;return S;},preloadDependencies:function(){var Z=this,X=Z.get("isSnippet"),W=NeoConfig.isFresh?(X?"_shared_module_search_refresh_rollup":"_shared_module_search_non_snippet_refresh_rollup"):(X?"_shared_module_search_rollup":"_shared_module_search_non_snippet_rollup"),Y=((NeoConfig.isFullSSL)?"https://s.yimg.com":"http://mail.yimg.com")+"/ok/u/assets/img/display-img/",T=["profile_16a.png","profile_16b.png","profile_16c.png","profile_16d.png","profile_16e.png"],U;
B.use("mail-ui-advancedSearchController","mail-ui-searchGroupsController","mail-ui-searchListController","mail-ui-toolbarController","contacts-api","contacts-api-utils","stylesheet","search_css","mail-ui-messageaction","mail-ui-inboxmenu-base","mail-common-inline-edit",W);for(var V=0,S=T.length;V<S;V++){U=new Image();U.src=Y+T[V];}},getSortParam:function(){var V=this,S=V.listMgr.getSortInfo(),U,T="none";if(S.sortKey=="attachmentcount"){U="date";T="hasAttachment";}else{if(S.sortKey=="flagged"){U="date";T="flagged";}else{if(S.sortKey=="unRead"){U="date",T="unRead";}}}return(T=="none")?{reqMix:false}:{reqMix:true,sortKey:U,groupBy:T};},makeRequest:function(U,W,V){var Z=this,b=Z.listMgr.getSortInfo(),X={start:W.startMid||0,query:W.query,sorting:b},S,Y=NeoConfig.pagedResults?B.common.persist.UserData.get("userUIPref.messagesPerPage")*1:10;if(U=="list"){if(W.fid){Z.set("fid",W.fid);}var X={fid:W.fid||Z.fid,startInfo:W.startMid||0,numInfo:(Y<100)?100:Y,bidiDetection:NeoConfig.bidi,sortKey:(b.sortKey=="from")?"sender":b.sortKey,sortOrder:b.sortOrder},a={success:V||function(c){Z.set("searchRequest",X);Z.searchResponseHandler.call(Z,{response:{hits:c.messageInfo,count:c.numInfo,total:c.folder.total,type:"list",fid:W.fid||Z.fid,start:W.startMid||0}});},failure:function(c){},timeout:NeoConfig.wsListTimeout||60000,suppressCodes:["*"],suppressLogs:(W.fid==="%40C%40Chats")&&["Client.FolderIdDoesntExist"],exceptCodes:[999]},T=Z.getSortParam();if(T.reqMix){B.mix(X,{sortKey:T.sortKey,groupBy:T.groupBy},true);}Z.requests.push(B.mail.Controller.Messages.list(X,a));}else{Z.stopWatchRT&&Z.stopWatchRT.start(1,"serverRequest");if(!W.disableRefinements){X=B.mail.ui.parseSearchRequest(X);X.query=B.mix(X.query,{"group":{"from":{},"folder":{},"flags":{order:"desc"},"attachmenttype":{},"date":{unit:(W.query.date&&W.query.date.year)?"month":"year"}}},true);}if(W.count){X.count=W.count;}S=new B.mail.ui.SearchRequest(X);Z.set("searchRequest",S);S.execute(V,Z);Z.makeDmRequest();}},makeDmRequest:function(){var V=this,U;if(NeoConfig.dmEnabled&&V.get("query").keyword&&(B.Lang.trim(V.get("query").keyword)!=="")&&!(V.get("query").keyword).match(/^from:/i)){var S,T=function(){if(U&&V.get("query").keyword&&(B.Lang.trim(V.get("query").keyword)!=="")&&!(V.get("query").keyword).match(/^from:/i)){if(!U.get("responseTime")&&V.get("responseTime")>NeoConfig.dmSLA){C.rocketstats.stat("dmsearch","failure:missedsla");return;}var X=V.get("tabNode"),W=X.one(".content.search")!==null?X.one(".content.search"):X.one(".result>.list-view");U.set("rootNode",W);U.render();}};if(V.get("dmDarlaEvent")){V.get("dmDarlaEvent").detach();}V.set("dmDarlaEvent",V.after("darlaEvent",T));B.use("mail-ui-dmsearch-controller",function(W){U=new W.mail.ui.dmsearchController({seedTerm:V.get("query").keyword});U.process();});}},abort:function(){var U=this,S,T=U.get("searchRequest");if(U.type=="list"){for(S=0;S<U.requests.length;S++){U.requests[S].abort();}}else{T&&T.abort();}},openInPreviewPane:function(V){var W=this,T=B.mail.model.DataStore.Messages.toMessage(W.fid,V),U=[],S=W.msgPane.get("message");if(W.type=="list"&&NeoConfig.pageMode==0){if((S==null||S.message.mid!==T.mid)){W.listMgr.getNeighbors(W.listMgr.getItemIndex(V.mid),U,W.fid);W.msgPane.set("message",{fid:W.fid,message:T,neighbors:U,index:null});W.msgPane.render("#inboxcontainer");}return;}},requestAction:function(V,X,S){var Y=this,U=Y.modules.listview,W=B.one("#redirectMsg"),T=W&&W.get("value");B.use("mail-ui-messageaction",function(d){var a={action:V,fid:Y.fid,forwardAsAttachment:X.forwardAsAttachment||false,msgs:X.msgs,msgInfo:X.msgInfo,destinationFid:X.destinationFid,redirectToEmail:T,index:X.index};if(V=="openInPane"){Y.openInPreviewPane(X.msgs[0]);return;}if(V==="open"){var Z,c=Y.listMgr,b=[];if(NeoConfig.prefetchMsgsFolders){c.getNeighbors(a.index,b,a.fid);}if(Y.type=="search"){Z=Y.get("searchRequest")&&Y.get("searchRequest").getAttrs();}else{if(Y.type=="list"){Z=Y.get("searchRequest");}}if(Z){delete Z.response;}d.mix(a,{fid:(X.msgs&&X.msgs[0].fid)||Y.fid,sortCol:c.getSortInfo(),query:Y.get("query"),neighbors:b,arrMsgSeq:c.getAllCachedItems(),searchRequestAttrs:Z,searchListMgr:d.clone(c),processData:H.processListData,type:Y.type},true);}d.mail.ui.MessageAction.handle(V,a,S);});},retainSelection:function(U){var Y=this,T=Y.modules.listview,W,X,S={"read":true,"unread":true,"flagged":true,"unflagged":true,"fullheader":true,"set_encodings":true,"spam":true,"sendercompromised":true,"phished":true,"delete":(Y.type=="list")?true:false,"move":(Y.type=="list")?true:false,"trash":(Y.type=="list")?true:false};if(!S[U]){Y.listMgr.selectAll(false);T&&T.selectItems(false);if(NeoConfig.pagedResults&&T){W=T.get("focusNode");if(W){X=Y.listMgr.getNextItem(W.getAttribute("data-key"));try{T.setFocusNode(Y.listMgr.generateKey(X.mid),true,true);T.set("firstSelectedMid",X.mid);Y.listMgr.select(X.mid,true);}catch(V){}}}}},handleMessageAction:function(W,V){var a=this,e=a.modules.listview,Y=[],f=[],S,b=a.listMgr.getSelectedItems(),c=a.listMgr.getCacheInfo(),U=V.fid,X=V.selectedItems,d=V.cbk,Z=V.forwardAsAttachment;switch(X.total){case 0:H.showAlert("emptySelection");return;case 1:break;default:if(B.Array.indexOf(A,W)!==-1){H.showAlert("multipleSelection");return;}break;}var T=(b.all&&!NeoConfig.pagedResults)?c.serverTotal-c.cacheTotal+b.total:b.total;if(!NeoConfig.pagedResults&&!X.singleOp&&T>=a.bulkThreshold){B.use("mail-ui-bulk-progress",function(h){var i=h.mail.ui.BulkProgressbar,g;a.modules.bulkProgress=i;i.set("action",W);i.set("progress",0);i.render();i.once("cancelProgress",function(j){a.modules.bulkProgress=null;g=(NeoConfig.pagedResults)?a.listMgr.getCurrentPage():a.listMgr.getFirstPage();if(e){e.pruneItems();e.appendPageData(g);a.retainSelection(W);}},a);if(c.serverTotal!=c.cacheTotal&&b.all){a.bulkActionHandler(W,U,{startMid:0,serverTotal:b.serverTotal},b.serverTotal);}else{a.cacheActionHandler(W,U,h.clone(X));}});}else{if(W==="delete"&&V.selectedItems.total>1&&a.listMgr.getCurrentPage().list.length==V.selectedItems.total){H.showConfirm("removeAll",function(){a.cacheActionHandler(W,U,B.clone(X),d,Z);
});}else{a.cacheActionHandler(W,U,B.clone(X),d,Z);}}},cacheActionHandler:function(V,U,X,d,Y){var a=this,i=0,T=X.total>a.bulkThreshold,b=a.modules.bulkProgress,W=[],f=[],h,S,g=[],e=a.modules.listview,Z=X.index;if(T&&!b){return;}for(var c in X.hash){i=i+1;W.push(X.hash[c]);S=X.hash[c].mid;f.push(S);delete X.hash[c];if(i>=a.bulkThreshold||B.Object.size(X.hash)===0){a.requestAction(V,{msgs:W,msgInfo:W,destinationFid:U,forwardAsAttachment:Y,index:Z},{success:function(j){if(a.type=="list"&&a.delRequests.length>0){e.appendPageData(a.delRequests[a.delRequests.length-1]);}else{if(NeoConfig.pagedResults&&(a.listMgr.getCacheInfo().cacheSize>=100)&&a.isMutableAction(V,{response:a.get("data")})){e.appendPageData(a.listMgr.getCurrentPage());}else{if(NeoConfig.pagedResults&&(a.listMgr.getCacheInfo().cacheSize<100)&&a.isMutableAction(V,{response:a.get("data")})){e.pruneItems();e.appendPageData(a.listMgr.getCurrentPage());}}}if(j===V){a.retainSelection(V);return;}h=((X.total-B.Object.size(X.hash))/X.total)*100;b&&b.set("progress",h);if(h<100){a.cacheActionHandler(V,U,X,d,Y);}if(h===100){d&&d.success&&d.success(j);a.retainSelection(V);}},failure:function(j){d&&d.failure&&d.failure(j);a.retainSelection(V);}});return;}}},bulkActionHandler:function(V,X,T,S){var Y=this,W,U;W={query:Y.get("query"),count:Y.bulkThreshold,startMid:T.startMid||0,disableRefinements:true};U=function(e){var a=e.response.hits,d=[],f=Y.listMgr.getSelectedItems(),b;for(var c=0,Z=a.length;c<Z;c++){b=Y.listMgr.getItem(a[c].mid);if((!b&&f.all)||(b&&b.selected=="checked")){d.push(a[c]);}}Y.requestAction(V,{msgs:d,msgInfo:d,destinationFid:X},function(h){var i,g,k,j=Y.modules.bulkProgress;if(!j){return;}if(!e.response||!e.response.hits){j.set("progress",100);return;}if(Y.isMutableAction(V,e)){i=0;g=S-e.response.hits.length;k=((T.serverTotal-g)/T.serverTotal)*100;}else{i=T.startMid+e.response.hits.length;g=S;k=(i/g)*100;}j.set("progress",Math.floor(k));if(i<S){Y.bulkActionHandler(V,X,{startMid:i,serverTotal:T.serverTotal},g);}});};if(Y.type=="search"){Y.makeRequest("search",W,U);}},isMutableAction:function(T,S){if(S&&S.response.refinedby&&B.Object.size(S.response.refinedby)){if(typeof S.response.refinedby.flags!=="undefined"&&typeof S.response.refinedby.flags.unread!=="undefined"&&T=="read"){return true;}if(typeof S.response.refinedby.flags!=="undefined"&&typeof S.response.refinedby.flags.flagged!=="undefined"&&T=="unflagged"){return true;}if(typeof S.response.refinedby.fnums!=="undefined"&&typeof S.response.refinedby.fnums[0]!=="undefined"){switch(T){case"inbox-move":case"folder-new":case"move":return true;break;}}}else{switch(T){case"inbox-move":case"folder-new":case"spam":case"sendercompromised":case"phished":return true;break;}}return false;},searchResponseHandler:function(W){var X=this,V=W.response,S=B.mail.Tabs.getActiveTab(),T=X.stopWatchRT,U;if(T){T.matches=(V.hits&&V.hits.length)||0;T.start(1,"renderSearch");T.start(2,"renderSearchContent");}if(S&&S.widget&&S.widget!=X){X.once("activeChange",function(Y){if(X.type=="list"&&(W.response&&X.fid!=W.response.fid)){return;}B.Lang.later(2,X,function(){X.searchResponseHandler(W);});},X);delete W.rendered;return;}if(X.type=="list"){V.rendered=W.rendered;V=H.processListData(V,X.fid);X.get("tabNode")&&this.get("tabNode").one("h3.loading")&&X.get("tabNode").one("h3.loading").addClass("hidden");}else{V.type="search";}X.reset();X.set("data",V);if(!V||!V.total||(V.hits&&V.hits.length===0)){X.renderAdvancedSearch(V);T&&T.stop();return;}X.listMgr.store(V);U=(X.type=="list"&&W.response.sortOrder=="up")?X.listMgr.getLastPage():X.listMgr.getCurrentPage();U.rendered=(X.type=="list"&&U.list.length==0)?true:V.rendered;X.renderSearchList(U);if(X.type=="list"){B.use("common-ui-dialog-helper","mail-ui-foldersview-bind","mail-ui-messagepane-base","mail-ui-messagepane-next-prev","mail-ui-emptyFolderController",function(){});}T&&T.start(2,"renderSearchGroups");if(X.type=="search"){X.renderSearchGroups(V);}T&&T.stop();},renderAdvancedSearch:function(){var T=this,S;S=new C.Stopwatch("renderAdvancedSearch");if(T.type=="list"){B.use("mail-ui-emptyFolderController",function(U){obj=new U.mail.ui.EmptyFolderController({rootNode:T.get("tabNode")});obj.process();S.stop();T.fire("search:complete");});}else{B.use("contacts-api","contacts-api-utils",function(W){var U=W.contacts,V=U.utils,X=U.api;if(!V.areContactsLoaded()){X.load();}});B.use("mail-ui-advancedSearchController",function(V){var U;T.set("contentToolbar","");U=new V.mail.ui.AdvancedSearchController({data:T.get("data"),query:T.get("query"),rootNode:T.get("tabNode")});T.modules.AdvancedSearch=U;U.process();U.on("doMailSearch",function(W){T.stopWatchRT=T.getStopwatch({source:"advancedSearch"});T.set("query",W.query);T.makeRequest("search",{query:W.query},T.searchResponseHandler);});S.stop();T.fire("search:complete");});}},renderToolbar:function(U){var V=this,S,T;S=new C.Stopwatch("renderToolbar");T=NeoConfig.hasConv?"minty_module_toolbar_inbox_search_thread_rollup":(NeoConfig.isFresh?"minty_module_toolbar_inbox_search_fresh_rollup":"minty_module_toolbar_inbox_search_rollup");B.use("mail-ui-toolbarController","mail-ui-button-ctxt",T,function(Z){var X,W;if(!V.modules.topToolbar){V.set("contentToolbar","");X=new Z.mail.ui.ToolbarController({data:U,rootNode:Z.one("#toolbar"),template:Z.ui.Templates[T],listMgr:V.listMgr,fid:V.fid,position:"top"});V.modules.topToolbar=X;X.process();X.after("activeChange",function(Y){V.set("contentToolbar",Y.newVal?X.get("widget"):"");},V);X.on("close",function(Y){V.set("contentToolbar","");});X.on("itemSelected",V.toolbarHandler,V);V.set("contentToolbar",X.get("widget"));}if(!V.modules.bottomToolbar){if(NeoConfig.fullPage){W=new Z.mail.ui.ToolbarController({data:V.get("data"),rootNode:V.get("tabNode").one("div.list-view-footer div.commontasks"),template:Z.ui.Templates[T],listMgr:V.listMgr,fid:V.fid,position:"bottom"});V.modules.bottomToolbar=W;W.render=function(){W.process();W.on("itemSelected",V.toolbarHandler,V);V.get("tabNode").one("div.list-view-footer div.commontasks").append(W.get("widget").get("content"));
};if(V.modules.listview){W.render();}}}S.stop();});},renderSearchList:function(V){var Y=this,X=Y.get("isSnippet"),U=NeoConfig.isFresh?(X?"_shared_module_search_refresh_rollup":"_shared_module_search_non_snippet_refresh_rollup"):(X?"_shared_module_search_rollup":"_shared_module_search_non_snippet_rollup"),T=Y.listMgr.getSortInfo(),W=Y.listMgr.getSelectedItems(),S;S=new C.Stopwatch("renderSearchList");V.type=Y.type;B.use("mail-ui-searchListController",U,function(a){var Z=new a.mail.ui.SearchListController({listMgr:Y.listMgr,isSnippet:X,data:V,query:Y.get("query"),rootNode:Y.get("tabNode"),makeRequest:a.bind(Y.makeRequest,Y),fid:Y.fid});Y.modules.listview=Z;Z.process();Z.on("doMailSearch",function(b){Y.stopWatchRT=Y.getStopwatch({source:"searchList"});Y.set("query",b.query);Y.makeRequest("search",{query:b.query},Y.searchResponseHandler);});Z.on("messageAction",function(b){Y.handleMessageAction(b.action,b.params);});Z.on("toggleSearchView",function(b){Y.toggleSearchViewHandler();},Y);Z.on("openInPreviewPane",function(c){var b=c.mid.split("_");Y.openInPreviewPane(c.message.hash[b[b.length-1]]);},Y);Z.on("updatePagination",function(d){var f=this,b=f.modules.topToolbar,c=f.modules.bottomToolbar;if(b){b.updatePaginationStatus(d.pageData);}if(c){c.updatePaginationStatus(d.pageData);}(f.type=="list")?f.handleDarlaEvent():f.fire("darlaEvent",{action:"search_results"});},Y);Y.modules.bottomToolbar=null;Y.stopWatchRT&&Y.stopWatchRT.start(3,"renderToolbar");Y.renderToolbar(Y.get("data"));S.stop();Y.fire("search:complete");if(Y.type=="list"&&NeoConfig.pageMode==0){if(!Y.msgPane){Y.msgPane=new a.mail.ui.MessagePane();}Y.msgPane.set("message",null);Y.msgPane.render("#inboxcontainer");}});if(NeoConfig.useDD&Y.supportPreview){B.use("mail-ui-messagesview-dd","mail-ui-messagesview-resize",function(a){if(typeof a.mail==="object"&&typeof a.mail.MessagesViewDD==="object"){a.mail.MessagesViewDD.setDD(Y);}else{}if(typeof a.mail==="object"&&typeof a.mail.ui.MessagesViewColResize==="object"){var Z=Y.get("tabNode").one(".list-header");Z.addClass("resize-columns");a.mail.ui.MessagesViewColResize.init(Z);}else{}});}},renderSearchGroups:function(T){var U=this,S;S=new C.Stopwatch("renderSearchGroups");B.use("mail-ui-searchGroupsController",function(W){var V=new W.mail.ui.SearchGroupsController({data:T,query:U.get("query"),rootNode:W.one("#shellnavigation")});U.modules.SearchGroups=V;V.process();V.on("doMailSearch",function(X){U.stopWatchRT=U.getStopwatch({source:"searchGroups"});U.set("query",X.query);U.makeRequest("search",{query:X.query},U.searchResponseHandler);});S.stop();});},onKeyDown:function(U){var V=this,T=U.metaKey,S=U.ctrlKey;U.keyCode=R[U.keyCode]||U.keyCode;switch(U.keyCode){case 68:B.fire("toolbar:ui-automation","menu","move");return true;case 220:if(T||S){V.set("close",1);return true;}break;case 27:if(V.type=="search"){V.set("close",1);}return true;}return V.modules.listview.keydownHandler(U);},toolbarHandler:function(U,S){var V=this,T;switch(U.dataAction){case"fullpage-view":case"scroll-view-prev":case"scroll-view-prev-beside":case"scroll-view-noprev":T=new B.mail.ui.MailView();T.switchView(U.dataAction);break;default:V.modules.listview.actionHandler(U,S);break;}},toggleSearchViewHandler:function(){var U=this,T=!U.get("isSnippet"),S;S=U.listMgr.getCurrentPage();if(!NeoConfig.pagedResults&&S.cacheIndex>0){S=U.listMgr.getFirstPage();}if(S.list.length){U.set("isSnippet",T);U.modules.listview.close();U.modules.listview=null;U.renderSearchList(S);}U.updateToolbars();},listMgrItemSelectHandler:function(S){var T=this;T.updateToolbars();},updateToolbars:function(){var X=this,S,T,U,W=[X.modules.topToolbar,X.modules.bottomToolbar],V=X.listMgr.getSelectedItems();if(NeoConfig.grayoutEnabled){for(S=0;S<2;++S){T=W[S];if(T){U=T.get("widget");if(U&&U.setButtonContext){U.setButtonContext(V.total);}}}}},removeMsgHandler:function(Z,f){var a=this,Y,b=f?f.length:0,h=a.modules.listview,X={},V,T,S,W=h.get("focusNode"),g=a.get("tabNode"),c=g.one("div.list-header input"),d=0,U,e;for(Y=0;Y<b;Y++){if(!f[Y].flags.isSpam&&a.type=="search"){continue;}a.listMgr.select(f[Y].mid,false);V=a.listMgr.generateKey(f[Y].mid);if(W&&W.getAttribute("data-key")==V){T=a.listMgr.getItemIndex(f[Y].mid);S=a.listMgr.getItemFromIndex(T+1)||a.listMgr.getItemFromIndex(T-1);}if(a.listMgr.getSelectedItems().all===true){if(NeoConfig.pagedResults){X=a.listMgr.remove(f[Y].mid);}else{if(a.listMgr.getSelectedItems().index===(b-1)){X=a.listMgr.remove(f[Y].mid,false);}else{X=a.listMgr.remove(f[Y].mid);h.removeItem(V);}}}else{X=a.listMgr.remove(f[Y].mid);h.removeItem(V);}d=d+1;}if(X.serverTotal===0){a.reset();a.renderAdvancedSearch();}else{if(NeoConfig.pagedResults){c&&c.set("checked",false);h.pruneItems();h.setStatus(strings.str_msg_list_loading);U=a.listMgr.getCurrentPage();e=!(U.list.length===0&&(U.cacheIndex*U.cacheSize<U.serverTotal));if((a.type=="search")||e){h.appendPageData(U);}else{a.delRequests.push(U);}}else{d&&h.appendPageData(a.listMgr.getNextPage());if(a.listMgr.getSelectedItems().all&&(a.listMgr.getSelectedItems().index!==(b-1))){h.clearLoadingStatus();}}X.serverTotal&&h.updateTitle(X);}if(S){h.setFocusNode(a.listMgr.generateKey(S.mid),false,true);if(a.type=="list"&&NeoConfig.pageMode==0){a.listMgr.select(S.mid,true);a.openInPreviewPane(S);}}},addMsgHandler:function(U,S,T){var V=this;(T=="encoding")&&V.changeMsgHandler(U,S,S,S,T);},changeMsgHandler:function(Y,S,T,g,X){var Z=this,V,a=T.length,e=Z.modules.listview,c,f,U,d,W=B.mail.model.DataStore.Messages.toMessageInfo;for(V=0;V<a;V++){U=Z.listMgr.getItem(T[V].mid);d=W(Y,T[V]);if(U&&d){f=C.merge(U,d);}if(!f){continue;}if(c=g[V].folderInfo){f.folder=P.Folders.get(c.fid).folderInfo.name;f.fid=c.fid;}if(g[V].flags){if(typeof g[V].flags.isRead!=="undefined"){f.flags.read=g[V].flags.isRead;}if(typeof g[V].flags.isFlagged!=="undefined"){f.flags.flagged=g[V].flags.isFlagged;}}if(g[V].header){C.merge(f,W(Y,g[V]));}Z.listMgr.update(T[V].mid,f);switch(X){case"move":case"remove":(Z.type=="search")&&e.updateItemFolder(Z.listMgr.generateKey(T[V].mid),f);
e.updateItemClass(T[V].mid,(Y==="Trash")?"Trash-move":"move");break;case"flag":for(var b in g[V].flags){e.updateItemClass(T[V].mid,b+"-"+g[V].flags[b]);}break;case"encoding":e.updateItemSubject(Z.listMgr.generateKey(T[V].mid),f);break;}}},onSearchStartHandler:function(S){var V=this,U=V.get("tabNode"),T;V.searchStopwatch=new C.Stopwatch("MailSearch");if(U){T=U.all("div.content");T&&T.remove();U.one("h3.loading")&&U.one("h3.loading").removeClass("hidden");}},onSearchCompleteHandler:function(T){var W=this,V=W.get("tabNode"),S=W.get("data"),U=W.stopWatchRT||{};V&&V.one("h3.loading").addClass("hidden");W.searchStopwatch&&W.searchStopwatch.stop&&W.searchStopwatch.stop();U.action="results";if(S&&S.refinedby&&B.Object.size(S.refinedby)){W.fire("darlaEvent",{action:"search_refinement"});U.action="refinement";}else{if(W.get("query").keyword){W.fire("darlaEvent",{action:"search_results",value:W.get("query").keyword});}else{if(W.type=="list"){W.handleDarlaEvent();}else{W.fire("darlaEvent",{action:"search_results"});}}}},handleDarlaEvent:function(V,T){var X=this,W={Inbox:"folderview_inbox","%40C%40Chats":"folderview_chat",Draft:"folderview_draft",Sent:"folderview_sent",Trash:"folderview_trash","%40B%40Bulk":"folderview_bulk"},S,U=X.get("data");emptyFolder=V||(!U||!U.total||(U.hits&&U.hits.length===0));S=W[X.fid]||"folderview_custom";X.fire("darlaEvent",{action:emptyFolder?S+"_empty":S});},afterActiveChangeHandler:function(W){var X=this,V=X.modules,T=X.get("query").keyword,S=B.one("#shellnavigation");if(V){for(var U in V){if(V[U]){V[U].set("active",W.newVal);}}}if(X.type=="search"){if(W.newVal){N.getSearchField().set("value",J(G(T)));if(typeof W.prevVal!=="undefined"){(X.get("query").keyword)?X.fire("darlaEvent",{action:"search_results",value:X.get("query").keyword}):X.fire("darlaEvent",{action:"search_results"});}S.all(".items").addClass("hidden");S.all("div.search-nav").removeClass("hidden");S.all("div.search-nav div.items").removeClass("hidden");}else{S.all(".items").removeClass("hidden");}}else{if(W.newVal){X.handleDarlaEvent();}}},close:function(U){var V=this,S=V.evt,T;V.abort();V.reset();N.getSearchField().set("value","");B.one("#shellnavigation").all(".items").removeClass("hidden");for(T in S){B.detach(S[T]);}B.mail.ui.searchTab=null;}},true);B.namespace("mail.ui");B.mail.ui.Search=E;},"1.0.0",{requires:["json","mail-ui-basewidget","common-utils","mail-ui-searchutils","mail-ui-search-model","mail-ui-list-mgr"]});