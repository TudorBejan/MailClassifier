YUI.add("_shared_module_updates_ycw",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_updates_ycw={base:'<div class="update hdr-info"> <span class="photo"><img src="{{url_profile_img}}" title="{{title_profile_img}}" /></span> {{msg}} {{tumor}}</div>',msg:'<div class="msg"><a href="#">{{profile_status_msg}}</a></div>',tumor:'<div class="tumor"></div>'};},"1.0.0");YUI.add("mail-common-hidef-profiles",function(A){A.namespace("mail.common.hiDefProfiles");A.mail.common.hiDefProfiles=function(){var C={};function E(O){var M=this,L=O.emails,P=L&&L.join(",")||O.email||"",Q=P&&P.toLowerCase()||"",R=O.cbk||0,S=O.updateHeader||0,K=O.updateRecipients||0,J=A.common.net.SessionMgr,N={failure:function(){R&&R.failure&&R.failure();},success:function(U){var Y=A.JSON.parse(U.responseText),a=Y.data,W,T,c,b=[],X,Z,V;if((c=O.emails)){for(Z in c){W=c[Z]&&c[Z].toLowerCase()||0;if(W){V=W.indexOf(";");T=(V!=-1)?W.substr(0,V):W;C[W]=a[T]||null;if(C[W]){b.push(C[W]);}}}R&&R.success&&R.success(b);}else{V=P.indexOf(";");T=(V!=-1)?P.substr(0,V):P;X=a[T]||null;C[P]=X;R&&R.success&&R.success([X]);}},suppressCodes:"*"},I=["/neo/profile?",(NeoConfig.mentos_enabled?"mentos=1&":""),"emails=",Q].join("");if(P&&!C[P]){J.request(I,null,N,"GET",null,true);}else{R&&R.success&&R.success([C[P]]);}}function H(I){return((I&&C[I])?[C[I]]:null);}function B(I){var K=A.mail.Tabs.tabs||[],O="",J;for(J=K.length-1;J>0;J--){var L=K[J];if(L.widget&&L.widget.msgPane&&L.widget.msgPane.message&&L.widget.msgPane.message.messageHeaders&&L.widget.msgPane.message.header&&L.widget.msgPane.message.header.from&&L.widget.msgPane.message.header.from.email&&L.widget.msgPane.message.header.from.email==I){var M=L.widget.msgPane.message,N=M.messageHeaders;O=D(N);break;}}return O;}function D(L,P){var O,R,J,I,S="",M,N,K=NeoConfig.mentos_abaca_threshold||-9999,Q=null;for(O=0;O<L.length;O++){R=L[O];J=R.headerValue;I=R.headerName.toLowerCase();if(I=="authentication-results"&&!S){M=J.indexOf("from=");if(M!=-1){N=J.indexOf(";",M);if(N!=-1){S=J.substring(M+5,N);}}}else{if(K!=-9999&&I=="x-rocket-track"&&!Q){M=J.indexOf("fs=");if(M!=-1){N=J.indexOf(";",M);if(N!=-1){Q=parseInt(J.substring(M+3,N),10);}}}}}if(P){return{dkim:S,msg_abaca_score:Q};}else{return S;}}function G(K){var L=B(K),I,J=((NeoConfig.isFullSSL)?"https://s.yimg.com":"http://mail.yimg.com")+"/nq/identity/profile_48a.png";if(!L){A.fire("contact:imgUrl:loaded",{imgUrl:J,dkim:L});}else{K=[K,";",L].join("");I={success:function(M){A.fire("contact:imgUrl:loaded",{imgUrl:(M[0]&&M[0].imgUrl?M[0].imgUrl:J),dkim:L});},failure:function(){A.fire("contact:imgUrl:loadfailed");}};E({email:K,cbk:I});}}var F={getProfile:E,getCachedProfile:H,getContactImgUrl:G,getDKIMDomain:B,getDKIMDomainFromHeaders:D};return F;}();},"1.0.0",{requires:["common-net-session"]});YUI.add("mail-ui-profileutils",function(F){F.namespace("mail.ui");var C=F.common.Utils,A=C.rocketstats,E=F.mail.common.hiDefProfiles;function D(O,J,H){var K,M,N,I={},L=[],G=[],P;if(!F.Lang.isArray(O)){O=[O];}M=O.length;for(K=0;K<M;K++){N=B(O[K]);G.push(N||null);if(N){I[N]=true;}}for(K in I){I[K]&&L.push(K);}if(L.length>0){P={success:function(Q){J&&J.call(H,Q,G,O);},failure:function(){A.stat("Mentos","ProfileFetchFailure");}};E.getProfile({emails:L,cbk:P});}}function B(L){var G=L&&L.header&&(L.header.sender&&L.header.sender.toLowerCase()||L.header.from.email),M="",K,J,I=NeoConfig.mentos_abaca_threshold||-9999,H=null;if(!G){return;}if(NeoConfig.mentos_enabled){K=L&&L.messageHeaders||[];J=E.getDKIMDomainFromHeaders(K,true);M=J.dkim;H=J.msg_abaca_score;if(!M){A.stat("Mentos","No_DKIM");return;}else{G=[G,";",M].join("");}if((I!=-9999&&(H==null||isNaN(H)))||(H<I)){A.stat("Mentos","Abaca_Score_Too_Low");return;}}return G;}F.mail.ui.ProfileUtils={appendProfileImage:D,prepareEmailIds:B};},"1.0.0",{requires:["common-net-session","common-utils","common-utils-stats","_shared_module_updates_ycw","mail-common-hidef-profiles"]});YUI.add("mail-ui-msgpane-profiles",function(A){A.namespace("mail.ui");var C=A.mail.ui._MessagePane,G=NeoConfig.isFresh?A.ui.Templates._shared_module_message_display_fresh_rollup:A.ui.Templates._shared_module_message_display_rollup,E=A.common.Utils,D=E.substitute,B=E.rocketstats;function I(M){var P=this,L=M.imgUrl||null,K=M.profileUrl,O="",J="",N={url_profile_img:L,title_profile_img:O||""};if(L==null||M.slice){return"";}else{return D(G.message_header_ycw,N);}}function F(U,J){var P=this,L,S,O=P.get("parentNode"),N=O&&O.one(".message-header"),R=N&&N.one(".update"),M,K,V,Q,T="mentos-enabled";if(NeoConfig.isFresh){return;}if(!U[0]){return;}if(U.length==1){L=U[0];}else{B.stat("Mentos","ProfileArrayLengthNotExpected");return;}S=L.imgUrl||null;M=P.getProfileImageMarkup(L);B.stat("Mentos",S?"ProfileReturned":"NoProfileFound");if(!S||L.slice){R&&R.remove(1);}else{if(N){V=N.one(".date");Q=N.one(".flag");K=O.one(".message-header .info.expanded");V.addClass(T);Q.addClass(T);if(!R){V.insert(M,"after");}else{R.insert(M,"replace");}K.addClass(T);}}P.fire("renderProfileImageComplete");}function H(){A.mail.ui.ProfileUtils.appendProfileImage(this.message,this.renderProfileImage,this);}A.mix(C.prototype,{renderProfileImage:F,appendProfileImage:H,getProfileImageMarkup:I});},"1.0.0",{requires:["mail-ui-messagepane-base","mail-ui-messagepane-read","common-net-session","common-utils-stats","_shared_module_updates_ycw","mail-common-hidef-profiles","mail-ui-profileutils"]});