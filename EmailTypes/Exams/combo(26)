YUI.add("tictac-att-slideshow",function(a){function f(a){var b=this;f.superclass.constructor.apply(b,arguments),a.stats&&a.stats.stat&&(b.stats=a.stats)}var b={width:"40%",height:"50%",top:"0",bottom:"0",left:"-100%",right:"100%",zIndex:99992,opacity:.25},c={near:"5%",far:"55%"},d=NeoConfig.bidi,e;f.NAME="slideshow",f.ATTRS={attachments:{validator:a.Lang.isArray,value:null},position:{validator:a.Lang.isNumber,value:0},delay:{validator:a.Lang.isNumber,value:2500},imgMain:{validator:a.Lang.isObject,value:{width:"60%",height:"80%",left:"0",right:"0",opacity:1,zIndex:99994}},imgLeft:{validator:a.Lang.isObject,value:{left:d?c.far:c.near,right:d?c.near:c.far,width:b.width,height:b.height,opacity:b.opacity,zIndex:b.zIndex}},imgRight:{validator:a.Lang.isObject,value:{left:d?c.near:c.far,right:d?c.far:c.near,width:b.width,height:b.height,opacity:b.opacity,zIndex:b.zIndex}},imgLeftMost:{validator:a.Lang.isObject,value:{left:d?"100%":"-100%",right:d?"-100%":"100%",width:b.width,height:b.height,opacity:b.opacity,zIndex:b.zIndex}},imgRightMost:{validator:a.Lang.isObject,value:{left:d?"-100%":"100%",right:d?"100%":"-100%",width:b.width,height:b.height,opacity:b.opacity,zIndex:b.zIndex}},duration:{validator:a.Lang.isNumber,value:.4},easing:{validator:a.Lang.isString,value:"ease-in-out"}},a.extend(f,a.Widget,{renderUI:function(){var b=this,c=b.get("contentBox"),e=b.get("attachments");c.append(a.Tictac.att.rollups.slideshow({attachments:e,disable_play:e.length===1,is_single:e.length===1,is_bidi:d})),b._slideshow=c.one(".tictac-att-slideshow"),b._arrangeAttachments(),b._hasRendered=!0},bindUI:function(){var b=this,c=b.get("contentBox");b._events=[],b._events.push(c.one(".tictac-att-ss-close").on("click",function(){b.hide()})),b._events.push(c.one(".tictac-att-ss-controls-prev").on("click",function(){b.moveLeft(),b.stats.stat("slideshow_previous")})),b._events.push(c.one(".tictac-att-ss-controls-next").on("click",function(){b.moveRight(),b.stats.stat("slideshow_next")})),b._events.push(c.one(".tictac-att-ss-controls-play").on("click",function(){b.play(),b._isPlaying?b.stats.stat("slideshow_play"):b.stats.stat("slideshow_pause")})),b._events.push(c.delegate("click",function(){var a=b.get("attachments"),c=b.get("position"),d=a[c].aid;b.fire("download:single",{data:d}),b.stats.stat("slideshow_download_single")},".tictac-att-ss-download")),b._events.push(c.one(".tictac-att-ss-topbar-download").on("click",function(){var c=b.get("attachments"),d;d=a.Array.map(c,function(a){return a.aid}),b._setScanning(!0),b.fire("download:all",{data:d,callback:function(){b._setScanning(!1)}}),b.stats.stat("slideshow_download_all")})),b._events.push(c.delegate("click",function(a){a.target.hasClass("tictac-att-ss-left")?b.moveLeft():b.moveRight()},".tictac-att-ss-left, .tictac-att-ss-right")),b._events.push(a.one(document.body).on("keydown",a.bind(function(a){var b=this,c=b.get("boundingBox");if(c.hasClass("hidden"))return;switch(a.keyCode){case 37:d?b.moveRight():b.moveLeft();break;case 39:d?b.moveLeft():b.moveRight();break;case 27:return a.halt(),b.hide(),!1}},b)))},destructor:function(){var a=this,b;if(a._events)for(b=0;b<a._events.length;b++)a._events[b].detach()},initializer:function(){},_doListenForBackButton:function(){function b(){a._dontListenForBackButton(),a.hide()}var a=this;typeof window.history.pushState=="function"&&(a._doBackButton=b,window.history.pushState(null,""),window.addEventListener("popstate",b,!1))},_dontListenForBackButton:function(){var a=this;a._doBackButton&&(window.removeEventListener("popstate",a._doBackButton,!1),a._doBackButton=null)},_getAttachmentObject:function(a){var b=this.get("attachments"),c=null;return b&&b.get&&(c=b.get(a)),c},_arrangeAttachments:function(){var a=this,b=a.get("position"),c=a.get("imgMain"),d=a.get("imgLeft"),e=a.get("imgLeftMost"),f=a.get("imgRight"),g=a.get("imgRightMost"),h=a.get("attachments"),i,j,k,l,m;a._slideshow.all(".tictac-att-ss-master").removeClass("tictac-att-ss-master"),a._slideshow.all(".tictac-att-ss-left").removeClass("tictac-att-ss-left"),a._slideshow.all(".tictac-att-ss-right").removeClass("tictac-att-ss-right");for(m=0;m<h.length;m++)l=h[m].aid,i=c,j={},k="",m<b?(i=m===b-1?d:e,k=m===b-1?"tictac-att-ss-left":""):m>b?(i=m===b+1?f:g,k=m===b+1?"tictac-att-ss-right":""):(k="tictac-att-ss-master",j=a._getAttSize(b)),a._slideshow.one('li[data-id="'+l+'"]').setStyles(i).setStyles(j).addClass(k);a._uiUpdateStatus()},_transition:function(b){var c=this,d=c.get("attachments"),e=c.get("position"),f,g,h,i,j,k;return b>=0&&b<d.length?(f=c._slideshow.one('li[data-id="'+d[e].aid+'"]'),e>0&&(g=c._slideshow.one('li[data-id="'+d[e-1].aid+'"]')),e>1&&(h=c._slideshow.one('li[data-id="'+d[e-2].aid+'"]')),e+1<d.length&&(i=c._slideshow.one('li[data-id="'+d[e+1].aid+'"]')),e+2<d.length&&(j=c._slideshow.one('li[data-id="'+d[e+2].aid+'"]')),k=function(b){return{on:{start:function(){b.addClass(a.UA.ie&&a.UA.ie<=9?"tictac-att-ss-transitioning-ie":"tictac-att-ss-transitioning")},end:function(){b.removeClass(a.UA.ie&&a.UA.ie<=9?"tictac-att-ss-transitioning-ie":"tictac-att-ss-transitioning")}}}},b>e?(f&&(f.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgLeft"),k(f))),f.removeClass("tictac-att-ss-master"),f.addClass("tictac-att-ss-left")),i&&(i.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgMain"),c._getAttSize(b),k(i))),i.addClass("tictac-att-ss-master"),i.removeClass("tictac-att-ss-right")),g&&(g.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgLeftMost"),k(g))),g.removeClass("tictac-att-ss-left")),j&&(j.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgRight"),k(j))),j.addClass("tictac-att-ss-right"))):(f&&(f.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgRight"),k(f))),f.removeClass("tictac-att-ss-master"),f.addClass("tictac-att-ss-right")),g&&(g.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgMain"),c._getAttSize(b),k(g))),g.addClass("tictac-att-ss-master"),g.removeClass("tictac-att-ss-left")),i&&(i.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgRightMost"),k(i))),i.removeClass("tictac-att-ss-right")),h&&(h.transition(a.merge({duration:c.get("duration"),easing:c.get("easing")},c.get("imgLeft"),k(h))),h.addClass("tictac-att-ss-left"))),c.set("position",b),!0):!1},_getAttSize:function(a){var b=this,c={},d=b.get("attachments")[a];return d&&d.width&&d.height&&(c.width=d.width+"px",c.height=d.height+"px"),c},_setScanning:function(a){var b=this._slideshow;if(!b)return;a?b.addClass("att-ss-scanning"):b.removeClass("att-ss-scanning")},_move:function(a){var b=this,c=b.get("position"),d=!1;return a==="left"?d=b._transition(c-1):a==="right"&&(d=b._transition(c+1)),b._uiUpdateStatus(),d},_loadImages:function(){function g(f){function h(){b[f].width=g.width,b[f].height=g.height,b[f].hasLoaded=!0,a.set("attachments",b),a._slideshow&&(c=c||a._slideshow.one(".tictac-att-ss-master"),d=c.getAttribute("data-id")),!e&&c&&c.hasClass("tictac-att-ss-master")&&d==b[f].aid&&(c.setStyles({width:g.width+"px",height:g.height+"px"}),e=!0)}var g=new Image;g.onload=h,g.src=b[f].fullsize}var a=this,b=a.get("attachments"),c,d,e=!1,f;for(f=0;f<b.length;f++)g(f)},play:function(){var b=this,c=b.get("delay"),d=b.get("attachments"),e;b._isPlaying?b.stop():d.length>1&&(b.get("position")+1===d.length&&(b.set("position",0),b._arrangeAttachments()),b._isPlaying=!0,e=b._slideshow.one(".tictac-att-ss-controls-play"),e.addClass("att-ss-playing"),e.set("title",a.Tictac.att.strings.str_tictac_att_pause),function f(){b._slideshowTimer=setTimeout(function(){var a;b._isPlaying&&(a=b.moveRight(),a&&b.get("position")+1<d.length?f():b.stop())},c)}())},stop:function(){var b=this;b._isPlaying=!1,clearTimeout(b._slideshowTimer),b._slideshow.one(".tictac-att-ss-controls-play").removeClass("att-ss-playing").set("title",a.Tictac.att.strings.str_tictac_att_play)},moveLeft:function(){return this._move("left")},moveRight:function(){return this._move("right")},show:function(b,c){var d=this,f=d.get("boundingBox"),g,h=b,i;d._loadImages();if(c){g=d.get("attachments");for(i=0;i<g.length;i++)if(g[i].aid===b){h=i;break}}b!==undefined&&d.set("position",h),d.hasRendered()?d._arrangeAttachments():d.render(),f.removeClass("hidden"),d._doListenForBackButton(),e=a.mail.ui.Workspace.get("navKeys"),a.mail.ui.Workspace.set("navKeys",null),document.activeElement.blur()},hide:function(){var b=this,c=this.get("boundingBox");c.addClass("hidden"),b._isPlaying&&b.stop(),b._doBackButton&&window.history.back(),b._dontListenForBackButton(),a.mail.ui.Workspace.set("navKeys",e)},hasRendered:function(){return!!this._hasRendered},_uiUpdateStatus:function(){var b=this,c=a.Tictac.att.strings,d=b.get("attachments"),e=b.get("position"),f=b._slideshow.one(".tictac-att-ss-controls-prev"),g=b._slideshow.one(".tictac-att-ss-controls-next");b._slideshow.one(".tictac-att-ss-topbar-count").setHTML(a.Tictac.base.utils.subs(c.str_tictac_att_slideshow_count,{pos:e+1,total:d.length})),b._slideshow.one(".tictac-att-ss-topbar-size").setHTML(d[e].filesize),e===0?f.addClass("att-ss-disabled"):f.removeClass("att-ss-disabled"),e+1>=d.length?g.addClass("att-ss-disabled"):g.removeClass("att-ss-disabled")}}),a.namespace("Tictac.att").Slideshow=f},"1.0.0",{requires:["node-base","widget","transition","tictac-base-utils","tictac-base-stats","tictac-att-rollups","tictac-att-strings"]});