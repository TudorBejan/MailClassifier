/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("editor-para",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="body",s="nodeChange",o="parentNode",u=i+" > p",a="p",f="<br>",l="firstChild",c="li";e.extend(n,e.Plugin.EditorParaBase,{_onNodeChange:function(t){var n=this.get(r),s=n.getInstance(),h,p,d,v,m,g=s.EditorSelection.DEFAULT_BLOCK_TAG,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=":last-child";switch(t.changedType){case"enter-up":var H=this._lastPara?this._lastPara:t.changedNode,B=H.one("br.yui-cursor");this._lastPara&&delete this._lastPara,B&&(B.previous()||B.next())&&B.ancestor(a)&&B.remove();if(!H.test(g)){var j=H.ancestor(g);j&&(H=j,j=null)}if(H.test(g)){var F=H.previous(),I,q,R=!1;if(F){I=F.one(D);while(!R)I?(q=I.one(D),q?I=q:R=!0):R=!0;I&&n.copyStyles(I,H)}}break;case"enter":e.UA.webkit&&t.changedEvent.shiftKey&&(n.execCommand("insertbr"),t.changedEvent.preventDefault());if(t.changedNode.test("li")&&!e.UA.ie){h=s.EditorSelection.getText(t.changedNode);if(h===""){d=t.changedNode.ancestor("ol,ul");var U=d.getAttribute("dir");U!==""&&(U=' dir = "'+U+'"'),d=t.changedNode.ancestor(s.EditorSelection.BLOCKS),v=s.Node.create("<p"+U+">"+s.EditorSelection.CURSOR+"</p>"),d.insert(v,"after"),t.changedNode.remove(),t.changedEvent.halt(),m=new s.EditorSelection,m.selectNode(v,!0,!1)}}if(e.UA.gecko&&n.get("defaultblock")!=="p"){d=t.changedNode;if(!d.test(c)&&!d.ancestor(c)){d.test(g)||(d=d.ancestor(g)),v=s.Node.create("<"+g+"></"+g+">"),d.insert(v,"after"),m=new s.EditorSelection;if(m.anchorOffset){y=m.anchorNode.get("textContent"),p=s.one(s.config.doc.createTextNode(y.substr(0,m.anchorOffset))),b=s.one(s.config.doc.createTextNode(y.substr(m.anchorOffset))),E=m.anchorNode,E.setContent(""),x=E.cloneNode(),x.append(b),T=!1,C=E;while(!T){C=C.get(o);if(C&&!C.test(g)){N=C.cloneNode(),N.set("innerHTML",""),N.append(x),w=C.get("childNodes");var z=!1;w.each(function(e){z&&N.append(e),e===E&&(z=!0)}),E=C,x=N}else T=!0}b=x,m.anchorNode.append(p),b&&v.append(b)}v.get(l)&&(v=v.get(l)),v.prepend(s.EditorSelection.CURSOR),m.focusCursor(!0,!0),h=s.EditorSelection.getText(v),h!==""&&s.EditorSelection.cleanCursor(),t.changedEvent.preventDefault()}}break;case"keyup":e.UA.gecko&&s.config.doc&&s.config.doc.body&&s.config.doc.body.innerHTML.length<20&&(s.one(u)||this._fixFirstPara());break;case"backspace-up":case"backspace-down":case"delete-up":e.UA.ie||(k=s.all(u),A=s.one(i),k.item(0)&&(A=k.item(0)),L=A.one("br"),L&&(L.removeAttribute("id"),L.removeAttribute("class")),p=s.EditorSelection.getText(A),p=p.replace(/ /g,"").replace(/\n/g,""),M=A.all("img"),p.length===0&&!M.size()&&(A.test(a)||this._fixFirstPara(),O=null,t.changedNode&&t.changedNode.test(a)&&(O=t.changedNode),!O&&n._lastPara&&n._lastPara.inDoc()&&(O=n._lastPara),O&&!O.test(a)&&(O=O.ancestor(a)),O&&!O.previous()&&O.get(o)&&O.get(o).test(i)&&(t.changedEvent.frameEvent.halt(),t.preventDefault())),e.UA.webkit&&t.changedNode&&(t.preventDefault(),A=t.changedNode,A.test("li")&&!A.previous()&&!A.next()&&(h=A.get("innerHTML").replace(f,""),h===""&&A.get(o)&&(A.get(o).replace(s.Node.create(f)),t.changedEvent.frameEvent.halt(),s.EditorSelection.filterBlocks())))),e.UA.gecko&&(v=t.changedNode,_=s.config.doc.createTextNode(" "),v.appendChild(_),v.removeChild(_))}e.UA.gecko&&t.changedNode&&!t.changedNode.test(g)&&(O=t.changedNode.ancestor(g),O&&(this._lastPara=O))},initializer:function(){var t=this.get(r);if(t.editorBR){e.error("Can not plug EditorPara and EditorBR at the same time.");return}t.on(s,e.bind(this._onNodeChange,this))}},{NAME:"editorPara",NS:"editorPara",ATTRS:{host:{value:!1}}}),e.namespace("Plugin"),e.Plugin.EditorPara=n},"3.7.2",{requires:["editor-para-base"]});
/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("editor-br",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="li";e.extend(n,e.Base,{_onKeyDown:function(t){if(t.stopped){t.halt();return}if(t.keyCode==13){var n=this.get(r),s=n.getInstance(),o=new s.EditorSelection,u="";if(o){if(e.UA.ie)if(!o.anchorNode||!o.anchorNode.test(i)&&!o.anchorNode.ancestor(i)){var n=this.get(r);n.execCommand("inserthtml",s.EditorSelection.CURSOR),t.halt()}e.UA.webkit&&!o.anchorNode.test(i)&&!o.anchorNode.ancestor(i)&&(n.frame._execCommand("insertlinebreak",null),t.halt())}}},_afterEditorReady:function(){var t=this.get(r).getInstance();try{t.config.doc.execCommand("insertbronreturn",null,!0)}catch(n){}(e.UA.ie||e.UA.webkit)&&t.on("keydown",e.bind(this._onKeyDown,this),t.config.doc)},_onNodeChange:function(e){switch(e.changedType){case"backspace-up":case"backspace-down":case"delete-up":var t=this.get(r).getInstance(),n=e.changedNode,i=t.config.doc.createTextNode(" ");n.appendChild(i),n.removeChild(i)}},initializer:function(){var t=this.get(r);if(t.editorPara){e.error("Can not plug EditorBR and EditorPara at the same time.");return}t.after("ready",e.bind(this._afterEditorReady,this)),e.UA.gecko&&t.on("nodeChange",e.bind(this._onNodeChange,this))}},{NAME:"editorBR",NS:"editorBR",ATTRS:{host:{value:!1}}}),e.namespace("Plugin"),e.Plugin.EditorBR=n},"3.7.2",{requires:["editor-base"]});
YUI.add("mail-ui-rteview",function(E){var U="hidden",N,T,C,H;function G(Y){var d=this;G.superclass.constructor.call(d,Y);N=Y.bidi;T=Y.fullpage;C=Y.isFullSSL;H=Y.isRTL;d.rte=null;d.contentInitialized=null;d.focusNode=false;d.baseNode=null;d.rteReady=false;d.rteArea=null;d.evt=[];d.set("isRich",Y.isRich);d.getDefaultFontInfo=Y.getDefaultFontInfo;d.convertToPlain=Y.convertToPlain;d.richFontInfo=d.getDefaultFontInfo(!Y.isRich);d.resizeNestCount=0;d.resizeRTEHeight=0;d.resizeNode=null;var c={isRich:{setter:function(e){d.isRich=e;d.switchEditMode();}},content:{setter:function(e){d.content=e;d.rte.getInstance().Selection.cleanCursor();d.baseNode&&d.baseNode.fire("switchToPlain");},getter:function(){return d.content?d.content:"";}}};d.addAttrs(c,Y||{});d.on("activeChange",function(f){d.handleActiveChanged(f);});}function b(d){var f=this,c,e,Y=f.evt;f.baseNode=d;E.Frame.DEFAULT_CSS="body { background-color: #fff; } a, a:visited, a:hover { color: blue; text-decoration: underline !important; cursor: text !important; } img { cursor: pointer !important; border: none; }";if(E.UA.ie){if(E.UA.ie>=8){E.Frame.getDocType=function(){return"";};}if(!N){E.Frame.DOM_EVENTS.keypress=0;}f.resizeNode=f.baseNode.one("div.compose-message").one("div.inner").ancestor("td");}f.rte=new E.EditorBase({extracss:f.getExtraCSS(f.isRich),defaultblock:"p",dir:N&&strings.str_tog_loadRTLCss?"rtl":"ltr"});E.Plugin.ExecCommand.COMMANDS.fontsize=null;f.rte.plug(E.Plugin.EditorPara);if(N){f.rte.plug(E.Plugin.EditorBidi);f.rte.plug(E.Plugin.EditorAutoBidi);}f.bindUI();f.renderUI();}function V(){var c=this,Y=c.evt;Y.push(c.rte.after("nodeChange",function(g){var f,d=g.changedType;if(c.isRich){if(d==="keypress"||(!E.UA.ie&&d=="keydown")){return;}if(d==="right"||d==="left"||d==="space"){return;}if(d==="mouseup"||(E.UA.ie&&d.indexOf("up")!=-1&&g.changedNode.get("tagName")!="SPAN")){return;}if(d==="mousedown"&&g.changedEvent&&g.changedEvent.which>1){return;}if(g.changedType&&g.changedType.toLowerCase()!="execcommand"){c.fire("nodeChange",g);}}}));Y.push(c.rte.frame.after("ready",function(){var d,e;c.rte.frame._iframe.setStyle("visibility","inherit");c.rteReady=true;Y.push(c.rte.frame.getInstance().one("win").on("focus",function(){c.fire("focus",{editor:c.rte});}));Y.push(c.rte.getInstance().one("doc").one("body").on("keyup",function(f){if(f.keyCode==8){f.halt();}}));Y.push(c.rte.frame.on("dom:keydown",function(f){c.fire("keyDown",f);}));Y.push(c.rte.frame.on("dom:mousedown",function(f){c.fire("mousedown");}));Y.push(c.rte.getInstance().one("doc").one("body").on("drop",function(f){c.fire("drop",f);}));Y.push(c.rte.after("dom:paste",function(f){c.resize(true);c.fire("paste");}));if(c.contentInitialized){c.setContent(c.contentInitialized,false);}if(c.resizeNode){Y.push(c.resizeNode.on((E.UA.ie&&E.UA.ie<8)?"resize":"windowresize",function(){c.resize();}));}if(E.UA.ie){E.Node.getDOMNode(c.rte.getInstance().one("doc").one("body")).contentEditable=true;}c.resize();c.set("ready",true);c.fire("ready");c.rte.frame.getInstance().one("body").setStyles({"fontSize":c.richFontInfo.fontSize,"fontFamily":c.richFontInfo.fontFamily});d=E.one("#rtetext iframe");if(d){d.set("title",strings.str_comp_messagebody);}e=c.rte.frame.getInstance().one("body");if(e){e.set("aria-label",strings.str_comp_messagebody);if(N&&H){e.set("dir","rtl");}}}));}function D(){var Y=this;Y.rteArea=Y.baseNode.one("div.compose-message").one("div.inner").one("div.cm-rtetext");Y.rte.render(Y.rteArea);if(N){Y.rte.fire("turnautobidioff",{status:!Y.isRich});}}function J(){var Y=this;if(E.UA.ie){Y.rteArea.setStyle("display","block");}Y.rteArea.setStyle("visibility","");}function S(){var Y=this;if(E.UA.ie){Y.rteArea.setStyle("display","none");}Y.rteArea.setStyle("visibility","hidden");}function K(Y,e){var f=this,d,c;if(f.rte){if(Y==="bidi"){f.rte.fire("disableautobidi");}f.rte.execCommand(Y,e);if(E.UA.webkit){f.rte.frame._iframe.focus();if(Y==="createlink"){d=f.rte.getInstance();c=new d.Selection();c&&c._selection&&c._selection.collapseToEnd();}}}}function L(c,k){var i=this,Y,g,d,h="",m=E.Selection.CURSOR,l=(!E.Lang.isUndefined(k))?k:true;if(l){h="<p>"+m+"</p>";}else{h="";}h+=c;if(i.rteReady){i.rte.set("content",h);g=i.rte.getInstance();g.Selection.filter();if(E.UA.ie){i.rte.frame._fixIECursors();}try{Y=new g.Selection();Y.focusCursor(true,true);}catch(j){}if(E.UA.ie&&E.UA.ie>=10){var f=i.rte.getInstance().one("doc").one("body > p .yui-cursor");if(f){f.remove(true);}}}else{i.contentInitialized=h;}}function a(){return this.rte.getContent();}function O(){return this.rte.get("content");}function Q(){return this.rte;}function M(){return this.rte.getInstance().one("doc");}function A(Y){if(this.rte){this.rte.focus(Y);}}function Z(){var Y=this;E.each(Y.evt,function(c){c.detach();});delete Y.evt;Y.rte.destroy(true);delete Y.rte;G.superclass.ondestroy.call(this,arguments);}function P(c){var d=this;if(d.rte){if(c.newVal){if(E.UA.ie&&d.rte){d.rte.frame._iframe.setStyle("display","block");}}else{d.rte.frame._iframe.setStyle("visibility","inherit");if(E.UA.ie){var Y=NeoConfig.searchField||E.one(".yucs-search-input")||E.one(".yucs-search-field")||E.one("#searchfield");Y&&Y.focus();d.rte.frame._iframe.setStyle("display","none");}}}}function I(){var d=this,Y,c;if(d.rte){c=d.isRich;Y=d.getDefaultFontInfo(!c);d.rte.set("extracss",d.getExtraCSS(c));d.rte.frame.getInstance().one("body").setStyles({"fontSize":Y.fontSize,"fontFamily":Y.fontFamily});if(N){d.rte.fire("turnautobidioff",{status:!c});}}}function X(){var f=this,e=f.rte.getInstance(),Y=e.one("doc").one("body");if(Y){var c=f.convertToPlain(Y,false);if(c){if(E.UA.ie){c=c.replace(/\xA0/gi," ");}var d=E.Lang.trim(c);if(d!==""){f.set("content",f.convertToPlain(Y,true));}return d!=="";}else{return false;}}return true;}function R(Y){var d=this,c=d.getDefaultFontInfo(!Y);if(Y){d.richFontInfo.fontFamily=c.fontFamily;d.richFontInfo.fontSize=c.fontSize;d.richFontInfo.foreColor="#000";d.richFontInfo.backColor="#fff";}return"body { color: "+d.richFontInfo.foreColor+"; background-color: "+d.richFontInfo.backColor+";padding: 0px; margin: 8px "+(N?(strings.str_tog_loadRTLCss?"12px 0px 12":"12px 0px 12"):"0px 0px 12")+"px; } "+"p { margin : 0 }"+"blockquote { margin : 1em; display : block; }"+"span.mark { background:transparent url("+((C)?"http://mail.yimg.com":"https://s.yimg.com")+"/ok/u/assets/img/rte-mark.png) repeat-x scroll center bottom; }";
}function W(f){var i=this,Y,e,h,g,d=false,c=T?270:100;if(i.resizeNode&&i.resizeNestCount===0){e=i.resizeNode.ancestor("TBODY").get("children");Y=i.baseNode.get("offsetHeight")-e.item(0).get("offsetHeight")-e.item(1).get("offsetHeight");if(Y<c){Y=c;d=true;}if(f||Y!=i.resizeRTEHeight){i.resizeRTEHeight=Y;h=i.baseNode.one("div.compose-message");h.setStyle("height",Y+"px");if(NeoConfig.fullPage&&E.UA.ie>0&&E.UA.ie<8){i.resizeNestCount++;h.ancestor("TR").setStyle("height",Y+"px");h.ancestor("TD").setStyle("height",Y+"px");i.resizeNestCount--;}if(NeoConfig.fullPage){g=h.one(".cm-rtetext");if(g){g.setStyle("height",(Y-20)+"px");}}if(i.rte&&i.rteReady&&E.UA.ie){i.ieSetBodyHeight();}if(T){i.baseNode.setStyle("overflow-y",d?"scroll":"hidden");}}}}function F(){var d=this,c,Y;d.rte.frame._ieSetBodyHeight();if(E.UA.ie>8){c=d.rte.getInstance();if(c){Y=(d.rte.frame._iframe.get("offsetHeight")-15)+"px";c.config.doc.body.style.height=Y;}}}function B(Y){if(this.rte){this.rte.plug(Y);}}E.namespace("mail");E.extend(G,E.mail.ui.BaseWidget);E.mail.RTEView=G;E.mix(E.mail.RTEView.prototype,{NAME:"RTE",render:b,renderUI:D,bindUI:V,execute:K,getRTE:Q,getDoc:M,getContent:a,getContentOnSave:O,getExtraCSS:R,setFocus:A,setContent:L,switchEditMode:I,hasContent:X,ieSetBodyHeight:F,resize:W,plug:B,hideArea:S,showArea:J,handleActiveChanged:P,ondestroy:Z},true);},"1.0.0",{requires:["node-base","node-event-delegate","attribute-base","event-base","mail-ui-basewidget","editor-base","editor-para","editor-br"]});/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("swfdetect",function(e,t){function c(e){return parseInt(e,10)}function h(e){i.isNumber(c(e[0]))&&(r.flashMajor=e[0]),i.isNumber(c(e[1]))&&(r.flashMinor=e[1]),i.isNumber(c(e[2]))&&(r.flashRev=e[2])}var n=0,r=e.UA,i=e.Lang,s="ShockwaveFlash",o,u,a,f,l;if(r.gecko||r.webkit||r.opera){if(o=navigator.mimeTypes["application/x-shockwave-flash"])if(u=o.enabledPlugin)a=u.description.replace(/\s[rd]/g,".").replace(/[A-Za-z\s]+/g,"").split("."),h(a)}else if(r.ie){try{f=new ActiveXObject(s+"."+s+".6"),f.AllowScriptAccess="always"}catch(p){f!==null&&(n=6)}if(n===0)try{l=new ActiveXObject(s+"."+s),a=l.GetVariable("$version").replace(/[A-Za-z\s]+/g,"").split(","),h(a)}catch(d){}}e.SWFDetect={getFlashVersion:function(){return String(r.flashMajor)+"."+String(r.flashMinor)+"."+String(r.flashRev)},isFlashVersionAtLeast:function(e,t,n){var i=c(r.flashMajor),s=c(r.flashMinor),o=c(r.flashRev);return e=c(e||0),t=c(t||0),n=c(n||0),e===i?t===s?n<=o:t<s:e<i}}},"3.7.2",{requires:["yui-base"]});
YUI.add("mail-service-uploader-utils",function(B){var A=B.common.Utils.rocketstats.intlStat;B.namespace("Y.mail.UploaderUtils");B.mail.UploaderUtils={getUploadCredential:function(D){var E=NeoConfig.launch_protocol+document.location.host+"/ya/upload_get_cred",C=B.mail.UploaderService,F={success:function(H,G,J){var I;if(H&&H.responseText){I=B.JSON.parse(H.responseText).Response.cred;}C.UPLOAD_CREDENTIAL=I||"failed";A("UploaderService","CredentialSet"+(I?"Successful":"FailedCallback"));if(!I){}D&&D();},failure:function(){C.UPLOAD_CREDENTIAL="failed";A("UploaderService","CredentialSetFailed");},suppressCodes:"*"};B.common.net.SessionMgr.request(E,null,F,"GET",null,true);},checkLimits:function(K){var L=K.files||[],P=K.cdo,I=K.uploader,D=B.common.persist.UserData,F=D.get("userFeaturePref.attachTotalSize"),C=D.get("userFeaturePref.attachFiles"),E,G,J,N=P&&P._getAttachmentsSize(),O=P&&P._getAttachmentsCount(),H,M=0;if(!L||!P||!I){return true;}for(H in L){E=L[H];G=E.get&&E.get("size")||E.size;J=E.get&&E.get("id")||E.id+"-"+E.name;if(((G>F)||(N+G>F))&&(!I.processedFiles[J]&&!I.removedFiles[J])){I.removedFiles[J]=1;M=1;delete L[H];}else{if(!I.processedFiles[J]&&!I.removedFiles[J]){N+=G;O++;}}}B.mail.UploaderService.logIt("checkLimits found totalSize = "+N+", totalCount="+O);if(O>C){for(H in L){if(O<=C){break;}E=L[H];J=E.get&&E.get("id")||E.id+"-"+E.name;if(!I.processedFiles[J]&&!I.removedFiles[J]){I.removedFiles[J]=1;delete L[H];O--;}}P.fire("CDO_ATTACHMENT_COUNT_VIOLATION");return false;}if((N>F)||M){P.fire("CDO_ATTACHMENT_SIZE_VIOLATION");return false;}return true;},handlePostRedirectResponse:function(C){var G=this,F=B.common.Utils.parseQueryString(C),E=B.mail.UploaderService.uploadersCreated[F.uploaderID],D=G.parseFormResponse(F,E);E.handlePostRedirectResponse(D);},parseFormResponse:function(E,H){var D=[],F,K,J,N=parseInt(E.cdoidx,10),I=(E.filename+"").split(","),M=(E.mimetype+"").split(","),L=(E.filesize+"").split(","),C=(E.diskfilename+"").split(","),G=(E.errorcode+"").split(",");for(J=0;J<G.length;J++){F={cdoIndex:N+J,filename:I[J],mimetype:M[J],size:{original:parseInt(L[J],10)},serverID:C[J],thumbData:null};this.setAttachmentState({item:F,state:G[J],uploader:H});D.push(F);}return D;},setAttachmentState:function(C){var G=C.item,E=C.state||G.attachCode,I=C.uploader,H=I.type||I.uploaderType,D={attachcode:E,resampled:false,cancelled:false,rotated:false,uploaded:false,scanned:false,failed:false},F=0;switch(E){case"uploadAVNoVirus":case"uploadAVCleaned":D.scanned=true;D.uploaded=true;A("UploaderService",H+"Attachment_UploadSuccess");break;case"uploadAVInternalError":case"uploadAVError":case"uploadAVNotScannable":case"uploadAVServerDown":D.uploaded=true;D.failed=false;D.failCause="averror";break;case"uploadFileSizeError":case"uploadNoFileError":D.failed=true;if(E=="uploadFileSizeError"){D.failCause="size";A("UploaderService",H+"Attachment_UploadFail");}else{D.failCause="nofile";A("UploaderService",H+"Attachment_NoFileError");}F=1;break;case"uploadAVCannotClean":case"uploadAVHasVirus":D.scanned=true;D.uploaded=true;D.failed=true;D.failCause="virus";A("UploaderService",H+"Attachment_UploadFailVirus");F=1;break;case"uploaderFormUploadNoResponse":D.failed=true;D.failCause="form_upload_no_response";A("UploaderService",H+"Attachment_UploadNoResponse");F=1;break;case"uploaderFormUploadUnexpectedResponse":D.failed=true;D.failCause="form_upload_unexpected_response";A("UploaderService",H+"Attachment_UploadUnexpectedResponse");F=1;break;case"uploaderFormUploadTimeout":D.failed=true;D.failCause="form_upload_timeout";A("UploaderService",H+"Attachment_UploadTimeout");F=1;break;case"uploaderFormUserCancelled":D.cancelled=true;D.failCause="form_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIUploadError":case"uploaderHTML5UploadError":D.failed=true;D.failCause=H+"_upload_error";A("UploaderService",H+"Attachment_UploadError");F=1;break;case"uploaderYUIResponseTimeout":case"uploaderHTML5ResponseTimeout":D.failed=true;D.failCause=H+"_response_timeout";A("UploaderService",H+"Attachment_UploadResponseTimeout");F=1;break;case"uploaderYUIUploadStartTimeout":case"uploaderHTML5UploadStartTimeout":D.failed=true;D.failCause=H+"_uploadstart_timeout";A("UploaderService",H+"Attachment_UploadStartTimeout");F=1;break;case"uploaderYUIProgressTimeout":case"uploaderHTML5ProgressTimeout":D.failed=true;D.failCause=H+"_progress_timeout";A("UploaderService",H+"Attachment_UploadProgressTimeout");F=1;break;case"uploaderYUIUploadCompleteTimeout":case"uploaderHTML5UploadCompleteTimeout":D.failed=true;D.failCause=H+"_uploadcomplete_timeout";A("UploaderService",H+"Attachment_UploadUploadCompleteTimeout");F=1;break;case"uploaderYUIUserCancelled":case"uploaderHTML5UserCancelled":D.cancelled=true;D.failCause=H+"_upload_cancelled";A("UploaderService",H+"Attachment_UploadCancelled");break;case"uploaderYUIAutoRetryAll":case"uploaderHTML5AutoRetryAll":D.failed=true;D.failCause=H+"_upload_error_retry";A("UploaderService",H+"Attachment_UploadErrorRetry");break;case"uploaderYUIAutoRetry2038":case"uploaderHTML5AutoRetry2038":D.failed=true;D.failCause=H+"_upload_error2038";A("UploaderService",H+"Attachment_UploadError2038");break;case"uploaderYUIError2049":case"uploaderHTML5Error2049":D.failed=true;D.failCause=H+"_upload_error2049";A("UploaderService",H+"Attachment_UploadError2049");F=1;break;case"uploaderYUICredExpired":case"uploaderHTML5CredExpired":D.failed=true;D.failCause=H+"_upload_302";A("UploaderService",H+"Attachment_UploadError302");break;case"uploadInternalError":D.failed=true;D.failCause="internal_server_error";A("UploaderService",H+"Attachment_InternalServerError");F=1;break;case"uploadMailboxError":D.failed=true;D.failCause="mailbox_error";A("UploaderService",H+"Attachment_MailboxError");F=1;break;case"uploadPartialFileError":D.failed=true;D.failCause="partial_file_error";A("UploaderService",H+"Attachment_PartialFileError");F=1;break;case"uploadAuthError":D.failed=true;D.failCause="upload_auth_error";
A("UploaderService",H+"Attachment_UploadAuthError");F=1;break;default:D.failed=true;D.failCause="generic_"+E;A("UploaderService",H+"Attachment_UploadFail");F=1;}A("UploaderService",H+"AttachmentStatus_"+E);if(D.failed){B.use("common-utils-error",function(J){J.common.Utils.error.report(E+":"+D.failCause,"ATTACH_UPLOAD_ERR",1,0,1);});}if(F){A("UploaderService",H+"UploaderFail_"+I.INITIAL_UPLOADER);}G.state=D;},createMenuNode:function(J){var C=parseInt(NeoConfig.switchAttachModeEnabled,10),F=J.node,I=J.uploader,K=J.cdo,D=J.attView,G=F.one("span.attach-btn-menu"),E=F.one(".attachment-button-html5")||F.one(".attachment-button-attach");if(C!=1){return;}I.handles.push(E.on("click",function(){G&&G.menu&&G.menu.hide&&G.menu.hide();K.fire("compose:restoreFocus");},I));var H="#attachment-button-input";B.one(H).on("click",function(){B.fire("mt:click",{action:"cmps_attfl",append:{t1:"cmpsTb"}});});G.on("click",this.createAttachOptionMenu,I,K,D);E&&E.removeClass("right");G&&G.removeClass("hidden");},selectDefaultMenuType:function(){var C=B.one("#menu-attach-options"),D=C&&C.one(".active")||0;if(D&&D.get("id")=="switch-form"){A("UploaderServiceMenu","FormOptionDefaulted");B.fire("compose:toggleUploaderType",{form:1,node:C,destroy:0});}},createAttachOptionMenu:function(E,D,H){var I=this,G=E.currentTarget,C=B.mail.UploaderService,F="hidden";B.fire("mt:click",{action:"cmps_attflmnu",append:{t1:"cmpsTb"}});E.preventDefault();if(!G.menu){B.use("common-ui-menu-helper","_shared_module_offscreen_bin_menus_compose_attach",function(N){var L=N.ui.Templates._shared_module_offscreen_bin_menus_compose_attach,K=H.type||H.uploaderType,M={html5_active:(H.type==C.UPLOADER_TYPE_HTML5?"active":""),flash_active:(H.type==C.UPLOADER_TYPE_FLASH?"active":""),form_active:(H.type==C.UPLOADER_TYPE_FORM?"active":"")},J=N.one("#menu-attach-options");if(!J){J=N.one("body").appendChild(N.common.Utils.substitute(L.base,M,0,0,strings));NeoConfig.isFresh&&J.appendChild(I.attView.attachLargeBtn);}if(H.type==C.UPLOADER_TYPE_HTML5){J.one("#switch-flash").addClass(F);J.one("#switch-html5").removeClass(F);}N.common.ui.MenuHelper.create(G,{menu:J,blur:true},function(){G.menu.getMenuNode().on("menuSelected",function(O){switch(O.dataAction){case"switch-html5":A("UploaderServiceMenu","HTML5OptionSelected");N.fire("compose:toggleUploaderType",{html5:1,node:J});break;case"switch-flash":A("UploaderServiceMenu","FlashOptionSelected");N.fire("compose:toggleUploaderType",{flash:1,node:J});break;case"switch-form":A("UploaderServiceMenu","FormOptionSelected");N.fire("compose:toggleUploaderType",{form:1,node:J,destroy:0});break;}D.fire("compose:restoreFocus");});});});}},verifyCrossDomainAccess:function(F){F=F||NeoConfig.attachmentServer;var G=this,E=B.mail.UploaderService,C=NeoConfig.launch_protocol+F+"/crossdomain.xml",D={success:function(){if(NeoConfig.attachmentServer!=F){NeoConfig.attachmentServer=F;E.UPLOAD_URL_BASE=NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings["str_cfg_base_intl"]+"."+NeoConfig.farm+".mail.yahoo."+(NeoConfig.intl=="jp"?"co.jp":"com")))+"/ya/upload";E.rs.intlStat("UploaderService","UsingBackupServer");}E.CROSS_DOMAIN_VERIFIED=true;},failure:function(){E.rs.intlStat("UploaderService","CrossDomainAccessFailed_"+(F==NeoConfig.attachmentServer?"primary":"backup"));if(F!=NeoConfig.attachmentServerBackup&&NeoConfig.attachmentServerBackup){B.mail.UploaderUtils.verifyCrossDomainAccess(NeoConfig.attachmentServerBackup);}else{E.DEFAULT_UPLOADER=E.UPLOADER_TYPE_FORM;B.fire("compose:toggleUploaderType",{form:1,destroy:1});}},suppressCodes:"*"};B.common.net.SessionMgr.request(C,null,D,"GET",null,true);}};},"1.0.0",{requires:["common-utils-stats","common-net-sessionmgr"]});YUI.add("mail-ui-composeview-attach",function(C){C.namespace("mail");var L={"application/pdf":"pdf","application/mspowerpoint":"ppt","application/vnd.ms-powerpoint":"ppt","application/excel":"xls","application/vnd.ms-excel":"xls","application/msword":"doc","application/vnd.ms-msword":"doc","application/x-trof-msvideo":"video","video/mpeg":"video","video/x-ms-wmv":"video","video/mov":"video","video/movie":"video","video/quicktime":"video","audio/wav":"music","audio/x-wav":"music","audio/mpeg":"music","audio/mp3":"music","audio/mid":"music","audio/realaudio":"music","audio/x-pn-realaudio":"music","image/bmp":"img","image/gif":"img","image/jpe":"img","image/jpeg":"img","image/jpg":"img","image/png":"img","image/tiff":"img","application/x-compressed":"zip","application/x-stuffit":"zip","application/x-tar":"zip","application/x-gzip":"zip"},H={"LOZENGE":0,"ICON":1},A=C.ui.Templates,b=C.common.Utils,G=C.mail.UploaderUtils,m=b.substitute,W=b.escapeHtml,V=window.strings||{},n=C.common.persist.UserData,f=n.get("userFeaturePref.attachTotalSize"),Q=n.get("userFeaturePref.attachFiles"),P=Math.round(f/1048576),i="hidden",T="attachmentVisible",X,D=(parseInt(NeoConfig.uploaderVersion,10)===2);function d(o,Y){Y=Y||"str_rte_attachments_";return V[Y+o]||"";}C.mail.AttachmentView=function(x,t,o){var p=this,r,y,AA,q,v,w,s,z;X=C.mail.UploaderService;p.cdo=x;if(!p.handles){p.handles=[];}z=p.handles;p.tab=t;p.tagPane=o&&o.tagPane?o.tagPane:".attachments-pane";p.tagWell=o&&o.tagWell?o.tagWell:".attachments-well";p.uiAttBar=t.one(p.tagPane);if(p.uiAttBar){p.uiAttBtnForm=p.uiAttBar.one(".attachment-button-form")||null;p.uiAttBtnDisabled=p.uiAttBar.one(".attachment-button-disabled");}p.uiAttPane=t.one(p.tagWell);var u=NeoConfig.isFresh?p.uiAttPane:p.uiAttBar;if(u){p.uiAttRemoveAll=u.one(".attachment-button-removeall");p.uiAttCount=y=u.one(".attachments-count");p.uiAttSize=AA=u.one(".attachments-size");p.uiAttAVLogo=u.one(".file-count img");p.uiAttMessage=u.one(".error");}if(p.uiAttPane){p.uiAttList=q=p.uiAttPane.one(".file-attach");p.uiAttWelcome=p.uiAttPane.one(".attachments-welcome");}if(q&&y&&AA){var Y=t.one("div.rte li.active a");q.setAttrs({"aria-labelledby":(Y?Y.generateID():""),"aria-describedby":(y.generateID()+" "+AA.generateID())});}p.errorFlags={tooMany:false,tooBig:false};p.attachPaneHidden=NeoConfig.isFresh?false:true;p.attachXY=null;p.uploaderConfig={"attView":p,"tab":t,"cdo":x,"attForm":p.uiAttBtnForm,"attInput":p.tab.one(".attachment-button-file")};p.toggleUploaderHandle=C.on("compose:toggleUploaderType",k,p);if(D){s=X.getDefaultUploaderType();switch(s){case X.UPLOADER_TYPE_HTML5:v="mail-uploader-html5";break;case X.UPLOADER_TYPE_FLASH:v="uploader-flash";break;default:v="mail-service-uploader-form";s=X.UPLOADER_TYPE_FORM;}p.type=s;}w=function(AB){p.uploader=AB;AB.updateUI&&AB.updateUI();p.updateSizeAndCount();if(AB.uploaderType!=C.mail.UploaderService.UPLOADER_TYPE_FORM&&parseInt(NeoConfig.switchAttachModeEnabled,10)===1){G.createMenuNode({uploader:AB,node:p.tab,cdo:p.cdo,attView:p});G.selectDefaultMenuType();}};C.use(v,function(AB){X.create(p.uploaderConfig,w,o?o.type:null);});z.push(p.cdo.on("CDO_ATTACHMENT_ADDED",function(AC,AB){p.addNewAttachment(AB);}));z.push(p.cdo.on("CDO_ATTACHMENT_DELETED",function(AC,AB){p.removeAttachment(AB);p.updateSizeAndCount();}));z.push(p.cdo.on("CDO_ATTACHMENT_PROCESSED",function(AD,AB){p.enableAttachment(AB);p.updateSizeAndCount();function AC(AE){var AF=AE.state;return(AF&&!AF.processed&&!AF.uploaded&&!AF.cancelled);}if(!p.cdo._getAttachmentsCount(AC)){p.checkOverLimit();}}));z.push(p.cdo.on("CDO_ATTACHMENT_SIZE_VIOLATION",function(){p.attachError("size");}));z.push(p.cdo.on("CDO_ATTACHMENT_COUNT_VIOLATION",function(){p.attachError("count");}));z.push(p.cdo.on("CDO_ATTACHMENT_UPLOAD_PROGRESS",function(AD,AC,AB){p.updateAttachmentProgress(AC,AB);}));z.push(p.cdo.on("CDO_THUMBNAIL_GENERATED",function(AE,AB,AD){var AC=p.uiAttList.all(".file-container").item(AB),AF=AC.one("div");if(!AF){AC.insert(C.Node.create("<div></div>"),0);AF=AC.one("div");}AF.setStyle("background","url('"+AD.src+"') no-repeat 0px "+((63-AD.height)/2)+"px");AC.ancestor("li").addClass("image");}));z.push(p.cdo.on("CDO_UPLOADER_CLEANUP",function(){var AB=p.cdo.get("attachments"),AD,AC;for(AD=0;AB&&AD<AB.length;AD++){AC=AB[AD];if(AC&&AC.timeout){clearTimeout(AC.timeout);AC.timeout=null;}if(AC&&AC.state&&!AC.processed&&!AC.state.cancelled){AC.processed=true;AC.state.failed=1;p.enableAttachment(AD);}}p.updateSizeAndCount();}));if(p.uiAttRemoveAll){z.push(p.uiAttRemoveAll.on("click",function(AB){p.cdo._removeAllAttachments();AB.preventDefault();}));}if(p.uiAttBtnDisabled){z.push(p.uiAttBtnDisabled.on("click",function(){p.checkOverLimit(1);}));}if(p.uiAttAVLogo){z.push(p.uiAttAVLogo.on("click",function(){window.open(NeoConfig.avTargetUrl);}));}};function O(Y){var o=this;if(Y=="icon"){o.iconType=H.ICON;o.uiAttList.addClass("icons");o.uiAttList.removeClass("lozenges");}else{o.iconType=H.LOZENGE;o.uiAttList.removeClass("icons");o.uiAttList.addClass("lozenges");}}function a(q,o){var t=this,s=C.mail.AttachmentView.attachErrorSize,p=o?C.all(".file-attach li").item(o):null,Y={"count":m(d("num_files_exceeded","str_comp_attach_"),{},{max_allowed:function(){return Q;}}),"size":m(d("size_exceeded","str_comp_attach_"),{},{max_size_MB:function(){return P;}}),"averror":d("noAVScanWarning")+(p?p.get("title"):""),"virus":d("alert_virus")},r=Y[q];if(p){p.set("title",r||"");}t.updateSizeAndCount();if(q==="size"&&s&&s(t.cdo)){}else{if(r){C.use("common-ui-dialog-helper",function(u){u.common.ui.DialogHelper.alert({hd:(q=="virus")?d("alert_virus_title"):d("error","str_comp_attach_"),bd:r,restoreFocusNode:t.uiAttBar});});}}b.rocketstats.intlStat("ATTACH_ERROR",q);}function J(Y){var o=this;o.addAttachment(Y);o.updateSizeAndCount();}function e(){var r=this,q=r.cdo._getAttachmentsCount(),Y=(q==1)?d("file_single"):m(d("num_files"),{},{file_attach_num_files:function(){return q;}}),v=r.cdo._getAttachmentsSize(),x=0,u=0,y,p,t,s,o,w=(q==1)?V["str_comp_remove"]:V["str_comp_removeall"];
if(q){if(r.uiAttWelcome){r.uiAttWelcome.addClass(i);}r.uiAttList.removeClass(i);if(r.uiAttRemoveAll){r.uiAttRemoveAll.removeClass(i).one("a").setContent(w).set("title",w);}r.uiAttPane.removeClass(i);if(r.uiAttCount){r.uiAttCount.removeClass(i);}if(r.uiAttSize){r.uiAttSize.removeClass(i);}}else{r.uiAttList.addClass(i);if(r.uiAttRemoveAll){r.uiAttRemoveAll.addClass(i);}if(r.uiAttMessage){r.uiAttMessage.addClass(i);}r.uiAttPane.addClass(i);if(r.uiAttCount){r.uiAttCount.setContent("");}if(r.uiAttSize){r.uiAttSize.setContent("");}r.toggleOverLimit(0);if(r.uiAttWelcome){r.uiAttWelcome.removeClass(i);}return;}if(r.uiAttCount){r.uiAttCount.setContent(Y);}if(r.uiAttSize){var z=(NeoConfig.isFresh)?"sizes_fresh":"sizes";r.uiAttSize.setContent(m(d(z),{},{transferred_size:function(){return h(v);},total_size:function(){return P+" "+V["str_rte_attachments_megabyte"];}}));}r.errorFlags.tooMany=q>Q;r.errorFlags.tooBig=v>f;if(v>f){r.toggleOverLimit(2);}else{if(q>=Q||v===f){r.toggleOverLimit(1);}else{r.toggleOverLimit(0);}}y=r.uiAttPane.all(".file-attach .transfer-error")._nodes;for(p=0,o=y.length;p<o;p++){t=C.one(y[p]);s=t.hasClass("lozenge")?t.get("parentNode"):t;if(!s.hasClass(i)){x++;if(t.hasClass("transfer-virus")){u++;}}}if(r.uiAttMessage){if(u){r.uiAttMessage.setContent((u==1)?d("virus_single"):m(d("virus_mult"),{},{num_virus_files:function(){return u;}}));r.uiAttMessage.removeClass(i);}else{if(x){r.uiAttMessage.setContent((x==1)?d("error_single"):m(d("error_mult"),{},{num_error_files:function(){return x;}}));r.uiAttMessage.removeClass(i);}else{r.uiAttMessage.addClass(i);if(NeoConfig.intl==="jp"){if(v>f){r.uiAttMessage.setContent(V.str_comp_attach_size_exceeded);r.uiAttMessage.removeClass(i);}else{if(q>Q){r.uiAttMessage.setContent(V.str_comp_attach_num_files_exceeded);r.uiAttMessage.removeClass(i);}}}}}}}function I(Y){var o=this;if(o.errorFlags.tooBig){o.attachError("size");}else{if(o.errorFlags.tooMany||Y){o.attachError("count");}else{return false;}}return true;}function R(p,Y){var x=this,v=x.uiAttList||x.tab.one(".file-attach"),AB=x.cdo.get("attachments")[p],w=AB.state||{},s=AB.size||{},AC,z=w.processed||AB.processed?"":" processing",AE,AD,q,AA,t,u,y,o,r=C.mail.UploaderService;s=w.resampled?s.sampled:s.original;s=h(s);if(x.cdo.get("passive")){AB.original=AB.size.original;}if(AB.original&&w.uploaded){AB.processed=true;}if(NeoConfig.bidi){C.use("comms-intl-bidi",function(AF){AC=AF.Intl.detectDirection(unescape(AB.filename));});}Y=Y||(x.uploader&&x.uploader.uploaderType)||r.DEFAULT_UPLOADER;AE="_shared_module_rte_well_content_attach_item";AD=A[AE].browser_plus_attach_else;q=C.Node.create(m(AD,AB,{filename:function(AF){return W(AF.filename.split("\\").pop());},in_progress1:function(){return AB.original?"":A[AE].in_progress1;},transfer_error1:function(){return w.failed?A[AE].transfer_error1:"";},transfer_warn1:function(){return w.failCause?A[AE].transfer_warn1:"";},retry:function(){return m(A[AE].retry,0,0,0,V);}},null,V));if((C.UA.ie>0)&&(C.UA.ie<8)){q.removeClass(i);q.setStyle("float","left");x.uiAttPane.setStyle("paddingBottom","6px");}q.one("a").set("title",(AB.filename.split("\\").pop()||"")+" ("+s+")");x.handles.push(q.one(".lozengeremove").on("click",function(){var AF=p;if(q.hasClass("downloading")&&x.uploader.cancelUpload){if(D){AF=x.cdo.get("attachments")[p].uploaderInternalID;}x.uploader.cancelUpload(AF);}x.cdo._removeAttachment(p);}));y=q.one(".lozengeretry");if(y){if(!C.UA.webkit&&Y==r.UPLOADER_TYPE_FORM){y.addClass("hidden");}else{x.handles.push(y.on("click",function(){var AF=y.getAttribute("retries")||0;y.setAttribute("retries",++AF);x.retryOrSwitchAttachmentMode(p,AF);}));}}if(AC){q.one(".btn").setAttribute("dir",AC).addClass(AC);}x.handles.push(q.on("click",function(AF){if(!q.hasClass("downloading")){x.downloadAttachment(p);}}));v.append(q);if(r.debug){x.handles.push(q.on("click",function(AF){if(AF.altKey){r.logIt(x.cdo.get("attachments")[p]);}}));}x.dirty=true;}function E(Y){var p=this,o;o=p.uiAttList.all("li")&&p.uiAttList.all("li").item(Y);if(o){o.addClass(i);o.removeClass(T);}p.uploader&&p.uploader.removeAttachment&&p.uploader.removeAttachment(Y);}function M(o,Y){var s=this,r,q,p;r=s.uiAttList.all("li")&&s.uiAttList.all("li").item(o);if(r){q=!!r.one(".lozenge");p=q?".lozengeProgress":".progress";r.one(p).setStyle("width",Y+"%");r.one(p).set("aria-valuenow",Y);}}function j(o){var y=this,AA="",v=V.str_rte_attachments_click_to_retry+".",w="",s="",t=y.uiAttList.all("li")&&y.uiAttList.all("li").item(o),z,AC,r,u,AF,q,x,Y="",AE,AB,p=C.mail.UploaderService;if(!t){return;}z=!!t.one(".lozenge");if(z){t=t.one(".lozenge").get("parentNode");}else{t.one(".file-container").removeClass("processing");t.one(".prog-indicator").addClass(i);}AC=y.cdo.get("attachments")[o];u=AC.state||{};AF=u.failCause;if(u.failed){t.addClass("transfer-error");if(z){t.all(".lozenge").addClass("lozengeerror");}if(AF==="virus"){t.addClass("transfer-virus");AA=d("virusWarning");}else{if(AF==="size"){t.removeClass("downloading");t.one(".lozenge a").set("title",d("alert_size"));}else{if(!z){t.one(".retry").removeClass(i);}AA=d("attachFailedWarning");}}if((C.UA.webkit||p.type!=p.UPLOADER_TYPE_FORM)&&AF!="virus"&&(AB=t.one(".lozengeretry"))){AB.removeClass(i);}y.attachError(AF,o);}else{if(AF){if(z){r=t.one("a");r.addClass("lozengewarn");AA=d("noAVScanWarning");}else{t.addClass("transfer-warning");if(p.DEFAULT_UPLOADER!=p.UPLOADER_TYPE_FORM||C.UA.webkit){t.one(".lozengeretry").removeClass(i);}y.attachError(AC.state.failCause,o);}}else{if(z){if(t.hasClass("transfer-error")){t.removeClass("transfer-error");}if((AE=t.all(".lozenge"))&&AE.hasClass("lozengeerror")){AE.removeClass("lozengeerror");if(AB=t.one(".lozengeretry")){AB.addClass("hidden");}if(u.retry){t.addClass("downloading");}}}}}if(z){q=AC.size;x=AC.filename;if(!u.retry){t.removeClass("downloading");}q=u.resampled?q.sampled:q.original;q=h(q);try{Y=decodeURIComponent(x||"");}catch(AD){Y=decodeURIComponent(escape(x)||"")||"";}if(AF=="yui_progress_timeout"){w=" YUI Upload Progress Timeout.";
}if(NeoConfig.bidi&&V.str_tog_loadRTLCss){s=AA+" "+Y+" \u202b("+q+")\u202c.";}else{s=AA+" "+Y+" ("+q+").";}AE=t.one(".lozenge");AE&&AE.one("a").set("title",s);}else{C.use("event-mouseenter",function(){y.handles.push(t.on("mouseenter",function(){t.addClass("over");}));y.handles.push(t.on("mouseleave",function(){t.removeClass("over");}));});}if(t.hasClass(i)){y.cdo._removeAttachment(o);}}function g(p,Y,q){var s=this,r,o=!(C.UA.webkit);if(s.uploader.uploaderType!=C.mail.UploaderService.UPLOADER_TYPE_FORM&&Y>1){C.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(t){t.common.ui.DialogHelper.custom({hd:V.str_comp_attach_reattach_title,bd:V.str_comp_attach_reattach_body,ft:m(A._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,V,A)},{"ok":{handler:function(){t.fire("compose:toggleUploaderType",{form:1,destroy:q});r=s.uiAttList.all(".lozengeretry");if(r&&o){r.addClass("hidden");}}}});});}else{if(Y>3){C.use("common-ui-dialog-helper",function(t){t.common.ui.DialogHelper.alert({hd:V.str_comp_attach_reattach_failure_title,bd:V.str_comp_attach_reattach_failure_body},{"ok":{handler:function(){s.cdo._removeAttachment(p);}}});});}else{s.uploader.retryAttachment&&s.uploader.retryAttachment(p);}}}function c(v){var t=this,o=t.tab.one("#upload_file_selection"),p=D&&o&&o.one(".attachment-button-html5")||D&&o&&o.one(".attachment-button-attach")||t.tab.one(".attachment-button-attach"),q=C.mail.UploaderService,w,u=t.uploaderConfig,r=v.flashCrash||0,x=v.destroy||0,y=v.callback||0,s=v.skipDefault||0,Y;if(s){u.skipDefault=s;}if(r){q.rs.intlStat("UploaderService","Uploader"+uploader.uploaderType+"_FlashCrash");}if(x){p.fire("yuiuploader:destroy");}else{if(!s){t.reposAttachObj("offscreen");}}if(y){w=y;}else{w=function(z){q.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+z.uploaderType);t.uploader=z;z.updateUI&&z.updateUI();};}if(t.prevUploader&&t.prevUploader.uploaderType==q.UPLOADER_TYPE_FORM){Y=t.uploader;t.uploader=t.prevUploader;t.prevUploader=Y;q.type=q.UPLOADER_TYPE_FORM;w(t.uploader);q.logIt("compose-attach: Switch to "+q.type+" uploader (found existing)");}else{t.prevUploader=t.uploader;u.forceForm=1;u.previousType=t.prevUploader&&t.prevUploader.uploaderType;C.use("mail-service-uploader-form",function(){q.create(u,w,q.UPLOADER_TYPE_FORM);});q.type=q.UPLOADER_TYPE_FORM;q.logIt("compose-attach: Switch to "+q.type+" uploader, creating new uploader");}t.prevUploader&&t.prevUploader.detachEvents&&t.prevUploader.detachEvents();}function B(o){var r=this,p=C.mail.UploaderService,Y,q=0;o=o||p.UPLOADER_TYPE_FLASH;p.rs.intlStat("UploaderService","SwitchTo"+o+"Uploader");if(r.prevUploader&&r.prevUploader.uploaderType==o){Y=r.uploader;r.uploader=r.prevUploader;r.prevUploader=Y;p.rs.intlStat("UploaderService","UploaderInstanceSwitchedTo_"+o);p.logIt("compose-attach: Switch to "+o+" uploader");p.type=o;r.uploader.bindEvents&&r.uploader.bindEvents();q=1;}else{p.logIt("compose-attach: switch to "+o+", ERROR - existing uploader not found!!");p.rs.intlStat("UploaderService","Existing"+o+"UploaderNotFound");}return q;}function K(p,Y,o){p.addClass("active");Y&&Y.hasClass("active")&&Y.removeClass("active");o&&o.hasClass("active")&&o.removeClass("active");}function S(o){var u=this,s=C.mail.UploaderService,t=o.text,r=u.type,q=u.tab,Y=u.uiAttBar,p=Y.one(".attachment-button-attach a")||Y.one(".attachment-button-attach i");s.logIt("updateAttachButtonUI");if(r==s.UPLOADER_TYPE_FLASH&&q.getStyle("visibility")=="visible"){u.reposAttachObj("restore");}else{u.reposAttachObj("offscreen");}if(D){s.toggleUploaderUI({type:r,tab:q,attView:u});}!NeoConfig.isFresh&&p.setContent(t);}function k(u){var t=this,p=C.mail.UploaderService,q="#switch-form",Y="#switch-flash",x="#switch-html5",v,o=u.node||C.one("#menu-attach-options"),s=u.flashCrash||0,w=u.destroy||0,r,y,z;p.logIt("toggleUploaderType: form="+u.form+", flash="+u.flash+",html5="+u.html5);if(u.form&&t.type!=p.UPLOADER_TYPE_FORM){p.rs.intlStat("UploaderService","ToggleFormActivated");t.type=p.UPLOADER_TYPE_FORM;t.switchToFormUploader({flashCrash:s,destroy:w});t.updateAttachButtonUI({text:V.str_comp_attach_singular});if(!C.UA.webkit){v=t.tab.all(".lozengeretry");v&&v.addClass("hidden");}o&&K(o.one(q),o.one(Y),o.one(x));}else{if((u.flash&&t.type!=p.UPLOADER_TYPE_FLASH)||(u.html5&&t.type!=p.UPLOADER_TYPE_HTML5)){if(u.flash){r=Y;y=x;z=p.UPLOADER_TYPE_FLASH;}else{r=x;y=Y;z=p.UPLOADER_TYPE_HTML5;}p.rs.intlStat("UploaderService","Toggle"+z+"Activated");o&&K(o.one(r),o.one(q),o.one(y));t.type=z;if(t.switchToUploader(z)){t.updateAttachButtonUI({text:V.str_comp_attach});}else{o&&K(o.one(q),o.one(Y),o.one(x));t.type=p.UPLOADER_TYPE_FORM;}}}}function h(o){var Y=V["str_rte_attachments_bytes"];if(o>1048575){o/=1048576;Y=V["str_rte_attachments_megabyte"];}else{if(o>1023){o/=1024;Y=V["str_rte_attachments_kilobyte"];}}if(isNaN(o)){o=0;}return Math.round(o)+" "+Y;}function N(Y){var r=this,o=r.cdo.get("attachments")[Y],q=o&&o.state||0,p=[];if(q.uploaded&&!q.failed&&!q.cancelled){r.cdo.fire("compose:downloadAttachment",Y);}}function l(t){var s=this,q=s.saveUiBtnStyle,p=t===2?"addClass":"removeClass",r=t>0?"addClass":"removeClass",Y=t>0?"removeClass":"addClass",o=C.one(".yuiUploadBox")||null;if(!s.uploader){return;}if(s.uiAttBtnDisabled&&s.uploader.uploaderType==C.mail.UploaderService.UPLOADER_TYPE_FLASH){s.uiAttBtnDisabled[Y](i);}if(s.uiAttSize){s.uiAttSize[p]("overlimit");}if(s.uiAttBtnForm){s.uiAttBtnForm[r](i);}if(o){if(t>0){if(!q){s.saveUiBtnStyle=o.getAttribute("style");}o.setAttribute("style","position:absolute;top:0;left:0;width:1px;height:1px;");}else{if(typeof q!=="undefined"){o.setAttribute("style",q);}}}}function Z(p){var o=p&&p.state||{},q=p.mimetype||"",Y="";q=unescape(q);if(o.failed){Y="transfer-error ";if(o.failCause=="virus"){Y+="virus ";}}if(q){if(L[q]){Y+=L[q];}else{Y+="no-type";}}else{Y+="no-type";}return Y;}function F(s,v){var w=this,r=C.mail.UploaderService,x=w.uploader&&w.uploader.uploaderType,q=r&&r.UPLOADER_TYPE_FLASH,u="offscreen",Y="restore",o="move",p,t=w.uiAttBar.one("#upload_file_selection");
if(r&&x==q&&w.uiAttBar){p=w.uiAttBar.one("span.attachment-button-attach");if(p.hasClass(i)){p=t;}v=v||p.getXY();if(s==u||w.attachPaneHidden){if(!w.attachXY||w.attachXY[0]!=0||w.attachXY[1]!=0){w.attachXY=[0,0];p.fire("compose:reposAttachObj",{x:0,y:0,resize:true,width:"1px",height:"1px"});D&&p.setStyle("position","absolute");}}else{if((!w.attachXY||v[0]!=w.attachXY[0]||v[1]!=w.attachXY[1])&&(w.type==q||!w.type)){if(D){t.setStyle("position","relative").setStyle("top","auto").setStyle("left","auto");return;}w.attachXY=[v[0],v[1]];if(s==Y){p.fire("compose:reposAttachObj",{x:v[0],y:v[1],resize:true,height:p.getStyle("height"),width:p.getStyle("width")});}else{p.fire("compose:reposAttachObj",{x:v[0],y:v[1],resize:false});}}}}}function U(){var o=this,Y=o.uploader;C.each(o.handles,function(p){p.detach&&p.detach();});o.handles=[];if(Y&&Y.handles){C.each(Y.handles,function(p){p.detach&&p.detach();});Y.handles=[];Y.attView=null;Y.tab.uploader=null;Y.tab=null;delete X.uploadersCreated[Y.id];}if(Y&&Y.checkFlashTimeout){clearTimeout(Y.checkFlashTimeout);}o.toggleUploaderHandle&&o.toggleUploaderHandle.detach();o.toggleUploaderHandle=null;o.uploader=null;o.uiAttForm=null;o.tab=null;o.uiAttBar=null;o.uiRemoveAll=null;o.uiAttCount=null;o.uiAttSize=null;o.uiAttAVLogo=null;o.uiAttMessage=null;o.uiAttBtnForm=null;o.uiAttBtnDisabled=null;o.uiAttPane=null;o.uiAttList=null;o.uiAttWelcome=null;o.uploaderConfig=null;if(NeoConfig.isFresh&&o.attachLargeBtn){o.attachLargeBtn.remove().destroy(true);o.attachLargeBtn=null;}}C.mail.AttachmentView.prototype={setAttachmentStyle:O,addAttachment:R,addNewAttachment:J,removeAttachment:E,enableAttachment:j,downloadAttachment:N,toggleOverLimit:l,updateAttachmentProgress:M,updateSizeAndCount:e,getIconClass:Z,attachError:a,checkOverLimit:I,retryOrSwitchAttachmentMode:g,switchToFormUploader:c,switchToUploader:B,toggleUploaderType:k,updateAttachButtonUI:S,reposAttachObj:F,cleanUp:U};},"1.0.0",{requires:["rocket-stats","swfdetect","mail-service-uploader-utils"]});YUI.add("comms-intl-bidi",function(A){A.mix(A.namespace("Intl"),{_rtlChars:"[\uD83A\uD83B][\uDC00-\uDFFF]|[\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05FF\u0604\u0605\u0608\u060B\u060D\u061B-\u064A\u065F\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070E\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA-\u0815\u081A\u0824\u0828\u082E-\u08FF\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFC\uFDFE\uFDFF\uFE70-\uFEFE]|\uD803[\uDC00-\uDE5F\uDE7F-\uDFFF]|\uD802[\uDC00-\uDD1E\uDD20-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDF38\uDF40-\uDFFF]",_neutralChars:"[\uDB40-\uDB43][\uDC00-\uDFFF]|\uD802[\uDD1F\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDF39-\uDF3F]|\uD804[\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD01\uDD40-\uDD8A\uDD90-\uDD9B\uDDFD]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDD00-\uDD0A]|[\u0000-\u0040\u005B-\u0060\u007B-\u00A9\u00AB-\u00B4\u00B6-\u00B9\u00BB-\u00BF\u00D7\u00F7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u036F\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u0483-\u0489\u058A\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0600-\u0603\u0606\u0607\u0609\u060A\u060C\u060E-\u061A\u064B-\u065E\u0660-\u066C\u0670\u06D6-\u06E4\u06E7-\u06ED\u06F0-\u06F9\u070F\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07F6-\u07F9\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0900-\u0902\u093C\u0941-\u0948\u094D\u0951-\u0955\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u09F2\u09F3\u09FB\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AF1\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0BF3-\u0BFA\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C78-\u0C7E\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0CF1\u0CF2\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E3F\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39-\u0F3D\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F90-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135F\u1390-\u1399\u1400\u1680\u169B\u169C\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DB\u17DD\u17F0-\u17F9\u1800-\u180E\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1940\u1944\u1945\u19DE-\u19FF\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1DC0-\u1DE6\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200D\u2010-\u2070\u2074-\u207E\u2080-\u208E\u20A0-\u20B8\u20D0-\u20F0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189\u2190-\u2335\u237B-\u2394\u2396-\u23E8\u2400-\u2426\u2440-\u244A\u2460-\u249B\u24EA-\u26AB\u26AD-\u26CD\u26CF-\u26E1\u26E3\u26E8-\u26FF\u2701-\u2704\u2706-\u2709\u270C-\u2727\u2729-\u274B\u274D\u274F-\u2752\u2756-\u275E\u2761-\u2794\u2798-\u27AF\u27B1-\u27BE\u27C0-\u27CA\u27CC\u27D0-\u27FF\u2900-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2CEF-\u2CF1\u2CF9-\u2CFF\u2DE0-\u2E31\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u3004\u3008-\u3020\u302A-\u3030\u3036\u3037\u303D-\u303F\u3099-\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA66F-\uA673\uA67C-\uA67F\uA6F0\uA6F1\uA700-\uA721\uA788\uA802\uA806\uA80B\uA825\uA826\uA828-\uA82B\uA838\uA839\uA874-\uA877\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uABE5\uABE8\uABED\uFB1E\uFB29\uFD3E\uFD3F\uFDD0-\uFDEF\uFDFD\uFE00-\uFE19\uFE20-\uFE26\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFF0-\uFFFF]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3\uDFCE-\uDFFF]|\uD834[\uDD67-\uDD69\uDD73-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE00-\uDE45\uDF00-\uDF56]",_initializeBidiPatterns:function(){this._rtlPattern=new RegExp("^(?:"+this._neutralChars+")*(?:"+this._rtlChars+")");this._neturalPattern=new RegExp("^(?:"+this._neutralChars+")*$");},setBidiChars:function(B,C){if(B!==undefined){this._rtlChars=B;}if(C!==undefined){this._neutralChars=C;}this._initializeBidiPatterns();},detectDirection:function(C,B){if(this._rtlPattern.test(C)){return"rtl";}else{if(B==="ltr"){return"ltr";}else{if(this._neturalPattern.test(C)){if(B==="rtl"){return"rtl";}else{return"";}}else{return"ltr";}}}}});A.Intl._initializeBidiPatterns();A.mix(A.namespace("Intl"),{bidiDirection:A.Intl.detectDirection});},"1.0.0");YUI.add("comms-node-setdir",function(B){var A={ltr:"rtl",rtl:"ltr"};B.Node.addMethod("setDirection",function(E,F){var D,C;if(F==="ltr"||F==="rtl"){D=B.one(E);C=D.getStyle("direction");D.setAttribute("dir",F);D.setStyle("direction","");D.removeClass(B.ClassNameManager.getClassName(A[F]));D.addClass(B.ClassNameManager.getClassName(F));if(F!==C){B.fire("directionChange",{target:D,dir:F});}}return D;});},"1.0.0",{requires:["classnamemanager","node-base","node-style"]});YUI.add("comms-bidi-textentry",function(B){function A(){A.superclass.constructor.apply(this,arguments);}A.NS="bidiTextEntry";A.NAME="bidiTextEntry";B.extend(A,B.Plugin.Base,{initializer:function(C){var E=this.get("host"),D;E.BIDI_DISABLED=false;E.PREVIOUS_DIRECTION=E.getStyle("direction");if(!E.PREVIOUS_DIRECTION){E.PREVIOUS_DIRECTION=E.getAttribute("dir");}E.DETECT_DEFAULT_DIRECTION=(C&&C.detect_default_direction===true);if(!E.DETECT_DEFAULT_DIRECTION){E.setDirection(E.PREVIOUS_DIRECTION);}else{D=B.Intl.detectDirection(E.get("value"));E.setDirection(D);E.PREVIOUS_DIRECTION=D;}this.afterHostEvent("valueChange",function(H){var G=this.get("host"),J,I=G.BIDI_DISABLED,F=G.PREVIOUS_DIRECTION,K;if(I){return;}K=G.getAttribute("dir");if(F!=K){G.BIDI_DISABLED=true;return;}J=B.Intl.detectDirection(H.newVal);if(J==="rtl"||J=="ltr"){G.PREVIOUS_DIRECTION=J;}G.setDirection(J);});}});B.namespace("Plugin");B.Plugin.BidiTextEntry=A;B.Plugin.BidiTextInput=A;},"1.0.0",{requires:["plugin","event-valuechange","comms-intl-bidi","comms-node-setdir"]});YUI.add("comms-editor-autobidi",function(D){var B=function(){B.superclass.constructor.apply(this,arguments);},A="host",C="text";D.extend(B,D.Base,{autoBidiOff:false,watchForAction:true,redetectDirection:false,disableAutoBidi:false,throttledFindEmptyParas:null,findEmptyParas:function(){var F=this.get(A).getInstance();if(F){var E=F.Selection.DEFAULT_BLOCK_TAG;if(F.all(E).size()==0){E=B.PARAGRAPHS;}F.all(E).each(function(H){var G=H.get(C);if(G===""||G===" "||G==="\u00A0"){H.setData(B.AUTO_BIDI,true);}});}},_onKeyDown:function(E){if(this.watchForAction&&!(E.crtlKey||E.metaKey)){this.throttledFindEmptyParas();this.watchForAction=false;}},autoBidi:function(J){var I,H,G,F,E;if(((J&&J.keyCode&&!B.NODETECT_KEYS[J.keyCode])||(J&&J.type&&J.type==="paste"))&&!this.autoBidiOff&&!this.disableAutoBidi){I=this.get(A).getInstance();E=I.Selection.DEFAULT_BLOCK_TAG;H=new I.Selection();G=H.anchorNode;if(G&&!(G.test(B.PARAGRAPHS))){G=G.ancestor(B.PARAGRAPHS);}if((G&&G.getData(B.AUTO_BIDI))||(G&&this.redetectDirection)){F=D.Intl.detectDirection(G.get(C));if(F){G.setAttribute("dir",F);G.setData(B.AUTO_BIDI,false);this.redetectDirection=false;}}}},_afterNodeChange:function(E){if(E.changedType==="mouseup"||(E.changedType==="keydown"&&(E.changedEvent.crtlKey||E.changedEvent.metaKey))){this.watchForAction=true;this.redetectDirection=true;}if(B.AFFECTING_EVENTS[E.changedType]){this.watchForAction=true;this.disableAutoBidi=false;}else{if(B.REDIRECTING_EVENTS[E.changedType]&&!this.disableAutoBidi){this.redetectDirection=true;}else{if(E.changedType!="keydown"&&E.changedType!="keyup"){D.later(50,this,this.autoBidi,E.changedEvent);}}}},_disableAutoBidi:function(){this.watchForAction=false;this.disableAutoBidi=true;},_turnAutoBidiOff:function(E){this.autoBidiOff=E.status;},initializer:function(){var E=this.get(A);E.after("nodeChange",D.bind(this._afterNodeChange,this));E.frame.on("dom:keydown",D.bind(this._onKeyDown,this));E.on("disableautobidi",D.bind(this._disableAutoBidi,this));E.on("turnautobidioff",D.bind(this._turnAutoBidiOff,this));this.throttledFindEmptyParas=D.throttle(D.bind(this.findEmptyParas,this),150);}},{PARAGRAPHS:"P, DIV, UL, OL",AUTO_BIDI:"autobidi",AFFECTING_EVENTS:{"enter":true,"backspace":true,"delete":true},REDIRECTING_EVENTS:{"home":true,"left":true,"right":true},NODETECT_KEYS:{8:"backspace",9:"tab",13:"enter",16:"shift",18:"alt",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},NAME:"editorAutoBidi",NS:"editorAutoBidi",ATTRS:{host:{value:false}}});D.namespace("Plugin");D.Plugin.EditorAutoBidi=B;},"1.0.0",{requires:["editor-base","comms-intl-bidi"]});/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("editor-bidi",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)},r="host",i="dir",s="BODY",o="nodeChange",u="bidiContextChange",a=s+" > p",f="style";e.extend(n,e.Base,{lastDirection:null,firstEvent:null,_checkForChange:function(){var e=this.get(r),t=e.getInstance(),i=new t.EditorSelection,s,o;i.isCollapsed?(s=n.blockParent(i.focusNode),s&&(o=s.getStyle("direction"),o!==this.lastDirection&&(e.fire(u,{changedTo:o}),this.lastDirection=o))):(e.fire(u,{changedTo:"select"}),this.lastDirection=null)},_afterNodeChange:function(e){if(this.firstEvent||n.EVENTS[e.changedType])this._checkForChange(),this.firstEvent=!1},_afterMouseUp:function(e){this._checkForChange(),this.firstEvent=!1},initializer:function(){var t=this.get(r);this.firstEvent=!0,t.after(o,e.bind(this._afterNodeChange,this)),t.after("dom:mouseup",e.bind(this._afterMouseUp,this))}},{EVENTS:{"backspace-up":!0,"pageup-up":!0,"pagedown-down":!0,"end-up":!0,"home-up":!0,"left-up":!0,"up-up":!0,"right-up":!0,"down-up":!0,"delete-up":!0},BLOCKS:e.EditorSelection.BLOCKS,DIV_WRAPPER:"<DIV></DIV>",blockParent:function(t,r){var i=t,o,u;return i||(i=e.one(s)),i.test(n.BLOCKS)||(i=i.ancestor(n.BLOCKS)),r&&i.test(s)&&(o=e.Node.create(n.DIV_WRAPPER),i.get("children").each(function(e,t){t===0?u=e:o.append(e)}),u.replace(o),o.prepend(u),i=o),i},_NODE_SELECTED:"bidiSelected",addParents:function(e){var t,r,i;for(t=0;t<e.length;t+=1)e[t].setData(n._NODE_SELECTED,!0);for(t=0;t<e.length;t+=1)r=e[t].get("parentNode"),!r.test(s)&&!r.getData(n._NODE_SELECTED)&&(i=!0,r.get("children").some(function(e){if(!e.getData(n._NODE_SELECTED))return i=!1,!0}),i&&(e.push(r),r.setData(n._NODE_SELECTED,!0)));for(t=0;t<e.length;t+=1)e[t].clearData(n._NODE_SELECTED);return e},NAME:"editorBidi",NS:"editorBidi",ATTRS:{host:{value:!1}},RE_TEXT_ALIGN:/text-align:\s*\w*\s*;/,removeTextAlign:function(e){return e&&(e.getAttribute(f).match(n.RE_TEXT_ALIGN)&&e.setAttribute(f,e.getAttribute(f).replace(n.RE_TEXT_ALIGN,"")),e.hasAttribute("align")&&e.removeAttribute("align")),e}}),e.namespace("Plugin"),e.Plugin.EditorBidi=n,e.Plugin.ExecCommand.COMMANDS.bidi=function(t,s){var o=this.getInstance(),u=new o.EditorSelection,a=this.get(r).get(r).editorBidi,f,l,c,h,p;if(!a){e.error("bidi execCommand is not available without the EditorBiDi plugin.");return}o.EditorSelection.filterBlocks();if(u.isCollapsed){l=n.blockParent(u.anchorNode),l||(l=o.one("body").one(o.EditorSelection.BLOCKS)),l=n.removeTextAlign(l),s||(p=l.getAttribute(i),!p||p=="ltr"?s="rtl":s="ltr"),l.setAttribute(i,s);if(e.UA.ie){var d=l.all("br.yui-cursor");d.size()===1&&l.get("childNodes").size()==1&&d.remove()}f=l}else c=u.getSelected(),h=[],c.each(function(e){h.push(n.blockParent(e))}),h=o.all(n.addParents(h)),h.each(function(e){var t=s;e=n.removeTextAlign(e),t||(p=e.getAttribute(i),!p||p=="ltr"?t="rtl":t="ltr"),e.setAttribute(i,t)}),f=h;return a._checkForChange(),f}},"3.7.2",{requires:["editor-base"]});
YUI.add("_shared_module_rte_well_content_attachments_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_attachments_fresh={base:'<div role="tabpanel" class="attachments-pane gwell rte-pane-fresh shaded" > <div role="toolbar"> <form method="post" enctype="multipart/form-data" class="attachment-button-form" target="" action=""> <span class="btn attachment-button-attach neo-tooltip" title="{{str_comp_attach_singular}}"> <a role="button" href="#" tabindex="-1"></a> <input type="file" id="attachment-button-input" name="uploadfile" class="attachment-button-file" tabindex="0"/> </span><span id="upload_file_selection" class="hidden" title="{{str_comp_attach_singular}}"><span id="uploader-v2"></span></span><span id="attach-btn-menu" class="menu hidden attach-btn-menu" data-action="menu"><a class="neo-tooltip" tabindex="-1" href="#" title="{{str_comp_attach_menu_title_fresh}}"><b>{{str_comp_attach_menu_btn}}</b></a></span> </form> <span class="btn left right menu attachment-button-disabled hidden"> <a role="button" href="#" tabindex="-1" >{{str_comp_attach}}</a> </span> <span role="alert" class="switch-to-basic-link hidden"> {{str_rte_attachments_basic_message}} <a role="button" href="#">{{str_rte_attachments_basic_link_text}}</a>. </span> </div></div>'};},"1.0.0");YUI.add("_shared_module_rte_well_content_format_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_format_fresh={base:'<div role="tabpanel" class="rte-pane-fresh format-pane gwell shaded {{options_signature_rich_else}}"> <div role="toolbar" class="format-inner"> <span id="btn-fontname" class="btn menu" data-action="menu" role="presentation"> <a role="presentation" class="icon neo-tooltip" data-action="rte-well" title="{{str_comp_font_menu_attr_fresh}}" target="fontname" tabindex="-1" href="#" draggable="false"> <i role="presentation" class="plaintext">{{str_comp_font_menu_attr}}</i> </a> </span> <span id="btn-fontsize" class="btn menu" data-action="menu" role="presentation"> <a role="presentation" class="icon neo-tooltip" title="{{str_comp_font_size_attr_fresh}}" data-action="rte-well" target="fontsize" tabindex="-1" href="#" draggable="false"> <i role="presentation" class="plaintext">{{str_comp_font_size_attr}}</i> </a> </span> <span class="btn" data-action="bold"><a role="button" tabindex="0" href="#" class="icon bold neo-tooltip" title="{{str_rte_bold_attr}}" draggable="false"><i>{{str_rte_bold}}</i></a></span><span class="btn" data-action="italic"><a role="button" tabindex="-1" href="#" class="icon italic neo-tooltip" title="{{str_rte_italic_attr_fresh}}" draggable="false"><i>{{str_rte_italic}}</i></a></span><span class="btn" data-action="underline"><a role="button" tabindex="-1" href="#" class="icon underline neo-tooltip" title="{{str_rte_underline_attr}}" draggable="false"><i>{{str_rte_underline}}</i></a></span> {{page_conversation_well}} {{page_compose_email}} {{options_only}} {{spellCheckEnabled}} <span class="btn btn-isPlain last" role="presentation"> <a role="presentation" data-action="rte-well" id="switchtext-plain" class="icon switchtext neo-tooltip" title="{{str_rte_richtext}}" target="plain-text" tabindex="-1" href="#" draggable="false"> <i role="presentation" class="plaintext">{{str_rte_richtext}}</i> </a> </span> <span class="btn btn-isRich last hidden" role="presentation"> <a role="presentation" data-action="rte-well" id="switchtext-rich" class="icon switchtext neo-tooltip" title="{{str_rte_plaintext}}" target="rich-text" tabindex="-1" href="#" draggable="false"> <i role="presentation" class="richtext">{{str_rte_plaintext}}</i> </a> </span> {{/page_compose_email}} </div> </div> ',options_signature_rich_else:"hidden",page_conversation_well:'<span id="btn-forecolor" class="btn menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon color-select neo-tooltip" title="{{str_rte_color_attr_fresh}}" draggable="false"><i style="background-color:{{text_color}};">{{str_rte_color}}</i></a></span> ',is_rtl:'<span id="right_to_left" value="rtl" class="btn" data-action="bidi"><a role="button" tabindex="-1" href="#" class="icon change_rtl neo-tooltip" title="{{str_rte_right_to_left}}" draggable="false"><i>{{str_rte_right_to_left}}</i><b></b></a></span><span id="left-to-right" value="ltr" class="btn right" data-action="bidi"><a role="button" tabindex="-1" href="#" class="icon change_ltr neo-tooltip" title="{{str_rte_left_to_right}}" draggable="false"><i>{{str_rte_left_to_right}}</i><b></b></a></span> ',is_rtl_else:'<span id="left-to-right" value="ltr" class="btn" data-action="bidi"><a role="button" tabindex="-1" href="#" class="icon change_ltr neo-tooltip" title="{{str_rte_left_to_right}}" draggable="false"><i>{{str_rte_left_to_right}}</i><b></b></a></span><span id="right_to_left" value="rtl" class="btn right" data-action="bidi"><a role="button" tabindex="-1" href="#" class="icon change_rtl neo-tooltip" title="{{str_rte_right_to_left}}" draggable="false"><i>{{str_rte_right_to_left}}</i><b></b></a></span> ',bidi:"{{is_rtl}} {{is_rtl_else}} ",page_compose_email:'<span id="btn-forecolor" class="btn menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon color-select neo-tooltip" title="{{str_rte_color_attr_fresh}}" draggable="false"><i style="background-color:{{text_color}};">{{str_rte_color}}</i></a></span><span id="btn-backcolor" class="btn menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon highlight neo-tooltip" title="{{str_rte_hilite_color_attr_fresh}}" draggable="false"><i>{{str_rte_hilite_color}}</i></a></span> <span id="btn-insertunordered" class="btn" data-action="insertunorderedlist"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon bulletlist neo-tooltip" title="{{str_rte_bullet_list_attr_fresh}}" draggable="false"><i>{{str_rte_list}}</i></a></span> <span id="btn-insertnumbered" class="btn" data-action="insertnumberedlist"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon numberlist neo-tooltip" title="{{str_rte_numbered_list_attr_fresh}}" draggable="false"><i>{{str_rte_list}}</i></a></span> <span id="btn-outdent" class="btn" data-action="outdent"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon outdent neo-tooltip" title="{{str_rte_indentation_less_attr}}" draggable="false"><i>{{str_rte_indent}}</i></a></span> <span id="btn-indent" class="btn" data-action="indent"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon indent neo-tooltip" title="{{str_rte_indentation_more_attr}}" draggable="false"><i>{{str_rte_indent}}</i></a></span> <span id="btn-text-align" class="btn" data-action="align-l"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon align-l neo-tooltip" title="{{str_rte_text_left_alignment_attr}}" draggable="false"><i>{{str_rte_align_l}}</i></a></span> <span id="btn-text-align" class="btn" data-action="align-c"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon align-c neo-tooltip" title="{{str_rte_text_center_alignment_attr}}" draggable="false"><i>{{str_rte_align_c}}</i></a></span> <span id="btn-text-align" class="btn" data-action="align-r"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon align-r neo-tooltip" title="{{str_rte_text_right_alignment_attr}}" draggable="false"><i>{{str_rte_align_r}}</i></a></span> {{bidi}} <span id="links" class="btn" data-action="insertlink"><a role="button" tabindex="-1" href="#" class="icon link neo-tooltip" title="{{str_rte_link_attr_fresh}}" draggable="false"><i>{{str_rte_link}}</i></a></span> <span id="emoticon" class="btn menu" data-action="menu" role="presentation"> <a role="presentation" class="icon emoticon neo-tooltip" data-action="rte-well" title="{{str_comp_emoticons}}" target="emoticon" tabindex="-1" href="#" draggable="false"> <i role="presentation" class="plaintext">{{str_comp_emoticons}}</i> </a> </span> <span class="om-buttons"></span> ',options_only:'<span id="btn-forecolor" class="btn menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon color-select neo-tooltip" title="{{str_rte_color_attr_fresh}}" draggable="false"><i style="background-color:{{text_color}};">{{str_rte_color}}</i></a></span><span id="btn-backcolor" class="btn right lg menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon highlight neo-tooltip" title="{{str_rte_hilite_color_attr_fresh}}" draggable="false"><i>{{str_rte_hilite_color}}</i></a></span> <span id="btn-insertunordered" class="btn" data-action="insertunorderedlist"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon bulletlist neo-tooltip" title="{{str_rte_bullet_list_attr_fresh}}" draggable="false"><i>{{str_rte_list}}</i></a></span> <span id="btn-insertnumbered" class="btn" data-action="insertnumberedlist"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon numberlist neo-tooltip" title="{{str_rte_numbered_list_attr_fresh}}" draggable="false"><i>{{str_rte_list}}</i></a></span> <span id="btn-outdent" class="btn" data-action="outdent"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon outdent neo-tooltip" title="{{str_rte_indentation_less_attr}}" draggable="false"><i>{{str_rte_indent}}</i></a></span> <span id="btn-indent" class="btn" data-action="indent"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon indent neo-tooltip" title="{{str_rte_indentation_more_attr}}" draggable="false"><i>{{str_rte_indent}}</i></a></span> <span id="btn-text-align" class="btn menu" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" class="icon align-l down neo-tooltip" title="{{str_rte_text_left_alignment_attr}}" draggable="false"><i>{{str_rte_text_alignment}}</i></a></span> <span id="links" class="btn" data-action="insertlink"><a role="button" tabindex="-1" href="#" class="icon link neo-tooltip" title="{{str_rte_link_attr_fresh}}" draggable="false"><i>{{str_rte_link}}</i></a></span> ',spellCheckEnabled:'<span id="spellCheck" class="btn {{HiddenClassName}}" data-action="spellcheck"><a role="button" tabindex="-1" href="#" class="icon spell neo-tooltip" title="{{str_rte_check_spelling_attr_fresh}}" draggable="false"><i>{{str_rte_check_spelling}}</i></a></span><span class="btn menu{{HiddenClassName}}" id="btn-spell-langs" data-action="menu"><a role="button" aria-haspopup="true" tabindex="-1" href="#" title="{{str_toolbar_spelling_menu_toggle_attr_fresh}}" draggable="false" class="neo-tooltip"><b>{{str_toolbar_spelling_menu_toggle}}</b></a></span> '};
},"1.0.0");YUI.add("_shared_module_rte_well_content_attachments_well_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_attachments_well_fresh={base:'<div class="attachments-well {{page_compose_email_else}} {{browser_plus_attach_else}}"> <div class="attachments-welcome"> {{browser_plus_attach}} </div> <ul role="listbox" aria-live="polite" class="file-attach hidden"> {{file_attach_files}} </ul> <span class="btn left right attachment-button-removeall hidden"> <a role="button" href="#" title="{{str_comp_attach_removeall}}">{{str_comp_attach_removeall}}</a> </span> {{_shared_module_rte_well_content_file_count}} <div role="alert" class="error transfer-error hidden"> <span class="attachmenterror"> {{attachments_error}} </span> </div> </div>',page_compose_email_else:"hidden",attached_files_else:"hidden",browser_plus_attach_else:"simple-upload {{attached_files_else}} ",browser_plus_attach:"<h2>{{str_rte_attachments_attach_files}}</h2> <h3>{{str_rte_attachments_drag_files}}</h3> ",file_attach_files:"{{_shared_module_rte_well_content_attach_item}} ",multiple_files_failed:"{{str_rte_attachments_error_mult}}",multiple_files_failed_else:"{{str_rte_attachments_error_single}}",attachments_error:"{{multiple_files_failed}} {{multiple_files_failed_else}} "};},"1.0.0",{requires:["_shared_module_rte_well_content_attach_item","_shared_module_rte_well_content_file_count"]});YUI.add("_shared_module_rte_well_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_fresh={base:'<div class="rte-well-container">{{_shared_module_rte_well_content_attachments_fresh}}{{_shared_module_rte_well_content_format_fresh}}{{_shared_module_rte_well_content_attachments_well_fresh}}</div>'};},"1.0.0",{requires:["_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_attachments_well_fresh"]});YUI.add("_shared_module_compose_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_fresh={base:'<div class="compose content"> <div class = "composeshim hidden"></div> <table role="presentation" border="0" style="margin:0;width:100%;height:100%;border-spacing:0; border-collapse:collapse;"> <tbody role="presentation"> <tr role="presentation"> <td role="presentation" height="10"> {{global_spearmint_view_else}} {{_shared_module_compose_message_header_fresh}} </td> </tr> <tr role="presentation"> <td role="presentation" height="10">{{_shared_module_rte_well_fresh}}</td> </tr> <tr role="presentation" style="height:100%"> <td role="presentation"> <div style="height:100%" class="compose-message {{page_well_is_open}}">{{_shared_module_compose_message_body}}</div> </td> </tr> </tbody> </table> </div> ',global_spearmint_view_else:" ",page_well_is_open:"rich-text "};},"1.0.0",{requires:["_shared_module_compose_message_header_fresh","_shared_module_rte_well_fresh","_shared_module_compose_message_body"]});YUI.add("_shared_module_toolbar_compose_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_toolbar_compose_fresh={base:'<div id="pagetoolbar" class="{{msgliststate}}" > <span class="bevel_divider"></span> <span class="btn left" id="btn-send" data-action="send"><a href="{{global_url_base}}/minty/page/send-confirm" title="{{str_comp_send_attr}}" draggable="false">{{str_comp_send}}</a></span><span id="btn-cancel-compose" class="btn"><a href="#" data-action="cancelcompose" class="btn-cancel-compose" title="{{str_comp_cancel_attr}}" draggable="false">{{str_comp_cancel}}</a></span><span id="btn-save-draft" class="savedraft btn right {{isDirty}}" data-action="savedraft"><a href="#" title="{{str_comp_savedraft_attr}}" draggable="false">{{str_comp_savetodrafts_fresh}}</a></span> {{global_spearmint_view_else}} <span class="lastsave">{{lastsaved}}</span></div>',isDirty:"disabled",global_spearmint_view_else:" ",lastsaved:"{{str_comp_autosave}}"};},"1.0.0");YUI.add("_shared_module_compose_loading",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_loading={base:'<div id="loadingpane" class="cm-loadingpane"> {{start}} {{slow}} {{error}} {{populate}}</div>',start:"<h2>{{str_comp_loading}}</h2> ",slow:'<h2>{{str_comp_loadslow}} <span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span></h2> ',can_retry:'<span class="btn left right small"><a href="#" class="retryOrigin">{{str_comp_loadretry}}</a></span> ',error:"<h2>{{str_comp_loaderr}} {{can_retry}} </h2> ",populate:"<h2>{{str_comp_loadpopulate}}</h2> "};},"1.0.0");YUI.add("_shared_module_rte_well_content_emoticons_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_emoticons_fresh={base:'<div role="tabpanel" class="emoticons-pane" > <ul role="toolbar"> <li role="button" data-value="emoticon_1*{{str_emoticon_happy}}" data-action="emoticon" class="emoticon_1" title="{{str_emoticon_happy}}" tabindex="0"><a></a></li> <li role="button" data-value="emoticon_2*{{str_emoticon_sad}}" data-action="emoticon" class="emoticon_2" title="{{str_emoticon_sad}}"><a></a></li> <li role="button" data-value="emoticon_3*{{str_emoticon_winking}}" data-action="emoticon" class="emoticon_3" title="{{str_emoticon_winking}}"><a></a></li> <li role="button" data-value="emoticon_4*{{str_emoticon_confused}}" data-action="emoticon" class="emoticon_4" title="{{str_emoticon_confused}}"><a></a></li> <li role="button" data-value="emoticon_5*{{str_emoticon_lovestruck}}" data-action="emoticon" class="emoticon_5" title="{{str_emoticon_lovestruck}}"><a></a></li> <li role="button" data-value="emoticon_6*{{str_emoticon_blushing}}" data-action="emoticon" class="emoticon_6" title="{{str_emoticon_blushing}}"><a></a></li> <li role="button" data-value="emoticon_7*{{str_emoticon_tongue}}" data-action="emoticon" class="emoticon_7" title="{{str_emoticon_tongue}}"><a></a></li> <li role="button" data-value="emoticon_8*{{str_emoticon_kiss}}" data-action="emoticon" class="emoticon_8" title="{{str_emoticon_kiss}}"><a></a></li> <li role="button" data-value="emoticon_9*{{str_emoticon_broken_heart}}" data-action="emoticon" class="emoticon_9" title="{{str_emoticon_broken_heart}}"><a></a></li> <li role="button" data-value="emoticon_10*{{str_emoticon_sigh}}" data-action="emoticon" class="emoticon_10" title="{{str_emoticon_sigh}}"><a></a></li> <li role="button" data-value="emoticon_11*{{str_emoticon_wits_end}}" data-action="emoticon" class="emoticon_11" title="{{str_emoticon_wits_end}}"><a></a></li> <li role="button" data-value="emoticon_12*{{str_emoticon_surprise}}" data-action="emoticon" class="emoticon_12" title="{{str_emoticon_surprise}}"><a></a></li> <li role="button" data-value="emoticon_13*{{str_emoticon_angry}}" data-action="emoticon" class="emoticon_13" title="{{str_emoticon_angry}}"><a></a></li> <li role="button" data-value="emoticon_14*{{str_emoticon_cool}}" data-action="emoticon" class="emoticon_14" title="{{str_emoticon_cool}}"><a></a></li> <li role="button" data-value="emoticon_15*{{str_emoticon_devil}}" data-action="emoticon" class="emoticon_15" title="{{str_emoticon_devil}}"><a></a></li> <li role="button" data-value="emoticon_16*{{str_emoticon_crying}}" data-action="emoticon" class="emoticon_16" title="{{str_emoticon_crying}}"><a></a></li> <li role="button" data-value="emoticon_17*{{str_emoticon_straight_face}}" data-action="emoticon" class="emoticon_17" title="{{str_emoticon_straight_face}}"><a></a></li> <li role="button" data-value="emoticon_18*{{str_emoticon_raised_eyebrows}}" data-action="emoticon" class="emoticon_18" title="{{str_emoticon_raised_eyebrows}}"><a></a></li> <li role="button" data-value="emoticon_19*{{str_emoticon_angel}}" data-action="emoticon" class="emoticon_19" title="{{str_emoticon_angel}}"><a></a></li> <li role="button" data-value="emoticon_20*{{str_emoticon_nerd}}" data-action="emoticon" class="emoticon_20" title="{{str_emoticon_nerd}}"><a></a></li> <li role="button" data-value="emoticon_21*{{str_emoticon_phbbbbt}}" data-action="emoticon" class="emoticon_21" title="{{str_emoticon_phbbbbt}}"><a></a></li> <li role="button" data-value="emoticon_22*{{str_emoticon_wave}}" data-action="emoticon" class="emoticon_22" title="{{str_emoticon_wave}}"><a></a></li> <li role="button" data-value="emoticon_23*{{str_emoticon_rolling_eyes}}" data-action="emoticon" class="emoticon_23" title="{{str_emoticon_rolling_eyes}}"><a></a></li> <li role="button" data-value="emoticon_24*{{str_emoticon_sick}}" data-action="emoticon" class="emoticon_24" title="{{str_emoticon_sick}}"><a></a></li> <li role="button" data-value="emoticon_25*{{str_emoticon_shh}}" data-action="emoticon" class="emoticon_25" title="{{str_emoticon_shh}}"><a></a></li> <li role="button" data-value="emoticon_26*{{str_emoticon_party}}" data-action="emoticon" class="emoticon_26" title="{{str_emoticon_party}}"><a></a></li> <li role="button" data-value="emoticon_27*{{str_emoticon_yawn}}" data-action="emoticon" class="emoticon_27" title="{{str_emoticon_yawn}}"><a></a></li> <li role="button" data-value="emoticon_28*{{str_emoticon_thinking}}" data-action="emoticon" class="emoticon_28" title="{{str_emoticon_thinking}}"><a></a></li> <li role="button" data-value="emoticon_29*{{str_emoticon_laughing}}" data-action="emoticon" class="emoticon_29" title="{{str_emoticon_laughing}}"><a></a></li> <li role="button" data-value="emoticon_30*{{str_emoticon_rofl}}" data-action="emoticon" class="emoticon_30" title="{{str_emoticon_rofl}}"><a></a></li> <li role="button" data-value="emoticon_31*{{str_emoticon_big_grin}}" data-action="emoticon" class="emoticon_31" title="{{str_emoticon_big_grin}}"><a></a></li> <li role="button" data-value="emoticon_32*{{str_emoticon_cowboy}}" data-action="emoticon" class="emoticon_32" title="{{str_emoticon_cowboy}}"><a></a></li> <li role="button" data-value="emoticon_33*{{str_emoticon_wasnt_me}}" data-action="emoticon" class="emoticon_33" title="{{str_emoticon_wasnt_me}}"><a></a></li> <li role="button" data-value="emoticon_34*{{str_emoticon_batting_eyelashes}}" data-action="emoticon" class="emoticon_34" title="{{str_emoticon_batting_eyelashes}}"><a></a></li> <li role="button" data-value="emoticon_35*{{str_emoticon_big_hug}}" data-action="emoticon" class="emoticon_35" title="{{str_emoticon_big_hug}}"><a></a></li> <li role="button" data-value="emoticon_36*{{str_emoticon_smug}}" data-action="emoticon" class="emoticon_36" title="{{str_emoticon_smug}}"><a></a></li> <li role="button" data-value="emoticon_37*{{str_emoticon_worried}}" data-action="emoticon" class="emoticon_37" title="{{str_emoticon_worried}}"><a></a></li> <li role="button" data-value="emoticon_38*{{str_emoticon_whew}}" data-action="emoticon" class="emoticon_38" title="{{str_emoticon_whew}}"><a></a></li> <li role="button" data-value="emoticon_39*{{str_emoticon_talk_to_the_hand}}" data-action="emoticon" class="emoticon_39" title="{{str_emoticon_talk_to_the_hand}}"><a></a></li> <li role="button" data-value="emoticon_40*{{str_emoticon_sleepy}}" data-action="emoticon" class="emoticon_40" title="{{str_emoticon_sleepy}}"><a></a></li> <li role="button" data-value="emoticon_41*{{str_emoticon_loser}}" data-action="emoticon" class="emoticon_41" title="{{str_emoticon_loser}}"><a></a></li> <li role="button" data-value="emoticon_42*{{str_emoticon_not_talking}}" data-action="emoticon" class="emoticon_42" title="{{str_emoticon_not_talking}}"><a></a></li> <li role="button" data-value="emoticon_43*{{str_emoticon_on_the_phone}}" data-action="emoticon" class="emoticon_43" title="{{str_emoticon_on_the_phone}}"><a></a></li> <li role="button" data-value="emoticon_44*{{str_emoticon_daydreaming}}" data-action="emoticon" class="emoticon_44" title="{{str_emoticon_daydreaming}}"><a></a></li> <li role="button" data-value="emoticon_45*{{str_emoticon_clown}}" data-action="emoticon" class="emoticon_45" title="{{str_emoticon_clown}}"><a></a></li> <li role="button" data-value="emoticon_46*{{str_emoticon_silly}}" data-action="emoticon" class="emoticon_46" title="{{str_emoticon_silly}}"><a></a></li> <li role="button" data-value="emoticon_47*{{str_emoticon_drooling}}" data-action="emoticon" class="emoticon_47" title="{{str_emoticon_drooling}}"><a></a></li> <li role="button" data-value="emoticon_48*{{str_emoticon_doh}}" data-action="emoticon" class="emoticon_48" title="{{str_emoticon_doh}}"><a></a></li> <li role="button" data-value="emoticon_49*{{str_emoticon_applause}}" data-action="emoticon" class="emoticon_49" title="{{str_emoticon_applause}}"><a></a></li> <li role="button" data-value="emoticon_50*{{str_emoticon_nail_biting}}" data-action="emoticon" class="emoticon_50" title="{{str_emoticon_nail_biting}}"><a></a></li> <li role="button" data-value="emoticon_51*{{str_emoticon_hypnotized}}" data-action="emoticon" class="emoticon_51" title="{{str_emoticon_hypnotized}}"><a></a></li> <li role="button" data-value="emoticon_52*{{str_emoticon_liar}}" data-action="emoticon" class="emoticon_52" title="{{str_emoticon_liar}}"><a></a></li> <li role="button" data-value="emoticon_53*{{str_emoticon_waiting}}" data-action="emoticon" class="emoticon_53" title="{{str_emoticon_waiting}}"><a></a></li> <li role="button" data-value="emoticon_54*{{str_emoticon_call_me}}" data-action="emoticon" class="emoticon_54" title="{{str_emoticon_call_me}}"><a></a></li> <li role="button" data-value="emoticon_57*{{str_emoticon_cheer}}" data-action="emoticon" class="emoticon_57" title="{{str_emoticon_cheer}}"><a></a></li> <li role="button" data-value="emoticon_58*{{str_emoticon_dizzy}}" data-action="emoticon" class="emoticon_58" title="{{str_emoticon_dizzy}}"><a></a></li> <li role="button" data-value="emoticon_59*{{str_emoticon_cook}}" data-action="emoticon" class="emoticon_59" title="{{str_emoticon_cook}}"><a></a></li> <li role="button" data-value="emoticon_60*{{str_emoticon_eat}}" data-action="emoticon" class="emoticon_60" title="{{str_emoticon_eat}}"><a></a></li> <li role="button" data-value="emoticon_61*{{str_emoticon_give_up}}" data-action="emoticon" class="emoticon_61" title="{{str_emoticon_give_up}}"><a></a></li> <li role="button" data-value="emoticon_62*{{str_emoticon_cold}}" data-action="emoticon" class="emoticon_62" title="{{str_emoticon_cold}}"><a></a></li> <li role="button" data-value="emoticon_63*{{str_emoticon_hot}}" data-action="emoticon" class="emoticon_63" title="{{str_emoticon_hot}}"><a></a></li> <li role="button" data-value="emoticon_64*{{str_emoticon_music}}" data-action="emoticon" class="emoticon_64" title="{{str_emoticon_music}}"><a></a></li> <li role="button" data-value="emoticon_65*{{str_emoticon_puke}}" data-action="emoticon" class="emoticon_65" title="{{str_emoticon_puke}}"><a></a></li> <li role="button" data-value="emoticon_66*{{str_emoticon_sing}}" data-action="emoticon" class="emoticon_66" title="{{str_emoticon_sing}}"><a></a></li> <li role="button" data-value="emoticon_67*{{str_emoticon_catch}}" data-action="emoticon" class="emoticon_67" title="{{str_emoticon_catch}}"><a></a></li> <li role="button" data-value="emoticon_68*{{str_emoticon_exercise}}" data-action="emoticon" class="emoticon_68" title="{{str_emoticon_exercise}}"><a></a></li> <li role="button" data-value="emoticon_69*{{str_emoticon_high_five}}" data-action="emoticon" class="emoticon_69" title="{{str_emoticon_high_five}}"><a></a></li> <li role="button" data-value="emoticon_70*{{str_emoticon_play_game}}" data-action="emoticon" class="emoticon_70" title="{{str_emoticon_play_game}}"><a></a></li> <li role="button" data-value="emoticon_71*{{str_emoticon_search_me}}" data-action="emoticon" class="emoticon_71" title="{{str_emoticon_search_me}}"><a></a></li> <li role="button" data-value="emoticon_72*{{str_emoticon_spooky}}" data-action="emoticon" class="emoticon_72" title="{{str_emoticon_spooky}}"><a></a></li> <li role="button" data-value="emoticon_73*{{str_emoticon_studying}}" data-action="emoticon" class="emoticon_73" title="{{str_emoticon_studying}}"><a></a></li> <li role="button" data-value="emoticon_74*{{str_emoticon_tv}}" data-action="emoticon" class="emoticon_74" title="{{str_emoticon_tv}}"><a></a></li> <li role="button" data-value="emoticon_75*{{str_emoticon_gift}}" data-action="emoticon" class="emoticon_75" title="{{str_emoticon_gift}}"><a></a></li> <li role="button" data-value="emoticon_76*{{str_emoticon_unlucky}}" data-action="emoticon" class="emoticon_76" title="{{str_emoticon_unlucky}}"><a></a></li> <li role="button" data-value="emoticon_77*{{str_emoticon_down_on_luck}}" data-action="emoticon" class="emoticon_77" title="{{str_emoticon_down_on_luck}}"><a></a></li> <li role="button" data-value="emoticon_78*{{str_emoticon_fight}}" data-action="emoticon" class="emoticon_78" title="{{str_emoticon_fight}}"><a></a></li> </ul></div>'};
},"1.0.0");YUI.add("_shared_module_rte_well_content_fontname_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_fontname_fresh={base:'<div id="menu-fontname" class="optionMenu"> <ul> {{intl_fonts}} <li data-action="fontname" data-value="{{str_rte_font_arial_attr}}"><a href="#"><span>{{str_rte_font_arial}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_tahoma_attr}}"><a href="#"><span>{{str_rte_font_tahoma}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_verdana_attr}}"><a href="#"><span>{{str_rte_font_verdana}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_times_attr}}"><a href="#"><span>{{str_rte_font_times}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_bookman_attr}}"><a href="#"><span>{{str_rte_font_bookman}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_courier_attr}}"><a href="#"><span>{{str_rte_font_courier}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_garamond_attr}}"><a href="#"><span>{{str_rte_font_garamond}}</span></a></li> <li data-action="fontname" data-value="{{str_rte_font_lucida_attr}}"><a href="#"><span>{{str_rte_font_lucida}}</span></a></li> </ul></div>',intl_fonts:'<li data-action="fontname" data-value="{{font_value}}"><a href="#"><span>{{font_name}}</span></a></li> '};},"1.0.0");YUI.add("_shared_module_rte_well_content_fontsize_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_content_fontsize_fresh={base:'<div id="menu-fontsize" class="optionMenu"> <ul> <li data-action="fontsize" data-value="1"><a href="#"><span>8</span></a></li> <li data-action="fontsize" data-value="2"><a href="#"><span>10</span></a></li> <li data-action="fontsize" data-value="3"><a href="#"><span>12</span></a></li> <li data-action="fontsize" data-value="4"><a href="#"><span>14</span></a></li> <li data-action="fontsize" data-value="5"><a href="#"><span>18</span></a></li> <li data-action="fontsize" data-value="6"><a href="#"><span>24</span></a></li> <li data-action="fontsize" data-value="7"><a href="#"><span>36</span></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_rte_well_tabs_compose_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_tabs_compose_fresh={base:'<div class="rte"> <ul role="tablist" aria-describedby="tablist-instr"> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_list={base:'<div id="menu-list" class="optionMenu"> <ul> <li data-action="insertunorderedlist"><a href="#" title="{{str_rte_bullet_list_attr}}"><span>{{str_rte_bullet_list}}</span></a></li> <li data-action="insertnumberedlist"><a href="#" title="{{str_rte_numbered_list_attr}}"><span>{{str_rte_numbered_list}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_text_align",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_text_align={base:'<div id="menu-text-align" class="optionMenu"> <ul> <li data-action="align-l"><a href="#"><span>{{str_rte_align_l}}</span></a></li> <li data-action="align-c"><a href="#"><span>{{str_rte_align_c}}</span></a></li> <li data-action="align-r"><a href="#"><span>{{str_rte_align_r}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("tictac-attach-utils",function(a){var b=a.Array.hash(["uploadFileSizeError","uploadNoFileError","uploadAVCannotClean","uploadAVHasVirus","uploadInternalError","uploadMailboxError","uploadPartialFileError","uploadAuthError"]),c=a.Array.hash(["uploadAVInternalError","uploadAVError","uploadAVServerDown","uploadAVCleaned"]),d=a.Array.hash(["uploadAVNoVirus","uploadAVNotScannable"]),e=a.merge(b,d);a.namespace("tictac.attach").Utils={configure:function(b,c){var d=!0;return a.each(c,function(c,e){a.Object.owns(b,e)||(d=!1,a.log("Invalid conf key: "+e))}),d?(a.mix(b,c,!0),!0):!1},trackClick:function(b,c){var d={action:b};c&&(d.append=c),a.fire("mt:click",d)},isSvrResponseRecognized:function(a){return!!e[a]},isSvrResponseWarning:function(a){return!!c[a]},isSvrResponseSuccess:function(a){return!!d[a]}}},"2.0",{requires:["node","json"]}),YUI.add("tictac-attach-main",function(a){function j(a){var c=this,d=c.getPreferredUploaderClassName(),e=function(){c.switchUploaderType.apply(c,arguments)};return arguments.length>1&&(a={tray:arguments[0],attach:arguments[1],attachContainer:arguments[2],dropArea:arguments[3],dropbox:arguments[4],rte:arguments[5],username:arguments[6],attachOption:arguments[7],attachMenuSelector:arguments[8]}),f(b.UploaderHTML5.conf,b.Stats.makeStatConf()),f(b.UploaderForm.conf,b.Stats.makeStatConf()),f(b.Controller.conf,b.Stats.makeStatConf()),c.btnNode=a.attach,c.btnContainer=a.attachContainer,c.dropArea=a.dropArea,c.btnAttachCloud=c.configDropbox(a.dropbox),c.model=new b.model.Attachments,c.uploader=c.createUploader(d),c.controller=new b.Controller(c.uploader,c.model,e),c.view=new b.View(c.model,c.controller,a),c.uploader.render(a.attachContainer),c.view.render(),c.stat=b.Controller.conf.stat,c.attachMenuSelector=a.attachMenuSelector,c.btnAttachOption=c.configAttachOpt(a.attachOption),c}var b=a.tictac.attach,c=a.Tictac.base.utils,d=c.getVal,e=b.strings,f=b.Utils.configure,g,h=!1,i=c.log;j.prototype={configDropbox:function(b){var e=this;return b&&a.Tictac.att.filter.hasDropboxEnabled()&&c.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-controller",function(a){b.one("a").on("click",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),g=d(a,"Tictac.dropbox.strings"),b.one("a").set("text",g.str_share_from_db),a.on("compose:dropbox:chooser",function(){a.Tictac.dropbox.controller.attachFrom(e.model)}),a.fire("compose:dropbox:ready")}),b},configAttachOpt:function(b){var c=this,d;return c.attachMenuSelector=c.attachMenuSelector+":last-of-type",b&&(b.one("a").once("click",function(){d=a.one(c.attachMenuSelector),d.on("menuSelected",function(){c.uploader.simulateClick()})}),b.one("a").set("text",e.str_attach_opt_menu)),b},cleanup:function(){var a=this;a.btnNode.remove(!0),a.btnContainer.remove(!0),a.uploader.cleanup(),a.controller.cleanup(),a.view.cleanup(),a.model.cleanup()},getPreferredUploaderClassName:function(){var b=a.UA.chrome>=8||a.UA.gecko>=4||a.UA.safari>=536.25||a.UA.ie>=10;return!h&&b?"HTML5":"Form"},createUploader:function(a){return new b["Uploader"+a]({dropArea:this.dropArea,selectFilesButton:this.btnNode.cloneNode(!0)})},switchUploaderType:function(a){function f(){i("switching uploader type to "+d),c.uploader.cleanup(),c.btnContainer.all("*").each(function(a){a.remove(!0)}),d=="Form"&&(c.forceFormUploader=!0),c.uploader=c.createUploader(d),c.controller.setUploader(c.uploader),c.uploader.render(c.btnContainer),c.stat("ToggleFormActivated")}var c=this,d=c.uploader.type=="HTML5"?"Form":"HTML5";return a?b.Neo.alert(e.str_attach_form_fallback_dialog_title,e.str_attach_form_fallback_dialog_body,f):f()}},f(b.UploaderHTML5.conf,b.Neo.makeHTML5UploaderConf()),f(b.Controller.conf,b.Neo.makeControllerConf()),a.namespace("tictac.attach").AttachmentComposer=j},"1.0.0",{requires:["tictac-att-filter","tictac-attach-neo","tictac-attach-stats","tictac-attach-model-attachments","tictac-attach-view","tictac-attach-controller","tictac-attach-uploader-form","tictac-attach-uploader-html5","tictac-attach-strings","tictac-attach-utils","tictac-base-utils"]}),YUI.add("tictac-attach-controller",function(a){function k(a){return parseInt(c(a,"size","0"),10)||0}function l(a,b,c){var d=this;d.uploader=a,d.model=b,d.switchUploaderType=c,d.getDownloadInfo=i.getDownloadInfo,d.aidsByFids={},d.evtHandles=[],d.setUploader(a)}function m(b,c){var d;return a.Object.some(b.aidsByFids,function(a,b){return a==c?(d=b,!0):!1}),d}function n(a,b,c){return a.model.checkId(c)?!1:(d("aborting "+b+" on "+c),!0)}function o(a,b,c){function f(){a.model.set(b.id,"thumbnail",c),d(c)}var e=new Image;e.src=c;if(e.complete){f();return}e.onload=f,a.thumbnailRequests.push(e)}var b=a.Tictac.base.utils,c=b.getVal,d=b.log,e=b.verify,f=5,g=3e4,h=2e3,i={download:null,stat:function(){d("stat not conf'ed.")},getDownloadInfo:null,getMsg:null,thumbnails:window.location.href.indexOf("joecomotion")!==-1},j=function(a,b){i.stat("controller_"+a,b)};l.prototype={setUploader:function(a){var b=this;b.uploader=a,b.evtHandles=b.evtHandles.concat([a.on("fileselect",b.fileselect,b),a.on("fileuploadstart",b.fileuploadstart,b),a.on("filedrop",b.filedrop,b),a.on("uploadprogress",b.uploadprogress,b),a.on("uploadcomplete",b.uploadcomplete,b),a.on("uploaderror",b.uploaderror,b),a.on("uploadcancel",b.uploadcancel,b),a.on("uploadfatalerror",b.uploadfatalerror,b),a.on("attachbuttonclick",b.attachButtonClick,b)]),b.thumbnailRequests=[]},uploadfatalerror:function(){var a=this;e(a.uploader.type=="HTML5","controller only handles fatal errors for HTML5"),a.deleteAttachments(),a.switchUploaderType(!0)},attachButtonClick:function(){this.trackClick("cmps_attfl",{t1:"cmpsTb"})},startUpload:function(b,c,d){var e=this;a.Array.each(c,function(a){var b={filename:a.name,size:k(a),hasProgress:a.hasProgress};d&&(b.dropbox={alf:!0},j("db_upload_start",{count:1,size:b.size})),e.aidsByFids[a.id]=e.model.add(b,!0)}),e.model.commit(),e.uploader.startUpload(b,d)},fileselect:function(b){var e=this,f=e.model,g=b.fileList,h=0,i=0,j=c(a,"Tictac.dropbox.controller");d("controller fileselect",g),h=a.Array.reduce(g,0,function(a,b){var c=k(b);return i=Math.max(i,c),a+c});if(j&&j.dialogIfTooBig(i,g.length>1))return;if(j&&!f.willFit(h)){j.attachLargeFiles(g.length>1,e.model,e,function(a){e.startUpload(b,g,a)});return}if(f.precheckQuota(g.length,h))return;e.startUpload(b,g)},fileuploadstart:function(a){var b=a.file,c=this,e=c.aidsByFids[b.id],f=c.model,g=f.get(e);if(n(c,"fileuploadstart",e))return;g.uploadStartTime||(g.uploadStartTime=(new Date).getTime()),c.model.setUploadState(e,{state:"started"}),d("controller fileuploadstart",b)},filedrop:function(a){this.trackClick("att_cmps_dnd_mlti",{ltxt:a.numberOfFiles})},uploadprogress:function(a){var b=a.file,c=this,d=c.aidsByFids[b.id];if(n(c,"uploadprogress",d))return;c.model.set(d,"progress",b.percentLoaded)},uploadcomplete:function(b){var c=b.file,e=this,f=e.model,g=e.aidsByFids[c.id],h;if(n(e,"uploadcomplete",g))return;d("controller uploadcomplete",b),h=f.get(g);if(a.Lang.isNumber(c.size)){if(e.uploader.type=="FORM"&&!f.willFit(c.size)){e.handleFormSizeViolation(g);return}h.size=c.size}h.diskfilename=c.diskfilename,h.setMimeType(c.mimetype),h.retryCount>0&&j("controller_uploadretrysuccess"),h.isDropbox()&&c.dropboxLink&&(h.dropbox.link=c.dropboxLink,j("db_upload_success",{count:1,size:c.size})),e.model.setUploadState(g,{state:"success",reason:c.reason}),!h.isDropbox()&&h.isImage()&&e.updateThumbnailURLs()},uploaderror:function(a){var b=a.file,c=this,e=c.aidsByFids[b.id],i=c.model,k=i.get(e),l=c.uploader,m=(new Date).getTime()-k.uploadStartTime;if(!k.isDropbox()&&a.transferFailed&&l.retryUpload&&(k.retryCount===0||m<g&&k.retryCount<f)){k.retryCount++,setTimeout(function(){l.retryUpload(b.id)},h);return}d("controller uploaderror",a),l.type=="HTML5"&&a.transferFailed&&j("uploaderror"),k.isDropbox()&&j("db_upload_failure",{count:1,size:b.size});if(l.type=="FORM"&&b.reason=="uploadFileSizeError"){c.handleFormSizeViolation(e);return}i.setUploadState(e,{state:"failed",reason:b.reason})},uploadcancel:function(a){var b=a.file,c=this,f=c.aidsByFids[b.id];e(!c.model.checkId(f),"Unexpected uploadcancel: "+b.id),d("got uploadcancel")},cancelUploadsInProgress:function(){var b=this,c;a.Array.each(b.model.getAll(),function(a){c=m(b,a.id),c&&!a.isUploadDone()&&(d("cancelling upload: "+a.id+" (fid: "+c+")"),b.uploader.cancel(c),b.model.setUploadState(a.id,{state:"failed",reason:"cancelled"}))})},deleteAttachments:function(b){var c=this,d=0;return a.Array.each(this.model.getAll(!0),function(a){if(b&&!b(a))return;c.deleteAttachment(a.id),d+=1}),d},deleteAttachment:function(a){var b=this,c=this.model.get(a),d=m(b,a);b.model.del(a),d&&(c.isUploadDone()||b.uploader.cancel(d),delete b.aidsByFids[d])},retryAttachment:function(a){var b=this;b.uploader.type=="HTML5"&&(b.cancelUploadsInProgress(),b.switchUploaderType(!1)),b.deleteAttachment(a),b.uploader.simulateClick()},trackClick:function(){a.tictac.attach.Utils.trackClick.apply(this,arguments)},cleanup:function(){var b=this;b.thumbnailTimer&&b.thumbnailTimer.cancel(),a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,a.each(b.thumbnailRequests,function(a){a.onload=null}),delete b.thumbnailRequests},handleFormSizeViolation:function(b){var d=this,e=d.model,f=c(a,"Tictac.dropbox.controller"),g=1,h=m(d,b);delete d.aidsByFids[h],e.del(b),g+=d.deleteAttachments(function(a){return!a.isDropbox()&&!a.isUploadDone()});if(!f){e.fireQuotaViolation({size:!0});return}f.attachLargeFiles(g>1,e,d)},updateThumbnailURLs:function(){var b=this,c=3e3,e;if(!i.getMsg)return;if(!i.thumbnails)return;if(b.thumbnailTimer)return;if(b.awaitingGetMsgResponse){b.thumbnailTimer=a.later(c,this,function(){b.thumbnailTimer=null,b.updateThumbnailURLs()});return}b.awaitingGetMsgResponse=!0,e=b.model.getAll(),i.getMsg(function(c){var f=c.attachments,g;b.awaitingGetMsgResponse=!1;if(!f||!a.Lang.isArray(f))return;a.Array.each(f,function(c,f){if(!c.thumbnailurl)return;if(f>=e.length)return;g=e[f];if(g.filename!==a.Lang.trim(c.filename)){d("msg and model atts name mismatch");return}g&&g.isUploadValid()&&!g.thumbnail&&o(b,g,c.thumbnailurl)})})}},a.augment(l,a.EventTarget),a.namespace("tictac.attach").Controller=l,a.namespace("tictac.attach.Controller").conf=i},"1.0.0",{requires:["tictac-attach-neo","tictac-attach-uploader-form","tictac-attach-model-attachments","tictac-attach-utils","tictac-base-stats","tictac-base-utils"]}),YUI.add("tictac-attach-model-attachments",function(a){function h(){var a=this;return a.map={},a.quotaViolation={},a.evts=[a.publish("added"),a.publish("updated"),a.publish("deleted"),a.publish("emptied"),a.publish("failures"),a.publish("quota",{emitFacade:!0}),a.publish("commit")],a}var b=a.tictac.attach.model.Attachment,c=a.Tictac.base.utils.verify,d=a.Tictac.base.utils.log,e=a.tictac.attach.Utils.isSvrResponseWarning,f=0,g={MAX_BYTES:26214400,MAX_COUNT:25};h.prototype={cleanup:function(){a.each(this.evts,function(a){a.detachAll()})},checkId:function(a){return this.map.hasOwnProperty(a)},sizeInBytes:function(b){return a.Array.reduce(a.Object.values(this.map),0,function(a,c){return!b&&c.isDropbox()?a:a+c.size})},count:function(b){return b=b||function(a){return!a.isDropbox()},a.Array.reduce(a.Object.values(this.map),0,function(a,c){return a+(b(c)?1:0)})},numFailures:function(){return a.Array.reduce(a.Object.values(this.map),0,function(a,b){return a+(b.uploadState=="failed"?1:0)})},numFailuresAndWarnings:function(){return a.Array.reduce(a.Object.values(this.map),0,function(a,b){return a+(b.uploadState=="failed"||e(b.reason)?1:0)})},areSendable:function(){return!a.Array.some(a.Object.values(this.map),function(a){return a.uploadState!=="success"})},areAnyUploading:function(){return a.Array.some(a.Object.values(this.map),function(a){return a.uploadState==="started"||a.uploadState==="queued"})},areAnyInfected:function(){return a.Array.some(a.Object.values(this.map),function(a){return!a.isVirusFree()})},areAllWarningOrSuccess:function(){return a.Array.every(a.Object.values(this.map),function(a){return a.uploadState==="success"||e(a.reason)})},areAllUploadsDone:function(){return!a.Array.some(a.Object.values(this.map),function(a){return!a.isUploadDone()})},precheckQuota:function(a,b,c){var d=this,e={};return d.sizeInBytes()+b>g.MAX_BYTES&&(e.size=!0),d.count()+a>g.MAX_COUNT&&(e.count=!0),!e.count&&!e.size?!1:(c||d.fireQuotaViolation(e),!0)},willFit:function(a){return!this.precheckQuota(0,a,!0)},add:function(a,c){var d=this,e,g;return f+=1,e="ATT_"+f,g=new b(e,a),d.map[e]=g,d.fire("added",g),c||d.fire("commit"),d.checkQuota(),e},get:function(a){var b=this;if(b.checkId(a))return b.map[a];throw["Bad attachment id (",a,"), deleted?"].join("")},getAll:function(b){var c=a.Object.values(this.map);return b||(c=a.Array.filter(c,function(a){return!a.isDropbox()})),c.sort(function(a,b){var c=parseInt(a.id.substr(4),10),d=parseInt(b.id.substr(4),10);return c-d})},order:function(b){var d=this.getAll(),e;return c(this.checkId(b),"id not valid in order: "+b),a.Array.some(d,function(a,c){return a.id!=b?!1:(e=c,!0)}),e},del:function(a,b){var c=this,d=c.get(a);delete c.map[a],c.fire("deleted",d),b||c.fire("commit"),c.count()||c.fire("emptied"),c.checkQuota(),c.fire("failures",c.numFailuresAndWarnings())},commit:function(){this.fire("commit")},delDownToQuota:function(){var a=this,b=a.getAll(),c;for(c=b.length-1;c>=0;c-=1){if(!a.isQuotaViolated())return;a.del(b[c].id)}},isQuotaViolated:function(){var a=this;return a.quotaViolation.size||a.quotaViolation.count},setUploadState:function(a,b){var c=this,e;if(!c.checkId(a)){d("aborting setUploadState on "+a);return}e=c.get(a),e.setUploadState(b.state,b.reason),c.fire("updated",e),b.squelchCommit||c.fire("commit"),c.checkQuota(),b.state!=="started"&&c.fire("failures",c.numFailuresAndWarnings())},set:function(b,d,e){var f=this,g=f.get(b);c(a.Object.owns(g,d),"Invalid field:"+d),g[d]=e,f.fire("updated",g)},findDropbox:function(b){var c=this,d=null,e=c.getAll(!0);return a.Array.some(e,function(a){return a.isDropbox()&&a.dropbox.link===b.link?(d=a,!0):!1}),d},fireQuotaViolation:function(a){this.fire("quota",{violation:a})}},a.mix(h.prototype,{checkQuota:function(){var a=this,b={};a.sizeInBytes()>g.MAX_BYTES&&(b.size=!0),a.count()>g.MAX_COUNT&&(b.count=!0);if(a.quotaViolation.size==b.size&&a.quotaViolation.count==b.count)return;a.quotaViolation=b,a.fireQuotaViolation(b)}}),a.namespace("tictac.attach.model").Attachments=h,a.namespace("tictac.attach.model.Attachments").conf=g,a.augment(h,a.EventTarget,!0,null,{prefix:"attachments"})},"1.0.0",{requires:["array-extras","event-custom","tictac-base-utils","tictac-attach-model-attachment","tictac-attach-utils"]}),YUI.add("tictac-attach-model-attachment",function(a){function f(b,f){var h=this,i=["fid","mid","partId","tnef","disposition","displayable"],j=/[\w\W]+\\([^\\]+)$/;h.id=b,c(f.filename,"filename required"),h.rawFilename=(f.filename||"").replace(j,"$1"),h.filename=a.Escape.html(h.rawFilename),h.thumbnail=f.thumbnail||"",h.size=f.size||0,h.mimetype=f.type&&f.subtype?f.type+"/"+f.subtype:"",h.type=f.type||"",h.referencedInline=f.referencedInline||!1,h.diskfilename=f.diskfilename||"",h.uploadState=f.uploadState||"queued",h.hasProgress=!!f.hasProgress,h.retryCount=0,h.uploadStartTime=0,c(g(h.uploadState),"illegal upload state:"+h.uploadState),h.reason=f.reason||"",h.progress=f.progress||0,f.original&&(c(e.keys(f.original).length==i.length,"Attachment original didn't include all members"),d.each(i,function(a){c(e.owns(f.original,a),"Attachment original missing key: "+a)}),h.original=f.original),f.dropbox&&(typeof f.dropbox.alf=="undefined"&&(f.dropbox.alf=!1),h.dropbox=f.dropbox)}function g(a){return!!b[a]}var b=a.Array.hash(["queued","started","failed","success"]),c=a.Tictac.base.utils.verify,d=a.Array,e=a.Object;f.prototype={setUploadState:function(a,b){var d=this;b=b||"",c(g(a),"illegal upload state: "+a),d.uploadState=a,d.reason=b},isUploadValid:function(){var a=this;return a.uploadState=="success"},isVirusFree:function(){var a=this;return a.reason!="uploadAVCannotClean"&&a.reason!="uploadAVHasVirus"},isDropbox:function(){return!!this.dropbox},isUploadDone:function(){var a=this;return a.uploadState=="success"||a.uploadState=="failed"},setMimeType:function(a){var b=this,c;a=a||"",a.toLowerCase(),c=a.split("/"),b.mimetype=a,b.type=a.split("/")[0]},isImage:function(){return this.type=="image"}},a.namespace("tictac.attach.model"),a.tictac.attach.model.Attachment=f},"1.0.0",{requires:["tictac-base-utils","tictac-attach-utils","escape"]}),YUI.add("tictac-attach-customuploader-html5",function(a){function b(){var c=this;b.superclass.constructor.apply(c,arguments),c.set("errorAction",a.Uploader.Queue.STOP)}b.NAME="tictac-attach-customuploader-html5",a.extend(b,a.UploaderHTML5,{cancelUpload:function(a){var b=this,c=b.queue;c.cancelUpload(a),!c.queuedFiles.length&&!c.numberOfUploads&&b.cleanUpQueue()},_uploadEventHandler:function(a){var c=this,d=this.queue;b.superclass._uploadEventHandler.apply(c,arguments),(a.type=="uploaderqueue:uploaderror"||a.type=="file:uploaderror")&&!d.queuedFiles.length&&!d.numberOfUploads&&c.cleanUpQueue()},_ddEventHandler:function(c){var d=this,e=c._event.dataTransfer;c.type=="drop"&&a.Array.indexOf(e.types,"Files")>-1&&d.fire("customdrop",{numberOfFiles:e.files.length}),b.superclass._ddEventHandler.apply(d,arguments)},cleanUpQueue:function(){var a=this;a.queue.cancelUpload(),a.queue=null}}),a.namespace("tictac.attach").CustomUploaderHTML5=b},"1.0.0",{requires:["uploader-html5","tictac-attach-yuipatch"]}),YUI.add("tictac-attach-uploader",function(a){function b(a){this.publish("fileselect"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("uploadcomplete"),this.publish("uploaderror"),this.publish("uploadcancel"),this.publish("dragenter"),this.publish("dragleave"),this.publish("dragover"),this.publish("drop")}b.prototype={render:function(a){},upload:function(a){},openFileSelectDialog:function(){},cancel:function(){},startUpload:function(a){},canInvokeFileSelectDialog:!1},a.namespace("tictac.attach").Uploader=b,a.augment(b,a.EventTarget,!0,null,{prefix:"uploader"})},"1.0.0",{requires:["event-custom"]}),YUI.add("tictac-attach-view",function(a){function h(b,d,e){var f=this;f.model=b,f.controller=d,f.rte=e.rte,f.stat=a.tictac.attach.Controller.conf.stat,f.username=e.username?e.username:"The sender",f.tray=new a.Tictac.att.AttachmentTray({attachments:new a.Tictac.att.Collection,isCompose:!0,collapsed:!1,boundingBox:e.tray}),f.evtHandles=[f.tray.on("removeall",f.cmdRemoveAllAttachments,f),f.tray.on("expanded",f.trayExpanded,f),f.tray.on("collapsed",f.trayCollapsed,f),f.tray.on("norton",f.nortonClick,f),f.model.on("added",f.addAttachment,f),f.model.on("deleted",f.removeAttachment,f),f.model.on("updated",f.updateAttachment,f),f.model.on("failures",f.updateFailureText,f),f.model.on("emptied",f.updateAttachmentEmpty,f),f.model.after("quota",function(a){(a.violation.size||a.violation.count)&&f.onQuotaViolated(a.violation,a.isDialogHandled)}),f.tray.on("menu-item-selected",function(a){var b;if(!a.attachment)return;b=a.attachment.getId(),a.action=="remove"?f.cmdRemoveAttachment(b):a.action=="download"?f.cmdDownloadAttachment(b):a.action=="save_dropbox"&&f.cmdSaveAttachmentToDropbox(b),a.action=="retry"&&a.attachment&&(this._attachmentMenu.allowSimClick(),f.cmdRetryAttachment(a.attachment.getId()))})],e.dropbox&&c.hasTictacModule("tictac-dropbox")&&a.use("tictac-dropbox-footer",function(a){f.footer=new a.Tictac.dropbox.footer(f.rte,f.model,f.username)})}function i(a){return a.isDropbox()?!1:b.filter(a)}var b=a.Tictac.att.filter,c=a.Tictac.base.utils,d=c.getVal,e=a.tictac.attach.Utils.isSvrResponseWarning,f={ERROR_TITLE:"ERROR_TITLE",ERROR_SIZE:"ERROR_SIZE",ERROR_COUNT:"ERROR_COUNT",alert:function(a){window.alert(a.hd+"\n\n"+a.bd)}},g=/[\w\W]+\.([^\.]+$)/;a.extend(h,a.Base,{updateFailureText:function(a){var b=this;if(a===0){b.tray.hideError();return}b.tray.showError(b.model.areAllWarningOrSuccess()?"tray:compose_warning":"tray:compose_error",a)},onQuotaViolated:function(a,b){var c=this,d;a.size?d=f.ERROR_SIZE:d=f.ERROR_COUNT,b||f.alert({hd:f.ERROR_TITLE,bd:d,restoreFocusNode:c.tray.get("boundingBox")}),c.model.delDownToQuota()},isDownloadable:function(a){return a.isUploadValid()&&!a.isDropbox()},addAttachment:function(c){var e=this,f;if(e.model.count(i)===0){e.tray.hide();return}if(!i(c))return;e.tray.show(),f=new a.Tictac.att["Attachment"+(c.hasProgress?"Progressbar":"Spinny")]({filename:c.filename,thumbnail:c.thumbnail,size:c.size}),f.setId(c.id),f.set("dropbox",c.dropbox?!0:!1),e.tray.addAttachment(f),c.isUploadDone()?(f.set("removable",!0),f.updateProperty("filetype",b.map(c.mimetype,c.filename.replace(g,"$1"),!1))):(f.updateProperty("cancelable",!0),f.activate(),e.tray.setStatus([c.id],"uploading")),e.isDownloadable(c)&&f.set("downloadable",!0),d(a,"Tictac.dropbox.controller")&&f.set("shareable",!0)},updateAttachment:function(a){var b=this,c=b.tray.get("attachments"),d=c.get(a.id);if(!i(a))return;a.hasProgress&&d.setProgress(a.progress),a.thumbnail&&d.updateProperty("thumbnail",a.thumbnail),d&&a.uploadState=="success"?b.successHandler(d,a):d&&a.uploadState=="failed"&&b.failureHandler(d,a)},successHandler:function(c,d){var f=this,h="compose:generic_warning";c.data.size=d.size,c.set("cancelable",!1),c.set("removable",!0),c.set("retryable",!1),c.updateProperty("error",{}),f.isDownloadable(d)&&c.set("downloadable",!0);switch(d.reason){case"uploadAVNotScannable":h="compose:password_protection";break;case"uploadAVCleaned":h="compose:virus_cleaned"}c.updateProperty("error",e(d.reason)?a.Tictac.att.attError(h):{}),c.updateProperty("filetype",b.map(d.mimetype,d.filename.replace(g,"$1"))),c.deactivate(),f.tray.clearStatus([d.id],"uploading"),f.stat("view_upload_success")},failureHandler:function(b,c){var d=this,e="compose:generic_error";switch(c.reason){case"uploadAVCannotClean":case"uploadAVHasVirus":e="compose:virus_not_cleaned"}b.set("cancelable",!1),b.set("removable",!0),b.set("downloadable",!1),a.UA.ie||b.set("retryable",!0),b.updateProperty("error",a.Tictac.att.attError(e)),b.deactivate(),d.tray.clearStatus([c.id],"uploading"),d.stat("view_upload_failure")},updateAttachmentEmpty:function(){this.tray.hide()},removeAttachment:function(a){var b=this;if(!i(a))return;b.tray.clearStatus([a.id],"uploading"),b.tray.removeAttachment(a.id)},cmdRemoveAllAttachments:function(){var a=this;a.controller.deleteAttachments(function(a){return!a.isDropbox()}),this.controller.trackClick("att_cmps_rmv")},cmdRemoveAttachment:function(a){this.controller.trackClick("att_cmps_mnu_rmv"),this.controller.deleteAttachment(a)},cmdRetryAttachment:function(a){this.controller.trackClick("att_cmps_mnu_rtry"),this.controller.retryAttachment(a)},cmdDownloadAttachment:function(b){var c=this,d=c.tray,e=a.Tictac.att.downloader;d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(a){a.aid=b,e.setStats({stat:c.stat}),e.download(d,[a])})},cmdSaveAttachmentToDropbox:function(b){var c=this,d=c.tray;c.controller.trackClick("att_save_to_dropbox"),c.stat("dropbox_saveto",{message:"clicked"}),d.setStatus([b],"scanning"),c.controller.getDownloadInfo(b,function(e){e.aid=b,a.use("tictac-dropbox-controller",function(a){a.Tictac.dropbox.controller.saveTo(d,[e],{stat:c.stat})})})},trayExpanded:function(){this.controller.trackClick("att_cmps_exp")},trayCollapsed:function(){this.controller.trackClick("att_cmps_cll")},nortonClick:function(){this.controller.trackClick("att_cmps_nrtn")},render:function(){this.tray.render()},cleanup:function(){var b=this;b.tray.destroy(),b.tray=null,b.controller=null,a.each(b.evtHandles,function(a){a.detach&&a.detach()}),delete b.evtHandles,b.footer&&b.footer.cleanup()}}),a.namespace("tictac.attach").View=h,a.namespace("tictac.attach.View").conf=f},"1.0.0",{requires:["base-base","node","tictac-base-utils","tictac-attach-utils","tictac-att-attachment-tray","tictac-att-filter","tictac-att-attachment-compose","tictac-att-attachment-error","tictac-att-attachments","tictac-att-downloader"]}),YUI.add("tictac-attach-neo",function(a){function b(){var a=NeoConfig.launch_protocol;return NeoConfig.attachmentServer&&(a+=NeoConfig.attachmentServer+"/"),NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL?a+=window.location.host:a+=[strings.str_cfg_base_intl,".",NeoConfig.farm,".mail.yahoo.",NeoConfig.intl=="jp"?"co.jp":"com"].join(""),a+="/ya/upload_with_cred?output=xml",a}a.namespace("tictac.attach").Neo={neoConfig:NeoConfig,makeHTML5UploaderConf:function(){var c={UPLOAD_URL_BASE:b(),LAUNCH_PROTOCOL:location.protocol+"//",stat:a.common.Utils.rocketstats.intlStat,uploader:{multipleFiles:!0,simLimit:1}};return c},makeControllerConf:function(){var b={stat:a.common.Utils.rocketstats.intlStat};return b},alert:function(b,c,d){var e=a.ui.Templates,f=a.common.Utils.substitute;a.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_ok",function(a){a.common.ui.DialogHelper.custom({hd:b,bd:c,ft:f(e._shared_module_offscreen_bin_modal_btn_ok.base,0,0,0,strings,e)},{ok:{handler:d},cancel:{handler:d}})})},dialog:function(b,c,d){a.use("common-ui-dialog-helper",function(a){a.common.ui.DialogHelper.confirm({hd:b,bd:c},d)})}}}),YUI.add("tictac-attach-uploader-html5",function(a){function o(b){var c=this,d;a.mix(b,h.uploader,!0),d=new a.tictac.attach.CustomUploaderHTML5(b),c.dropArea=b.dropArea,c.yuiImpl=d,c.type="HTML5",c.evtHandles=[],c.getCredRetry=0,c.credWaitTimer=null,c.dropArea.appendChild(a.tictac.attach.templates.dragdrop({})),c.dropArea.setStyle("position","relative"),c.tictacDropAreaNode=c.dropArea.one(".tictac-attach-droparea"),c.tictacDropAreaNode.hide(),e(h.UPLOAD_URL_BASE&&h.LAUNCH_PROTOCOL,"You must configure UPLOAD_URL_BASE and LAUNCH_PROTOCOL"),d.set("uploadURL",h.UPLOAD_URL_BASE),d.set("dragAndDropArea",c.dropArea),c.evtHandles=c.evtHandles.concat([c.convert(d,"uploadcomplete",c.onUploadComplete),c.convert(d,"uploaderror",c.onUploadError),c.convert(d,"uploadprogress",c.onUploadProgress),c.dropArea.on(["dragenter","dragover"],c.onDragOverOrEnter,c),c.dropArea.on("drop",c.onDrop,c),d.on("customdrop",c.onCustomDrop,c),h.dropNode.on(["dragenter","dragover"],c.onDragOverOrEnter,c),c.convert(d,"fileselect",c.onRefire),c.convert(d,"fileuploadstart",c.onRefire),c.convert(d,"uploadcancel",c.onRefire),l.on("updateUploadURL",c.setCredential,c),l.on(["dragenter","dragover"],c.onDragOverOrEnter,c),l.on("drop",c.onDrop,c),d.get("selectFilesButton").on("click",function(a){a.halt()})]),c.get=d.get,e(d.get("appendNewFiles"),"appendNewFiles has to be true or fileFromFid breaks"),c.fetchCredential()}function p(a){return a.id=a.get("id"),a.name=a.get("name"),a.hasProgress=!0,a.size=a.get("size"),a}function q(b){return b.fileList?b.fileList=a.Array.map(b.fileList,function(a){return new p(a)}):b.file&&(b.file=new p(b.file)),b}var b=a.Tictac.base.utils,c=b.log,d=a.one(document),e=b.verify,f=b.getVal,g=a.tictac.attach.Neo.neoConfig,h={UPLOAD_URL_BASE:"",LAUNCH_PROTOCOL:"",dropNode:a.one("body"),rteContainer:a.one("body"),stat:function(){c("stat not conf'ed.")},stopwatch:function(){c("STOPWATCH not conf'ed."),this.stop=function(){}},simpleRelogin:function(){c("relogin!")},uploader:{multipleFiles:!0,simLimit:1}},i=10,j=1e3,k=i*j,l={},m,n=function(a,b){h.stat("html5_tt_"+a,b)};a.augment(l,a.EventTarget),d.on("dragenter",function(a){l.fire("dragenter",a)}),d.on("dragover",function(a){l.fire("dragover",a)}),d.on("drop",function(a){l.fire("drop",a)}),o.NAME="tictac-attach-uploader-html5",a.mix(o.prototype,{convert:function(a,b,c){var d=this;return a.on(b,function(a){c.call(d,new q(a),b)})},render:function(){var b=this,c;b.yuiImpl.render.apply(b.yuiImpl,arguments),c=b.yuiImpl.get("selectFilesButton"),c.setStyles({width:"",height:""}),c.setAttribute("title",a.tictac.attach.strings.str_attach_html5_attach_button),b.evtHandles.push(c.on("click",b.onAttachButtonClicked,b))},cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.evtHandles=null,b.yuiImpl.destroy(),b.yuiImpl=null},doUpload:function(b){var d=this,e=b.fileList,f=d.yuiImpl.get("postVarsPerFile");a.Array.each(e,function(a){f[a.get("id")]={filename:a.get("name"),filesize:a.get("size")}}),d.yuiImpl.get("uploadURL")==h.UPLOAD_URL_BASE&&n("no_cred",{message:g.neoguid}),c("uploadThese on ",e),n("onFileSelect"),d.yuiImpl.uploadThese(e,d.yuiImpl.get("uploadURL"),f)},doDropboxUpload:function(b,d){var e=this,f=b.fileList,g=e.yuiImpl,h=g.get("postVarsPerFile"),i;a.Array.each(f,function(a){h[a.get("id")]={web_session_token:d.token},i=a.startUpload,a.startUpload=function(b,c,e){return b=d.url,e="file",a.set("xhrWithCredentials",!1),a.set("isDropbox",!0),i.call(a,b,c,e)}}),g.set("postVarsPerFile",h),c("doDropboxUpload on ",f),g.uploadThese(f)},startUpload:function(a,b){var c=this;if(b){c.doDropboxUpload(a,b);return}m?c.doUpload(a):(c.evtHandles.push(c.once("credentialSetSuccessful",c.doUpload,c,a)),c.credWaitTimer||(c.credWaitTimer=setTimeout(function(){c.getCredRetry=i,c.fire("uploadfatalerror")},k)))},retryUpload:function(b){var c=this,d=c.yuiImpl.queue,e=c.fileFromId(b);n("retry",{message:g.neoguid}),d?(d.addToQueueTop(e),d._currentState=a.Uploader.Queue.UPLOADING,d._startNextFile()):c.yuiImpl.uploadThese([e])},cancel:function(a){var b=this,c=b.fileFromId(a),d=b.yuiImpl,e=d.queue;e&&(n("Attachment_UploadCancelled"),d.cancelUpload(c))},simulateClick:function(){var a=this,b=a.yuiImpl.get("selectFilesButton");b._node.click()}},!0),a.mix(o.prototype,{setCredVal:function(a){m=a},setCredential:function(){var a=[h.UPLOAD_URL_BASE,"&",m].join("");this.yuiImpl.set("uploadURL",a),this.yuiImpl.queue&&this.yuiImpl.queue.set("uploadURL",a)},fetchCredential:function(){function e(a,d){if(!c.yuiImpl)return;d=d.response||d.responseText,m=b.parseJSON(d),m=f(m,"Response.cred");if(!m){n("CredentialSetFailedCallback",{message:g.neoguid}),n("CredFetchSuccessData",{message:(d+"").substr(0,27)}),c.getCredRetry<i&&setTimeout(function(){c.fetchCredential(),c.getCredRetry++},j);return}clearTimeout(c.credWaitTimer),c.credWaitTimer=null,c.setCredential(),c.fire("credentialSetSuccessful"),n("CredentialSetSuccessful",{message:g.neoguid}),c.getCredRetry&&n("CredentialSetSuccessful_retry"),c.getCredRetry=0}function k(b,d){if(!c.yuiImpl)return;n("CredentialSetFailed",{message:d.status+"_"+d.statusText+"_"+g.neoguid});if(c.getCredRetry>=i)return;setTimeout(function(){d.status==302?(a.once("net:reloginSuccessful",function(){c.fetchCredential()}),h.simpleRelogin()):c.fetchCredential(),c.getCredRetry++},j)}var c=this,d=[h.LAUNCH_PROTOCOL,document.location.host,"/ya/upload_get_cred?r=",(new Date).getTime().toString(36)].join("");if(m){c.setCredential();return}a.io(d,{on:{success:e,failure:k}})},fileFromId:function(b){var c=a.Array.find(this.yuiImpl.get("fileList"),function(a){return a.id==b});return e(c,"No file found with id: "+b),c},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onCustomDrop:function(a){this.fire("filedrop",a)},onDrop:function(a){var b=this;a.halt(),b.tictacDropAreaNode&&b.tictacDropAreaNode.hide()},onDragOverOrEnter:function(b){var c=this,d=b._event.dataTransfer,e=c.tictacDropAreaNode;return a.Array.indexOf(d.types,"Files")!==-1||d.types.contains&&d.types.contains("application/x-moz-file")?(b.halt(),e&&(e.show(),c.dropAreaTimer&&(clearTimeout(c.dropAreaTimer),c.dropAreaTimer=null),c.dropAreaTimer=setTimeout(function(){e.hide()},100)),!0):!1},onUploadComplete:function(b){var d=this,e=a.tictac.attach.Utils,g=b.file.get("isDropbox"),h,i;if(g){var j=f(a,"Tictac.dropbox.controller");j.parseServerResponse(b.file,b.data),h=j.isSvrResponseSuccess,i=j.isSvrResponseWarning}else h=e.isSvrResponseSuccess,i=e.isSvrResponseWarning,d.parseServerResponse(b.file,b.data);h(b.file.reason)||i(b.file.reason)?b.type="uploadcomplete":b.type="uploaderror",c("uploaderHTML5 firing uploadcomplete"),n("success",{message:b.file.reason}),d.fire(b.type,b)},onUploadError:function(b){var c=this,d=this.yuiImpl,e=d.queue,h=b.file.get("isDropbox"),i,j;if(h){var k=f(a,"Tictac.dropbox.controller");k.parseServerResponse(b.file,b.data)}b.transferFailed=!0,e.queuedFiles.length&&e.restartUpload(),b.source=="io"?n("failure_uploaderror_io",{message:g.neoguid}):(j=(b.data+"").match(/<Error>([0-9A-Za-z]*?)<\/Error>/),i=j?j[1]:"parseerror_"+b.status+"_"+b.statusText,n("failure",{messsage:i})),b.file.get("isDropbox")&&n("db_upload_try_failure"),c.fire("uploaderror",b)},onUploadProgress:function(a){a.file.percentLoaded=a.percentLoaded,this.fire("uploadprogress",a)},onRefire:function(a,b){b||(b=a.type.substring(a.type.indexOf(":")+1)),this.fire(b,a)},parseServerResponse:function(b,c){var d,e;b.reason="unknown",d=this.stringToXMLDoc(c),c=d.firstChild,c.getElementsByTagName||(c=d.childNodes[1]),e=c.getElementsByTagName("attachment")[0];if(!e){b.reason=c.getElementsByTagName("Error"
)[0],b.reason&&(b.reason=b.reason.text);return}a.Array.each(e.childNodes,function(a){var c={id:"diskfilename",type:"mimetype",name:"name",size:"size",code:"reason"},d,e;d=a.nodeName,e=a.text||a.textContent;if(!c[d])return;b[c[d]]=e,d=="size"&&(b.size=parseInt(b.size,10))})},stringToXMLDoc:function(a){var b;return window.DOMParser?b=(new window.DOMParser).parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a)),b}}),a.augment(o,a.EventTarget,!0,null,{prefix:"Uploaderhtml5"}),a.namespace("tictac.attach").UploaderHTML5=o,a.tictac.attach.UploaderHTML5.conf=h},"1.0.0",{requires:["array-extras","event-custom","io","tictac-attach-customuploader-html5","tictac-attach-templates","tictac-attach-strings","tictac-attach-utils","tictac-base-utils"]}),YUI.add("tictac-attach-stats",function(a){function g(a,b){var c="UploaderService";a=a.toLowerCase(),b&&b.message?(b.message=b.message.toLowerCase(),a==="form_tt_server_response"?f(c,"form_tt_"+b.message):f(c,a+"_"+b.message)):f(c,a),e.stat(a,b)}var b={html5_tt_onfileselect:13,html5_tt_attachment_uploadcancelled:14,html5_tt_credentialsetfailedcallback:15,html5_tt_credentialsetsuccessful:16,html5_tt_credentialsetsuccessful_retry:17,html5_tt_credentialsetfailed:18,html5_tt_failure_uploaderror_io:19,html5_tt_no_cred:20,html5_tt_retry:21,html5_tt_success:22,html5_tt_failure:23,form_tt_onfileselect:24,form_tt_attachment_uploadcancelled:25,form_tt_attachuploadiframeerror:26,form_tt_abandon:27,form_tt_server_response:28,controller_uploaderror:29,view_upload_success:30,view_upload_failure:31,html_tt_credfetchsuccessdata:32,controller_uploadretrysuccess:33,toggleformactivated:34,download_error_json:35,download_error_general:36,download_success_error:37,download_success_errors:38,download_success_nourl:39,download_success_success:40,download_success_warning:41,download_success:42,controller_db_upload_start:43,controller_db_upload_success:44,controller_db_upload_failure:45,html5_tt_db_upload_try_failure:46,dropbox_saveto:56},c={action:17,bucket:28,message:20,count:29,size:30},d={name:"att-compose",sourceUrl:"https://s.yimg.com/mi/ono/ywa.js",appId:"1000934436956",isSampled:Math.floor(Math.random()*100+0)===0,actionEnums:b,customFieldEnums:c},e=new a.Tictac.base.Ywa(d),f=a.common.Utils.rocketstats.intlStat;a.namespace("tictac.attach").Stats={makeStatConf:function(){return{stat:g}}},a.namespace("tictac.attach.Stats").stat=g},"1.0.0",{requires:["tictac-base-ywa"]}),YUI.add("tictac-attach-uploader-form",function(a){function n(){return a.UA.ie?"IE"+a.UA.ie:a.UA.safari?"Safari"+a.UA.safari:a.UA.chrome?"Chrome"+a.UA.chrome:a.UA.gecko?"Firefox"+a.UA.gecko:"unknown"}function o(a){var b=this;if(!g.UPLOAD_URL_BASE)throw"You must configure UPLOAD_URL_BASE'";return b.type="FORM",b.selectFilesButton=a.selectFilesButton,b.instanceId=h++,b.fileMap={},b.fileCount=0,i[b.instanceId]=b,b.evtHandles=[],b}var b=['<form method="post" enctype="multipart/form-data" ','class="attachment-button-form"></form>'].join(""),c=['<input type="file" id="attachment-button-input" ','name="uploadfile" style="position: absolute; ',"top: 0; right: 0; z-index: 100; opacity: 0; ",'filter: alpha(opacity=0); display:block;">'].join(""),d=['<iframe id="FILE_ID" name="FILE_ID" ','style="display:none;"></iframe>'].join(""),e=["<script>window.onunload=function(){","parent.UploaderService.onIframeUpdate(",'"INSTANCE_ID", "FILE_ID");};',"</script>"].join(""),f=function(a,b){g.stat("form_tt_"+a,b)},g={IFRAME_USE_TIMEOUTS:!0,IFRAME_UPLOAD_TIMEOUT_MS:15e5,IFRAME_POLL_INTERVAL_MS:2e3,IFRAME_MAX_POLL_ATTEMPTS:15,REDIRECT_URL_BASE:document.location.protocol+"//"+document.location.host,UPLOAD_URL_BASE:"",BUILD_ID:0,stat:function(a,b){l("STAT: "+a+":"+b)},stopwatch:function(){l("STOPWATCH not conf'ed."),this.stop=function(){}}},h=0,i={},j=0,k=a.Tictac.base.utils,l=k.log,m=k.verify;window.UploaderService={onIframeUpdate:function(a,b){var c=i[a];c&&c.onIframeUpdate(b)},handlePostRedirectResponse:function(b){var c,d;b&&b.charAt(0)==="?"&&(b=b.substring(1)),d=a.QueryString.parse(b),l("postRedirectResponse parsed "+b,d),m(d.hasOwnProperty("instanceId")&&i[d.instanceId],"UploaderForm unmapped instanceId:"+d.instanceId),c=i[d.instanceId],c.onPostResponse(d)}},o.NAME="tictac-attach-uploader-form",a.mix(o.prototype,{cleanup:function(){var b=this;a.Array.each(b.evtHandles,function(a){a.detach()}),b.selectFilesButton.detachAll(),delete i[b.instanceId]},render:function(d){var e=a.Node.create(b),f=a.Node.create(c),g=this,h=g.evtHandles;d.append(e.append(g.selectFilesButton.append(f))),g.container=d,h=h.concat([f.on("change",g.onFileSelected,g),f.on("click",g.onAttachButtonClicked,g)])},simulateClick:function(){var a=this,b=a.container.one("#attachment-button-input");b._node.click()},startUpload:function(b){function i(){e.abandon(d,"Attachment_UploadNoResponse")}m(a.Lang.isArray(b.fileList)&&b.fileList.length==1,"startUpload got invalid evt.fileList");var c=b.currentTarget.ancestor("form"),d=b.fileList[0],e=this,h;e.fire("fileuploadstart",{file:d}),h=e.makeIframeId(d.id),d.iframe=e.injectIframe(d,h),c.set("target",h),c.set("action",e.makeUploadURL(d.id)),c._node.submit(),f("FormUploader",{message:"onFileSelect"}),d.stopwatch=new g.stopwatch("AttachmentUpload"),d.stopwatch.attType="form",g.IFRAME_USE_TIMEOUTS&&(d.timeout=setTimeout(i,g.IFRAME_UPLOAD_TIMEOUT_MS)),c._node.reset()},cancel:function(a){var b=this,c=b.fileMap[a];m(c,"uploaderForm can't cancel "+a),b.clearCallbacks(c),delete b.fileMap[c.id],c.iframe&&c.iframe.remove(!0),f("Attachment_UploadCancelled"),b.fire("uploadcancel",{file:c})}},!0),a.mix(o.prototype,{makeIframeId:function(a){return j+=1,a+"_"+j},onAttachButtonClicked:function(){this.fire("attachbuttonclick")},onFileSelected:function(a){var b=a.currentTarget,c={name:b.get("value")},d=this;if(!c.name)return;c.id="FORM_FILE_"+d.fileCount,d.fileCount+=1,d.fileMap[c.id]=c,a.fileList=[c],d.fire("fileselect",a)},injectIframe:function(a,b){var c=this;m(c.container,"You forgot to call UploaderForm.render");var f=d.replace(/FILE_ID/g,b),g=c.container.appendChild(f),h=g._node,i=h.contentDocument||h.contentWindow.document;return i.open("text/html","replace"),i.write(e.replace("INSTANCE_ID",c.instanceId).replace("FILE_ID",a.id)),i.close(),g},onIframeUpdate:function(a){var b=this.fileMap[a];if(!b){l("UploaderForm IframeLoad for unknown file");return}this.clearCallbacks(b),b.interval=setInterval(this.makeIframePoller(b),g.IFRAME_POLL_INTERVAL_MS)},clearCallbacks:function(a){a.timeout&&(clearTimeout(a.timeout),delete a.timeout),a.interval&&(clearInterval(a.interval),delete a.interval),a.evtIframeLoad&&(a.evtIframeLoad.detach(),delete a.evtIframeLoad)},makeIframePoller:function(b){function m(d){var e,g;try{e=d.pathname}catch(h){g="uploaderFormUploadServerHangUp_Error"}return e?e:(g=g||"uploaderFormUploadServerHangUp",j+=1,j>2&&(c.abandon(b,g),f("AttachUploadIframeError",{message:a.UA.os+"-"+n()})),null)}function o(){var a=h&&h.location,d=m(a);k+=1;if(k>=g.IFRAME_MAX_POLL_ATTEMPTS){c.abandon(b,"Attachment_UploadTimeout");return}if(!d)return;if(d.indexOf("attach.php")!==-1){l("UploaderForm iframe success for "+b.id),c.clearCallbacks(b),b.processed=!0;return}if(a==i||d.indexOf("ya/upload")!=-1)return;c.abandon(b,"Attachment_UploadUnexpectedResponse")}var c=this,d=b.iframe._node,e=d.contentDocument||d.contentWindow.document,h=d.contentWindow||e,i=h.location,j=0,k=0;return o},abandon:function(a,b){var c=this;f("abandon",{message:b}),c.clearCallbacks(a),delete c.fileMap[a.id],a.iframe.remove(!0),c.fire("uploaderror",{file:a,reason:b})},makeUploadURL:function(a){var b=this,c;return c=[g.REDIRECT_URL_BASE,"/neo/php/attach.php?instanceId=",b.instanceId,"&bid=",g.BUILD_ID,"&fileId=",a].join(""),[g.UPLOAD_URL_BASE,"?resulturl=",encodeURIComponent(c)].join("")},onPostResponse:function(b){var c=this,d,e="uploadcomplete",g=a.tictac.attach.Utils;m(b.fileId,"onPostResponse no file id"),l("onPostResponse",b),d=c.fileMap[b.fileId],d.iframe.remove(!0),delete c.fileMap[d.id],d.diskfilename=b.diskfilename,d.mimetype=b.mimetype,d.size=parseInt(b.filesize,10),g.isSvrResponseSuccess(b.errorcode)||g.isSvrResponseWarning(b.errorcode)?e="uploadcomplete":e="uploaderror",d.stopwatch&&(d.stopwatch.attSize=d.size,d.stopwatch.stop(),delete d.stopwatch),c.clearCallbacks(d),d.reason=b.errorcode,f("server_response",{message:d.reason}),c.fire(e,{file:d})}},!0),a.namespace("tictac.attach").UploaderForm=o,a.namespace("tictac.attach.UploaderForm").conf=g,a.augment(o,a.EventTarget,!0,null,{prefix:"uploaderform"})},"1.0.0",{requires:["event-custom","querystring-parse-simple","tictac-base-utils","tictac-attach-utils"]}),YUI.add("tictac-attach-yuipatch",function(a){a.Uploader.Queue.prototype.restartUpload=function(){this._currentState=a.Uploader.Queue.UPLOADING;while(this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length)this._startNextFile()},a.FileHTML5.prototype._uploadEventHandler=function(a){var b=this.get("xhr");switch(a.type){case"progress":this.fire("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*a.loaded/this.get("size"))/100)}),this._set("bytesUploaded",a.loaded);break;case"load":if(b.status>=200&&b.status<=299){this.fire("uploadcomplete",{originEvent:a,data:a.target.responseText});var c=b.upload,d=this.get("boundEventHandler");c.removeEventListener("progress",d,!1),c.removeEventListener("error",d,!1),c.removeEventListener("abort",d,!1),b.removeEventListener("load",d,!1),b.removeEventListener("error",d,!1),b.removeEventListener("readystatechange",d,!1),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,data:b.responseText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:a,status:b.status,statusText:b.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:a});break;case"readystatechange":this.fire("readystatechange",{readyState:a.target.readyState,originEvent:a})}}},"1.0.0",{requires:["file-html5","uploader-queue"]});YUI.add("mail-tt-attcomposer",function(E){var O,H=E.common.persist.UserData,F=H.get("userFeaturePref.attachTotalSize"),K=H.get("userFeaturePref.attachFiles");function C(){var P=NeoConfig.launch_protocol;if(NeoConfig.attachmentServer){P+=NeoConfig.attachmentServer+"/";}if(NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL){P+=window.location.host;}else{P+=[strings["str_cfg_base_intl"],".",NeoConfig.farm,".mail.yahoo.",(NeoConfig.intl=="jp"?"co.jp":"com")].join("");}P+="/ya/upload";return P;}O=C();function M(){var Q={UPLOAD_URL_BASE:O,IFRAME_USE_TIMEOUTS:!NeoConfig.low_bandwidth,stopwatch:E.common.Utils.Stopwatch},P;P=parseInt(NeoConfig.formUploaderResponseTimeout,10);if(P){Q.IFRAME_UPLOAD_TIMEOUT_MS=P;}P=parseInt(NeoConfig.formUploaderRedirectInterval,10);if(P){Q.IFRAME_POLL_INTERVAL_MS=P;}return Q;}function G(P){var Q={},R=E.Object.keys(E.tictac.attach.Controller.conf);R=E.Array.hash(R);if(R.getDownloadInfo){Q.getDownloadInfo=function(T,S){D(P,T,S);};}if(R.download){Q.download=function(T,S){B(P,T,S);};}if(R.getMsg){Q.getMsg=function(S){N(P,S);};}return Q;}function L(P){var S=this,R=P.currentTarget,Q="hidden";E.fire("mt:click",{action:"cmps_attflmnu",append:{t1:"cmpsTb"}});P.preventDefault();if(!R.menu){E.use("common-ui-menu-helper","_shared_module_offscreen_bin_menus_compose_attach",function(U){var T=U.one("#menu-attach-options");T=U.Node.create('<div id="menu-attach-options" class="optionMenu"></div>');U.one("body").append(T);if(S.attachLargeBtn){NeoConfig.isFresh&&T.appendChild(S.attachLargeBtn);}U.common.ui.MenuHelper.create(R,{menu:T,blur:true,allowSimClick:true},function(){});});}}function I(S,P,R){var U=P.node,T=U.one("span.attach-btn-menu"),V=U.one(".attachment-button-attach"),Q=R.btnContainer;S.push(T.on("click",L,R));V&&V.removeClass("right");T&&T.removeClass("hidden");}function J(T,Q,V,S){var U=false,P,R=(E.UA.ie==0||(E.Tictac&&E.Tictac.dropbox));P=E.after("om:compose_add_btn",function(){if(!U&&R&&Q._node){Q.one(".attachment-button-attach").ancestor().append(V);I(T,{node:Q},S);U=true;}});T.push(P);if(R){Q.one(".attachment-button-attach").ancestor().append(V);I(T,{node:Q},S);U=true;}}function N(R,P){function Q(S){E.use("mail-controller-messages",function(T){T.mail.Controller.Messages.get({fid:"Draft",msg:{mid:S}},P);});}R.getMID(Q);}function D(T,S,P){var R=T.cdo.attachments,Q=R.get(S).filename;function U(X){var W,V;if(!X.attachments||(X.attachments.length!==R.count())){return;}V=X.attachments[R.order(S)];if(E.Lang.trim(V.filename)!=Q){return;}W={fid:"Draft",mid:X.mid,pid:V.partId,filename:V.filename};if(typeof V.tnefId!="undefined"){W.tnefid=V.tnefId;}P(W);}N(T,U);}function B(R,Q,P){E.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),"mail-controller-messages",function(S){D(R,Q,function(T){S.mail.common.downloader.render([T]);P("success");});});}function A(T,d,c,e,Q){var V=this,X=E.tictac.attach,b=c.one("span.attachment-button-attach"),a=window.strings,Z=c.one(".attach-btn-menu"),W,Y,P,U,S,R="#menu-attach-options";S=E.Node.create("<li data-action='attach' id='attachOptn'><a>href='#'></a></li>");W=E.Node.create("<li id='attachCloudFile'><a href='#'></a></li>");Y=T.editor.getDoc();Z.remove();b.remove();b.one("input[type=file]").remove();c.empty();e.empty();X.Utils.configure(X.UploaderForm.conf,M());X.Utils.configure(X.UploaderHTML5.conf,{simpleRelogin:E.common.net.Error.simpleRelogin,stopwatch:E.common.Utils.Stopwatch,dropNode:Y});X.Utils.configure(X.model.Attachments.conf,{MAX_BYTES:F,MAX_COUNT:K});X.Utils.configure(X.View.conf,{ERROR_TITLE:a["str_comp_attach_error"],ERROR_SIZE:a["str_comp_attach_size_exceeded"],ERROR_COUNT:a["str_comp_attach_num_files_exceeded"],alert:function(f){E.use("common-ui-dialog-helper",function(g){g.common.ui.DialogHelper.alert(f);});}});if(X.Controller.conf){E.mix(X.Controller.conf,G(T),true);}U={tray:e,attach:b,attachContainer:c,dropArea:T.baseNode,dropbox:W,rte:Q,username:T.header.getHeader().from.name,attachOption:S};P=new X.AttachmentComposer(e,b,c,T.baseNode,W,Q,U.username,S,R);J(T.handles,c,Z,P);delete d.oComposeData.attachments;d.attachments=P.model;return P;}E.namespace("mail.tt.attcomposer").make=A;},"1.0.0",{requires:["tictac-attach-main","common-utils-stats"]});YUI.add("mail-ui-fullcompose-fresh",function(AL){var Al=AL.Lang.trim,S=AL.Node.create,o=AL.mail,Q=o.Controller.Compose,AT=[],r=AL.common,AQ=r.Utils,U=AQ.substitute,AX=AQ.escapeHtml,J=AQ.unescapeHtml,Am=AL.ui.Templates,P=Am._shared_module_toolbar_compose_fresh,Ai=r.persist.UserData,K=o.persist.MetaData,AP="hidden",AM="focus",Aa=500,T={"align-l":"justifyleft","align-c":"justifycenter","align-r":"justifyright",inserthrule:"inserthorizontalrule",insertlink:"createlink",setfontstyle:"fontname",setfontsize:"fontsize",insertnumberedlist:"insertorderedlist",color:"notyet",hilitecolor:"notyet"},Aq=Am._shared_module_compose_loading,b=[10,13,16,18,24,32,48],R=[8,10,12,14,18,24,36],At=2000,F=7000,AJ=AL.EditorBase.NC_KEYS,An="offscreen",AR="restore",W="move";var AK=function(Y,Av,Ax,Aw){var Az=this,Au={};AK.superclass.constructor.apply(Az,arguments);Az.formatButtons=null;Az.fontFamilyOptions=null;Az.fontSizeMenu=null;Az.fontNameMenu=null;Az.selectedFSIndex=-1;Az.selectedFS=null;Az.selectedFNIndex=-1;Az.selectedFN=null;Az.spellCheckView=null;Az.scView=null;Az.slowOriginReqTimer=null;Az.keepHdrFocus=false;Az.formatShortcutTimer=null;Az.mouseFocusEvent=false;Az.composeViewRendered=false;Az.resizeHandle=null;Az.rteTabIndex=0;Az.type="fullCompose";Az.handles=[];Az.lastSendState=null;Az.closeSrc="closeBtn";Au={bidi:NeoConfig.bidi,fullpage:NeoConfig.fullPage,isRTL:NeoConfig.isRTL,isFullSSL:NeoConfig.isFullSSL,isRich:Az._isRTEActive(),getDefaultFontInfo:Q.getDefaultFontInfo,convertToPlain:Q.convertToPlain};Az.editor=new o.RTEView(Au);Az.addChild(Az.editor);Az.loadFormatters={start:function(A1,A0){return(A0=="start")?U(Aq.start,null,null,null,strings):"";},slow:function(A1,A0){return(A0=="slow")?U(Aq.slow,null,null,null,strings):"";},error:function(A1,A0){return(A0=="err")?U(Aq.error,null,null,null,strings):"";},populate:function(A1,A0){return(A0=="pop")?U(Aq.populate,null,null,null,strings):"";}};Az.tbFormatters={lastsaved:function(){if(Az.lastSaveType===-1){return U(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:Az.lastSave});}else{if(Az.lastSave){if(Az.lastSaveType===1){return U(strings.str_comp_autosave_fresh,0,0,0,{autosave_time:Az.lastSave});}else{return U(strings.str_comp_saved_fresh,0,0,0,{saved_time:Az.lastSave});}}}return"";},isDirty:function(){return Az.enableSaveDraft?"":U(P.isDirty,null,null,null,strings);}};if(NeoConfig.bidi){AL.use("comms-intl-bidihighlight");}Az.handles.push(Az.on("closeChange",Az.handleCloseChange,Az));Az.handles.push(Az.on("activeChange",Az.handleActiveChanged,Az));var Ay=Y.get("origin");Az.enableSaveDraft=(Ay&&Ay.oMsg)?true:false;};function d(){var Ax=this,Y,Av=Ax.author.get("contentToolbar"),Au=Av&&Av.root.one("#btn-send"),Aw;if(Ax.isSending){return;}Y=S(U(P.base,{},Ax.tbFormatters,0,strings,Am));Aw=Au&&Au.hasClass("disabled");if(Aw){Y.one("#btn-send").addClass("disabled");}Ax.author.attachToolbar(new o.ui.Toolbar({root:Y}));}function AB(Av){var Aw=this,Y,Au;if(Av.newVal){Aw.updateToolbar();if(Aw.composeViewRendered){if(Aw.isDraft){Y="draft";}else{Au=(Aw.cdo&&Aw.cdo.get&&Aw.cdo.get("origin"));Y=Au?Au.action:null;}Y=Y||"new";AL.Lang.later(90,null,function(){Aw.fire("darlaEvent",{action:"compose_"+Y});});}Aw.attView&&Aw.attView.reposAttachObj(AR);if(AL.UA.ie){AL.Lang.later(20,null,function(){Aw._resizeComposePage();});}Aw.attView&&Aw.attView.attachLargeBtn&&Aw.attView.attachLargeBtn.removeClass("hidden");}else{Aw.header.hideACWidget();if(Aw.dirty&&Aw.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose){Aw._invokeSaveDraft({auto:true});AQ.rocketstats.stat("savemessage","switchingTab");}if(Aw.hiliteCP){Aw.hiliteCP.hide();}if(Aw.textCP){Aw.textCP.hide();}Aw.attView&&Aw.attView.reposAttachObj(An);Aw.attView&&Aw.attView.attachLargeBtn&&Aw.attView.attachLargeBtn.addClass("hidden");}if(Av.cbk){Av.cbk();}}function Aj(Ax){var Ay=this,Y=Ay.cdo,Aw=Y.get("origin"),Au=Ay.closeSrc,Av;if(Aw&&Aw.action!==null){Aw=Aw.action;}else{Aw="new";}Av={action:"cmps_tab_cls",append:{t1:"cmpsTb",ltxt:Aw}};switch(Au){case"closeBtn":break;case"escKey":Av.append.actn="keybrd";break;case"cancelBtn":Av.action="tlbr_cancelcompose";break;}AL.fire("mt:click",Av);}function a(){var Ax=this,Av=Ax.attView,Aw=Av&&Av.uploader,Y=Ax.cdo,Au=Ax.attComposer;Ax.blockSave=true;if(Ax.saveTimer){Ax.saveTimer.cancel();}Ax._clearOriginTimers();if(Ax.hiliteCP){Ax.hiliteCP.hide();}if(Ax.textCP){Ax.textCP.hide();}if(Ax.resizeHandle){Ax.resizeHandle.detach();}if(!AL.Lang.isNull(Ax.spellCheckView)&&!AL.Lang.isUndefined(Ax.spellCheckView)){Ax.spellCheckView.destroy();}delete Ax.spellCheckView;if(Av){Av.cleanUp&&Av.cleanUp();delete Ax.attView;}if(Au){Au.cleanup();delete Ax.attComposer;}if(Y){AL.each(Ax.handles,function(Ay){Ay.detach&&Ay.detach();});AL.each(Y.get("attachments"),function(Ay){if(Ay.timeout){clearTimeout(Ay.timeout);Ay.timeout=null;}});delete Ax.cdo;}Ax.fontFamilyOptions&&Ax.fontFamilyOptions.remove().destroy(true);Ax.fontSizeMenu&&Ax.fontSizeMenu.remove().destroy(true);Ax.fontNameMenu&&Ax.fontNameMenu.remove().destroy(true);Ax.formatButtons&&Ax.formatButtons.remove().destroy(true);Ax.fontSizeMenu=null;Ax.fontNameMenu=null;Ax.selectedFSIndex=null;Ax.selectedFS=null;Ax.selectedFNIndex=null;Ax.selectedFN=null;Ax.fontFamilyOptions=null;Ax.formatButtons=null;Ax.rtSwitch=null;if(Ax.baseNode){AL.each(Ax.handles,function(Ay){Ay.detach();});delete Ax.handles;Ax.baseNode.remove().destroy(true);}Ax.header=null;Ax.formatters=null;Ax.author=null;AK.superclass.ondestroy.call(this,arguments);}function X(Au){var Av=this,Y=Av.baseNode.one(".ac-input.focus .recipient-input input");if(Y){Av.header._lozengeIt(Y);}setTimeout(function(){Av._invokeSend(true,{saveBeforeSend:Au});},0);}function G(Az){var Ay=this,Au=Az?Az.dataAction:0,Aw=(Az&&Az.rawEvent&&Az.rawEvent.shiftKey)?Az.rawEvent.shiftKey:false,A3=true,A0={},Y="",A2=Ay.cdo.get("origin");if(A2&&A2.action!=null){A2=A2.action;}else{A2="new";}if(AL.UA.ie&&AL.UA.ie<=9&&Az.item&&Az.item.hasClass("disabled")){return;}switch(Au){case"send":A0.spid="sent";if(Ay.lastSendState){Y=Ay.lastSendState;
}Ay._handleSendAction(Aw);break;case"savedraft":Ay.blockSave=true;Ay._invokeSaveDraft();break;case"cancelcompose":A3=false;Ay.closeSrc="cancelBtn";Ay.set("close",1);break;case"insertsignature":var A4=Ay.cdo.get("isRichText"),Ax,Av,A1=Q.getSignature(Ay.header.getHeader().from.email);if(A1){Ax=Ay.assembleSendBody();Av=Ax.html;Av=Q.injectSignature(Av,A4,A1);Ay.cdo.set("content",Av,{textConvert:true});}break;default:A3=false;break;}if(A3){A0.append={t1:"cmpsTb"};A0.action="tlbr_"+Au;if(Y){A0.append.ltxt=Y;}AL.fire("mt:click",A0);}}function C(){var A1=this,A6,Ay,Y,A2,Aw,Au,Az,Ax,A0,A5,Av,A4=A1.cdo,A3=A1.handles;A1.attachBtn=A1.baseNode.one("#attachment-button-input");if(NeoConfig.bidi){A1.baseNode.all(".cm-subject-field").plug(AL.Plugin.BidiTextEntry);}if(NeoConfig.backButton&&(typeof history.state==="object")){if(!history.state||!history.state.id){history.pushState({id:"1"},document.title,window.location.pathname+window.location.search);}if(!window.location.hash.length){history.replaceState({id:"1"},document.title,"#mail");}}A3.push(A1.editor.on({keyDown:function(A8){var A7=false;if(A8.ctrlKey||A8.metaKey||A8.altKey||A8.shiftKey){A7=A1.author?A1.author.onKeyDown(A8):A1.onKeyDown(A8);}if(A7){A8.halt();}else{A1._setDirty();}},nodeChange:function(A7){A1._updateRTToolbar(A7);},focus:function(A7){A1._registerFocus(A7.editor);},mousedown:function(A7){A1.header._removeLozengeHighlights();},drop:function(A9){var A7=A1.attView,A8=A7&&A7.uploader;A1._setDirty();if(A8&&A8.uploaderType===o.UploaderService.UPLOADER_TYPE_HTML5&&A8._ddEventHandler&&A1.author.get("active")){}},paste:function(){A1._setDirty();},ready:function(){if(A1.focusNode){A1.setFocus(A1.focusNode);}}}));A3.push(A4.on("compose:restoreFocus",function(){if(A1.focusNode instanceof AL.Node){A1._restoreFocus();}else{A1.setFocus("body",0,1);}},A1));A1._bindTextSwitchFresh(A3);A3.push(AL.on("click",function(A9){var BA=A9.currentTarget.get("parentNode").get("id");A9.halt(false);if(A1.allowEdit){var A8=BA==="btn-show-cc-in-to"||BA==="btn-show-cc-in-cc",A7="cmps_"+(A8?"shwcc":"hdcc");A1.header._cmdBccSwitch(A8,"cc");AL.fire("mt:click",{action:A7,append:{t1:"cmpsTb"}});}A1._restoreFocus();},A1.baseNode.all("span.cc-btn a")));A3.push(AL.on("click",function(A9){var BA=A9.currentTarget.get("parentNode").get("id");A9.halt(false);if(A1.allowEdit){var A7=BA==="btn-show-bcc-in-to"||BA==="btn-show-bcc-in-cc",A8="cmps_"+(A7?"shwbcc":"hdbcc");A1.header._cmdBccSwitch(A7,"bcc");AL.fire("mt:click",{action:A8,append:{t1:"cmpsTb"}});}A1._restoreFocus();},A1.baseNode.all("span.bcc-btn a")));A3.push(A1.baseNode.delegate("click",function(){A1._clearOriginTimers();A1._displayLoading();Q.fetchOrigin(A4,A1.isDraft);},"a.retryOrigin"));A1.once("renderComplete",function(){A1.contentLoaded=true;AL.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(A7){});});if(NeoConfig.fullPage||(AL.UA.ie&&AL.UA.ie>=8)){A1.resizeHandle=AL.on((AL.UA.ie&&AL.UA.ie<8)?"resize":"windowresize",function(){A1._resizeComposePage();});}if(NeoConfig.intl!=="jp"){if(NeoConfig.isFresh){A1._addFocusListenersFresh();}}A3.push(A1.baseNode.on("keydown",function(A9){var A8,A7=A9.target;if(A9.keyCode===13){if(A7.ancestor("div.rte-well-container")){A9.halt();A1.focusNode=A7;A8=A7.one("b");A8&&A8.simulate("click");}}}));Av=A1.attachBtn;if(Av){A3.push(Av.on({focus:function(A7){Av.ancestor("span").addClass("focused");},blur:function(A7){Av.ancestor("span").removeClass("focused");},click:function(A7){if(A1.attView&&A1.attView.uploader&&A1.attView.uploader.uploaderType===o.UploaderService.UPLOADER_TYPE_YUI&&!A1.attView.formUploader){A1.attView.switchToFormUploader({skipDefault:true});}}}));}A1.handles.push(A1.on("compose:dirty",function(A9){if(!A1.enableSaveDraft){var A8=A1.author.get("contentToolbar"),A7=A8&&A8.root.one(".savedraft");A7&&A7.removeClass("disabled");A1.enableSaveDraft=true;}}));A1._showSendBtn(false);}function I(Y){var Aw=this,Av=Aw.author.get("contentToolbar"),Au=Av&&Av.root.one("#btn-send");if(Y){Au&&Au.removeClass("disabled");}else{Au&&Au.addClass("disabled");}}function y(){var Az=this,Ax,A2,A7,Au=["bold","italic","underline"],Av,A8,Ay,A4,A6,A0,A5,Y,Aw,A3=Az.handles;Az.baseNode.one("div.attachments-well").addClass(AP);A5=Az.baseNode.one("div.format-pane");A2=A5.all("select");A3.push(AL.on("change",function(A9){Az._invokeAction(A9.currentTarget.get("parentNode"),A9.currentTarget.get("value"));},A2));var A1=A5.all(".btn");A3.push(AL.on("click",function(BB){var BA=BB.currentTarget,A9=BA.getAttribute("data-action"),BC="cmps_wl_";if(A9=="menu"){BC+=BA.get("id");}else{BC+=A9;}AL.fire("mt:click",{action:BC,append:{t1:"cmpsTb"}});BB.preventDefault();Az._invokeAction(BB.currentTarget,"");},A1));A1.each(function(BA){var BB,A9=Au.length,BC=BA.getAttribute("data-action");if(BC){for(BB=0;BB<A9;BB++){if(Au[BB]==BC){BA.addClass("btnpress");}}}});Az._intlBindUIRTE();}function AV(){}function AU(){var Au=this,Y;if(NeoConfig.useAttComposerTT){Y=Au.cdo.attachments.count();}else{Y=Au.cdo._getAttachmentsCount();}if(Y!==0){Au.baseNode.one("div.attachments-well").removeClass(AP);}else{Au.baseNode.one("div.attachments-well").addClass(AP);}Au._initializeSpellCheck();}function AF(Av){var Ax=this,Au,Aw;if(Av){Ax.parent=Av;Au=U(Am._shared_module_compose_fresh.base,Ax.cdo,Ax.formatters,null,strings,Am);Av.append(Au);Ax.baseNode=Av.one(".compose.content");if(!NeoConfig.useAttComposerTT){Ax.attView=new o.AttachmentView(Ax.cdo,Ax.parent);}Ax.compArea=Ax.baseNode.one("div.compose-message").one("div.inner");Ax.loadingArea=Ax.compArea.one("div.cm-loadingpane");var Y=Q.getDefaultFontInfo(!Ax._isRTEActive());Ax.richFontInfo.fontFamily=Y.fontFamily;Ax.richFontInfo.fontSize=Y.fontSize;Aw=Ax.baseNode.one("div.cm-plaintext");if(Aw){Aw.get("parentNode").removeChild(Aw);}if(AL.UA.gecko&&!NeoConfig.fullPage){Ax.compArea.ancestor("td").setStyle("height","0");}Ax._switchEditModeFresh(Ax._isRTEActive());Ax.header.enableHeader(false);Ax._renderWellsFresh();Ax.bindUI();Ax.header.render();Ax.composeViewRendered=true;}}function Ab(){var Av=this,Au=Av.handles;
function Y(Ax){var A3=Ax.params,Ay,A1,Aw,Az,A0={format:1};if(!A0.hasOwnProperty(A3.tab)){return;}if(!Av.baseNode){return;}A3.tooltip=A3.tooltip||"";if(A3.tab!=="format"){return;}A1=A3.name||"Stationery";Aw="<span class='btn menu' data-app='"+Ax.appInstance+"'>"+"<a class='neo-tooltip icon "+A1+"' href='#' title='"+A3.tooltip+"'>"+"<i role='presentation' class='plaintext'>"+A3.label+"</i></a></span>";Az=S(Aw);try{Av.baseNode.one("."+A3.tab+"-pane").one(".om-buttons").append(Az);}catch(A2){}Ay=AL.stamp(Az);Au.push(Az.on("click",function(A4){A4.preventDefault();Ax.handler(Ay,Av);}));Au.push(AL.on("om:click_btn",function(A4){if(!A4.app||!A4.app.instance||!A4.tab){return;}if(Ax.appInstance==A4.app.instance){Ax.handler(Ay,Av);}}));}AL.each(AT,Y);Au.push(AL.on("om:compose_add_btn",function(){Y(AT[AT.length-1]);}));}function N(Ax,Aw){var Ay=this,Au=Ay.handles,Av=S("<ul class='om-buttons'></ul>"),Y=Ay.baseNode.one("div.rte-well-container");if(AL.Tictac&&AL.Tictac.dropbox&&AL.UA.ie==0){Av.appendChild(Ax);Y.addClass("largefiles");}if(AL.Tictac&&AL.Tictac.dropbox){Av.appendChild(Aw);Au.push(Aw.on("click",function(Az){AL.fire("mt:click",{action:"cmps_attlgfl",append:{t1:"cmpsTb"}});Az.preventDefault();}));Y.addClass("largefiles");}if(Ay.attView){Ay.attView.attachLargeBtn=Av;}if(Ay.attComposer){Ay.attComposer.attachLargeBtn=Av;}Au.push(AL.on("om:click_btn",function(Az){if(!Az.app||!Az.app.instance||!Az.tab){return;}}));}function Ad(){var A6=this,Au,A0,Y,BA,Av,BB,A2,Ax,A3,A5,Az=A6.cdo,A7,Aw,Ay,A4;A6.editor.render(A6.baseNode);if(NeoConfig.useAttComposerTT){Aw=A6.baseNode.one("input[type=file]").ancestor("div");Ay=A6.baseNode.one("div.attachments-well");A4=A6.baseNode.one("div.cm-rtetext");A6.attComposer=AL.mail.tt.attcomposer.make(A6,A6.cdo,Aw,Ay,A6.editor);if(A6.onAttachmentsReady){A6.onAttachmentsReady(A6.cdo);}}A6._bindWellUIFresh();A7=A6.baseNode.one("div.format-pane");A6.formatButtons=A7.all(".btn");A6.fontFamilyOptions=A7.all("span.showFontStyle select option");A6._bindCDO();if(A6._isOrigin()){A6.slowOriginReqTimer=setTimeout(function(){A6._handleSlowOriginRequest();},F);A6.loadingTimer=setTimeout(function(){A6._displayLoading();},At);A6.editor.hideArea();if(A6.cdo&&A6.cdo.get("passive")){var A1=A6.cdo.get("content");A6.contentChangeAfter(A1);A6.replyheaderChangeAfter();A6.replyContentChangeAfter(A1);if(A6.cdo.get("attachments")){for(var A8=0,A9=Az.oComposeData.attachments.length;A8<A9;A8++){A6.attView.addNewAttachment(A8);}}}else{Q.fetchOrigin(Az,A6.isDraft,A6.stopwatch,function(){if(A6.isDraft&&Az&&Az.oComposeData&&Az.oComposeData.origin&&Az.oComposeData.origin.oMsg){A6.draftMID=Az.oComposeData.origin.oMsg.mid;}});}if(A6.isDraft){AL.Lang.later(90,null,function(){A6.fire("darlaEvent",{action:"compose_draft"});});A6.hasHardDraft=true;A6.draftMID=Az.oComposeData.origin.oMsg.mid;}else{A3=Az.get("origin");AL.Lang.later(90,null,function(){A6.fire("darlaEvent",{action:"compose_"+A3.action});});}Y=Az.oComposeData.origin.oMsg;BA=Y&&Y.header&&Y.header.to;Av=A6.baseNode.all("#from-field option");AL.Array.some(BA||[],function(BC){Av.each(function(BE,BD){var BF=BE.get("value").replace(/.+\<(.+)\>/,"$1");if(BC.email==BF){AL.later(100,A6,function(){BE.get("parentNode").set("selectedIndex",BD);});return true;}});});A5=Y.header?Y.header.from:Y.from;if(A5&&A6.isDraft){AL.later(10,A6,function(){A6.header._setFromMenu(Y.header.from);});}}else{Au=Az.get("header");A6.header.setHeader(Au);A6._allowEditing(Az.get("content"));A6.dirty=Az.get("prePopulated");A6.setFocus((Au.to&&Au.to.length>0)?"body":"to");A6.fire("darlaEvent",{action:"compose_new"});}if(NeoConfig.fullPage){A6._resizeComposePage();}else{if(A6.editor.get("ready")){A6.editor.resize(true);}}if(Az.get("passive")){A6.dirty=1;}A2=A6.richFontInfo.fontFamily;Ax=A6.richFontInfo.fontSize;A6.fontFamilyOptions.each(function(BC){var BD=BC.get("value");if(BD===A2){BC.set("selected",true);}});if(Ax){BB=parseInt(Ax.replace("pt",""),10);BB=AL.Array.indexOf(R,BB);if(BB>=0){A6.selectedFSIndex=BB;}}A6.selectedFNIndex=A2;if(A6.attComposer){A6.addAttachMenuItems(A6.attComposer.btnAttachOption,A6.attComposer.btnAttachCloud);}A6._initOpenMailButtons();}function l(){var Az=this,Ax=Az.handles,Aw=Az.baseNode.one("div.rte-well-container"),Ay=[".attachments-pane","#btn-fontname a","#btn-fontsize a","a.bold","a.italic","a.underline","#btn-forecolor a","#btn-backcolor a","#btn-insertunordered a","#btn-insertnumbered a","#btn-outdent a","#btn-indent a","a.align-l","a.align-c","a.align-r","#links a","#emoticon a","a.Stationery","#spellCheck a","#btn-spell-langs a",".btn-isRich a",".btn-isPlain a"];function Y(){var A0;if(Ay[Az.rteTabIndex]===".btn-isRich a"||Ay[Az.rteTabIndex]===".btn-isPlain a"){return Aw.one(Ay[Az.rteTabIndex]);}if(!Az._isRTEActive()&&Ay[Az.rteTabIndex]==="#attach-btn-menu a"){Az.rteTabIndex=Ay.length-1;return Aw.one(Ay[Az.rteTabIndex]);}do{A0=Aw.one(Ay[++Az.rteTabIndex]);}while(!A0||A0.ancestor().hasClass(AP)||A0.ancestor().getStyle("display")==="none");return A0;}function Av(){var A0;if(Az.rteTabIndex===0){return Aw.one(Ay[Az.rteTabIndex]);}if(!Az._isRTEActive()&&Ay[Az.rteTabIndex]===".btn-isPlain a"){Az.rteTabIndex=1;return Aw.one(Ay[Az.rteTabIndex]);}do{A0=Aw.one(Ay[--Az.rteTabIndex]);}while(!A0||A0.ancestor().hasClass(AP)||A0.ancestor().getStyle("display")==="none");return A0;}function Au(A3){var A1,A0,A2=Az.baseNode.one(".attachments-pane");switch(A3.keyCode){case 9:if(!A3.shiftKey){A1=Az.baseNode.one(".attachments-well");if(A1&&!A1.hasClass(AP)){A0=A1.one('li.attachmentVisible span.left a[tabIndex="0"]');if(!A0){A0=A1.one("li.attachmentVisible span.left a");A0&&A0.set("tabIndex","0");}}else{A3.target.blur();Az.setFocus("body");A3.halt();}}break;case 13:case 32:if(A3.target!==A2){A3.target._node.click();}else{A3.target.one("input")&&A3.target.one("input")._node.click();}break;case 37:A3.target&&A3.target.set("tabIndex","-1");A0=Av();A0&&A0.set("tabIndex","0");A0.focus();break;case 39:A3.target&&A3.target.set("tabIndex","-1");A0=Y();A0&&A0.set("tabIndex","0");A0.focus();
break;default:}}Ax.push(Aw.delegate("keydown",Au,"div.attachments-pane, span.btn, span.menu"));}function c(A0){var Ay=this,A4=A0.keyCode,A2,A3=(A0.ctrlKey||A0.metaKey)&&(!A0.altKey&&!A0.shiftKey),Aw=AL.UA.os,Y=(A0.ctrlKey&&(Aw==="windows"||Aw==="win"))||(A0.metaKey&&(Aw==="macintosh"||Aw==="mac")),Av=Y&&A3,Az=null,Au,Ax=false;switch(A4){case 85:if((Y&&A0.shiftKey)&&!AL.UA.ie&&(!AL.UA.gecko||AL.UA.gecko>1.92)){Au=Ay.baseNode.one(".attachments-pane input");Au._node.click();A0.halt();}break;case 13:if(Y&&!A0.altKey){Ax=(A0.shiftKey?true:false);var A1={spid:"sent",append:{t1:"cmpsTb",actn:"keybrd"},action:"tlbr_send"};if(Ay.lastSendState){A1.append.ltxt=Ay.lastSendState;}AL.fire("mt:click",A1);Ay._handleSendAction(Ax);if(A0.frameEvent){A0.frameEvent.halt();}A0.halt();return true;}else{if(A0.target.get("nodeName")=="A"){A0.target.simulate("click");return true;}}break;case 83:if(A3){Ay._invokeSaveDraft();if(A0.frameEvent){A0.frameEvent.halt();}A0.halt();return true;}break;case 89:if((A0.ctrlKey||A0.metaKey)&&A0.shiftKey){A0.halt();if(Ay.allowEdit){Ay._cmdTextSwitch();}return true;}break;case 219:case 221:AL.fire("tabview:handleKeyDown",A0);break;default:break;}if(A0.frameEvent){if(A3||(NeoConfig.bidi&&A0.ctrlKey)){switch(A4){case 66:Az="bold";break;case 73:Az="italic";break;case 85:Az="underline";break;case 16:if(NeoConfig.bidi){Az="bidi";}break;case 86:Ay._setDirty();break;default:break;}if(Az){if(Ay._isRTEActive()){Az=Ay.baseNode.one(".format-pane .btn[data-action="+Az+"]");clearTimeout(Ay.formatShortcutTimer);Ay.formatShortcutTimer=setTimeout(function(){Ay._invokeAction(Az,"",true);},100);}A0.frameEvent.halt();return true;}}else{if(A0.shiftKey){if(A4==9){Ay._handleShiftTabFresh(A0);}}}}if(A3){return true;}return false;}function D(Ay){var A0=this,Au=A0.baseNode.one("div.rte-well-container"),Az=Au.one("li.active b"),Y,Aw=Au.one(".rich-text-switch-pane"),Ax=Au.one(".attachments-well"),Av;A0.rteTabIndex=0;if(Ax&&!Ax.hasClass(AP)){Ax.all("li.attachmentVisible span.left a").each(function(A1){if(!Y&&A1.get("tabIndex")=="0"){Y=A1;}});if(!Y){Y=Ax.one("li.attachmentVisible span.left a");Y&&Y.set("tabIndex","0");}}else{Y=Au.one(".attachments-pane");Y&&Y.set("tabIndex","0");}Y&&A0.setFocus(Y);Ay.frameEvent.halt();}function g(Au){var Y=AL.Node.getDOMNode(Au);if(Y!==null){return(Y.tagName.toUpperCase()=="DIV");}return false;}function AH(){var Av=this,Y=Av.cdo,Au;if(!Av.handles){Av.handles=[];}Au=Av.handles;Au.push(Y.after("contentChange",function(Aw){Av.contentChangeAfter(Aw);}));Au.push(Y.after("isRichTextChange",function(Aw){Av.editor.set("isRich",!NeoConfig.low_bandwidth&&Aw.newVal);if(NeoConfig.isFresh){Av._switchEditModeFresh(Aw.newVal);}else{Av._switchEditMode(Aw.newVal);}}));Au.push(Y.after("replyheaderChange",function(){Av.replyheaderChangeAfter();}));Au.push(Y.after("replycontentChange",function(Aw){Av.replyContentChangeAfter(Aw);}));Au.push(Y.after("originerrorChange",function(Ax){Av._clearOriginTimers();var Aw=Ax.newVal;if(Aw.code!=r.net.Error.abort){Av._writeLoadingHtml("err");}}));if(NeoConfig.useAttComposerTT){Av._bindAttachmentsTT();}else{Av._bindAttachments();}}function AN(){var Av=this,Y=Av.cdo,Au=Av.handles;Au.push(Y.on("CDO_ATTACHMENT_ADDED",function(Ay,Ax,Aw){Av._setDirty();if(!Aw){Av.attachmentsLoading[Ax]=1;}Av.editor.resize();}));Au.push(Y.on("CDO_ATTACHMENT_DELETED",function(Ax,Aw){Av._setDirty();Av.editor.resize();Av.attachmentsLoading[Aw]=0;if(AL.UA.os=="macintosh"&&AL.UA.chrome>=11){Av.setFocus("body",0,1);}else{Av._restoreFocus();}}));Au.push(Y.on("CDO_ATTACHMENT_PROCESSED",function(Ax,Aw){Av._setDirty();Av.attachmentsLoading[Aw]=0;}));Au.push(Y.on("CDO_ATTACHMENT_FILES_SELECTED",function(Ax){var Aw=Av.attachBtn;if(Aw){Aw.blur();}if(AL.UA.os=="macintosh"&&AL.UA.chrome>=11){Av.setFocus("body",0,1);}else{Av._restoreFocus();}}));}function Ac(){var Av=this,Au=Av.cdo.attachments,Y=Av.handles;Y.push(Au.on("added",function(Aw){Av._setDirty();Av.editor.resize();}));Y.push(Au.on("deleted",function(Aw){Av._setDirty();Av.editor.resize();}));Y.push(Au.on("updated",function(Aw){if(!Aw.isUploadDone()){return;}Av._setDirty();}));}function AG(Y){var Au=this;if(!Y.uiUpdate){Y.newVal?Au.editor.setContent(Y.newVal,!Y.textConvert||AL.UA.gecko):Au.editor.setContent(Au.cdo.get("content"));}}function Ap(){var Av=this,Au=Av.cdo.get("header"),Y;Av.header.setHeader(Au);Y=Au.subject;Av.author.updateTabTitle(AX(J(Y)));if(NeoConfig.bidi){Av.author.updateTabDirection(AL.Intl.detectDirection(Y));}}function j(Y){var Av=this;var Au=Av.cdo.get("header");Av._allowEditing(Y.newVal,(Au.cc&&Au.cc.length>0)?Au.cc:"");Av.header.enableSwitchReplyButton();Av.dirty=false;Av.setFocus((Au.to&&Au.to.length>0)?"body":"to");}function v(Y){var Au=this;Au.baseNode.one("div.format-pane").all("span").each(function(Av){if(!Av.hasClass("last")){Av.setStyle("display",Y?"":"none");}else{if(Y){Av.hasClass("btn-isPlain")?Av.addClass("hidden"):Av.removeClass("hidden");}else{Av.hasClass("btn-isPlain")?Av.removeClass("hidden"):Av.addClass("hidden");}}});}function t(Y){var Au=this;if(!Au.rtSwitch){Au.rtSwitch=Au.baseNode.all("a.switchtext");}Y.push(Au.rtSwitch.each(function(Av){Av.on("click",function(Aw){AL.fire("mt:click",{action:"cmps_stchpt",append:{t1:"cmpsTb",ltxt:(Au._isRTEActive()?"plaintext":"richtext")}});Aw.halt(false);if(Au.allowEdit){Au._cmdTextSwitch();}});}));}function Ah(){function Y(){Ax.editor.baseNode.fire("beforeModeSwitch");Ax.editor.set("content",Ax.getContent());Ax.cdo.updateData({content:Ax.getContent()});Ax._setDirty();}function Av(){Y();Q.toPlainText(Ax.cdo,Ax.editor.get("content"));Ax.setFocus("body");Ax.editor.baseNode.fire("afterModeSwitch");}var Ax=this,Au,Aw;if(Ax._isRTEActive()){if(Ax.editor.hasContent()){Aw=true;Ax.confirm(strings.str_rte_plaintext,strings.str_comp_conf_plainText,Av);}else{Av();}}else{Y();Q.toRichText(Ax.cdo);Ax.editor.baseNode.fire("afterModeSwitch");}!Aw&&Ax.setFocus("body");}function Ao(){return !NeoConfig.low_bandwidth&&this.cdo.get("isRichText");}function Ar(){return(this.spellCheckView&&this._isRTEActive());
}function O(Y){return this.baseNode.one(".cm-"+Y+" ul li");}function B(){return this.editor.getContent();}function AA(){return this.editor.getRTE();}function Ae(Ax,Aw,Y){var Az=this,Av=true,Ay,Au=Az.editor.getRTE();if((typeof Ax=="string")){Ay=Az.baseNode.one(".compose-header");switch(Ax){case"to":case"cc":case"bcc":case"subject":Ay=Az.baseNode.one(".compose-header");Ax=Ay.one(".cm-"+Ax+"-field");break;case"body":Ax=Au;Av=(Y&&AL.UA.os=="macintosh"&&AL.UA.chrome>=11)?0:Az.editor.get("ready");break;}}if(Av){if(Ax==Au){Az.editor.setFocus(Aw);}else{Ax&&Ax.focus();}}Ax&&Az._registerFocus(Ax);}function AW(Av,Y){var Aw=this,Au;Y=Y||"";Aw._clearOriginTimers();Aw.header.enableHeader(true);Aw.editor.showArea();Aw.loadingArea.addClass(AP);Aw._activateWellFresh();if(Av){Aw.editor.setContent(Av,!Aw.isDraft);}Aw.header.allowEditing(Av,Y);Aw.allowEdit=true;Aw.fire("renderComplete");}function e(Y,Av){var Ax=this,Au=null,Aw=Av;switch(Y){case"fontname":Au="userUIPref.composeFontFamily";break;case"fontsize":Au="userUIPref.composeFontSize";Av=parseInt(Av,10);Av=R[--Av];break;default:break;}if(Au&&Av){Q.savePref(Au,Av);}}function Z(A0,Y){var Az=this,Aw=T[A0],Av,A1,Ay,Au,Ax;if(Aw){A0=Aw;}if(A0!=="notyet"){if(A0==="emoticon"){AL.later(10,Az,function(){Ax=Y.indexOf("*");Ay=Y.slice(0,Ax);Ay=Ay.replace(/emoticon_(\d+)/,Az.formatters.global_path_img()+"/emoticons/emo$1.gif");Au=Y.slice(Ax);Au=Au.replace(/"/,"&quot;").replace(/</,"&lt").replace(/>/,"&gt;").replace(/&/,"&amp;");Y='<img src="'+Ay+'" alt="'+Au+'">';A0="insertandfocus";Az._setComposePreference(A0,Y);Az._invokeRTECommand(A0,Y);},null,null);}else{Az._setComposePreference(A0,Y);Az._invokeRTECommand(A0,Y);}}}function z(Y,Au){var Av=this;Av._setDirty();Av.setFocus("body",function(){Av.editor.execute(Y,Au);});}function s(){var Aw=this,Av,Au,Y=Aw.handles;if(!Aw._formatPane){Aw._formatPane=Aw.baseNode.one(".format-pane");}Av=Aw._formatPane.one(".btn[data-action="+"spellcheck"+"]");Au=Av.next();Y.push(Av.on("click",function(Ax){Aw._doSpellCheck();Ax.preventDefault();}));Y.push(Au.on("click",function(Ax){Aw._openSpellCheckMenu(Ax);Ax.preventDefault();}));}function Ak(Au,Av,Ax){var Aw=this,Y;AL.use("editor-lists","createlink-base",function(Ay){Aw.editor.plug(Ay.Plugin.EditorLists);Y=Au.getAttribute("data-action");if(Y&&(Y==="color"||Y==="hilitecolor")){}else{if(Y&&Y!="menu"){if((Y=="bold")||(Y=="italic")||(Y=="underline")){Au.toggleClass("pressed");}else{if(Y&&Y==="insertlink"){Ay.Plugin.CreateLinkBase.STRINGS.PROMPT=strings.str_comp_createlink_prompt;Ay.Plugin.CreateLinkBase.STRINGS.DEFAULT=strings.str_comp_createlink_default;}else{if(Y&&Y==="bidi"){if(!Ax){Av=Au.getAttribute("value");}}}}Aw._invokeDataAction(Y,Av);}else{if(Au.hasClass("menu")){Aw._showMenus(Au);}}}});}function AI(Aw,Y){if(Aw){var Ay=this,Ax=Y+1;if(Ay.selectedFN!==null){Ay.selectedFN.removeClass("checked");}var Au=Aw.all("li[data-value]"),Av;Au.each(function(Az){Av=Az.getAttribute("data-value");if(Av.toLowerCase().indexOf(Y)>=0){Ay.selectedFN=Az;}});if(Ay.selectedFN){Ay.selectedFN.addClass("checked");}}}function A(Au,Y){if(Au){var Aw=this,Av=Y+1;if(Aw.selectedFS!==null){Aw.selectedFS.removeClass("checked");}Aw.selectedFS=Au.one("li[data-value="+Av+"]");if(Aw.selectedFS){Aw.selectedFS.addClass("checked");}}}function AE(Au){toolTipIns&&toolTipIns.hide();var A2=this,Av,A5,Az,A4,Ax,Aw,A3,A1,A0,A7,A8,Ay=false,Y,A6=A2.handles;if(Au.menu){if(Au.get("id")==="btn-fontname"){A2.selectFontNameInMenu(A2.fontNameMenu,A2.selectedFNIndex);}return;}A4=Au.get("id");switch(A4){case"btn-text-align":Az=Am._shared_module_offscreen_bin_compose_menu_text_align.base;break;case"btn-fontname":Y=U(Am._shared_module_rte_well_content_fontname_fresh.base,A2.cdo,A2.formatters,null,strings,Am);break;case"btn-fontsize":Az=Am._shared_module_rte_well_content_fontsize_fresh.base;break;case"emoticon":Az=Am._shared_module_rte_well_content_emoticons_fresh.base;break;case"btn-forecolor":case"btn-backcolor":A3=[["000000","111111","2d2d2d","434343","5b5b5b","737373","8b8b8b","a2a2a2","b9b9b9","d0d0d0","e6e6e6","ffffff"],["7f7f00","bfbf00","ffff00","ffff40","ffff80","ffffbf","525330","898a49","aea945","c3be71","e0dcaa","fcfae1"],["407f00","60bf00","80ff00","a0ff40","c0ff80","dfffbf","3b5738","668f5a","7f9757","8a9b55","b7c296","e6ebd5"],["007f40","00bf60","00ff80","40ffa0","80ffc0","bfffdf","033d21","438059","7fa37c","8dae94","acc6b5","ddebe2"],["007f7f","00bfbf","00ffff","40ffff","80ffff","bfffff","033d3d","347d7e","609a9f","96bdc4","b5d1d7","e2f1f4"],["00407f","0060bf","0080ff","40a0ff","80c0ff","bfdfff","1b2c48","385376","57708f","7792ac","a8bed1","deebf6"],["00007f","0000bf","0000ff","4040ff","8080ff","bfbfff","212143","373e68","444f75","585e82","8687a4","d2d1e1"],["40007f","6000bf","8000ff","a040ff","c080ff","dfbfff","302449","54466f","655a7f","726284","9e8fa9","dcd1df"],["7f007f","bf00bf","ff00ff","ff40ff","ff80ff","ffbfff","4a234a","794a72","936386","9d7292","c0a0b6","ecdae5"],["7f003f","bf005f","ff007f","ff409f","ff80bf","ffbfdf","451528","823857","a94a76","bc6f95","d8a5bb","f7dde9"],["800000","c00000","ff0000","ff4040","ff8080","ffc0c0","441415","82393c","aa4d4e","bc6e6e","d8a3a4","f8dddd"],["7f3f00","bf5f00","ff7f00","ff9f40","ffbf80","ffdfbf","482c1b","855a40","b27c51","c49b71","e1c4a8","fdeee0"]];A1=A3[0].length;A0=A3.length;Az=["<div id='menu-color-picker' class='optionMenu colorPickerMenu'>"];Aw=(A4=="btn-forecolor")?"forecolor":"backcolor";for(A7=0;A7<A0;A7++){Az.push("<ul>");for(A8=0;A8<A1;A8++){Az.push("<li style='background-color:#",A3[A7][A8],";' data-action='",Aw,"' data-value='#",A3[A7][A8],"'><a href='#'></a></li>");}Az.push("</ul>");}Az.push("</div>");Az=Az.join("");break;default:break;}if(Az){Y=U(Az,null,null,null,strings);}if(Y){Ax=A2._showRTEMenu(Y,Au,function(A9){A2.handles.push(A9.on("menuSelected",function(BA){A2._invokeDataAction(BA.dataAction,BA.dataValue);}));});}}function M(Ay,BH){var BB=this,BC=BB.header.getHeader(),A5=true,A1=false,Az=0,BJ=BB.cdo._getAttachments(),Aw,Y,A2,BI,BG,A6,BE,A8=true,A3,Au=BB.getRTEInstance(),BA,A4,Ax;
if(BB.isSending){return;}Ax=function(BK){BB.allowSend=true;if(!BK){BB.setFocus("body",0,1);}else{BB._restoreFocus();}};if(BB.allowSend){if(BB.baseNode.one(".file-attach .downloading:not(.hidden)")||(NeoConfig.useAttComposerTT&&BB.cdo.attachments.areAnyUploading&&BB.cdo.attachments.areAnyUploading())){AL.use("common-ui-dialog-helper",function(BK){BB.allowSend=false;r.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_still_uploading,suppressRestoreFocus:true},{ok:{handler:Ax},cancel:{handler:Ax}});});BB.lastSendState="attInPrgrss";return;}}else{return;}if(BB.attView&&BB.attView.checkOverLimit()){BB.lastSendState="attOvrLmt";return;}if(NeoConfig.useAttComposerTT){A5=BB.cdo.attachments.areSendable();A1=BB.cdo.attachments.areAnyInfected();}else{while(A5&&BJ[Az]){Y=BJ[Az++].state;if(!Y.cancelled&&Y.failed){A5=false;}if(Y.failCause=="virus"){A1=true;}}}if(!A5){BB._alertInvalidAttachments(A1);BB.lastSendState="attInvld";return;}if(typeof BB.cdo.attachments==="object"&&!(BB.cdo.attachments.count())&&NeoConfig.attachAlert){var BF=Q.attachAlert(BB.getContent(),BB.cdo.get("content"));if(BF){BB.allowSend=false;var BD=strings.str_modal_send_msg_title,A9="You mentioned '"+BF+"' in your mail but there are no attachments! Send anyway?",A0=strings.str_comp_send;BB.confirm(BD,A9,function(){Av();},function(){Ax();},A0);}}if(!BC.validAddress){var A7=strings.str_comp_invalidAddressA+"<br><br>"+AX(BC.currentAddress)+"<br><br>";A7+=U(strings.str_comp_invalidAddressB,null,null,null,strings);BB._alertProblem(strings.str_comp_title_invalidAddr,A7);BB.lastSendState="addInvld";return;}if(BC.to.length<1&&BC.cc.length<1&&BC.bcc.length<1){BB._alertProblem(strings.str_comp_title_emptyToField,strings.str_comp_emptyToField);BB._registerFocus(AL.one("#to-field"));BB.lastSendState="addEmpty";return;}if(BH.saveBeforeSend){BB._invokeSaveDraft({saveBeforeSend:true});BB.lastSendState="svDrft";return;}BA=Au.all("a");BA.each(function(BL){var BK;try{BK=BL.get("href");}catch(BM){BK="";}if(typeof(BK)==="string"){BK=BK.replace(/&amp;/g,"&");BL.set("href",BK);}});A3=new AQ.Stopwatch("SendConfirm","start");Aw=BB.assembleSendBody();var Av=function(){var BN=BB.baseNode.one(".attachment-button-attach"),BL=BB.cdo.get("origin");if(BN){BN.fire("compose:close");}if(BB.isSending){return;}else{BB.isSending=true;}BB._cancelSaveTimer();BB.dirty=false;var BK={header:BB.header.getHeader(),content:Aw.html,textcontent:Aw.text};BB.cdo.updateData(BK);A2={draftMID:BB.draftMID,noScroll:Ay,keepDraft:BH.keepDraft?BH.keepDraft:false,cid:BL.oMsg&&BL.oMsg.cid};var BM=BB.cdo.oComposeData.header;BB.author.invokeSend(BB.cdo,A2,A3);};BI=Al(BC.subj);BG=Al(Aw.text);if(BB.getRTEDocNode().one("body img")){A8=false;}if(BI.length<1&&BG.length<1&&A8){A6=strings.str_modal_send_msg_title;BE=strings.str_comp_invalidSubjectAndContent;A4=strings.str_comp_send;BB.lastSendState="sbCntInvld";}if(BB.allowSend){if(BE){BB.allowSend=false;BB.confirm(A6,BE,function(){Av();},function(){Ax(AL.one("#subject-field"));},A4);}else{Av();}}}function V(Y){var Aw=this,Au,Av=Aw.baseNode.one(".attachment-button-attach");if(Y){Au=Aw.cdo.after("saveactionChange",function(Ax){Au.detach();Aw.author.set("forceClose",1);Aw.author.set("close",1);Av.fire("compose:close");});}else{Av.fire("compose:close");Aw.author.set("forceClose",1);Aw.author.set("close",1);}}function E(){}function AO(Aw){var Ax=this,Y=Ax.getRTEDocNode(),Av=Ax.getRTEInstance(),Au;Au=Aw?Ax.editor.getContentOnSave():Ax.editor.getContent();if(Ax._isSpellCheckActive()){o.Controller.SpellCheck.removeAllMarkers(Y,null);}return Q.assembleSendBody(Y,Ax.editor.richFontInfo,Au);}function n(){var Y=this;if(Y._isSpellCheckActive()){return;}if(Y.spellCheckView===null){if(strings.str_tog_spellcheckEnabled){Y.spellCheckView=new o.ui.SpellCheckView(Y,Y.cdo);Y.spellCheckView.bindCDO();}else{Y.spellCheckView=0;}}}function m(){var Y=this;AL.use("mail-ui-composeview-spellcheck",function(){Y._activateSpellCheck();if(Y._isSpellCheckActive()){Y.spellCheckView.doSpellCheck();Y.setFocus("body");Y.fire("darlaEvent",{action:"spell_chk"});}});}function x(Y){var Au=this;AL.use("mail-ui-composeview-spellcheck",function(){Au._activateSpellCheck();if(Au._isSpellCheckActive()){Au.spellCheckView.showLangMenu(Y);}});}function u(){return this.editor.getRTE().getInstance();}function Ag(){return this.getRTEInstance().one("doc");}function AZ(){this.editor.resize();}function H(){var Aw=this,Av,Y,Au;if(NeoConfig.fullPage){if(Aw.baseNode===null){return;}Av=Aw.baseNode.one("table");if(Av===null){return;}Au=parseInt(Av.one(".compose-header").getStyle("height"),10);Y=AL.one("body").get("winHeight")+Au;if(Y<Aa){Y=Aa;}Av.setStyle("height",Y+"px");if(AL.UA.ie){Aw.baseNode.setStyle("height",Y+"px");}}if(AL.UA.ie){Aw.editor.resize(true);}}function f(Ax){var Ay=this,Au,Y,Av,Aw=b.length;if(!0){Au=Ax.commands;Ay.formatButtons.removeClass("pressed");Ay.formatButtons.each(function(A1){var A0=A1.getAttribute("data-action"),Az=A1.hasClass("btnpress");if(A0&&Au[A0]&&Az){A1.addClass("pressed");}});if(Ax.fontFamily){Ay.selectedFNIndex=Ax.fontFamily;Ay.selectFontNameInMenu(Ay.fontNameMenu,Ay.selectedFNIndex);}if(Ax.fontSize.indexOf("pt")!==-1){Y=Ax.fontSize.replace("pt","");Ay.selectedFSIndex=Y;Ay.selectFontSizeInMenu(Ay.fontSizeMenu,Ay.selectedFSIndex);}else{Y=parseInt(Ax.fontSize.replace("px",""),10);if(!isNaN(Y)){Ay.selectedFSIndex=Ay._fontSizeMatch(Y);Ay.selectFontSizeInMenu(Ay.fontSizeMenu,Ay.selectedFSIndex);}else{if(AL.UA.webkit){Y=Ay._fontSizeMatchWebkit(Ax.fontSize);if(!isNaN(Y)){Ay.selectedFSIndex=Y-1;}Ay.selectFontSizeInMenu(Ay.fontSizeMenu,Ay.selectedFSIndex);}}}}}function k(Ax){var Ay=10000,Av,Au=Ax,Aw,Y=b.length;if(Au>7){for(Aw=0;Aw<Y;Aw++){Av=Math.abs(Ax-b[Aw]);if(Av<Ay){Ay=Av;Au=Aw;}}}else{if(Au){Au--;}}return Au;}function w(Y){var Au=Y=="-webkit-xxx-large"?7:Y=="xx-large"?6:Y=="x-large"?5:Y=="large"?4:Y=="medium"?3:Y=="small"?2:Y=="x-small"?1:Y;return Au;}function AD(Av,Au,Y){var Ax=this;var Aw=S(Av);AL.one("body").appendChild(Aw);if(Aw.get("id")==="menu-fontsize"){Ax.fontSizeMenu=Aw;
}if(Aw.get("id")==="menu-fontname"){Ax.fontNameMenu=Aw;}AL.use("comms-ui-menu-base",function(Az){Au.plug(Az.Plugin.Menu,{"menu":Aw});if(Au.get("id")==="btn-fontsize"){Ax.selectFontSizeInMenu(Ax.fontSizeMenu,Ax.selectedFSIndex);}if(Au.get("id")==="btn-fontname"){Ax.selectFontNameInMenu(Ax.fontNameMenu,Ax.selectedFNIndex);}Ax.handles.push(Aw.on("menu:state",function(A0){if(A0.state==="show"){Au.addClass("pressed");}else{if(A0.state==="hide"){Au.removeClass("pressed");}}}));Au.menu.show();function Ay(A0){switch(A0.keyCode){case 13:case 32:A0.currentTarget.simulate("mousedown");break;default:break;}}Ax.handles.push(Aw.delegate("keydown",Ay,"li"));Ax.handles.push(Aw.delegate("mousedown",function(A4){A4.halt();var A3=A4.target,A2=A4.currentTarget,A0=A3.ancestor(function(A6){return A6.getAttribute("data-action")||A6===A2;},true),A1=A0?A0.getAttribute("data-action"):0,A5=A0.getAttribute("data-value")||"";Aw.fire("menuSelected",{dataAction:A1,dataValue:A5,item:A0});Au.menu&&Au.menu.hide();},"li"));Y(Aw);});return Aw;}function L(Y){var Aw=this,Av,Au=o.model.DataStore.Messages.getPermMidPart;if(Y&&Y.oMsg&&Aw.draftMID){return Au(Aw.draftMID)==Au(Y.oMsg.mid);}if(!Aw._isOrigin()){if(!Y||!Y.oMsg){return true;}}if(Y&&Y.oMsg){Av=Aw.cdo.get("origin");return(Y.action===Av.action&&Y.fid===Av.fid&&Y.oMsg.mid===Av.oMsg.mid&&Y.forwardAsAttachment===Av.forwardAsAttachment);}return false;}function Af(){var Au=this,Y;Y=Au.cdo.get("origin");return(Y.action&&Y.fid&&Y.oMsg);}function AS(){var Au=this,Y;Y=Au.cdo.get("origin");Au._clearOriginTimers();Au._writeLoadingHtml(Y.errInfo=="ok"?"pop":"slow");}function p(){var Y=this;Y._writeLoadingHtml("start");}function h(Au,Y){this.editor.setContent(Au,Y);}function As(Au){var Y=this;if(Y.loadingArea.hasChildNodes()){Y.loadingArea.get("children").remove().destroy(true);}Y.loadingArea.appendChild(S(U(Aq.base,null,Y.loadFormatters,Au,strings,Am)));}function AY(){var Y=this;Y.slowOriginReqTimer&&clearTimeout(Y.slowOriginReqTimer);Y.loadingTimer&&clearTimeout(Y.loadingTimer);}function AC(Y){var Aw=this,Av,Au;if(Aw.allowSend){AL.use("common-ui-dialog-helper",function(Ax){Aw.allowSend=false;Av={hd:Y?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,bd:Y?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:true};Au=function(){Aw.allowSend=true;Aw._restoreFocus();};r.ui.DialogHelper.alert(Av,{ok:{handler:Au},cancel:{handler:Au}});});}else{Aw._restoreFocus();}}function i(Av,Au,Y){AT.push({params:AL.clone(Av),appInstance:Au,handler:Y});AL.fire("om:compose_add_btn");}function q(Y){var Av=this,Au;if(Av.isSaved()&&!Av.isDirty()){Y(Av.draftMID);return;}Au=Av.on("compose:saveSuccess",function(){Au.detach();Y(Av.draftMID);});Av._invokeSaveDraft();}AL.extend(AK,o.ui.MailCompose);AL.mix(AK.prototype,{NAME:"FullCompose",render:AF,bindUI:C,_bindWellUIFresh:y,onKeyDown:c,onFocus:g,handleActiveChanged:AB,handleToolbarSelection:G,handleCloseChange:Aj,updateToolbar:d,getContent:B,getRTE:AA,getRTEInstance:u,getRTEDocNode:Ag,getFirstNode:O,setFocus:Ae,contentChangeAfter:AG,replyheaderChangeAfter:Ap,replyContentChangeAfter:j,postRender:Ad,matchOrigin:L,setContent:h,addAttachMenuItems:N,_bindCDO:AH,_initOpenMailButtons:Ab,_addFocusListenersFresh:l,_handleShiftTabFresh:D,_handleSendAction:X,_intlBindUIRTE:E,_allowEditing:AW,_invokeDataAction:Z,_invokeRTECommand:z,_invokeAction:Ak,_isRTEActive:Ao,_updateRTToolbar:f,_resizeComposePage:H,_resizeRTE:AZ,assembleSendBody:AO,_invokeSend:M,_closeAfterWarning:V,_activateWellFresh:AU,_renderWellsFresh:AV,_switchEditModeFresh:v,_bindTextSwitchFresh:t,_cmdTextSwitch:Ah,selectFontSizeInMenu:A,selectFontNameInMenu:AI,_showMenus:AE,_showRTEMenu:AD,_alertInvalidAttachments:AC,_initializeSpellCheck:s,_activateSpellCheck:n,_isSpellCheckActive:Ar,_doSpellCheck:m,_openSpellCheckMenu:x,_isOrigin:Af,_handleSlowOriginRequest:AS,_displayLoading:p,_writeLoadingHtml:As,_clearOriginTimers:AY,_setComposePreference:e,_fontSizeMatch:k,_fontSizeMatchWebkit:w,_bindAttachments:AN,_bindAttachmentsTT:Ac,getMID:q,_showSendBtn:I,ondestroy:a},true);AL.namespace("mail");o.ComposeView=AK;AL.mix(o.ComposeView,{addButton:i},true);if(NeoConfig.intl==="jp"){AL.use("mail-ui-composeview-base-jp",function(Au){Au.extend(o.ComposeViewJp,AK);o.ComposeView=o.ComposeViewJp;});}},"1.0.0",{requires:["mail-ui-mailcompose","mail-ui-rteview","mail-ui-messagepane-utils","forms_css","rte_css","attachments_css","attachments-fresh_css","rte-fresh_css","mod-stationery_css","mod-compose_css","mod-compose-fresh_css","mail-ui-composeview-attach","editor-base","editor-para","editor-br","node","stylesheet","mail-controller-compose-text","mail-model-compose","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose","_shared_module_compose_fresh","_shared_module_toolbar_compose_fresh","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_emoticons_fresh","_shared_module_rte_well_content_fontname_fresh","_shared_module_rte_well_content_fontsize_fresh","_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_tabs_compose_fresh","common-ui-toolbar-base","common-ui-menu-helper","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align"]});YUI.add("_shared_module_compose_title",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_title={base:"<span class='compose'><span>{{str_comp_title}}</span>{{compose_title}}</span>"};},"1.0.0");YUI.add("_shared_module_offscreen_bin_notification_notifications",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_notification_notifications={base:"{{send_success}}{{send_error}}{{send_abuse}}",send_success:'<div class="nf-text">{{str_comp_msg_sent}}</div>',send_error:'<div class="nf-text">{{str_comp_not_sent}}<a href = "#" data-action="retry">{{str_retry}}</a></div>',send_abuse:'<div class="nf-text">{{str_comp_send_abuse_error}}</div>'};},"1.0.0");YUI.add("mail-ui-authorview-base",function(C){var F=C.Node.create,i="hidden",e=C.common.Utils,q=e.substitute,O=e.escapeHtml,Q=e.unescapeHtml,m="focus",A=C.Lang.trim,R=NeoConfig.isFresh;var X=function(Y){var s=this,r;s.keyCodes=[];s.keyCodesL10N={};s.parent=null;s.subview=null;s.subviews=[];s.cdo=null;s.composeView=null;s.composeViewTainer=null;s.sendConfirmView=null;s.sendConfirmViewTainer=null;s.captchaView=null;s.captchaViewTainer=null;s.localCharCodes=[8,77,78,73,84];s.composeActive=true;s.type="author";s.keyCodesL10N[strings["str_cfg_sc_keycode_save_as_draft"]]=83;s.keyCodesL10N[strings["str_cfg_sc_keycode_close_tab"]]=220;for(r in s.keyCodesL10N){s.keyCodes.push(r);}X.superclass.constructor.call(s,Y);s.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+s.keyCodes.join("+ctrl,")+"+ctrl,"+s.keyCodes.join("+meta,")+"+meta");if(C.UA.ie){s.set("localCharCodes",s.localCharCodes.join());}s.updateTabTitle(s.get("title"));s.dsMsgChgHandler=C.on("ds:msg:change",s.handleDSMessageChange,s);};function W(s,AA,u,AC,x){var y=this,AB=y.cdo&&y.cdo.oComposeData&&y.cdo.oComposeData.origin,r,t,v,Y=u&&u[0],w,z;if(AB){r=AB.oMsg;t=AB.fid;v=AB.action;}if((v=="reply_all"||v=="reply_sender"||v=="forward")&&x=="move"){for(w=0;r&&w<u.length;w++){z=u[w].mid;if(C.mail.model.DataStore.Messages.hasMoved(r.mid,z,t,s)){y.backToMessageTab=null;y.subview.showToolbarButtons&&y.subview.showToolbarButtons();y.dsMsgChgHandler&&y.dsMsgChgHandler.detach();return;}}}}function p(r){var s=this;var Y=(R)?"str_tabs_compose_fresh":"str_tabs_compose";r=r||strings[Y];s.set("title",r);}function k(Y){var r=this;r.set("direction",Y);}function l(s){var t=this,Y=t.localCharCodes.length,r;for(r=0;r<Y;r++){if(s==t.localCharCodes[r]){return true;}}return false;}function D(Y){var s=this,r=Y.keyCode;r=s.keyCodesL10N[r]||r;switch(r){case 220:if(!Y.altKey&&(Y.metaKey||Y.ctrlKey)){s.set("close",1);return true;}break;case 27:if(s.composeView){s.composeView.closeSrc="escKey";}s.set("close",1);return true;break;}if(C.UA.ie&&s.subview.onLocalKeyDown){if(!s.subview.onLocalKeyDown(Y)){return false;}}if(s.subview&&s.subview.onKeyDown){return s.subview.onKeyDown(Y);}else{return null;}}function T(Y){var r=this;if(r.subview.onFocus){return r.subview.onFocus(Y);}else{return null;}}function f(){var Y=this;if(Y.subview.isDirty){return Y.subview.isDirty();}else{return true;}}function B(){var Y=this;if(Y.subview.isSaved){return Y.subview.isSaved();}else{return false;}}function N(Y){var r=this;if(r.subview.matchOrigin){return r.subview.matchOrigin(Y);}else{return false;}}function j(Y){var r=this;r.set("contentToolbar",Y);if(Y){r.toolBarHandler=Y.on("itemSelected",Z,r);}}function Z(Y){var r=this;if(Y.item&&Y.item.ancestor().hasClass("disabled")){return;}if(r.subview.handleToolbarSelection){r.subview.handleToolbarSelection(Y);}else{}}function P(Y){var r=this;r.sendConfirmViewTainer.addClass(i);r.composeViewTainer.removeClass(i);r.composeView.isSending=false;r.composeView.updateToolbar();r.composeView.resetSaveTimer();if(Y){r.composeView.dirty=true;r.composeView.allowSend=true;}r.composeActive=true;r.subview=r.composeView;}function d(Y){var s=this,r;if(NeoConfig.isFresh){s.showComposeShim(true);if(s.notification){s.notification.hide();s.notification=null;}}else{s.sendConfirmView.fire("showSendConfirm");s.sendConfirmViewTainer.removeClass(i);s.composeViewTainer.addClass(i);s.sendConfirmView.updateToolbar();if(!Y&&NeoConfig.fullPage){r=C.config.win||window;r.scrollTo(0,0);}s.sendConfirmViewTainer.setAttribute("tabIndex","-1");s.set("focusNode",s.sendConfirmViewTainer.one(".col-a"));s.sendConfirmViewTainer.one(".col-a").focus();}s.composeActive=false;s.subview=s.sendConfirmView;}function h(s,r){var t=this,Y;s.cdo&&s.cdo.get("passive")?Y=s.cdo:Y=C.mail.Controller.Compose.createCDO();r=false||r;if(r){t.setDraftOrigin(Y,s);t.setDraftFromAddress(Y);}else{t.setMessageFromAddress(Y);t.setMessageOrigin(Y,s);}if(s&&s.cbfn){Y.set("prePopulated",true);s.cbfn(Y,s);}if((!s||!s.action||!s.fid||!s.oMsg)&&!(s.cdo&&s.cdo.get("passive"))){C.mail.Controller.Compose.insertSignature(Y);}return Y;}function U(r,Y){var s=this;Y=false||Y;s.cdo=s.initComposeData(r,Y);s.subview=s.createComposeView(s.cdo,Y,r);s.subviews.push(s.subview);if(r&&r.postRender){s.subview.handles.push(s.subview.on("renderComplete",function(){r.postRender(s,r);}));}if(r&&r.oMsg&&r.oMsg.header){r.oMsg.header.subject=C.mail.Controller.Compose.seedSubject(r);}return s.subview;}function E(Y,t,r){var s=this;r&&r.start(1,"moduleLoad");C.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base",function(w){var u=s.sendConfirmView?s.sendConfirmView.sdo:null,v=w.mail.persist.MetaData.get("cg.pref.general.showconfirmpage");if(r){r.start(1,"prepareSend");r.action="normal";}u=w.mail.Controller.Compose.transformSend(Y,u,t,true);s.createSendConfirmView(u,Y);w.mail.Controller.SendConfirm.sendMessage(u,r);w.use("contacts-api-utils",function(x){s.showSendConfirm(t.noScroll);});});}function I(Y,r){if(r&&r.action&&r.fid&&r.oMsg){Y.set("origin",{action:r.action,fid:r.fid,oMsg:r.oMsg,forwardAsAttachment:r.forwardAsAttachment,ctxReq:null});}}function K(Y){var r=Y.get("header");r.from=C.mail.Controller.Compose.getDefaultFromAddress();Y.set("header",r);}function M(Y,r){if(r&&r.action&&r.fid&&r.oMsg){Y.set("origin",{action:r.action,fid:r.fid,oMsg:r.oMsg,ctxReq:null});}}function V(Y){var s=Y.get("header"),r=Y.get("origin").oMsg;s.from=r.from?r.from:(r.header||{}).from;Y.set("header",s);}function g(t,Y){var x=this,w=Y.get("origin"),v=0,u=0,s=null,r=null;if(!!w&&w.action&&w.action=="reply_sender"||w.action=="reply_all"){v=1;}else{if(!!w&&w.action=="forward"){u=1;}}s=new C.mail.SendConfirmView({sdo:t,author:x,isReply:v,isForward:u});s.handles=[];s.handles.push(s.on("darlaEvent",function(y){x.fire("darlaEvent",y);}));r=F('<div class="hidden">');r.addClass(i);s.render(r);x.parent.appendChild(r);x.set("rootNode",x.parent.one("div.compose.content"));s.postrender(r);x.addChild(s);x.sendConfirmView=s;x.subviews.push(s);x.sendConfirmViewTainer=r;
}function H(Y,s,t){var u=this,r=null;r=new C.mail.ComposeView(Y,s,u,t);r.handles=[];r.handles.push(r.on("darlaEvent",function(v){u.fire("darlaEvent",v);}));u.addChild(r);u.composeView=r;return r;}function o(){var Y=this;Y.parent=Y.get("parentNode");Y.composeView.render(Y.parent);Y.composeViewTainer=Y.composeView.baseNode;Y.composeView.postRender();}function S(r){var s=this,Y=C.one(r);s.set("parentNode",Y);s.set("rootNode",Y.one("div.compose.content"));return;}function n(){return;}function G(Y){var r=this;r.composeViewTainer&&this.composeViewTainer.one(".composeshim")[Y?"removeClass":"addClass"]("hidden");r.disableToolbar(Y);if(Y){r.tab&&r.tab.elTab.addClass("sending");r.updateTabTitle(strings["str_comp_sending"]);}else{r.tab&&r.tab.elTab.removeClass("sending");r.setSubjectAsTitle();}}function b(r){var s=this,Y=C.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_error;if(r){C.use("common-ui-dialog-helper","_shared_module_offscreen_bin_modal_btn_generic",function(u){var v=e.substitute(u.ui.Templates._shared_module_offscreen_bin_modal_btn_generic.base,0,0,0,{btnID:"cancel","default":"default",btnLabel:strings.str_toolbar_back_to_message}),t={hd:r.title,bd:r.body,ft:v};u.common.ui.DialogHelper.createCommon(t,{cancel:{handler:function(){u.mail.Tabs.switchToTab(s.tab);}}});});}else{s.notification=new C.common.ui.Notification({sticky:true,type:"fade",className:"top"});s.notification.on("clickEvent",function(t){if(t.action=="retry"){s.get("contentToolbar").get("content").one("#btn-send a").simulate("click");s.showComposeShim(true);}});s.notification.notify(q(Y,null,null,null,strings));}}function c(){var r=this,Y=C.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_abuse;r.notification=new C.common.ui.Notification({sticky:true,type:"fade",className:"top"});r.notification.notify(q(Y,null,null,null,strings));}function J(Y){var s=this,r=s.get("contentToolbar").get("content");r.all(".btn")[Y?"addClass":"removeClass"]("disabled");}function L(){var t=this,s=t.composeView.baseNode,r=s.one(".cm-subject-field"),Y=s.one("input.cm-subject-field");Y.ancestor("div").removeClass(m);subjectVal=A(r.get("value"));if(subjectVal){t.updateTabTitle(O(Q(subjectVal)));if(NeoConfig.bidi){t.updateTabDirection(r.getStyle("direction"));}}else{t.updateTabTitle(t.composeView.title);if(NeoConfig.bidi){t.updateTabDirection("");}}}function a(){var Y=this;Y.dsMsgChgHandler&&Y.dsMsgChgHandler.detach();Y.toolBarHandler&&Y.toolBarHandler.detach();X.superclass.ondestroy.call(Y,arguments);}C.extend(X,C.mail.ui.BaseWidget);C.mix(X.prototype,{NAME:"AuthorView",ondestroy:a,onKeyDown:D,onFocus:T,bindUI:n,render:S,initCompose:U,initComposeData:h,createComposeView:H,bindComposeView:o,createSendConfirmView:g,showSendConfirm:d,showCompose:P,isLocalCharCode:l,isDirty:f,isSaved:B,invokeSend:E,matchOrigin:N,setMessageOrigin:I,setMessageFromAddress:K,setDraftOrigin:M,setDraftFromAddress:V,attachToolbar:j,proxyToolbarSelection:Z,updateTabTitle:p,updateTabDirection:k,handleDSMessageChange:W,showComposeShim:G,notifyError:b,notifyAbuse:c,disableToolbar:J,setSubjectAsTitle:L},true);C.namespace("mail.ui");C.mail.ui.AuthorView=X;},"1.0.0",{requires:["mail-controller-base","mail-controller-compose","mail-ui-fullcompose","_shared_module_compose_title","_shared_module_offscreen_bin_notification_notifications"]});YUI.add("om-ui-composeview",function(D){var C=false;function B(E){E.mail.ui.Factory.register("mail.SendConfirmView",E.om.ui.SendConfirmView);C=true;}function A(){var E=this;A.superclass.constructor.apply(E,arguments);!C&&E.once("renderComplete",function(){D.use("om-ui-sendconfirm",B);});D.fire("om:compose.start",{cdo:E.cdo},E);}D.extend(A,D.mail.ComposeView,{NAME:"OMComposeView"},{addButton:D.mail.ComposeView.addButton,removeButtons:D.mail.ComposeView.removeButtons});D.namespace("om.ui");D.om.ui.ComposeView=A;},"1.0.0",{requires:["mail-ui-fullcompose"]});YUI.add("om-controller-compose-events",function(A){var P=A.om,E=P.Controller,B=E.extend("ComposeEvents"),M=P.common.Utils,G=function(){A.log.apply({},arguments);M.log.apply({},arguments);},J=A.Lang,O=A.common.Utils,D=A.contacts.utils,Q={},C={START:"compose.start",SENDSTART:"compose.sendstart",USER_EVENT:"compose.user_event"};function I(W,T,X){var U={};this.view=X;try{U=this.formatData(A.clone(T||{}));}catch(V){G('Bad incomding data to Open Mail event "'+this.eventName+'" : '+V.message);throw V;}var L=X&&(X.cdo||X.sdo),R=L&&L._yuid,Y=L&&L.get&&L.get("origin"),S;switch(Y&&Y.action){case"reply_sender":case"reply_all":S="reply";break;case"forward":S="forward";break;default:S="compose";}this.returnEventId=W+A.guid("-");this.sharedData={data:U,action:S,instance:R||"",cancel:F(I.CANCEL,this.eventName,this.returnEventId),proceed:F(I.SUCCESS,this.eventName,this.returnEventId)};}I.CANCEL="cancel";I.SUCCESS="success";I.prototype={eventName:"",onCancel:function(){},onSuccess:function(){},getSharedData:function(){return this.sharedData;},formatData:function(L){return L;},validateSuccessData:function(L){return true;},validateCancelData:function(L){return true;},validateLog:function(L,R){var T;if(!L){T=["OM compose_event: Invalid data from App."," returnEventId=",this.returnEventId,", data="].join("");try{T+=A.JSON.stringify(R||"");}catch(S){T+="(Error stringifying data: "+S.message+")";}G(T);}return L;},responseHandler:function(R,S,L){if(R.returnCode===I.SUCCESS){this.validateSuccessData(R.data)&&this.onSuccess.apply(this,arguments);}else{if(R.returnCode===I.CANCEL){this.validateCancelData(R.data)&&this.onCancel.apply(this,arguments);}else{G("OM compose_events handler - unhandled returnCode ["+R.returnCode+"], event: "+this.returnEventId);}}}};function F(R,L,S){return["function(o) { ",'    var _context = { eventName: "',L,'",','                     returnEventId: "',S,'"};','    var _params =  { cmd:"returnEvent", args:{ ctx:_context, ','                     returnCode:"',R,'", data:o } };',"    openmail.Application.callWebService( ",'          { url:"apps://", method:"GET", parameters : _params });',"};"].join("");}function K(R){var L=R.eventName;Q[L]=A.Base.create(L,I,[],R);}K({eventName:C.SENDSTART,formatData:function(S){var R=S.sdo,T=R.get("header"),L=A.clone(R.get("recipients"),true);A.Array.each([].concat(L.to,L.cc),function(U){U.contactId=(D.getContactsByEmail(U.email)||[0])[0]["id"];});return{subject:O.escapeHtml(T.subject),recipients:L,from:T.from};},validateSuccessData:function(R){var L=R.view&&J.isString(R.view)&&(!R.width||J.isNumber(parseInt(R.width,10)))&&(!R.height||J.isNumber(parseInt(R.height,10)));return this.validateLog(L,R);},onSuccess:function(R,S,L){if(L&&L.attachAppView){L.attachAppView(S,R.data,this.sharedData.data);}else{G("OM compose event onSuccess - no view or not an OMSendconfirmView: event="+this.returnEventId);}}});K({eventName:C.USER_EVENT,formatData:function(S){var R=this.view,T=R._getHeader(),L={to:T.to,cc:T.cc,bcc:T.bcc};this.appArgs=S.args;R.getRTEInstance().Selection.cleanCursor();return{body:R.getContent(),recipients:L,from:T.from,subject:O.escapeHtml(T.subj)};},getSharedData:function(){if(!this.sharedData.returneMessage){this.sharedData.returnMessage=this.sharedData.proceed;}A.mix(this.sharedData,this.appArgs);this.sharedData.body=this.sharedData.data.body;delete this.sharedData.data.body;return this.sharedData;},validateSuccessData:function(U){var V=!U.body||J.isString(U.body),T=!U.to||J.isArray(U.to),S=!U.cc||J.isArray(U.cc),L=U.body||U.to||U.cc,R=V&&T&&S&&L;return this.validateLog(R,U);},onSuccess:function(S,W,R){var L=S.data.body,V=S.data.to,T=S.data.cc,U;if(L){R.setContent(L,false);}if(V){U=R.getFirstNode("to");R._makeLozenges(V,U);}if(T){U=R.getFirstNode("cc");R._makeLozenges(T,U);}}});function H(){return A.Object.keys(Q);}function N(L){if(!(L in Q)){throw new Error("OM compose unsupported event: "+L);}return Q[L];}A.mix(B,{COMPOSE:C,getSupportedEvents:H,getHandlerClass:N});},"1.0.0",{requires:["om-common-utils","om-controller-base"]});YUI.add("om-controller-compose",function(F){var N=F.om,e=N.common.Utils,D=N.model.DataStore,V=D.Registry,b=D.ViewRegistry,X=V.getAll(),O=N.Controller,c=N.Controller.Views,A=O.extend("Compose"),H=F.common.Utils.assert,L=function(){F.log.apply({},arguments);e.log.apply({},arguments);},J="om:",I=F.common.Utils.rocketstats,f=false,R=e.tryProp,B=(function(){var Y={};return function(i,h){if(!(i in Y)||h){Y[i]=[];}return Y[i];};})(),a=O.ComposeEvents,U=a.COMPOSE,K=a.getSupportedEvents();function P(h){var Y;if(!h||V.isSick(h)){return null;}return R(h,"config.events.compose.action.launch");}function d(Y,h){var i=c.getInternalViewId(Y,"compose",h);return b.get(i)!==null;}function Q(m,j,Y,i){H(m.app==j);var k=m.instance,l=P(m),h=V.isPreload(m);if(!l||!l.view||V.isSick(m)){return;}if(m.needsAck&&!i){return;}if(d(j,l)){return;}if(!h&&!f&&!i){return;}L("yomc:loadComposeView: "+m.name);F.each(K,function(n){var p=e.getEventName(m.instance,n,null),o=p+"registered";F.once(o,function(q,r){T(m,n,p);if(n===U.USER_EVENT){S(m,p,r);}});});F.once("om:close_application"+k,G);c.runActions(m,"events","compose",true,null);}function W(){F.detach("omcompose|*");if(f){return;}f=true;X=V.getAll();F.each(X,Q);}function T(k,Y,h){var i,j=k.instance;i=F.on(J+Y,function(p,m,l){var n,o;if(l&&l!==h){return;}try{n=new (a.getHandlerClass(Y))(h,p,m);}catch(q){L('OM Compose Ctrl: Caught exception for event "'+Y+'"... returning. '+q.message);return;}o=F.on(n.returnEventId,n.responseHandler,n,k,m);B(k.instance).push(o);F.fire(h,n.getSharedData());});B(j).push(i);}function G(Y){F.each(B(Y),F.detach);B(Y,true);}function S(k,h,Y){var i=k.instance,j={label:Y.label,tooltip:Y.tooltip,name:Y.name,tab:Y.tab};function l(n,m){Y.elemID=n;I.stat("OM","compose:user_event:click:"+k.app);F.fire(J+U.USER_EVENT,{args:Y},m,h);}F.once("om:close_application"+i,F.mail.ComposeView.removeButtons);F.mail.ComposeView.addButton(j,i,l);}function g(){var Y=[];F.each(X,function(h){if(V.isLargeFiler(h)){Y.push(h);}});return Y;}function E(Y){c.runActions(Y,"events","url",true,{});}function C(Y){Y.attachments.on("quota",function(h){if(!h.violation.size){return;}if(!M(Y)){return;}h.isDialogHandled=true;});}function M(q){var Y=g();if(!Y.length){return false;}var o=window.strings||{},j=Y[0],l=o["str_comp_attach_error"]||"",p=o["str_comp_attach_size_exceeded"],m=F.common.Utils.substitute,k={partner_name:function(){return j.developer_name;},app_name:function(){return j.name;}},n=o["str_comp_attach_install_app"];if(R(j,"settings.feature")){n="Yahoo! has partnered with Dropbox to offer an "+"alternative for sending large files.  Would you "+"like to try out this feature?";}n=m(n,{},k);function h(){F.fire("om:click_btn",{app:V.get(j.app),tab:"attachments"});if(q.attachments){q.attachments.delDownToQuota();}else{q._removeAllAttachments(q._isAttachmentOversized);}}function i(){if(!j.needsAck){h();return;}var r=F.after("om:compose_add_btn",function(t){var s=V.get(j.app);if(t!=s.instance){return;}r.detach();h();});Q(j,j.app,null,true);}F.use("common-ui-dialog-helper",function(r){r.common.ui.DialogHelper.confirm({hd:l,bd:["<p>",p,"</p><p>",n,"</p>"].join("")},{ok:{handler:i,stopDestroy:false}});});return true;}function Z(){F.each(X,Q);F.on("om:register_app",Q);F.once("omcompose|newMessage",W);F.once("omcompose|editMessage",W);F.once("omcompose|Y.mail.ui.Workspace:composeMessage:complete",W);}if(NeoConfig.useAttComposerTT){F.mix(F.mail.ComposeView.prototype,{onAttachmentsReady:C},true);}else{F.mix(F.mail.AttachmentView,{attachErrorSize:M},true);}L("Open Mail is overriding mail.ComposeView.");F.mail.ui.Factory.register("mail.ComposeView",N.ui.ComposeView);if(D.Loading.isLoading()){F.on("om:datastoreLoaded",Z);}else{Z();}},"1.0.0",{requires:["om-controller-base","om-controller-views","om-ui-composeview","om-controller-compose-events","om-controller-internalapi","rocket-stats","om-common-utils","common-utils-stats"]});YUI.add("mail-service-uploader-v1",function(B){var A=function(D){if(NeoConfig.flashUploaderPercentage==""){NeoConfig.flashUploaderPercentage=100;}var E=!!(D.mail.UploaderServiceDebug||false),F=parseInt(NeoConfig.flashUploaderPercentage,10),J=parseInt(Math.random()*100,10),M=(J>=F);D.namespace("mail");var G=(window.location.search.indexOf("uploader=yui")>0),H=(window.location.search.indexOf("uploader=form")>0)&&!G,K=function(P,N,Q){var O=D.log;if(D.mail.UploaderServiceDebug){D.mail.UploaderServiceDebug.logIt(P,N,Q);}if(window.location.search.indexOf("uploaddebug=1")>0){O(P);}};if((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)||M){G=false;H=true;}function I(){var N=NeoConfig.yuiUploaderDisabledIntls;if(N=="1"){return false;}return D.SWFDetect.isFlashVersionAtLeast(10,1,0);}function C(){var N=D.mail.UploaderService,O=D.common.Utils.rocketstats;K("Uploader Service: Determining default uploader...");if(I()&&!H){K("Uploader Service: YUI is the default Uploader",null,"YUI");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_YUI;O.intlStat("UploaderService","UploaderTypeYUI");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_YUI;}else{K("Uploader Service: Flash is not available");K("Uploader Service: Form is the default Uploader",null,"Form");N.DEFAULT_UPLOADER=N.UPLOADER_TYPE_FORM;O.intlStat("UploaderService","UploaderTypeForm");N.INITIAL_UPLOADER=N.UPLOADER_TYPE_FORM;}N.emptyCreateQueue();return;}D.mail.UploaderService={debug:E,UPLOADER_TYPE_WAIT:"wait",UPLOADER_TYPE_FORM:"form",UPLOADER_TYPE_YUI:"yui",UPLOADER_TYPE_FLASH:"yui",UPLOAD_URL_BASE:NeoConfig.launch_protocol+(NeoConfig.attachmentServer?NeoConfig.attachmentServer+"/":"")+((NeoConfig.isFullSSL&&!NeoConfig.isAttachSSL)?window.location.host:(strings["str_cfg_base_intl"]+"."+NeoConfig.farm+".mail.yahoo."+(NeoConfig.intl=="jp"?"co.jp":"com")))+"/ya/upload",DEFAULT_UPLOADER:"wait",createQueue:[],uploadersCreated:{},uploadersCount:0,rs:D.common.Utils.rocketstats,handlePostRedirectResponse:function(N){D.mail.UploaderUtils.handlePostRedirectResponse(N);},emptyCreateQueue:function(){var N=this.createQueue;for(var O=0;O<N.length;O++){N[O]();}},create:function(P,O,Q){var R=this,N=function(){Q=Q||R.DEFAULT_UPLOADER;var S="mail-service-uploader-"+Q;R.type=Q;D.use(S,function(X){var V=new Date(),U=V.getTime(),W=R.uploadersCreated,T;P.uploaderID=U;switch(Q){case"yui":X.mail.Uploader=X.mail.UploaderYUI;break;case"form":X.mail.Uploader=X.mail.UploaderForm;break;}T=new X.mail.Uploader(P);if(T.fail){R.rs.intlStat("UploaderService","UploaderInstanceCreationFailed_"+Q);K("Uploader Service: Uploader creation failed for "+Q,"color:red;font-weight:bold;");R.DEFAULT_UPLOADER=R.UPLOADER_TYPE_FORM;K("Uploader Service: Reverting to uploader type: "+R.DEFAULT_UPLOADER);R.rs.intlStat("UploaderService","UploaderCreationFallback_"+R.DEFAULT_UPLOADER);S="mail-service-uploader-"+R.DEFAULT_UPLOADER;X.use(S,function(Z){R.create(P,O);});return;}else{R.rs.intlStat("UploaderService","UploaderInstanceCreated_"+Q);}W[U]=T;T.id=U;R.uploadersCount++;if(R.uploadersCount<6){R.rs.intlStat("UploaderService","UploadersCreated_"+R.uploadersCount);}else{if(R.uploadersCount==6){R.rs.intlStat("UploaderService","UploadersCreated_Plus");}}if(O){O(T);}});};if(R.DEFAULT_UPLOADER===R.UPLOADER_TYPE_WAIT){R.createQueue.push(N);R.rs.intlStat("UploaderService","UploaderCreationQueued");}else{N();}}};D.mail.UploaderService.logIt=K;C();var L=function(N){function O(Q,P){this.theQueue.push({action:Q,att:P});}};D.mail.attachmentQueue=L;};A(B);},"1.0.0",{requires:["_shared_module_compose","mail-controller-compose","mail-model-compose","rocket-stats","common-utils","swfdetect","mail-service-uploader-utils"]});