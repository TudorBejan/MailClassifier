YUI.add("om-controller-base",function(C){var A=C.namespace("om.Controller");A.extend=function(D){if(!A[D]){A[D]=C.clone(B);}return A[D];};var B={};},"3.0.0",{requires:[]});YUI.add("om-common-utils",function(F){F.namespace("om.common.Utils");var C=F.om.common.Utils,A=F.common.Utils,E=F.Lang;var D=(function(){var G={};return function(H){return G[H]?G[H]:G[H]=C.md5(NeoConfig.om.crumb+H);};})();function B(){var S=0,G="",O=8;function P(U){return T(K(H(U),U.length*O));}function K(j,Z){var k;k=Z>>5;j[k]|=128<<((Z)%32);k=(((Z+64)>>>9)<<4)+14;j[k]=Z;var h=1732584193,g=-271733879,f=-1732584194,e=271733878,W,Y,X,V,U;for(W=0;W<j.length;W+=16){Y=h;X=g;V=f;U=e;h=N(h,g,f,e,j[W+0],7,-680876936);e=N(e,h,g,f,j[W+1],12,-389564586);f=N(f,e,h,g,j[W+2],17,606105819);g=N(g,f,e,h,j[W+3],22,-1044525330);h=N(h,g,f,e,j[W+4],7,-176418897);e=N(e,h,g,f,j[W+5],12,1200080426);f=N(f,e,h,g,j[W+6],17,-1473231341);g=N(g,f,e,h,j[W+7],22,-45705983);h=N(h,g,f,e,j[W+8],7,1770035416);e=N(e,h,g,f,j[W+9],12,-1958414417);f=N(f,e,h,g,j[W+10],17,-42063);g=N(g,f,e,h,j[W+11],22,-1990404162);h=N(h,g,f,e,j[W+12],7,1804603682);e=N(e,h,g,f,j[W+13],12,-40341101);f=N(f,e,h,g,j[W+14],17,-1502002290);g=N(g,f,e,h,j[W+15],22,1236535329);h=J(h,g,f,e,j[W+1],5,-165796510);e=J(e,h,g,f,j[W+6],9,-1069501632);f=J(f,e,h,g,j[W+11],14,643717713);g=J(g,f,e,h,j[W+0],20,-373897302);h=J(h,g,f,e,j[W+5],5,-701558691);e=J(e,h,g,f,j[W+10],9,38016083);f=J(f,e,h,g,j[W+15],14,-660478335);g=J(g,f,e,h,j[W+4],20,-405537848);h=J(h,g,f,e,j[W+9],5,568446438);e=J(e,h,g,f,j[W+14],9,-1019803690);f=J(f,e,h,g,j[W+3],14,-187363961);g=J(g,f,e,h,j[W+8],20,1163531501);h=J(h,g,f,e,j[W+13],5,-1444681467);e=J(e,h,g,f,j[W+2],9,-51403784);f=J(f,e,h,g,j[W+7],14,1735328473);g=J(g,f,e,h,j[W+12],20,-1926607734);h=R(h,g,f,e,j[W+5],4,-378558);e=R(e,h,g,f,j[W+8],11,-2022574463);f=R(f,e,h,g,j[W+11],16,1839030562);g=R(g,f,e,h,j[W+14],23,-35309556);h=R(h,g,f,e,j[W+1],4,-1530992060);e=R(e,h,g,f,j[W+4],11,1272893353);f=R(f,e,h,g,j[W+7],16,-155497632);g=R(g,f,e,h,j[W+10],23,-1094730640);h=R(h,g,f,e,j[W+13],4,681279174);e=R(e,h,g,f,j[W+0],11,-358537222);f=R(f,e,h,g,j[W+3],16,-722521979);g=R(g,f,e,h,j[W+6],23,76029189);h=R(h,g,f,e,j[W+9],4,-640364487);e=R(e,h,g,f,j[W+12],11,-421815835);f=R(f,e,h,g,j[W+15],16,530742520);g=R(g,f,e,h,j[W+2],23,-995338651);h=L(h,g,f,e,j[W+0],6,-198630844);e=L(e,h,g,f,j[W+7],10,1126891415);f=L(f,e,h,g,j[W+14],15,-1416354905);g=L(g,f,e,h,j[W+5],21,-57434055);h=L(h,g,f,e,j[W+12],6,1700485571);e=L(e,h,g,f,j[W+3],10,-1894986606);f=L(f,e,h,g,j[W+10],15,-1051523);g=L(g,f,e,h,j[W+1],21,-2054922799);h=L(h,g,f,e,j[W+8],6,1873313359);e=L(e,h,g,f,j[W+15],10,-30611744);f=L(f,e,h,g,j[W+6],15,-1560198380);g=L(g,f,e,h,j[W+13],21,1309151649);h=L(h,g,f,e,j[W+4],6,-145523070);e=L(e,h,g,f,j[W+11],10,-1120210379);f=L(f,e,h,g,j[W+2],15,718787259);g=L(g,f,e,h,j[W+9],21,-343485551);h=M(h,Y);g=M(g,X);f=M(f,V);e=M(e,U);}return Array(h,g,f,e);}function I(Z,W,V,U,Y,X){return M(Q(M(M(W,Z),M(U,X)),Y),V);}function N(W,V,e,Z,U,Y,X){return I((V&e)|((~V)&Z),W,V,U,Y,X);}function J(W,V,e,Z,U,Y,X){return I((V&Z)|(e&(~Z)),W,V,U,Y,X);}function R(W,V,e,Z,U,Y,X){return I(V^e^Z,W,V,U,Y,X);}function L(W,V,e,Z,U,Y,X){return I(e^(V|(~Z)),W,V,U,Y,X);}function M(U,X){var W=(U&65535)+(X&65535),V=(U>>16)+(X>>16)+(W>>16);return(V<<16)|(W&65535);}function Q(U,V){return(U<<V)|(U>>>(32-V));}function H(X){var W=Array(),V,U=(1<<O)-1;for(V=0;V<X.length*O;V+=O){W[V>>5]|=(X.charCodeAt(V/O)&U)<<(V%32);}return W;}function T(W){var V=S?"0123456789ABCDEF":"0123456789abcdef",X="";for(var U=0;U<W.length*4;U++){X+=V.charAt((W[U>>2]>>((U%4)*8+4))&15)+V.charAt((W[U>>2]>>((U%4)*8))&15);}return X;}return P;}F.mix(C,{getIFrameById:function(G){return F.one(document.getElementById(G));},getEventName:function(I,H,G){if(C.Event.isMailEvent(H)){return H;}switch(H){case"crumb.update":case"folderpane.scroll":case"mail.signout":case"browser.resize":case"themes:change":case"contacts.sendsms":case"contacts.sendim":case"contacts.changed":case"social.statuschanged":case"tab.changed":case"chats.sendim":case"chats.sendsms":case"search.input":return H;case"compose.start":case"compose.sendstart":case"compose.sendcomplete":case"compose.user_event":return H+I;case"message.read":case"subfolder.click":case"sandbox.controller":return H+I.split(".")[0];case"app.jserror":case"data.action":case"message.render":case"message.render.messageflagstatus":case"message.render.handleupdatelozenges":case"message.render.updateheight":case"messageview.resize":case"view.focus":case"view.blur":case"view.resize":case"view.unload":A.assert(G,"viewId is required for '"+H+"' event");H=H+"."+G;}return I+"."+H;},getDiffList:function(J,H){var L=[],K,G=J;if(E.isArray(J)){G={};for(K=J.length-1;K>=0;--K){G[J[K].app]=1;}}if(E.isArray(H)){for(var K=0,I=H.length;K<I;K++){if(!G[H[K].app]){L.push(H[K].app);}}}else{for(K in H){if(!G[H[K].app]){L.push(H[K].app);}}}return L;},Event:{PREFIX:"mail-event:",encodeMailEvent:function(G){return C.Event.PREFIX+G;},isMailEvent:function(G){return(G||"").indexOf(C.Event.PREFIX)==0;}},convertArrayIndex:function(I,H){var G,K,J=[];for(G in I){K=I[G];J[K[H]]=K;}return J;},escapeDots:function(G){return G.replace(/\./g,"\\.");},fireEvent:function(I){var H,G;H=I.match(/^om:(.*):(.*):(.*)$/);G=this.getEventName(H[1],"data.action",H[2]);F.fire(G,{data_action:H[3]});},compareVer:function(I,H){I=I.split(".");H=H.split(".");if(I.length!==3||H.length!==3){A.assert(false);return;}var K=0,J=0;for(var G=0;G<3;G++){K=parseInt(I[G],10);J=parseInt(H[G],10);if(K!==J){return(K>J)?1:-1;}}return 0;},tryProp:function(L,M,I){var K=M.split(".");for(var J=0,G=K.length;J<G;J++){var H=K[J];if(L!==null&&typeof L==="object"&&H in L){L=L[H];}else{return I;}}return L;},getObjSize:function(I){var G=0,H;for(H in I){if(I.hasOwnProperty(H)){G++;}}return G;},getAppSignature:D,getViewport:(function(){var G=true;var H;F.on("resize",function(){G=true;});F.on("scroll",function(){G=true;},window);return function(){if(G){H={width:F.DOM.winWidth(),height:F.DOM.winHeight(),scrollX:F.DOM.docScrollX(),scrollY:F.DOM.docScrollY()};G=false;}return H;};})(),md5:B(),onIdle:(function(){var H={};var G=0;return function(J,I){var K=G++;I=I||150;return function(){if(H[K]){H[K].cancel();
}H[K]=F.later(I,this,function(){J();});};};})(),LookupList:function(){for(var G=arguments.length;G--;){this[arguments[G]]=1;}},log:(function(){var G=NeoConfig&&NeoConfig.om&&NeoConfig.om.debug,H;return function(I,J){var K;if(G){if(!H){H=F.comms.log4js.getLogger("openMailLogger");F.use("comms-log4js-appenders-console",function(){H.useAppender("console").show();});}H.log("["+(J||"Openmail")+"] "+I);}};})(),range:function(H,I,G){return Math.max(Math.min(G,I),H);},getImageUrl:function(I,H,G){return NeoConfig.launch_protocol+NeoConfig.om.webcacheHostCom+"/om/image.appid."+I+".type."+H+".v."+G+".intl."+NeoConfig.om.intl+".lang."+NeoConfig.lang;},createLogger:function(G){return function(H){C.log(H,G);};}});},"1.0.0",{requires:["common-utils"]});YUI.add("om-common-net-session",function(F){F.namespace("om.common.net");var D=F.common.net,B=D.Error,A=D.SessionMgr,E=F.Lang,C={"100":[100,false,"",2],"200":[100,false,"",2],"201":[100,false,"",2],"202":[100,false,"",2],"203":[100,false,"",2],"300":[100,false,"",2],"301":[100,false,"",2],"302":[100,false,"",2],"400":[100,false,"",2],"401":[100,false,"",2],"408":[100,false,"",2],"409":[100,false,"",2],"410":[100,false,"",2],"500":[100,false,"",2],"503":[100,false,"",2],"504":[100,false,"",2],"506":[100,false,"",2],"507":[100,false,"",2],"510":[100,false,"",2],"600":[100,false,"",2],"604":[100,false,"",2],"1101":[100,false,"",2],"1102":[100,false,"",2],"1201":[100,false,"",2],"1204":[100,false,"",2],"1301":[100,false,"",2],"1303":[100,false,"",2],"1401":[100,false,"",2],"1402":[100,false,"",2],"1403":[100,false,"",2]};F.om.common.net.session=function(){var H={getUrlForModule:function(I){return"/om/api/1.0/"+I;},getBaseCallback:function(L,I,K){var J=H.session,M={service:"om",responseType:"json",formatter:J.formatResponse,success:J.callback,failure:J.callback,method:L,suppressWssid:true,suppressCodes:["*"],suppressLogs:["*"],timeout:5000,args:{success:I,failure:K}};return M;},formatResponse:function(J,K){var L=K.status,N=K.callback,M;switch(L){case 200:break;case 500:var I=K.body;if(I){K.fault=H.makeFault(I.status,I.message,I.context);}else{K.fault=H.makeFault(L.toString(),B.http);}break;default:K.fault=H.makeFault(L.toString(),B.http);}},getErrorMap:function(J,I){if(J==null||I==null||!E.isString(J)||!E.isString(I)){return{};}return C[I]||{};},isHttpError:B.isHttp,makeFault:A.makeFaultObject};H.session={formatResponse:function(I,J){H.formatResponse(I,J);},callback:function(I){if(I.fault){H.session.handleFailure(I);}else{var J=I.callback.args;if(E.isFunction(J.success)){J.success.apply(null,[I,J]);}}},handleFailure:function(N){var K=E.trim(N.getResponseHeader("crumb")),O,I,M;if(K){O=N.request;I=O.url;M=O.urlparams||{};if(O&&I){if(O.mthd=="GET"){M["crumb"]=K;}else{I=O.url.replace(/crumb=([^&]*)/,"crumb="+K);M=O.post;}NeoConfig.om.crumb=K;F.fire(F.om.common.Utils.getEventName("","crumb.update"),{"crumb":K});A.request(I,M,N.callback,O.mthd,O.enc,true);return;}}var P=N.fault||{},T=P.message,R=!P.code||H.isHttpError(P.code)?N.status+"":P.code,L=(P.detail&&P.detail.operation)?P.detail.operation:"",S=H.getErrorMap(T,R),J=S[1]||false,Q=N.callback.args;if(E.isFunction(Q.failure)){Q.failure.apply(null,[N,Q]);}}};function G(N,O,M){if(M.callback&&M.callback.service=="om"){var K,L=M.fault.code,J=M.status,I=!(J==401||J==402||J==302||J==13030);if(L==1401){N.callDefault(402);}return I;}}B.onError(G);return H;}();},"1.0.0",{requires:["event-custom","common-utils","common-net-session","common-net-sessionmgr","om-common-utils"]});/*
YUI 3.7.2 (build 5639)
Copyright 2012 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("array-extras",function(e,t){var n=e.Array,r=e.Lang,i=Array.prototype;n.lastIndexOf=r._isNative(i.lastIndexOf)?function(e,t,n){return n||n===0?e.lastIndexOf(t,n):e.lastIndexOf(t)}:function(e,t,n){var r=e.length,i=r-1;if(n||n===0)i=Math.min(n<0?r+n:n,r);if(i>-1&&r>0)for(;i>-1;--i)if(i in e&&e[i]===t)return i;return-1},n.unique=function(e,t){var n=0,r=e.length,i=[],s,o,u,a;e:for(;n<r;n++){a=e[n];for(s=0,u=i.length;s<u;s++){o=i[s];if(t){if(t.call(e,a,o,n,e))continue e}else if(a===o)continue e}i.push(a)}return i},n.filter=r._isNative(i.filter)?function(e,t,n){return i.filter.call(e,t,n)}:function(e,t,n){var r=0,i=e.length,s=[],o;for(;r<i;++r)r in e&&(o=e[r],t.call(n,o,r,e)&&s.push(o));return s},n.reject=function(e,t,r){return n.filter(e,function(e,n,i){return!t.call(r,e,n,i)})},n.every=r._isNative(i.every)?function(e,t,n){return i.every.call(e,t,n)}:function(e,t,n){for(var r=0,i=e.length;r<i;++r)if(r in e&&!t.call(n,e[r],r,e))return!1;return!0},n.map=r._isNative(i.map)?function(e,t,n){return i.map.call(e,t,n)}:function(e,t,n){var r=0,s=e.length,o=i.concat.call(e);for(;r<s;++r)r in e&&(o[r]=t.call(n,e[r],r,e));return o},n.reduce=r._isNative(i.reduce)?function(e,t,n,r){return i.reduce.call(e,function(e,t,i,s){return n.call(r,e,t,i,s)},t)}:function(e,t,n,r){var i=0,s=e.length,o=t;for(;i<s;++i)i in e&&(o=n.call(r,o,e[i],i,e));return o},n.find=function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(r in e&&t.call(n,e[r],r,e))return e[r];return null},n.grep=function(e,t){return n.filter(e,function(e,n){return t.test(e)})},n.partition=function(e,t,r){var i={matches:[],rejects:[]};return n.each(e,function(n,s){var u=t.call(r,n,s,e)?i.matches:i.rejects;u.push(n)}),i},n.zip=function(e,t){var r=[];return n.each(e,function(e,n){r.push([e,t[n]])}),r},n.flatten=function(e){var t=[],i,s,o;if(!e)return t;for(i=0,s=e.length;i<s;++i)o=e[i],r.isArray(o)?t.push.apply(t,n.flatten(o)):t.push(o);return t}},"3.7.2",{requires:["yui-base"]});
YUI.add("om-model-datastore",function(C){C.namespace("om.model");var J=C.om,D=C.Array,E=C.Object,F=C.Lang,G=C.om.common.Utils.tryProp,H=J.model.DataStore={},I={NEO_SANDBOX:"Message Sandbox",QUICKREPLY:"QuickReply",FLIXY:"Flixy Browse",SHORTCUTS:"Yahoo! Shortcuts",QUICKRSVP:"QuickRSVP"},B={PUBLIC:1,REVOKED:2,HASPUBLISHED:8,DEVELOPER:16,MODIFIED:32,IN_DB:64,OMIT_DISCLAIMER:128,INTERNAL:256,SICK:512,IN_DEVELOPMENT:1024,UDBLESS_INSTALL:2048,CG_HIDDEN:4096,SANDBOXED:8192,SMART_FOLDER:16384,READONLY:32768,PRELOAD:65536,PERMANENT:131072,NO_GALLERY:262144,NO_APPLIST:524288,LARGE_FILER:1048576};C.mix(H,{Loading:(function(){var L=false;function A(M){L=M;if(M===false){C.fire("om:updateFolders",true);C.fire("om:datastoreLoaded",true);}}function K(){return(L===true);}return{set:A,isLoading:K};})(),currentVersions:[],currentProfile:{},updateList:[],removeList:[],folderConfigs:{},wsObject:null,wsCallMap:{},APP_FLAGS:B});C.mix(H,{ApplicationList:(function(){var Q=[],R=null;function P(T,U){Q=T;R=U;C.fire("om:applistupdate");}function S(){return Q;}function L(){Q={};}function A(T,U){Q[T]=U;}function O(T){return Q[T];}function K(T){return C.Array.find(Q,function(U){return U.app==T;});}function N(U){var T=K(U);return(T&&C.Lang.isNumber(T.version))?T.version:0;}function M(T){delete Q[T];}return{setAll:P,getAll:S,delAll:L,set:A,get:O,getByAppId:K,getAppVersion:N,del:M,getSpriteURL:function(){return R;}};})()});C.mix(H,{ApplicationConfig:(function(){var M={message_read:["header","flags","annotation"],attachment:["content_type"]},N=[];function A(P){var Q=P&&P.config&&P.config.events,O;if(Q&&Q.message_read&&(O=Q.message_read.match)){if(!O["@attributes"]){O["@attributes"]={};}if(!O["@attributes"].mode){O["@attributes"].mode="or";}D.each(D.filter(M.message_read,function(S){return !!O[S];}),function(S){O[S]=D(O[S]);O[S]=D.filter(D.map(O[S],function(W){var V,U,T;if((V=W.name)){W.name=V.toLowerCase();}if((U=W.regex)){T=/^\/(.*)\/(.*)$/.exec(U);if(!T){return null;}W.regex=new RegExp(T[1],T[2]);}return W;}),function(T){return T!==null;});});}if(Q){E.each(Q,function(T,S){if(S.indexOf("attachment_")!==0){return;}O=T.match;D.each(M.attachment,function(U){O[U]=D(O[U]);});});}if(P.settings&&F.isString(P.settings)){try{P.settings=C.JSON.parse(P.settings);}catch(R){}}return P;}function K(O){N=D.map(O,A);}function L(){return N;}return{MATCH_CATEGORIES:M.message_read,setAll:K,getAll:L};})()});C.mix(H,{Registry:(function(){var b={},R={"3id1k74o3ic9k":1,"3aophcopmae1m":1,"36or471hmce9m":1,"3copmchj36d1m":1,"30db665j3ge9n":1,"32p326himcdpg":1,"3cp9lcoq32dpn":1},n={"34o9m69ij8e9m":1,"62pb5c4p32c33":1,"30eb260pjiphl":1},i={},k={"_default":function(q,r){return q===r;},"content_type":function(q,r){return q.toLowerCase()===r.toLowerCase()||q==="*";}};function h(q,r){b[q]=r;if(T(q)){i[q]=1;}C.fire("om:register_app",r,q);}function a(q){b=q;E.each(q,function(r,s){if(T(s)){i[s]=1;}});}function K(q){return b[q]||null;}function p(){return b;}function M(s,q){var r=b[s];if(r&&r[q]){return r[q];}}function c(q){delete b[q];if(q in i){delete i[q];}}function W(){b={};}function L(){var t,s,q=false,r=false;for(t in b){s=b[t];if(N(s)){r=true;}else{if(j(s)){q=true;}}if(r&&q){return true;}}return false;}function N(q){var r=C.Object.getValue(q,["config","events","click","action","launch"]);return(r&&r.target_zone=="tab"&&r.context=="http://calendar.yahoo.com")||H.Registry.isInDevelopment(q.app);}function j(q){var r=C.Object.getValue(q,["config","events","click","action","launch"]);return r&&r.target_zone=="window"&&r.view=="http://calendar.yahoo.com/";}function V(){var s,q,r;for(s in b){q=b[s];if(q&&q.config){for(r in q.config.events){if((r==="click-gallery")&&(q.status&B.INTERNAL)){return q;}}}}}function m(){var s,q,r=[];for(s in b){if(Z(s)){q=b[s];r.push(q);}}if(r.length>0){if(r.length>1){for(s=0;s<r.length;++s){if(!(r[s].status&B.PUBLIC)){return r[s];}}}return r[0];}}function d(q){return function(r){if(!F.isObject(r)){r=b[r];}return !!(r&&(r.status&q));};}function S(r){var q=b[r];return q&&q.name||"";}function U(q){return R[q];}function O(q){return n[q];}function Z(u){var t=b[u],r,s,q;return(t&&t.name===I.NEO_SANDBOX&&(t.status&B.INTERNAL)&&(t.status&B.SANDBOXED)&&!(t.status&B.SICK)&&(r=t.config)&&(s=r.events)&&(q=s.message_render)&&q);}function Y(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKREPLY||q===I.FLIXY||q===I.SHORTCUTS);}function l(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKRSVP);}function P(s){var r=b[s],q;q=r?r.name:"";return(q===I.QUICKREPLY);}function A(t){var s,q,u,r;return t&&(r=t.config)&&(s=r.events)&&(q=s.message_read)&&(u=q.match);}function T(q){var r=b[q];if(!r||!r.config||!r.config.events){return false;}return E.some(r.config.events,function(t,s){return s.indexOf("attachment_")===0;});}function o(r){var u,q,s,t=false;if(!F.isObject(r)){C.log("Malformed attachment handler search: "+C.JSON.stringify(r)+"; expected an object","error");return -1;}t=E.some(i,function(w,x){u=b[x];if(!u.config.events.attachment_view){return;}q=u.config.events.attachment_view.match;return E.some(r,function(y,v){if(!(v in q)){return;}s=k[v]||k._default;return D.find(D(y),function(z){return D.find(q[v],function(AA){return s(AA,z);});});});});return t&&{handlerId:u.app,name:u.name||""};}function Q(v,t,s){var u=["config.events.attachment_",t,".match.content_type"].join(""),r=G(v,u),q=k["content_type"];if(!F.isArray(r)){return false;}return D.some(r,function(w){return q(w,s);});}function f(t,r){var s="config.events.attachment_"+r+".@attributes",q=G(t,s);return q&&q.global==="true";}function e(s){var u,t=s.content_type,q=["view","sign","save"],r={};if(!F.isObject(s)||!F.isString(s.content_type)){C.log("Malformed attachment handlers search: "+C.JSON.stringify(s)+"; wanted args.content_type string","error");return -1;}E.each(i,function(w,x){u=b[x];D.each(q,function(v){if(!Q(u,v,t)){return;}r[v]={handlerId:x,name:u.name};if(f(u,v)){r[v].global=true;}});});return E.isEmpty(r)||r;}function g(q){return q.length?"/om/combo/"+q.join("/"):null;}function X(){var z,w,AH,y,AB,q,AD,v=false,u=[],AE=[],AI={},AF=[],r=[],x=[],AG=[],s=[],t=[],AA=[],AC=H.Registry;
E.each(b,function(AJ){if(NeoConfig.isFullSSL&&AJ.name==I.SHORTCUTS){return;}if(AJ.config&&AJ.config.events&&AJ.config.events.message_read&&AJ.config.events.message_read.message_actions&&(z=AJ.config.events.message_read.message_actions.enhance_message)){w=AJ.app;v=AC.isPreload(w)&&!AC.isSick(w);x=[];AG=[];s=[];t=[];AA=[];y=AC.isInternal(w)?NeoConfig.om.webcacheHostCom:NeoConfig.om.webcacheHostNet;AB=(y.indexOf("yahoo.com")!==-1&&y.indexOf(".corp.")!==-1);AH=(y.indexOf(".c.yom.mail.yahoo.")!==-1)?"-":".";if(z.css){q=z.css.path;u=F.isArray(q)?q:[q];D.each(u,function(AK){if(strings&&strings.str_tog_loadRTLCss){AK=AK.replace(/\.css$/,"-rtl.css");}if(AK.match(/http(?:s)?:\/\//)){AG.push(AK);}else{(v?r:x).push("f."+AK.replace(/^\/om\/assets\//,""));}});}if(z.js){AD=z.js.path;AE=F.isArray(AD)?AD:[AD];D.each(AE,function(AK){if(AK.match(/http(?:s)?:\/\//)){AA.push(AK);}else{(v?s:t).push("f."+AK.replace(/^\/om\/assets\//,""));}});}AI[w]={app:w,name:AJ.name,msg_read_data:{preload:v,cssCombo:g(x),css:AG,preloadJsCombo:g(s),jsCombo:g(t),js:AA,context:{appId:w,instanceId:AC.get(w).instance,invokePrefix:NeoConfig.launch_protocol+(AB?y:[w,AH,y].join(""))}}};AF.push(w);}});return{msgReadAppIdList:AF,msgReadAppConfigs:AI,preloadCssCombo:g(r)};}return{set:h,setAll:a,get:K,getAll:p,getProperty:M,del:c,delAll:W,getGalleryData:V,getSandboxData:m,getAppName:S,getAttachmentHandlerInfo:o,getAttachmentHandlers:e,isPublic:d(B.PUBLIC),isRevoked:d(B.REVOKED),isInDb:d(B.IN_DB),isNoDisclaimer:d(B.OMIT_DISCLAIMER),isInternal:d(B.INTERNAL),isSick:d(B.SICK),isInDevelopment:d(B.IN_DEVELOPMENT),isSmartFolder:d(B.SMART_FOLDER),isPreload:d(B.PRELOAD),isPermanent:d(B.PERMANENT),isNoAppList:d(B.NO_APPLIST),isLargeFiler:d(B.LARGE_FILER),isMessenger:U,isAttachLargeFiles:O,isSandbox:Z,isMsgReadRtbApp:Y,isNewCalendarApp:N,isOldCalendarApp:j,isAttachmentHandler:T,isCorpmailDisabledApp:l,isFreshDisabledApp:P,hasMessageReadEvents:A,hasOldAndNewCalendarApps:L,getSandboxMsgReadConfig:X};})()});C.mix(H,{ViewRegistry:(function(){var L={};function A(O,P){L[O]=P;}function M(O){return L[O]||null;}function N(){return L;}function K(O){delete L[O];}return{set:A,get:M,getAll:N,del:K};})()});C.mix(H,{OpenViewLog:(function(){var M={};function A(N,O){M[N]=O;}function L(N){return M[N]||null;}function K(N){delete M[N];}return{set:A,get:L,del:K};})()});C.mix(H,{EventRegistry:(function(){var L={};function A(S,R,U,Q,T){if(!L[U]){L[U]={};}if(!L[U][Q]){L[U][Q]={};}L[U][Q][T]=S;L[U][Q][T].listenerFn=R;}function P(Q){return L[Q]||null;}function N(R,Q){try{return L[R][Q]||null;}catch(S){return null;}}function O(S,Q,R){try{return L[S][Q][R]||null;}catch(T){return null;}}function M(){return L||null;}function K(S,Q,R){delete L[S][Q][R];var T;for(T in L[S][Q]){return;}delete L[S][Q];for(T in L[S]){return;}delete L[S];}return{set:A,getByInstId:P,getByViewId:N,getByEventName:O,getAll:M,del:K};})()});C.mix(H,{ApplicationSubFolderList:(function(){var K={};function A(N,O){K[N]=O;}function M(N){return K[N]||null;}function L(N){K[N]=[];}return{set:A,get:M,del:L};})()});C.mix(H,{MessageReadRunList:(function(){var M={};function A(O,P){M[O]=P;}function L(O){return M[O]||null;}function K(O){delete M[O];}function N(){return M;}return{set:A,get:L,del:K,getAll:N};})()});},"1.0.0",{requires:["array-extras","om-common-utils"]});YUI.add("om-controller-applicationlist",function(D){var K=D.om,L=K.Controller,W=L.extend("ApplicationList"),Z=K.common.net.session,b=K.common.Utils,B=K.model.DataStore,T=B.Registry,A=B.ApplicationList,V=D.common.net,P=D.Lang,G=D.common.Utils.rocketstats,F=V.SessionMgr,X=B.APP_FLAGS,R="YahooMailNeoOM";function E(){function Y(e){G.stat("OM","ERR:uninstallCleanup:_onFailure");}if(Math.random()>=(1/100)){return;}var c={crumb:NeoConfig.om.crumb,cleanup:1},d=Z.getBaseCallback("openmail.app.instance.uninstall",null,Y);F.request(Z.getUrlForModule(d.method),c,d,"GET",null,true);}function N(){var c=A.getAll(),Y=B.folderConfigs;B.removeList=b.getDiffList(c,Y);B.updateList=b.getDiffList(Y,c);}function a(){var f=A.getAll(),d=B.folderConfigs,h=B.removeList,c=B.updateList,g,e,Y;if(!f){return;}for(e in h){delete d[h[e]];}for(e in c){for(Y in f){g=f[Y];if(c[e]===g.app){d[g.app]={app:g.app,instance:g.instance,label:g.label,tooltip:g.tooltip||"",image_url:g.image_url||"",status:g.status,count:-1,subFolders:[]};break;}}}}function M(d){var Y={},c=d.split(",");D.Array.each(c,function(e){e=e.split(":");if(e.length===2){Y[e[0]]=e[1];}});return Y;}function O(){if(window.om&&D.Object.getValue(om,["appProfile","data","length"])){D.Array.each(window.om.appProfile.data,function(Y){if(Y.value){B.currentProfile[Y.extensionId+"."+Y.instanceId]=M(Y.value);}});}}function I(){function d(g){var i=(g.fault?g.fault:g.body.error)||{},h=i.code;h=(!h||Z.isHttpError(h))?g.status+"":h;G.stat("OM","ERR:getAppVer:"+h);B.currentVersions=[];S();}function Y(h){var k=h.body?h.body.error:h.fault;if(k){d(h);return;}var m={},g,l,j=h.body.result.data;for(l in j){g=parseInt(j[l].value,10);m[j[l].extensionId+"."+j[l].instanceId]=isNaN(g)?0:g;}B.currentVersions=m;S();}function c(){var k,m,l,j=[],n,g,h="/ws/mailPreferences/v1/jsonrpc";for(k in e){m=e[k].instance.split(".");j.push({key:"_CG_ver",extensionId:m[0],instanceId:m[1]});}l={method:"GetExtensionData",params:[{query:j}],id:"123456789"};n={success:Y,failure:d,responseType:"json",exceptCodes:[401,402,999],suppressCodes:["*"]};g=F.request(h,D.JSON.stringify(l),n,"POST");g.addUrlParam("appid",R);g.send();}var e=A.getAll(),f;if(!e||e.length===0){return;}if(window.om&&D.Object.getValue(om,["appVersion","data","length"])){f={body:{result:window.om.appVersion}};Y(f);return;}c();}function Q(c){function h(i){}function l(i){}if(c.length===0){return;}var e,d,j=[],f,k,m,g,Y="/ws/mailPreferences/v1/jsonrpc";for(g in c){e=c[g];d=P.isString(e.value)?e.value:D.JSON.stringify(e.value);j.push({key:"_CG_ver",value:d,extensionId:e.extensionId,instanceId:e.instanceId,version:0,expiration:0});}f={method:"SetExtensionData",params:[{setdata:j}],id:"123456789"};k={success:l,failure:h,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};m=F.request(Y,D.JSON.stringify(f),k,"POST");m.addUrlParam("appid",R);m.send();}function C(){var g=A.getAll(),h=B.removeList,c=B.updateList,f,e,d,Y;for(d in h){T.del(h[d]);}for(d in c){f=c[d];for(Y in g){e=g[Y];if(f===e.app){T.set(f,e);break;}}}}function H(r){var n=A.getAll(),e=B.ApplicationConfig.getAll(),o={},m={},h,s,p=[],d,x,w,v=[],u=[],y=NeoConfig.om.isSandboxEnabled,g=T.isSandbox,t,j,z,k,f,q,l,Y,c;o=b.convertArrayIndex(e,"app");for(s in n){h=n[s].app;w=n[s].instance;if(o[h]){l=B.Loading.isLoading()?D.merge(o[h],n[s]):D.merge(n[s],o[h]);if(P.isString(l.omprofile)){Y=M(l.omprofile);l.omprofile=Y;if(!B.Loading.isLoading()){c=n[s].main_id;w=c?c+"."+w.split(".")[1]:w,B.currentProfile[w]=Y;}}A.set(s,l);m[h]=n[s];}}a();C();for(h in m){w=m[h].instance;d=m[h].version;x=B.currentVersions[w]||0;if(m[h].needsAck){continue;}if(d>x){B.currentVersions[w]=d;w=w.split(".");p.push({value:d,extensionId:w[0],instanceId:w[1]});}else{if(d<x){G.stat("OM","ERR:version_toolarge:"+h);delete m[h];}}}if(p.length>0){Q(p);}for(h in m){if(!T.isSick(h)&&(t=m[h])&&(j=t.config)&&(z=j.events)&&(!t.needsAck||(t.needsAck&&T.isNoDisclaimer(h)))){if((k=z.load)&&k.action&&(y||!g(h))){v.push(t);}if(y&&T.isPreload(h)&&(f=z.message_read)&&(q=f.action)&&q.launch&&q.launch.target_zone&&(q.launch.target_zone=="hidden")){u.push(t);}if(NeoConfig.isCorpmail&&T.isCorpmailDisabledApp(h)){T.del(h);}if(NeoConfig.isFresh&&T.isFreshDisabledApp(h)){T.del(h);}}}if((v.length>0)||(u.length>0)){D.use("om-controller-views",function(i){for(s in v){b.log("LOAD event: launching '"+v[s].name+"'");L.Views.runActions(v[s],"events","load",null,null,null,null,true);}for(s in u){b.log("ONREAD: PRELOAD: launching '"+u[s].name+"'");L.Views.runActions(u[s],"events","message_read",null,null,null,null,true);}});}if(r&&P.isFunction(r)){r(true);}if(B.Loading.isLoading()){B.Loading.set(false);D.later(5000,this,E);}}function S(m){function v(i){a();D.fire("om:updateFolders");if(m){m(0);}}function k(j){var x=j.body,p,w;if(!x){v(j);return;}for(p in x){try{if(P.isString(x[p].config)){x[p].config=D.JSON.parse(x[p].config);}}catch(w){G.stat("OM","ERR:Config_Invalid:"+x[p].app);x[p].config={};}}B.ApplicationConfig.setAll(x);H();if(m){m(1);}}var o=A.getAll(),Y=B.updateList,t=B.currentVersions,u=false,c=[],l=[],h,e,s,d,g,r,q,n,f;for(r in Y){d=Y[r];for(q in o){s=o[q];if(d===s.app){g=t[s.instance]?t[s.instance]:(s.version?parseInt(s.version):0);c.push(d+"_"+g);u=true;break;}}}c=c.sort();for(r in c){n=c[r].split("_");l.push("app."+n[0]);if(n.length>1){l.push("ver."+n[1]);}}if(u){h=Z.getBaseCallback("openmail.app.list",k,v);h.cache=true;f=[Z.getUrlForModule(h.method),".lang.",NeoConfig.lang,".intl.",NeoConfig.om.intl,".",l.join(".")].join("");D.common.net.SessionMgr.request(f,null,h,"GET",null,true);}else{e={body:[]};k(e);}}function U(){function c(f){a();D.fire("om:updateFolders",undefined,true);}function Y(f){if(!f.body){c(f);return;}if(P.isArray(f.body)){A.setAll(f.body);}else{A.setAll(f.body.apps,f.body.spriteURL);}if(NeoConfig.om&&!NeoConfig.om.isMiMEnabled){var h=A.getAll();for(var g=0;g<h.length;){if(T.isMessenger(h[g].app)){h.splice(g,1);}else{g++;}}}N();I();O();}var d,e;if(!window.om||!window.om.appData||(P.isArray(window.om.appData)&&!window.om.appData.length)||(window.om.appData.apps&&!window.om.appData.apps.length)){d={"crumb":NeoConfig.om.crumb,".intl":NeoConfig.om.intl,".lang":NeoConfig.lang};
e=Z.getBaseCallback("openmail.app.instance.list",Y,c);F.request(Z.getUrlForModule(e.method),d,e,"GET",null,true);}else{Y({body:window.om.appData});}}function J(){B.Loading.set(true);U();}D.mix(W,{loadApplication:J,updateAddRemoveList:N,mergeApplicationConfigs:H,getApplicationConfigs:S,updateFolderConfig:a,parseOmProfile:M},true);},"1.0.0",{requires:["om-controller-base","om-common-net-session","om-model-datastore","rocket-stats"]});YUI.add("om-common-errors",function(A){A.namespace("om.common.Errors");A.mix(A.om.common.Errors,{ERR_NONE:0,ERR_BAD_ARG:1,ERR_DEPRECATED:2,ERR_DELETED:3,ERR_XFRAME:4,ERR_UNSUPPORTED_BY_HOST:5,ERR_VIEW_NOT_FOUND:1000,ERR_INVALID_TARGET:1001,ERR_VIEW_EXISTS:1002,ERR_NOT_ATTACHMENT_URL:1003,ERR_SET_DATA:1004,ERR_GET_DATA:1005,ERR_KEY_NOT_SET:1006,ERR_KEY_EXPIRED:1007,ERR_KEY_FAILURE:1008,ERR_KEY_INVALID:1009,ERR_REMOVE_DATA:1010,ERR_VALIDATION_FAILURE:2000,ERR_AUTH:3000,ERR_FLASH_REQUIRED:3001,ERR_FLASH_ERR:3002,ERR_FLASH_LAUNCH_ERR:3003,ERR_API_UNAVAILABLE:3004,ERR_UNDEFINED:-1});},"1.0.0");YUI.add("_shared_module_open_mail_application_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_application_list={base:'<div class="items items-nav items-nav-applications collapsed" {{om_hide_app_until_bidi_ready}} data-action="collapsable"> <h2 role="toolbar" aria-labelledby="apps-toggle-btn" id="nav-applications" class="legend"><span id="apps-toggle-btn" role="button" tabindex="0" aria-controls="app-list" aria-expanded="true" class="label">{{str_nav_applications}}</span> <span class="rht"><span class="btn small left right hidden neo-tooltip" title="{{str_nav_applications_btn_edit_attr}}"><input tabindex="-1" class="icon edit" type="button" value="{{str_nav_applications_btn_edit}}"></span></span></h2> <ul id="app-list" class="hidden" role="listbox" aria-labelledby="apps-toggle-btn" aria-describedby="list-instr"> {{application_list}} </ul></div>',application_refresh:'<span class="rht" id="{{app_refblock_id}}"> <span class="btn small left right"><input id="{{app_ref_id}}" type="button" class="icon check-mail" value=" "></span> </span> ',application_count_markup:'<span class="unread-count" title="{{app_folder_count}}">{{app_folder_count}}</span> ',application_count:'<span class="rht"> {{application_count_markup}} </span> ',application_list_subfolder_count:'<span class="rht"> <span class="unread-count" title="{{app_sub_folder_count}}">{{app_sub_folder_count}}</span> </span> ',application_list_subfolder_row:'<li role="presentation" id="{{app_sub_folder_row_id}}"> <a role="option" tabindex="-1" href="#" title="{{app_sub_folder_tooltip}}">{{app_sub_folder_label}} {{application_list_subfolder_count}} </a> </li> ',application_list_subfolder:'<div role="presentation" id="{{app_subfolder_div_id}}"> <ul role="group"> {{application_list_subfolder_row}} </ul> </div> ',application_list:'<li role="presentation" data-action="application" id="{{app_row_id}}" class="btn-apps"> <a id="{{app_row_info_id}}" href="#" role="option" tabindex="-1" title="{{app_name}}"> <i id="{{app_row_name_id}}" style="background:url({{app_icon_url}}){{app_icon_pos}} no-repeat;">{{app_name}}</i> {{application_refresh}} {{application_count}} </a> {{application_list_subfolder}} </li> '};},"1.0.0");YUI.add("_shared_module_open_mail_webservice_container",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_webservice_container={base:"<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000' id='{{flash_id}}' width='1' height='1'> <param name='movie' value='{{flash_src}}'/> <param name='allowScriptAccess' value='always'/> <embed src='{{flash_src}}' width='1' height='1' name='{{flash_id}}' allowScriptAccess='always' type='application/x-shockwave-flash'> </embed></object>"};},"1.0.0");YUI.add("om-controller-webservice",function(B){var L=B.om,F=L.Controller,H=F.extend("Webservice"),E=L.common.Errors,I=L.common.Utils,G=L.model.DataStore,K=B.common.Utils,A=K.rocketstats;function D(N,M){var T="omapiwsobj",S="http://l.yimg.com/nq/ued/assets/flash/wsclient_17.swf",R=null,Q=null,P,O;if(NeoConfig.isFullSSL&&S.match(/^http:\/\/l.yimg.com\/nq/)){S=S.replace(/^http:\/\/l/,"https://s");}P=K.substitute(B.ui.Templates._shared_module_open_mail_webservice_container.base,{flash_id:T,flash_src:S});window.wsclientFlashReady=function(){if(B.UA.ie===9){G.wsObject=document.getElementById(T);}else{G.wsObject=document[T]||window[T];}if(G.wsObject&&NeoConfig.om.wsdebug){G.wsObject.setDebug(true);}if(M){clearTimeout(R);clearTimeout(Q);M(true);}};window.wsclientReceive=function(Y,X,V,U){var W={data:(U==="text")?decodeURIComponent(X):X,httpStatus:V||null};N(G.wsCallMap[Y],W);delete G.wsCallMap[Y];};window.wsclientError=function(X,V,U){var W={error:E.ERR_FLASH_ERR,flashError:V.text,errorMsg:"Flash returned error "+V.text,httpStatus:U||null,errorDetail:{data:decodeURIComponent(V.data||""),errorID:V.errorID,type:V.type,text:V.text}};N(G.wsCallMap[X],W);delete G.wsCallMap[X];};window.wsclientLog=function(U){if(window.console){console.log("OM:WSClient",U);}};if(M){R=setTimeout(function(){M(false);},10000);}Q=setTimeout(function(){B.use("swfdetect",function(U){if(!U.UA.flashMajor){if(K.isBrowserCORSCapable()){U.use("io",function(V){V.io.header("X-Requested-With");G.wsObject={fetch:C};});clearTimeout(R);}}});},1500);O=document.createElement("DIV");O.style.position="absolute";O.style.top="-5000px";document.body.appendChild(O);O.innerHTML=P;}function C(O,N,M,R,Q,U){var V,S;function T(Y,W){var X="callWebService:"+(G.wsCallMap[O].appid)+":CORS:success:"+W.status;if(U==="binary"){receivedData=W.responseText;}else{receivedData=W.responseText;}window.wsclientReceive(O,receivedData,W.status,U);I.log(X);B.log(X);A.stat("OM","WS:CORS:success");}function P(Y,W){var X="callWebService:"+(G.wsCallMap[O].appid)+":CORS:failure:"+W.status;if(!W.status){V=G.wsCallMap[O],S=V.parameters.reason;F.Openapi.handleFlashRequired(V,S);}else{window.wsclientError(O,{data:W.responseText,type:"",text:W.statusText||"",errorID:""},W.status);}I.log(X);B.log(X);A.stat("OM","WS:CORS:failure");A.stat("OM","WS:CORS:failure:"+W.status);if(NeoConfig.log_error_yapache==1){B.use("common-utils-error",function(Z){Z.common.Utils.error.report("OM:"+X+":url:"+N);});}}B.io(N,{method:M||"GET",data:R||"",headers:J(Q),xdr:{use:"native"},on:{success:T,failure:P}});}function J(P){var Q={},O;if(!P){return Q;}for(var N=0,M=P.length;N<M;N++){O=(""+P[N]).match((/\s*([^:\s]*)\s*:\s*(.*)\s*/));if(O&&O[1]){Q[O[1]]=O[2];}}return Q;}B.mix(H,{createWebServiceObject:D},true);},"1.0.0",{requires:["om-controller-base","om-model-datastore","om-common-errors","om-common-utils","common-utils","_shared_module_open_mail_webservice_container"]});YUI.add("om-common-constants",function(A){A.mix(A.namespace("om.common.Constants"),{DIALOG_CANCEL:0,DIALOG_OK:1,OK:1,FAIL:0,UNDEFINED:2});},"1.0.0");YUI.add("om-controller-openapi",function(y){var AH=y.om,q=AH.Controller,v=q.extend("Openapi"),AW=AH.model.DataStore,AE=AW.Registry,n=AW.ViewRegistry,e=AW.EventRegistry,U=AW.OpenViewLog,AK=AW.APP_FLAGS,W=AH.common.Utils,AO=AH.common.Errors,AI=AH.common.net.session,w={error:AO.ERR_NONE},AF=y.Lang,o=y.common.Utils,AV=y.common.net.SessionMgr,C=y.common.Utils.rocketstats,k="YahooMailNeoOM",Ah=false,AC=[],F=100-Math.min(y.config.windowResizeDelay||40,100),s={getParameters:t,setListener:AD,callWebService:h,logMessage:A,getViewport:AZ,search:Aj,compose:AA,draft:I,openView:j,closeView:AB,openMessage:Z,setFolderConfig:AQ,getAttachmentUrl:J,upgradeApplication:Ag,upgradeIfNecessary:a,filterHTML:R,setData:D,getData:N,removeData:Q,getAuthStatus:X,getUserAuthorizationUrl:H,notifyAuthorizationComplete:S,removeAuthorization:G,callAuthWebService:c,getAuthParameters:Ae,reportJSError:AU,setTabCloseMessage:Ac},x={SCOPE_MISMATCH:1,SCOPE_NOT_EXIST:2},b={OMXDB_SUCCESS:0,OMXDB_FAILURE:-1,OMXDB_KEY_DOES_NOT_EXIST:-2,OMXDB_INSTANCE_DOES_NOT_EXIST:-3,OMXDB_EXPIRED:-4,OMXDB_LOWER_VERSION:-5,OMXDB_INVALID_KEY:-6,OMXDB_BUSY:-7};function t(Y,Al,Ao){var An=Y.parameters;if(An.reason==="data/message"&&An.data.from.name===undefined){if(W.compareVer(Y.apiVersion,"0.1.6")===-1){An.data.from=An.data.from[0];}}if(y.Lang.isObject(An.user)){if(NeoConfig.isFresh&&NeoConfig.theme){var Am=yui&&yui.config&&yui.config.groups&&yui.config.groups.mail_css;if(Am){NeoConfig.theme.url=Am.comboBase+Am.root.replace(/css/,"theme")+NeoConfig.theme.id+"/"+NeoConfig.theme.id+"-fresh"+Am.suffix+".css";}}An.user.themeinfo=NeoConfig.theme?{name:NeoConfig.theme.id,css:NeoConfig.theme.url}:{};}Ao&&Ao(Y,An);}function Ag(Y,Al){y.use("om-controller-views",function(Ao){var Am=Y.id,An=U.get(Am);q.Views.closeView(Am);AP(Y.appid,Y.instanceid,An,false);});}function a(Al,An){if(An.error){An.ctx=Al;return;}var Y=Al.id,Am=U.get(Y);Ad(Al,Am,An.suppressMessaging);}function J(As,An){var Al=An.url,Ap,Am,Ar,Au,Av={mimeurl:Al},Y=0,Aq="&giveurl=1";if(An.hasOwnProperty("longtimeout")){Y=An.longtimeout;}function At(Ax){try{return Ax.match(/^https?:\/\/.*\.yahoo\.com\/(proxy\/)?ya\/download\?.*/);}catch(Aw){}return false;}try{if(!At(Al)){Av.error=AO.ERR_NOT_ATTACHMENT_URL;L(As,Av,true);return;}Ap=function(Ax,Aw){Av.url=Ax.responseText;L(As,Av);};Am=function(Ax,Aw){var Ay=Ax.body?Ax.body.error:{code:-1};Av.error=AO.ERR_UNDEFINED;Av.errorMsg=Ay.code;L(As,Av,true);};Ar={success:Ap,failure:Am,responseType:"text",suppressWssid:true,suppressCodes:["*"],exceptCodes:[401,402,999],timeout:5000,args:{}};if(Y==1){Aq+="&longtimeout=1";}Au=AV.request(Al+Aq,null,Ar,"GET");Au.send();}catch(Ao){Av.error=AO.ERR_UNDEFINED;L(As,Av,true);}}function AL(An,At,Y,Au,Aq){var Ap,Av,Ao,Am,Ar,Ax,Al,Aw;try{if(!An){if(Y){Y(null);}return;}Ao="content="+encodeURIComponent(An);if(Aq){Ao+="&restrictOff=true";}Am=function(A0,Az){var Ay;if(At){Ay=A0.responseText;Ap=2;while(Ap--){Av=Ay.lastIndexOf("-->");if(Av===Ay.length-4){Av=Ay.lastIndexOf("<!--");if(Av!==-1){Ay=Ay.slice(0,Av);}}}At(Ay);}};Ar=function(Az,Ay){if(Az.fault){C.stat("OM","ERR:yivValidate");C.stat("OM","ERR:yivValidate:"+Az.fault.code);}if(Y){Y("YIV validation failed ."+(Az&&Az.responseText?Az.responseText:""),An);}};Aw={success:Am,failure:Ar,responseType:"x-www-form-urlencoded",suppressWssid:true,suppressCodes:["*"],exceptCodes:[401,402,999],timeout:5000,args:{}};Al=Aw.args;if(Au){Al.argument=Au;}Ax=AV.request("/om/yiv/om_yiv.php",Ao,Aw,"POST");Ax.setHeader("Content-length",String(Ao.length));Ax.setHeader("Connection","close");Ax.send();}catch(As){C.stat("OM","ERR:YIVValidation:"+y.JSON.stringify(As));Y("YIV Validation of message failed : "+As.description,An);}}function R(Y,Al){function An(Ao){L(Y,{html:Ao});}function Am(Ao,Ap){L(Y,{error:AO.ERR_UNDEFINED,errorMsg:Ao});}AL(Al.html,An,Am,null,true);}function Ad(Al,Am,An){var Y=AE.get(Al.appid).version;function Ar(At,As){L(Al,{error:AO.ERR_UNDEFINED,errorMsg:"Couldn't fetch version"});}function Ap(At,As){var Aw,Au;try{Aw=At.body;Au=Aw[0].version;if(Au===undefined){L(Al,{error:AO.ERR_UNDEFINED,errorMsg:"couldn't retrieve server version"});return;}if(Y>=Au){L(Al,{data:"app up to date (ver "+Au+")"});return;}AP(Al.appid,Al.instanceid,Am,An);}catch(Av){L(Al,{error:AO.ERR_UNDEFINED,errorMsg:"exception during upgrade"});return;}}var Ao={app:Al.appid,ver:Y,lang:NeoConfig.lang,intl:NeoConfig.om.intl},Aq=AI.getBaseCallback("openmail.app.list",Ap,Ar);AV.request(AI.getUrlForModule(Aq.method),Ao,Aq,"GET",null,true);}function AP(An,Al,Y,Am){y.use("om-controller-views",function(Ap){var Aq=AW.ViewRegistry.getAll(),Ar=q.Views,Ao=false,As=AE.isSandbox(An)||AE.isMessenger(An),Au,At;function Aw(){if(Y){Ar.openView.apply(this,Y);}}function Av(){if(!As){Ar.closeApplication(An,Al);}AW.removeList=[];AW.updateList=[An];var Ax=Y?Aw:null;Ap.use("om-controller-applicationlist",function(Ay){q.ApplicationList.getApplicationConfigs(Ax);});}for(At in Aq){Au=Aq[At];if(Aq.hasOwnProperty(At)&&An===Au.get("appId")){if(Au.name&&Au.name==="omHiddenView"||Au.get("closing")){continue;}Ao=true;break;}}if(Am||!Ao||As){Av();return;}Ap.use("common-ui-dialog-helper",function(Az){var Ay={hd:strings.str_om_tou_title,bd:strings.str_om_upgrade_choice};function Ax(A0){if(A0.dataAction==="ok"){Av();}}Az.common.ui.DialogHelper.confirm(Ay,{ok:{handler:Ax},cancel:{handler:Ax}});});});}function h(Y,Al){T(Y,Y.cbid,Al.url,Al.method,Al.parameters,Al.headers,Al.dataformat);}function AZ(Al,Am){var Y=W.getViewport();L(Al,Y);}function AX(Al){for(var Y in Al){if(Al[Y].match(/^content-type:\s*application\/json/i)||Al[Y].match(/^content-type:\s*multipart\/form-data/i)){return true;}}return false;}function Ak(Al){for(var Y in Al){if(Al[Y].match(/^content-type:\s*application\/json/i)){return true;}}return false;}function g(Am){var Al={},An,Ao;for(var Y in Am){An=encodeURIComponent(Y);Ao=encodeURIComponent(Am[Y]);Al[An]=Ao;}return Al;}function AN(Am,An){var Y=Am,Ao=[];if(An&&!o.isEmpty(An)){if(Am.search(/\?/)===-1){Y+="?";}if(Am.search(/[\&=]/)!==-1){Y+="&";}for(var Al in An){Ao.push(Al+"="+An[Al]);
}Y+=Ao.join("&");}return Y;}function z(Y){if(Y!=="events/load"&&Y!=="events/message_read"&&Y!=="events/message_render"){y.use("common-ui-dialog-helper",function(Al){Al.common.ui.DialogHelper.alert({hd:strings.str_om_error_flash_unavailable_title,bd:strings.str_om_error_flash_unavailable_body});});}C.stat("OM","Noflash_appinvoke");}function P(Y,Al){var Am;Am={error:AO.ERR_FLASH_REQUIRED,errorMsg:"callWebService requires the client to have Flash installed."};z(Al);L(Y,Am,true);}function V(Y,Al){var Am;Am={error:AO.ERR_FLASH_LAUNCH_ERR,errorMsg:"callWebService was unable to launch Flash.  Flash may be blocked or a Flash error may have occurred."};z(Al);L(Y,Am,true);}function Aa(Y,Al){return function(){T.apply(Y,Al);};}function f(Aw,An,Al,Y,Aq,Ap,As){var Au=AW.wsObject,At=Al,Ao,Av,Am=(Y.search(/GET/i)!==-1)?true:false,Ar=Ak(Ap);As=As||"text";AW.wsCallMap[An]=Aw;W.log("callWebService",AE.getAppName(Aw.appid)+".API");if(Am){At=AN(Al,g(Aq));}else{if(Ar){Ao=Aq;}else{Av=o.parseQueryString(Al);if(Av&&Aq){Ao=o.merge(Av,Aq);}else{if(Aq){Ao=Aq;}else{Ao=Av;}}}}if(Am){Au.fetch(An,At,Y,null,null,As);}else{Au.fetch(An,At,Y,Ao,Ap,As);}}function T(As,Am,Al,Y,Ao,An,Ar){var Ap=Al.substring(0,Al.indexOf(":")),Aq;if(Ap==="apps"){if(!(q.Internalapi&&q.Internalapi.internalAPI)){y.use("om-controller-internalapi",function(At){q.Internalapi.internalAPI(As,Ao);});}else{q.Internalapi.internalAPI(As,Ao);}return;}if(AW.wsObject){f(As,Am,Al,Y,Ao,An,Ar);}else{y.use("swfdetect",function(At){if(!At.SWFDetect.isFlashVersionAtLeast(9,0,115)){Aq=As.parameters.reason;P(As,Aq);}else{if(Ah){Aq=As.parameters.reason;V(As,Aq);}else{AC.push(Aa(this,[As,Am,Al,Y,Ao,An,Ar]));}}});}}function Aj(Y,Al){y.fire("search:input",{query:o.escapeHtml(Al.query)});L(Y,w,true);}function D(Y,Al){var An,Am;if(W.compareVer(Y.apiVersion,"0.1.7")===-1){An=Al.data;Al.keys=[];Al.ttl=[];for(Am in An){Al.keys[An[Am][0]]=An[Am][1];if(An[Am][2]){Al.ttl[An[Am][0]]=An[Am][2];}}delete Al.data;}Af(Y.instanceid,Y,Al);}function Af(Ay,Aw,A1){function Au(A3){L(Aw,w,true);}function A2(A3){var A6=(A3.fault?A3.fault:A3.body.error)||{},A5=A6.code;A5=!A5||AI.isHttpError(A5)?A3.status:A5;C.stat("OM","ERR:setAppData:"+A5);var A4={error:AO.ERR_SET_DATA,errorMsg:A6.message||""};L(Aw,A4,true);}var Al=Ay.split("."),Y=AE.getProperty(Al[0],"main_id"),Av=B(Al[0]),Aq="",Ar="",Ao=0,A0,Ap=[],At,Az,As="/[?|*]/";As=new RegExp(As.substr(1,(As.length-2)),"g");for(Az in A1.keys){Aq="_APP_"+Az.replace(As,"");Ar=A1.keys[Az];Ar=y.JSON.stringify(Ar);Ao=A1.ttl?(A1.ttl[Az]||0):0;if(Ao!==0){A0=new Date();Ao+=Math.round(A0.getTime()/1000);}Ap.push({key:Aq,value:Ar,extensionId:Y||Al[0],instanceId:Al[1],version:Av,expiration:Ao});}var Ax={method:"SetExtensionData",params:[{setdata:Ap}],id:"123456789"},Am="/ws/mailPreferences/v1/jsonrpc",An={success:Au,failure:A2,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};At=AV.request(Am,y.JSON.stringify(Ax),An,"POST");At.addUrlParam("appid",k);At.send();}function N(Y,Al){AJ(Y.instanceid,Y,Al);}function AJ(Am,Ax,At){var As=At.keys,Aw=Am.split("."),Al=AE.getProperty(Aw[0],"main_id"),Aq=0,Ao=[],Ay,An,Ap,Y,Av;if(!AF.isUndefined(At.pageInfo)){Aq=At.pageInfo.iOffset;}function Au(A5){var A7={},A8={},A3={},BA=[];if(!AF.isUndefined(At.pageInfo)){A7=At.pageInfo.oPagedData;A8=At.pageInfo.oPagedVer;A3=At.pageInfo.oPagedErr;BA=At.pageInfo.keyErrors;}var Az=A5.body,A1=Az.result.data,BB="",A4=null,A6;for(A6 in A1){BB=A1[A6].key.substr("_APP_".length);A4=A1[A6].value;try{A7[BB]=A4?y.JSON.parse(A4):A4;}catch(A9){A7[BB]=A4;}A8[BB]=A1[A6].version;switch(A1[A6].errorCode){case b.OMXDB_SUCCESS:A3[BB]=AO.ERR_NONE;break;case b.OMXDB_EXPIRED:A3[BB]=AO.ERR_KEY_EXPIRED;break;case b.OMXDB_KEY_DOES_NOT_EXIST:case b.OMXDB_INSTANCE_DOES_NOT_EXIST:A3[BB]=AO.ERR_KEY_NOT_SET;break;case b.OMXDB_INVALID_KEY:A3[BB]=AO.ERR_KEY_INVALID;break;case b.OMXDB_FAILURE:case b.OMXDB_LOWER_VERSION:case b.OMXDB_BUSY:A3[BB]=AO.ERR_KEY_FAILURE;break;default:A3[BB]=AO.ERR_KEY_FAILURE;break;}if(A1[A6].errorCode!==b.OMXDB_SUCCESS){C.stat("OM","ERR:getAppData:"+A1[A6].errorCode);BA.push(BB);}}var A2=Az.result.totalCount,A0=Az.result.returnCount;if((A0+Aq)<A2){At.pageInfo={oPagedData:A7,oPagedVer:A8,oPagedErr:A3,iOffset:Aq+A0,keyErrors:BA};d(At.$cmd,Ax,At);return;}var BC={data:A7,version:A8,errorCode:A3,totalCount:A2};if(BA.length){BC.warn=AO.ERR_GET_DATA;BC.errorMsg="Errors in key(s): "+BA.join(", ");}L(Ax,BC);}function Ar(Az){var A2=(Az.fault?Az.fault:Az.body.error)||{},A1=A2.code;A1=!A1||AI.isHttpError(A1)?Az.status:A1;C.stat("OM","ERR:getAppData:"+A1);var A0={error:AO.ERR_GET_DATA,errorMsg:A2.message||""};L(Ax,A0,true);}for(Ap in As){Ao.push("_APP_"+As[Ap]);}An={method:"GetExtensionData",params:[{query:{key:Ao,extensionId:Al||Aw[0],instanceId:Aw[1]},maxReturn:Number(20),offset:Aq}],id:"123456789"};Y="/ws/mailPreferences/v1/jsonrpc";Av={success:Au,failure:Ar,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};Ay=AV.request(Y,y.JSON.stringify(An),Av,"POST");Ay.addUrlParam("appid",k);Ay.send();}function Q(Y,Al){AY(Y.instanceid,Y,Al);}function AY(Al,Av,Ar){var Ap=Ar.keys,Au=Al.split("."),Aq=[],Aw,An;function At(Ax){L(Av,w,true);}function Ao(Ax){var A0=(Ax.fault?Ax.fault:Ax.body.error)||{},Az=A0.code;Az=!Az||AI.isHttpError(Az)?Ax.status:Az;C.stat("OM","ERR:removeAppData:"+Az);var Ay={error:AO.ERR_REMOVE_DATA,errorMsg:A0.message||""};L(Av,Ay,true);}for(An in Ap){Aq.push("_APP_"+Ap[An]);}var Am={method:"DeleteExtensionData",params:[{query:{key:Aq,extensionId:Au[0],instanceId:Au[1]}}],id:"123456789"},Y="/ws/mailPreferences/v1/jsonrpc",As={success:At,failure:Ao,responseType:"json",suppressCodes:["*"],exceptCodes:[401,402,999]};Aw=AV.request(Y,y.JSON.stringify(Am),As,"POST");Aw.addUrlParam("appid",k);Aw.send();}function X(Y,Al){Ab(Y.instanceid,Y,Al.profile);}function H(Y,Al){AT(Y.instanceid,Y,Al.profile,Al.params);}function S(Y,Al){AS(Y.instanceid,Y,Al.profile);}function G(Y,Al){Ai(Y.instanceid,Y,Al.profile);}function r(Au,An,Am){var As,Ao,At=Au.appid,Al=AE.getProperty(Au.appid,"main_id"),Ap=Al?Al+"."+Au.instanceid.split(".")[1]:Au.instanceid,Ar=O(Ap,An);
function Aq(Av,Ay){var Ax=AE.getProperty(At,"omprofile"),Aw=q.ApplicationList.parseOmProfile(Av.body.cache);if(Ax[Am]===Aw[Am]){if(!AW.currentProfile[Ap]){AW.currentProfile[Ap]={};}AW.currentProfile[Ap][Am]=Ax[Am];}Ar.refresh=false;y.Array.each(Ar.backlog,function(Az){Ae.apply(this,Az);});Ar.backlog=[];}function Y(Av,Aw){y.Array.each(Ar.backlog,function(Ax){L(Ax[0],i(Av));});Ar.refresh=false;Ar.backlog=[];}As=AI.getBaseCallback("openmail.app.auth.login.complete",Aq,Y);Ao={crumb:NeoConfig.om.crumb,instance:Ap,profile:An};AV.request(AI.getUrlForModule(As.method),Ao,As,"GET",null,true);}function AM(Y,Al){var Aq=Al.appid,Am=AE.getProperty(Aq,"main_id"),Ao=Am?Am+"."+Al.instanceid.split(".")[1]:Al.instanceid,An=AE.getProperty(Aq,"omprofile"),Ap=AW.currentProfile[Ao];if(!(An&&An[Y])){return x.SCOPE_NOT_EXIST;}if(!(Ap&&Ap[Y])){return x.SCOPE_MISMATCH;}if(An[Y]!==Ap[Y]){return x.SCOPE_MISMATCH;}return;}function Ae(Au,Aq){var Am=Aq.profile,Y=AE.getProperty(Au.appid,"main_id"),Ap=Y?Y+"."+Au.instanceid.split(".")[1]:Au.instanceid,Ar=O(Ap,Am),Av,Aw,Ao;if(Am!=="_openmail_internal"){return;}if(Ar.refresh){Ar.backlog.push([Au,Aq]);}Ao=AM("email-r",Au);if(Ao===x.SCOPE_MISMATCH){function As(){Ar.backlog.push([Au,Aq]);Ar.refresh=true;r(Au,Am,"email-r");}function At(Ax){var Az="User authorization denied",Ay={error:AO.ERR_AUTH,errorMsg:Az};L(Au,Ay);}Av={source:"getauthparameters",callback:At};if(AE.isNoDisclaimer(Au.appid)){r(Au,Am,"email-r");}else{y.use("om-controller-addremoveapp",function(Ax){q.AddRemoveApp.showLegal(Au.appid,Av,As);});}return;}if(Ao===x.SCOPE_NOT_EXIST){var Al="Authorization service ["+Am+"] does not exist for this application",An={error:AO.ERR_AUTH,errorMsg:Al};L(Au,An);return;}Aw={user:{email:NeoConfig.userDataObj.userSendPref.defaultFromAddress,name:NeoConfig.userDataObj.userSendPref.defaultFromName}};L(Au,Aw);}function c(Y,Al){K(Y,Y.cbid,Al.profile,Al.url,Al.method,Al.parameters,Al.body,Al.headers,Al.dataformat,Al.rewrite);}var u={},m={error:AO.ERR_AUTH};function O(Y,Am){var Al=Y+"_"+Am;if(undefined===u[Al]){u[Al]={backlog:[],refresh:false};}return u[Al];}function Ab(Y,Al,Am){var Ar,Ap,An=O(Y,Am);function Ao(At,Av){var Ax,As,Au;try{Ax=At.body;if(Ax.cache!==undefined){An.cache=Ax.cache;if(Ax.version!==undefined){An.version=Ax.version;}}else{delete An.cache;delete An.version;}As={status:Ax.status};if(Ax.data){As.info=Ax.data;}L(Al,{data:As});}catch(Aw){Au={error:AO.ERR_AUTH,errorMsg:Aw.toString()};L(Al,Au);}}function Aq(As,At){L(Al,i(As));}Ar=AI.getBaseCallback("openmail.app.auth.status",Ao,Aq);Ap={crumb:NeoConfig.om.crumb,instance:Y,profile:Am};AV.request(AI.getUrlForModule(Ar.method),Ap,Ar,"GET",null,true);}function i(Y){var Am=Y.fault,Al={error:AO.ERR_AUTH,errorMsg:Am.message,errorDetail:{errorCode:Am.code,detail:Am.detail,httpStatus:Y.status,httpStatusTxt:Y.statusText}};return Al;}function AT(Aq,As,Am,An){var Ar,Al,Ap=O(Aq,Am);if(!An){An={};}function Ao(Au,Aw){var Ay,At,Av;try{Ay=Au.body;if(Ay.cache!==undefined){Ap.cache=Ay.cache;if(Ay.version!==undefined){Ap.version=Ay.version;}}else{delete Ap.cache;delete Ap.version;}At={};At.data={url:Ay.data};L(As,At);}catch(Ax){Av={error:AO.ERR_AUTH,errorMsg:Ax.toString()};L(As,Av);}}function Y(At,Au){L(As,i(At));}Ar=AI.getBaseCallback("openmail.app.auth.login.url",Ao,Y);Al={crumb:NeoConfig.om.crumb,instance:Aq,profile:Am,params:y.JSON.stringify(An)};AV.request(AI.getUrlForModule(Ar.method),Al,Ar,"GET",null,true);}function AS(Y,Al,Am){var Ar,Ap,An=O(Y,Am);function Ao(As,Au){var Ay,Aw,Av,At;try{Ay=As.body;if(Ay.cache!==undefined){An.cache=Ay.cache;if(Ay.version!==undefined){An.version=Ay.version;}}else{delete An.cache;delete An.version;}Aw={};if(Ay.data){Aw.info=Ay.data;}Av={};Av.data=Aw;L(Al,Av);}catch(Ax){At={error:AO.ERR_AUTH,errorMsg:Ax.toString()};L(Al,At);}}function Aq(As,Av){var Ax,Az,At={},Aw,Au,Ay;if(Am==="_yahoo_internal"){Ax=Y.split(".")[0];Az=AE.get(Ax);At.appName=Az.name;}L(Al,i(As));}Ar=AI.getBaseCallback("openmail.app.auth.login.complete",Ao,Aq);Ap={crumb:NeoConfig.om.crumb,instance:Y,profile:Am};if(An.cache){Ap.cache=An.cache;}if(An.version){Ap.version=An.version;}AV.request(AI.getUrlForModule(Ar.method),Ap,Ar,"GET",null,true);}function Ai(Y,Al,Am){var Ar,Ap,An=O(Y,Am);function Ao(As,At){delete An.cache;delete An.version;L(Al,{});}function Aq(As,At){L(Al,i(As));}Ar=AI.getBaseCallback("openmail.app.auth.revoke",Ao,Aq);Ap={crumb:NeoConfig.om.crumb,instance:Y,profile:Am};AV.request(AI.getUrlForModule(Ar.method),Ap,Ar,"GET",null,true);}function p(Ar,Al,Ao,Am){var As,An,Aq=O(Ar,Al);function Ap(At,Aw){var Av,Au,Ay,Ax=At.body;if(Ax.cache!==undefined){Aq.cache=Ax.cache;if(Ax.version!==undefined){Aq.version=Ax.version;}}else{delete Aq.cache;delete Aq.version;}Aq.refresh=false;Av=Aq.backlog;for(Au in Av){Ay=Av[Au];K.apply(this,Ay);}Aq.backlog=[];}function Y(At,Ax){var Aw,Av,Az,Au={},Ay;if(Al==="_yahoo_internal"){Ay=Ar.split(".")[0];Az=AE.get(Ay);Au.appName=Az.name;}Aw=Aq.backlog;for(Av in Aw){L(Aw[Av][0],m);}Aq.backlog=[];Aq.refresh=false;}As=AI.getBaseCallback("openmail.app.auth.login.complete",Ap,Y);An={crumb:NeoConfig.om.crumb,instance:Ar,profile:Al};if(!Ao){if(Aq.cache){An.cache=Aq.cache;}if(Aq.version){An.version=Aq.version;}}if(Am){An.install_token=Am;}AV.request(AI.getUrlForModule(As.method),An,As,"GET",null,true);}function K(Az,An,Aq,Am,Y,Ar,As,Ap,At,Aw){var Ay,Ao,Ax=Az.instanceid,Av=O(Ax,Aq);if(Av.refresh){Av.backlog.push([Az,An,Aq,Am,Y,Ar,As,Ap,At,Aw]);}function Au(A1,A3){var A5,A0,A2;try{A5=A1.body;if(A5.cache!==undefined){Av.cache=A5.cache;}if(A5.status==="complete"){L(Az,{data:A5.data});return;}A0=A5.data;if(AX(Ap)){A0.url=AN(A0.url,g(A0.params));f(Az,An,A0.url,Y,As,Ap,At);}else{f(Az,An,A0.url,Y,A0.params,Ap,At);}}catch(A4){A2={error:AO.ERR_AUTH,errorMsg:A4.toString()};L(Az,A2);}}function Al(A4,A6){var A0=A4.body,A2,A8={},A7,A5,A1,A3;if(A0&&A0.status==="408"){Av.backlog.push([Az,An,Aq,Am,Y,Ar,As,Ap,At,Aw]);if(!Av.refresh){Av.refresh=true;setTimeout(function(){p(Ax,Aq);},500);}}else{if(Aq==="_yahoo_internal"&&A0&&(A0.status==="407"||A0.status==="410")){A2=function(A9){var BB="User authorization denied",BA={error:AO.ERR_AUTH,errorMsg:BB};
C.stat("OM","ERR:callAuthWebService:"+BB);L(Az,BA);};A8={source:"signcall",callback:A2};A7=function(A9){Av.backlog.push([Az,An,Aq,Am,Y,Ar,As,Ap,At,Aw]);Av.refresh=true;var BA=true;setTimeout(function(){p(Ax,Aq,BA,A9);},500);};if(AE.isNoDisclaimer(Az.appid)){A7(null);}else{y.use("om-controller-addremoveapp",function(A9){q.AddRemoveApp.showLegal(Az.appid,A8,A7);});}}else{C.stat("OM","ERR:callAuthWebService:"+A4.fault.message);L(Az,i(A4));}}}Ay=AI.getBaseCallback("openmail.app.auth.sign",Au,Al);Ao={crumb:NeoConfig.om.crumb,instance:Ax,profile:Aq,url:Am,method:Y,params:y.JSON.stringify(Ar),body:As||""};if(Ap){Ao.headers=y.JSON.stringify(Ap);}if(Av.cache){Ao.cache=Av.cache;}if(Aw&&Aw.proxy&&Aw.url){Ao.rewrite=y.JSON.stringify(Aw);}if(Av.version){Ao.version=Av.version;}AV.request(AI.getUrlForModule(Ay.method),Ao,Ay,"GET",null,true);}function AA(Y,An){var Am={warn:"openmail.Errors.ERR_VALIDATION_FAILURE"};var Ao=function(){y.fire("newMessage",{forceNew:true,cbfn:function(Ax,Aq){var At,Av=Ax.get("isRichText");if(An.appid){Ax.appid=An.appid;}var As=function(A0){var A1=[],Az=[];if(AF.isArray(A0)){Az=y.clone(A0);}else{A1=A0.split(",");y.Array.each(A1,function(A3,A2,A4){if(A3){Az.push({email:A3});}});}return Az;};var Au=function(A0,A1){Ax.set("content",A0);var Az=w;if(A1){Az={warn:AO.ERR_VALIDATION_FAILURE};}Az.instance=Ax._yuid;L(Y,Az,true);};var Ay=function(A0,Az){var A1=o.escapeHtml(Az||"")||"";Au(A1,true);};var Ar=function(Az){An.to=An.to||"";An.cc=An.cc||"";An.subject=An.subject||"";Az.to=As(An.to);Az.cc=As(An.cc);if(!y.Lang.isUndefined(An.bcc)&&!y.Lang.isNull(An.bcc)){Az.bcc=As(An.bcc);}Az.subject=An.subject;return Az;};var Aw=Ar(Ax.get("header"));Ax.set("header",Aw);if(An.html&&Av){AL(An.body,Au,Ay,An,true);}else{At=o.escapeHtml(An.body||"");Au(At||"");}},postRender:function(Aq,As){var Ar=An.attachments;if(Ar&&Ar.length){Ap(Ar,Aq);}}});};var Ap=function(At,Au){var Ay=[],Aw,Ax=y.Lang.isObject;function Av(A0){var Az={filename:A0.filename||"",size:{original:Math.max(0,parseInt(A0.size||0,10))},state:{uploaded:true,processed:true},original:{partId:A0.partId,mid:A0.mid,fid:A0.fid,tnef:A0.tnef||""}};return Az;}function Ar(Az){return Ax(Az)&&Az.mid&&Az.fid&&Az.partId;}for(var As=0,Aq=At.length;As<Aq;As++){Ar(At[As])&&Ay.push(Av(At[As]));}if(Ay.length){Au.cdo._addAttachments(Ay);Aw=Au.cdo.get("origin");Aw.action="om:app";Au.cdo.set("origin",Aw);}};var Al=y.common.persist.UserData.get("userUIPref.useRichText");if((Al==="plain")&&An.html){y.use("common-ui-dialog-helper",function(Aq){Aq.common.ui.DialogHelper.confirm({hd:strings.str_om_switch_to_rich_text_title,bd:strings.str_om_switch_to_rich_text_body,suppressActive:true},{ok:{handler:function(){Aq.common.persist.UserData.set("userUIPref.useRichText","dynamic");Ao();}},cancel:{handler:function(){An.body=Aq.mail.Controller.Compose.convertHTMLToPlain(An.body);Ao();}}});});}else{Ao();}}function j(Y,Al){var Am={warn:"openmail.Errors.ERR_VIEW_EXISTS"};y.use("om-controller-views",function(Aq){var Ar=q.Views,Ao=Ar.getInternalUserViewId(Y.appid,Al.id),An=n.get(Ao),Ap=An?Am:w;Ar.openView(Y.appid,Y.instanceid,Ao,Al.view,Al.viewType,Al.target,Al.context||null,Al.parameters||null,Al.width,Al.height,Al.ttl||0,Al.title||"","api/openView",Y,null,null,null,Al.options||{},function(As){L(Y,As,true);});});}function AB(Y,Al){y.use("om-controller-views",function(Ap){var Aq=q.Views,Ao={},An=Al.id?Aq.getInternalUserViewId(Y.appid,Al.id):Y.id,Am=n.get(An);if(Am){Aq.closeView(An);L(Y,w,true);}else{Ao.error=AO.ERR_VIEW_NOT_FOUND;Ao.errorMsg="The application does not have a view named '"+An+"'";L(Y,Ao,true);}});}function I(Y,Al){Al=Al||{};Al.folderId="Draft";Z(Y,Al);}function Z(At,Ao){var Am=y.mail.model.DataStore,Y=y.mail.Controller.Messages,Aq=Am.Messages,Ar,Al;Ao=Ao||{};Ar=Ao.messageId;Al=Ao.folderId;try{if(!Am.Folders.getByName(Al)){L(At,{error:AO.ERR_UNDEFINED,errorMsg:"Invalid folder id"});}else{function As(){L(At,{error:AO.ERR_UNDEFINED,errorMsg:"Unable to load message"});}function Ap(){Y.get({fid:Al,msg:Aq.get(Al,Ar)},{success:function(){y.fire("openMessage",{fid:Al,msg:Ar});},failure:As});}if(Aq.get(Al,Ar)){Ap();}else{Y.list({fid:Al,offsetMid:Ar,numInfo:1,startInfo:0},{success:function(Au){Aq.set(Al,Au.messageInfo);Ap();},failure:As});}}}catch(An){L(At,{error:AO.ERR_UNDEFINED});}}function AR(Ao,Y,Al,An){function Aq(Ar){Ao.label=encodeURIComponent(Ar);delete Ao.htmlLabel;Am();}function Am(){Y.asyncCount--;if(!Y.asyncCount){y.fire("om:updateSingleFolder",{ctx:Al,config:An});L(Al,w,true);}}var Ap=false;if(Ao.label){Ao.label=o.escapeHtml(Ao.label);}else{if(Ao.htmlLabel){Ao.label=o.escapeHtml(Ao.htmlLabel);Ap=true;Y.asyncCount++;AL(Ao.htmlLabel,Aq,Am);}}if(Ao.icon){delete Ao.icon;}if(Ao.tooltip){Ao.tooltip=o.escapeHtml(Ao.tooltip);}return Ap;}function M(Al,Am){var An,Ap,Ao=false;var Y={asyncCount:0};Ao|=AR(Am,Y,Al,Am);if(Am.subFolders){for(An=0,Ap=Am.subFolders;An<Ap.length;An++){Ao|=AR(Ap[An],Y,Al,Am);}}return Ao;}function AQ(Y,Al){if(!M(Y,Al)){y.fire("om:updateSingleFolder",{ctx:Y,config:Al});L(Y,w,true);}}function AU(Ax,As){var Aw=Ax.appid,Am=Ax.instanceid,Av=Ax.id,At=AE.get(Aw).name,Aq=W.getEventName(Am,"app.jserror",Av),Ao=As.message,Al=As.url||As.pageurl,An=As.linenumber||As.errorcode,Y=AW.MessageReadRunList.getAll(),Au,Ap,Ar=false;C.stat("OM","API:JSERROR");C.stat("OM","API:JSERROR:"+Aw.toLowerCase());for(Au in Y){y.fire("message.read.jserror"+Au);}if(e.getByEventName(Am,Av,Aq)){y.fire(Aq,{app:Aw,instance:Am,appName:At,message:Ao,url:Al,lineno:An});Ar=true;}Ap=['openapi: app "',At,'" ',(Ar?"handled":"didn't handle")," a JS error. ","line:",An,"/ msg:",Ao,"/ url: ",Al].join("");W.log(Ap);if(NeoConfig.log_error_yapache==1){y.use("common-utils-error",function(Ay){Ay.common.Utils.error.report(Ap,1);});}}var AG=new W.LookupList("crumb.update","app.uninstalled","mail.signout","contacts.sendsms","contacts.sendim","contacts.changed","tab.changed","social.statuschanged","chats.sendim","chats.sendsms");function AD(Ar,An){var At=Ar.appid,Y=An.event,Aq=An.crumb,Am=Ar.instanceid,Al=Ar.id,Ap=W.getEventName(Am,Y,Al),As=(Y===Ap);
if((Y in AG||W.Event.isMailEvent(Y))&&NeoConfig.om.crumb!==Aq){return;}function Ao(Av){Av.$keep=true;try{for(var Au in e.getByInstId(Am)){L(e.getByEventName(Am,Au,Ap),Av);}}catch(Aw){return;}Av.handled=true;}if(!As){y.detachAll(Ap);}e.set(Ar,Ao,Am,Al,Ap);y.on(Ap,Ao);y.fire(Ap+"registered",Ap,An);}function A(Y,Al){var Am=Al.logs||[];if(Am.length){y.fire("om:logStats",{appid:Y.appid,logs:Am});}}function Ac(Y,Al){y.use("om-controller-views",function(Ap){var Aq=q.Views,Am=Aq.getInternalUserViewId(Y.appid,Al.id),Ao=Am&&n.get(Am),An=Ao&&Ao.get("tab");if(Ao&&An){Ao.set("tabCloseMessage",Al.msg);An.cfg.widget.set("canClose",!Al.msg);}});}function B(Y){return Number(AE.get(Y).config["@attributes"].version);}function E(Y,Al,An,Ao){Ao=Ao||y.JSON.stringify(Al);try{return YUI.om.Iframe.send(Y.proxy,An,["cmd=",Y.skipURIEncode?Ao:encodeURIComponent(Ao)].join(""),W.getAppSignature(Y.appid),Y.version,Y.id);}catch(Am){W.log("returnSend:YUI.om.Iframe.send error:"+Am.message||"unknown");C.stat("OM",["ERR:returnSend:",Y.appid,":",Am.message||"unknown"].join(""));}}function L(Y,Al,An,Ao){var Am;if(!Y){return;}if(Y.restoreCallerContext){Y.restoreCallerContext();}if(Al){if(Y.cbid===null){if(An){return;}else{throw new Error("returnAPI: cannot return value, no callback id set.");}}Al.$cbid=Y.cbid;Al.$apiVersion=Y.apiVersion;if(!y.UA.gecko&&Y.id&&frames[Y.id]){return v.returnSend(Y,Al,"frames['"+Y.id+"']",Ao);}else{for(Am=frames.length-1;Am>=0;--Am){if(frames[Am]===Y.iframe.contentWindow){return v.returnSend(Y,Al,"frames["+Am+"]",Ao);}}}W.log("returnAPI: couldn't find return context iframe");C.stat("OM","ERR:returnAPI:"+Y.appid);}}function l(Am,Y,Al){switch(Am){case"getParameters":s[Am](Y,Al,L);break;default:s[Am](Y,Al);}}function d(Am,Y,Al){var Ap,An,Ao=Am;Am=Am.toLowerCase();if(!((Am==="callwebservice")&&Al&&Al.url&&(Al.url==="apps://"))){Ap="API:"+Am;An=Ap+":"+(Y.appid||"gallery").toLowerCase();C.stat("OM",Ap);C.stat("OM",An);}W.log(Am,AE.getAppName(Y.appid)+".API");l(Ao,Y,Al);}y.on("windowresize",W.onIdle(function(){y.fire(W.getEventName(null,"browser.resize"),{});},F));y.mix(v,{returnAPI:L,returnSend:E,publicAPIs:s,enforceRules:d,setListener:AD,logMessage:A,upgrade:AP,validateFolderConfig:M,handleFlashRequired:P},true);q.Webservice.createWebServiceObject(L,function(Y){if(!Y){Ah=true;}while(AC.length>0){(AC.shift())();}});},"1.0.0",{requires:["om-controller-base","om-controller-webservice","om-common-constants","om-common-net-session","om-common-utils","om-model-datastore","om-common-errors","common-net-sessionmgr","common-utils","json","rocket-stats"]});var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var YUI;if(typeof YUI==="undefined"){(function(){var e=".",b=Object.prototype.hasOwnProperty,d=Object.prototype.toString,c={"undefined":"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error"},f,a=function(j,i){var h=typeof j;return(j&&(h==="object"||(!i&&(h==="function"||f.Lang.isFunction(j)))))||false};f={namespace:function(){var k=arguments,q=this,n=0,m,p,h;for(;n<k.length;n++){h=k[n];if(h.indexOf(e)){p=h.split(e);for(m=(p[0]=="YAHOO")?1:0;m<p.length;m++){q[p[m]]=q[p[m]]||{};q=q[p[m]]}}else{q[h]=q[h]||{}}}return q},add:function(h,i){if(i){i(f)}},use:function(){var h=arguments[arguments.length-1];if(typeof h==="function"){h(f)}},log:function(){},merge:function(){var k=arguments,m=0,j=k.length,h={};for(;m<j;++m){f.mix(h,k[m],true)}return h},Object:{_hasEnumBug:!{valueOf:0}.propertyIsEnumerable("valueOf"),_forceEnum:["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"]},mix:function(h,j,q,k,n,r){var o,u,t,m,v,p,s;if(!h||!j){return h||f}if(n){if(n===2){f.mix(h.prototype,j.prototype,q,k,0,r)}t=n===1||n===3?j.prototype:j;s=n===1||n===4?h.prototype:h;if(!t||!s){return h}}else{t=j;s=h}o=q&&!r;if(k){for(m=0,p=k.length;m<p;++m){v=k[m];if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}}else{for(v in t){if(!b.call(t,v)){continue}u=o?false:b.call(s,v);if(r&&u&&a(s[v],true)&&a(t[v],true)){f.mix(s[v],t[v],q,null,0,r)}else{if(q||!u){s[v]=t[v]}}}if(f.Object._hasEnumBug){f.mix(s,t,q,f.Object._forceEnum,n,r)}}return h},Lang:{isString:function(h){return typeof h==="string"},isFunction:function(h){return f.Lang.type(h)==="function"},type:function(h){return c[typeof h]||c[d.call(h)]||(h?"object":"null")}}};YUI=function(){return f};for(var g in f){if(f.hasOwnProperty(g)){YUI[g]=f[g]}}})()}if(typeof YAHOO==="undefined"||!YAHOO){var YAHOO={util:{}}}if(typeof YAHOO.util==="undefined"||!YAHOO.util){YAHOO.util={}}if(!YAHOO.util.CrossFrame){YAHOO.util.CrossFrame=(function(){var k=/^frames\[(\d+)\]$/,h=/^frames\[['"]([a-zA-Z0-9-_]+)['"]\]$/;var m,e,g,o,i,f,c,b,n,a=YUI;if(window.postMessage||document.postMessage){c=function(p,s,q){var r;if(n(q||"1.0.15","1.0.15")<1){r=[i(s),i(p)].join("|")}else{r=[i(q),i(s),i(p)].join("|")}return r};b=function(r){var q=r.split("|"),p;for(p=q.length-1;p>=0;--p){q[p]=f(q[p])}if(q.length==2){return{sig:q[0],body:q[1]}}else{if(q.length==3){return{version:q[0],sig:q[1],body:q[2]}}else{return null}}};i=function(p){return p.replace(/\|/g,"&c124;")};f=function(p){return p.replace(/&c124;/g,"|")}}else{c=function(p,u,q,s,r){var t;q=q||"1.0.15";if(n(q,"1.0.15")<1){t=[u,p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;")].join("|")}else{if(n(q,"1.1.9")<0){t=[i(q),i(u),i(p)].join("|")}else{t=[i(q),i(u),i(p),i(s),i(r)].join("|")}}return t};b=function(q){var p=q.split("|");if(p.length===2){return{sig:p[0],body:p[1].replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}else{if(p.length===3){return{version:f(p[0]),sig:f(p[1]),body:f(p[2])}}else{if(p.length===5){return{version:f(p[0]),sig:f(p[1]),body:f(p[2]),target:f(p[3]),url:f(p[4])}}else{return null}}}};i=function(p){return escape(p.replace(/\&/g,"&c38;").replace(/\"/g,"&c34;").replace(/\'/g,"&c39;").replace(/\\/g,"&c92;").replace(/\0/g,"&c0;").replace(/\n/g,"&c10;").replace(/\r/g,"&c13;").replace(/\//g,"&c47;").replace(/\@/g,"&c64;").replace(/\+/g,"&c43;"))};f=function(p){return unescape(p).replace(/&c43;/g,"+").replace(/&c64;/g,"@").replace(/&c47;/g,"/").replace(/&c13;/g,"\r").replace(/&c10;/g,"\n").replace(/&c0;/g,"\0").replace(/&c92;/g,"\\").replace(/&c39;/g,"'").replace(/&c34;/g,'"').replace(/&c38;/g,"&")}}n=function(t,r){var s=typeof t==="string",q=typeof r==="string";if(!s||!q){return s&&!q?1:(!s&&q?-1:0)}t=t.split(".");r=r.split(".");if(t.length!==3||r.length!==3){throw new Error("Invalid version format")}var v=0,u=0;for(var p=0;p<3;p++){v=parseInt(t[p],10);u=parseInt(r[p],10);if(v!==u){return(v>u)?1:-1}}return 0};e=function(p,q){if(Object.prototype.hasOwnProperty){return p.hasOwnProperty(q)}return typeof p[q]!=="undefined"&&p.constructor.prototype[q]!==p[q]};g=function(v){var w,t,y,x,u,q;w={};t=v.split("&");for(u=0,q=t.length;u<q;u++){x=t[u].indexOf("=");w[t[u].substr(0,x)]=decodeURIComponent(t[u].substr(x+1))}return w};m=function(v){var s=v.split("."),t,r,q,u;v=window;for(r=0,q=s.length;r<q;r++){u=s[r];if(u==="parent"){v=v.parent}else{if(u==="opener"){v=v.opener}else{if(u==="top"){v=v.top}else{if((t=k.exec(u)||h.exec(u))){v=v.frames[t[1]]}else{throw new Error("Invalid Target: "+v)}}}}}return v};o=function(){var u,t,r,q,p,w=g(window.location.hash.substr(1)),v=b(window.name);if(w.target){t=m("parent."+w.target);q=w.url}else{t=m("parent.opener."+v.target);q=v.url}if(v&&t&&q){r=q.split("/")[2];p=v.version;u=(t.YUI&&t.YUI.util&&t.YUI.util.CrossFrame)?t.YUI.util.CrossFrame:t.YAHOO.util.CrossFrame;try{if(navigator.userAgent.indexOf("Firefox")>-1){t.setTimeout(function(){u._receive([v.sig,v.body].join("|"),r,q,p)},0)}else{u._receive([v.sig,v.body].join("|"),r,q,p)}}catch(s){}}else{throw new Error("Missing required params")}};function d(r,s,q,p){a.util.CrossFrame._receive(r,s,q,p)}var j;j={proxyReceive:o,parseTarget:m,constructMessage:c,deconstructMessage:b,escapeAttr:i,unescapeAttr:f,compareVer:n,_receive:d};return j})();if(typeof YUI!=="undefined"&&YUI){YUI.namespace("util.CrossFrame");YUI.add("omCrossframe",function(a){},"1.0.0",{requires:[]});(function(d){var u="1.1.16",p=YUI.util.CrossFrame;var h="OM_VBS_Wrapper",b="OM_VBS_GetWrapper",s="OM_VBS_HandleMessage",m="OM_VBS_CreateChannel",j,v=window.location.toString(),i,x,n,y;i=YAHOO.util.CrossFrame.parseTarget;x=YAHOO.util.CrossFrame.compareVer;function o(D,C,B,e){if(D&&D.addEventListener){D.addEventListener(C,B,e)}else{if(D&&D.attachEvent){D.attachEvent("on"+C,B)}}}function g(e){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{if(e.stopPropagation){e.stopPropagation()}}e.cancelBubble=true}n=function(D){var e=(d.Lang.isString(D))?D.replace(/#$/,""):false,C=document.getElementsByTagName("iframe"),B;for(B=0,l=C.length;B<l;B++){if(C[B].src.replace(/#$/,"")===e||C[B].contentWindow.location===D){return C[B]}}return null};y=function(D){var B=(typeof D==="object")&&(D!==null)&&(typeof D.sig==="string")&&(typeof D.body==="string")&&(D.sig.length>2)&&(D.body.length>0);if(B){try{if(x(D.version||"1.0.15","1.0.15")<1){}else{B=(x(D.version,D.version)===0)}}catch(C){B=false}}return B};var z,q,k,a,t,A,r,f,c;k=YAHOO.util.CrossFrame.constructMessage;a=YAHOO.util.CrossFrame.deconstructMessage;t=YAHOO.util.CrossFrame.escapeAttr;A=YAHOO.util.CrossFrame.unescapeAttr;if(window.postMessage||document.postMessage){r=!window.postMessage;o(window,"message",function(B){var C,D,E,G;B=B||window.event;try{G=a(B.data);if(y(G)){D=B.origin;E=D.split("/")[2];C=n(B.source.location);if(self===top){g(B)}p.fire("receiveMessage",[G.sig,G.body].join("|"),E,D,C,G.version)}else{}}catch(F){d.log("crossframe.js:onMessageListener: error msg["+F.message+"]")}},false);z=function(E){var B,D,C=i(E.target),e=E.version||u;if(!C){return false}if(r){C=C.document}D=k(E.message,E.sig||"",e);C.postMessage(D,E.proxy);E.handler.call(window);return true}}else{if(window.ActiveXObject){j={};window[s]=function(e,H,I,F){var E=arguments.length,D,C,B,G;window.setTimeout(function(){try{if(E===1){D=JSON.parse(e);e=D.uri;H=D.sig;I=D.message;F=D.version}else{e+="";H+="";I+="";F+=""}C=n(e);B=e.split("/")[2];p.fire("receiveMessage",[H,I].join("|"),B,e,C,F)}catch(J){}},0)};window[m]=function(e,B){j[e]=B};vbscript=["Class "+h+"\n ","Private m_Intended\n","Public Sub SetIntendedName(name)\n ","If isEmpty(m_Intended) Then\n","m_Intended = name\n","End If\n","End Sub\n","Public Sub SendMessage(data)\n ",s+"(data)\n","End Sub\n","Public Sub SendMessage2(uri, sig, message, version)\n ","Call "+s+"(uri, sig, message, version)\n","End Sub\n","Public Sub CreateChannel(channel)\n ","Call "+m+"(m_Intended, channel)\n","End Sub\n","End Class\n","Function "+b+"(name)\n","Dim wrap\n","Set wrap = New "+h+"\n","wrap.SetIntendedName name\n","Set "+b+" = wrap\n","End Function"].join("");try{window.execScript(vbscript,"vbscript")}catch(w){}}z=function(E){var B,C;E.version=E.version||u;E.sig=E.sig||"";E.uri=v;try{B=E.targetId||"parent";if(B=="parent"){C=j.parent;if(!C&&window.opener&&"CreateChannel" in window.opener){C=window.opener;C.CreateChannel(window[b]("parent"));j.parent=C;window.opener=null}if(C){if("SendMessage2" in C){C.SendMessage2(E.uri,E.sig,E.message,E.version)}else{C.SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}else{if(j[B]){if("SendMessage2" in j[B]){j[B].SendMessage2(E.uri+"",E.sig+"",E.message+"",E.version+"")}else{j[B].SendMessage(JSON.stringify(E))}E.handler.call(window);return true}}}catch(D){}c.send(E)};c=(function(){var e=(function(){var C=0;return function(){return"om_xdm_proxy"+C++}})();q=function(D){function C(){var E=document.getElementById(D);E.getElementsByTagName("iframe")[0].onload=null;if(E.parentNode){E.parentNode.removeChild(E)}E=null}p.mapHandlers[D].call(window);delete p.mapHandlers[D];if(navigator.userAgent.indexOf("Firefox")>-1){setTimeout(C,0)}else{C()}};var B=function(E){if(!document||!document.body){setTimeout(function(){z(E)},20);return}var I=E.proxy,G=E.target,O=E.message,L=E.handler,N=E.sig||"",H=E.version||u;if(!i(G)){L();return false}if(window.ActiveXObject&&x(H,"1.1.9")>=0){var J=new ActiveXObject("htmlfile");J.open();J.parentWindow.opener=window;J.parentWindow.callback=function(){J=null;L()};J.write(["<html><head></head><body>",'<iframe src="',I,'" name="',k(O,N,H,G,v),'"></iframe>',"<script>onload = callback;<\/script>","</body></html>"].join(""));J.close()}else{var K=[I,"#","target=",encodeURIComponent(G)+"&url=",encodeURIComponent(v)].join(""),F,D,C=document.createElement("div"),M=C.style;D=e();p.mapHandlers[D]=L;F=["<iframe onload=\"YAHOO.util.CrossFrame.iframeOnload('",D,'\');" name="',k(O,N,H),'" src="',K,'"></iframe>'].join("");M.width=M.left=M.top=M.height="0";M.overflow="hidden";M.position="absolute";C.id=D;document.body.appendChild(C);C.innerHTML=F}return true};return{send:B}})()}d.mix(p,{_events:{},on:function(e,C){var B=this._events;if(!B[e]){B[e]=[C]}else{B[e].push(C)}},fire:function(C){var E=this._events[C]||[],B=Array.prototype.slice.apply(arguments,[1]);for(var D=E.length;D--;){try{E[D].apply(null,B)}catch(F){}}},send:z,mapHandlers:{},_receive:function(D,E,C,e){var B=n(C);p.fire("receiveMessage",D,E,C,B,e)},initIEFrameTransport:function(e,C){var B;if(window.ActiveXObject&&!window.postMessage){B=window[b](C);e.contentWindow.opener=B}},proxyReceive:YAHOO.util.CrossFrame.proxyReceive},true);YAHOO.util.CrossFrame.iframeOnload=q})(YUI())}}if(typeof YUI!=="undefined"&&YUI&&!(YUI.om&&YUI.om.Iframe)){YUI.namespace("om.Iframe");(function(b){var d=[],f=[],j,c,g,i,e=true,h=YUI.util.CrossFrame;j=function(v,o,m,p,s){var k=v.indexOf("|"),u=v.substr(0,k),t,q,n;v=v.substr(k+1);for(q=0,n=d.length;q<n;q++){t=d[q];if(t.sig){if(!u||(t.sig!==u)){continue}}if(t.filter&&((t.filter.exec&&!t.filter.exec(m))||(t.filter.call&&!t.filter.call(null,m)))){continue}if(t.handler){try{t.handler.apply(t.scope,[{iframe:p,version:s},v.substr(4)])}catch(r){b.log("Exception in user defined handler","om.Iframe","iframe.js")}}}};h.on("receiveMessage",j);c=function(k){if(!k.pattern||!k.pattern.test||!k.handler||!k.handler.call){return false}d.push(k);return true};i=function(o,q,p,m,k,n){f.push({proxy:o,target:q,message:p,handler:g,sig:m,version:k,targetId:n});if(!e){g()}};g=function(){if(!f.length){e=false;return}e=true;h.send(f.shift())};YUI.om.Iframe={listen:c,send:i};function a(k){if(/in/.test(document.readyState)){setTimeout(function(){a(k)},9)}else{k()}}if(window.postMessage||document.postMessage||(top==self)){g()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",g,false)}else{a(g)}}})(YUI())};YUI.add("om-controller-crossframe",function(C){var M=C.om,E=M.Controller,N=E.extend("Crossframe"),L=E.Openapi,D=M.common.Errors,K=M.common.Utils,F=M.model.DataStore,H=F.Registry,A=false,B=C.common.Utils.rocketstats;function G(R,S,T,P){var O=R.iframe,W=null,V={},Q,U=R.version||"1.0.15";if(K.compareVer(U,"1.0.16")<0&&P){throw new Error("initAPI: bad API, crossframe version");}if(O!==null){W=F.ViewRegistry.get(O.id);V={cbid:S||null,apiVersion:T,version:U,skipURIEncode:P,iframe:O,proxy:O.src.split("/").slice(0,3).join("/")+"/om/xdm_proxy?bn="+NeoConfig.om.xdmproxyVer,widget:W,appid:W&&W.get("appId"),instanceid:W&&W.get("instanceId"),id:W&&W.get("viewId"),parameters:W&&W.get("params")};for(Q=frames.length-1;Q>=0;--Q){if(frames[Q]===O.contentWindow){return V;}}}throw new Error("initAPI: invalid message origin");}function I(V,T){var Q,P,S=false;try{Q=C.JSON.parse(T);S=true;}catch(U){}if(C.Lang.isUndefined(Q)){Q=C.JSON.parse(decodeURIComponent(T));}var O=G(V,Q.$cbid,Q.$apiVersion,S),R=L.publicAPIs[Q.$cmd];if(R){if(!A&&H.isMessenger(O.appid)){A=true;C.fire("Y.om.controller:launchIM:complete");}L.enforceRules(Q.$cmd,O,Q);}else{P={error:D.ERR_UNSUPPORTED_BY_HOST};L.returnAPI(O,P,true);}}function J(R){var P="https?://(?:[a-z0-9]+(-|\\.))?",O="(?:"+K.escapeDots(NeoConfig.om.webcacheHostNet)+")",S="(?:"+K.escapeDots(NeoConfig.om.webcacheHostCom)+")";try{YUI.om.Iframe.listen({pattern:/^cmd=([\s\S]*)$/,handler:R,filter:new RegExp(["^",P,"(?:",O,"|",S,")","(?:/|$)"].join(""))});K.log("INIT Crossframe handler");}catch(Q){K.log("neo:OM:crossframe:setListenerHandler: YUI.om.Iframe missing, check if neo loaded openmail crossframe correctly. message=["+(Q.message||"")+"]");B.stat("OM",["OM:ERR:setListenerHandler",Q.message].join(":"));}}J(I);C.mix(N,{publicHandler:I,setListenHandler:J},true);},"1.0.0",{requires:["om-controller-base","om-common-utils","om-controller-openapi","omCrossframe","rocket-stats"]});YUI.add("om-controller-views",function(E){var e=E.om,L=e.Controller,s=e.common.Errors,g=L.extend("Views"),t=e.common.Utils,v=e.model.DataStore,n=v.Registry,f=v.ViewRegistry,G=v.EventRegistry,U=v.OpenViewLog,j=v.APP_FLAGS,T=E.common.Utils,r=T.substitute,W="om_user_view_id_",l="om_default_view_id_",A=E.Lang,c=E.Array,H=T.rocketstats,K=[NeoConfig.lang?NeoConfig.lang.replace(/-x-.*$/,""):"en-US"],k=NeoConfig.om.intl?NeoConfig.om.intl.replace(/_.*$/,""):"us",N=NeoConfig.om.intl?NeoConfig.om.intl.replace(/^.*_|^.*$/,""):"";function O(w,Y){return W+w+"-"+Y;}function h(w,Y){return l+w+"-"+Y;}function F(w,Y){return h(w,Y)+"_"+new Date().getTime();}function B(w,Y,x){if(x.target_zone==="messagepane"){return F(w,Y);}return x.id?O(w,x.id):h(w,Y);}function b(w){var Y="";if(w.indexOf(W)===0){Y=w.indexOf("-")+1;return w.substring(Y);}return w;}function d(){return"&cb="+(new Date()).getTime();}function J(x,w){var Y=n.get(x);if(Y&&Y[w]){return Y[w];}}function m(AA,x){var Y=n.isInternal(AA),y=J(AA,"status")&j.SANDBOXED,w=(Y&&!y)?NeoConfig.om.webcacheHostCom:NeoConfig.om.webcacheHostNet,AB=(NeoConfig.om.webcacheHostCom.indexOf("yahoo.com")!==-1&&NeoConfig.om.webcacheHostCom.indexOf(".corp.")!==-1),z="-";return NeoConfig.launch_protocol+(!AB?[AA,z,w].join(""):w);}function u(AF,AD,AH,AG){var x,w=NeoConfig.farm?NeoConfig.farm.substring(1):"",z=c.hash(["9323","323","372","6193"]),y=NeoConfig.om.xdmproxyVer,AB=NeoConfig.isFullSSL,AC=n.isInternal(AH),AA=[m(AH,AB),"/om/api/1.0","/openmail.app.invoke"].join(""),AE=[AH,J(AH,"version"),y,NeoConfig.om.intl,NeoConfig.lang,AF,AB?"1":"0"],Y={bn:y,".lang":NeoConfig.lang,".intl":NeoConfig.om.intl,rtl:NeoConfig.isRTL?"1":"0",proxyhost:NeoConfig.servername,sig:t.getAppSignature(AH),vid:b(AG),app:AH,mailver:"neo"};if(w in z){Y.farm=w;}if(AB){Y.proxyssl=1;}x=[AA,"/",AE.join("/"),"#",E.QueryString.stringify(Y),AC?"&crumb="+NeoConfig.om.crumb:""].join("");return x;}function P(Y){var w=f.get(Y);if(w){t.log("openview: view["+w+"] already running, no need to openView");}return !!w;}function C(AC,AF,AA,AB,z,w,AE,x,Y,y,AD){E.use("om-ui-views-hidden",function(AI){if(P(AC)){return;}var AH=u(AB,z,AF,AC),AG=new AI.om.ui.views.Hidden({appId:AF,instanceId:AA,viewId:AC,params:AE,url:AH,elementAttributes:y});f.set(AC,AG);AG.on("load",function(){if(AD){AD(AG);}});AG.render();});}function D(AC,AF,AA,AB,z,w,AE,x,Y,y,AD){E.use("om-ui-views-simple","_shared_module_open_mail_application_messagepane",function(AI){if(P(AC)){return;}var AH=u(AB,z,AF,AC),AG=new AI.om.ui.views.Simple({template:AI.ui.Templates._shared_module_open_mail_application_messagepane,appId:AF,instanceId:AA,viewId:AC,params:AE,url:AH,elementAttributes:y});f.set(AC,AG);if(AD){AD(AG);}});}function X(Y,AA,y,x,w,z,AB){E.use("om-ui-views-folderpane",function(AD){if(P(Y)){return;}var AC=new AD.om.ui.views.FolderPane({appId:AA,instanceId:y,viewId:Y,params:w.parameters,url:x,height:w.height,hidden:w.hidden,elementAttributes:z});f.set(Y,AC);AC.on("load",function(){if(AB){AB(AC);}});AC.render();AD.on("scroll",t.onIdle(function(){AD.fire(t.getEventName(null,"folderpane.scroll"),{});},200),(NeoConfig.fullPage)?window:"#shellnavigation");});}function V(AC,AG,z,AA,y,w,AF,Y,AE,AB,AH,x,AD){E.use("om-ui-views-alignedoverlay",function(AJ){if(P(AC)){return;}var AI=new AJ.om.ui.views.AlignedOverlay({appId:AG,instanceId:z,viewId:AC,params:AF,url:AA,width:Y,height:AE,elementAttributes:x,options:AH||{}});f.set(AC,AI);AI.on("load",function(){if(AD){AD(AI);}});AI.render.apply(AI,AH.renderParams||[]);});}function R(AC,AG,z,AA,y,w,AF,Y,AE,AB,AH,x,AD){E.use("om-ui-views-panel",function(AJ){if(P(AC)){return;}var AI=new AJ.om.ui.views.Panel({appId:AG,instanceId:z,viewId:AC,params:AF,url:AA,width:Y,height:AE,elementAttributes:x,options:AH||{}});f.set(AC,AI);AI.on("load",function(){if(AD){AD(AI);}});AI.render.apply(AI,AH.renderParams||[]);});}function S(y,Y,x){var w=G.getByEventName(y,Y,x);if(w){E.detach(x,w.listenerFn);G.del(y,Y,x);}}function I(x,Y){var y=G.getByViewId(x,Y),w;if(y){for(w in y){S(x,Y,w);}}}function Q(w){if(!w){T.assert(false);return;}var Y=w.get("viewId"),x=w.get("instanceId");U.del(Y);f.del(Y);I(x,Y);}function q(z,AP,AR,AK,AQ,AT,x,AB,AL,AI,AF,AU,AD,AM,Y,AG,AC,y,AA){H.stat("OM","APP:INVOKE:"+z);U.set(AR,arguments);AP=AP||J(z,"instance");y=y||{};function AS(AV){if(AA){AA(AO);}}var AJ={title:y.elementTitle?T.escapeHtml(y.elementTitle):n.getAppName(z)},AO={},w=[AT],AE=[],AH={appId:z||null,context:x||null,data:AB||{},reason:AD||null,theme:"",user:{cobrand:N,guid:NeoConfig.neoguid,intl:k,lang:K.slice(),bidi:!!NeoConfig.bidi,isRTL:!!NeoConfig.isRTL,useRichText:E.common.persist.UserData.get("userUIPref.useRichText"),theme:"",themeinfo:NeoConfig.theme?{name:NeoConfig.theme.id,css:NeoConfig.theme.url}:{}},version:"2"};if(n.isInternal(z)){AH.fullPage=NeoConfig.fullPage;AH.isFresh=NeoConfig.isFresh;AH.instanceId=AP||null;AH.isAMT=NeoConfig.isAMT;AH.urlParams=T.parseQueryString();AH.wssid=NeoConfig.wssid;if(N&&!c.some(AH.user.lang,function(AV){return AV===NeoConfig.lang;})){AH.user.lang.unshift(NeoConfig.lang);}}if(AG){AH.actionType=AG;}try{if(Y&&Y.className&&(Y.className.indexOf("subAppRow")>-1)){AE=Y.id.split("_");AH.index=AE[AE.length-1];}}catch(AN){}switch(AT){case"alignedoverlay":V(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,y,AJ,AS);break;case"panel":R(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,y,AJ,AS);break;case"folderpane":y.parameters=AH;X(AR,z,AP,u(AK,AQ,z,AR),y,AJ,AS);break;case"overlay":y.parameters=AH;w.push(AR,z,AP,u(AK,AQ,z,AR),y,AJ,AS);break;case"tab":w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AU,AD,AJ,AS,y);break;case"lightbox":w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,AH,AJ,AS);break;case"bubble":case"dialog":if(!AL){AL=400;AO={errorMsg:"No width specified - defaulting to 400",warn:s.ERR_BAD_ARG};}if(!AI){AI=400;AO={errorMsg:"No height specified - defaulting to 400",warn:s.ERR_BAD_ARG};}w.push(AR,z,AP,u(AK,AQ,z,AR),AQ,x,AH,AL,AI,AU,AJ,AS);break;case"hidden":C(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AS);break;case"uninstall":C(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AA);break;case"messagepane":if(NeoConfig.om.isSandboxEnabled){D(AR,z,AP,AK,AQ,x,AH,AF,AD,AJ,AA);
}break;default:AO={error:s.ERR_INVALID_TARGET,errorMsg:"Target '"+AT+"' not supported."};AS();}if(w.length>1){E.use("om-controller-views-other",function(AV){g.handleView.apply(null,w);});}}function p(w,x,AA,Y){T.assert(x==="data"||x==="events");var z;try{z=w.config[x][AA].action;}catch(y){if(Y){z={launch:{view:"full",target_zone:"tab",context:null}};}}return z;}function Z(Y){Y.close();Q(Y);Y.destroy();}function a(w){var Y=f.get(w),x=Y&&Y.get("instanceId"),w=Y&&Y.get("viewId");if(!Y||Y.get("closing")){return;}Y.set("closing",true);Z(Y);}function M(w,x){var Y;if(!n.isInDb(w)){if(!x){E.use("common-ui-dialog-helper",function(AA){var z={hd:strings["str_om_error_app_not_found_title"],bd:strings["str_om_error_app_not_found_body"]};function y(){AA.use("om-controller-addremoveapp",function(AB){L.AddRemoveApp.uninstallApp(w.app);});}AA.common.ui.DialogHelper.confirm(z,{ok:{handler:y}});});}return false;}if(n.isRevoked(w)){if(!x){Y={source:"unpublish",noConfirmDialog:true};E.use("common-ui-dialog-helper",function(z){function y(){z.use("om-controller-addremoveapp",function(AA){L.AddRemoveApp.uninstallApp(w.app,Y);});}z.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_nonexistant_title"],bd:strings["str_om_error_app_nonexistant_body"]},{ok:{handler:y}});});}return false;}if(n.isSick(w)){if(!x){E.use("common-ui-dialog-helper",function(y){y.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_unavailable_title"],bd:r(strings["str_om_error_app_unavailable_body"],{app_name:w.label})});});}return false;}return true;}function i(AG,AE,AJ,y,w,Y,AA,AC,z,AD){T.assert(!AA);if(!AG||!AG.config||AG.app=="retry"){E.use("om-controller-applicationlist",function(AN){if(AG.app=="retry"){L.ApplicationList.loadApplication();}else{L.ApplicationList.getApplicationConfigs(function(AO){if(AO){i(n.get(AG.app),AE,AJ,y,w,Y,AA,AC,z,AD);}else{return;}});}});return;}if(!M(AG,AC)){return;}var x={};if(AG.needsAck){t.log("preinstall: "+AG.name);x={callback:function(AN){if(!AN.error){i(n.get(AG.app),AE,AJ,y,w,Y);}},appStatus:AG.status,appName:AG.name,developerName:AG.developer_name,description:AG.description,source:"preinstall"};E.use("om-controller-addremoveapp",function(AN){L.AddRemoveApp.installApp(AG.app,x);});return;}var AB=p(AG,AE,AJ,y),AF,AL,AK,AM,AI,AH=(AE==="data")?"data/message":(AE+"/"+AJ);for(AF in AB){AL=AB[AF];T.assert(AF=="launch");if(!AG.views[AL.view]){E.use("common-ui-dialog-helper",function(AN){AN.common.ui.DialogHelper.alert({hd:strings["str_om_error_app_unavailable_title"],bd:r(strings["str_om_error_app_unavailable_body"],{app_name:AG.label})});});return false;}AI=w;AK=B(AG.app,AJ,AL);AM=(AL.target_zone==="uninstall")?AG.label:(AL.title||AG.label);if(n.isMessenger(AG.app)){if(!NeoConfig.isCorpmail){E.fire("Y.om.controller:launchIM:start");}}E.each(AL.options,function(AP,AO){var AQ=(AP==="true"||AP==="1"),AR=(AP==="false"||AP==="0"),AN=AQ||AR;x[AO]=AN?(AQ||!AR):AP;});q(AG.app,AG.instance,AK,AL.view,AG.views[AL.view].type,AL.target_zone,AL.context,AI||null,AL.width,AL.height,AL.ttl,AM,AH,null,Y,AJ,z,x,AD);}}function o(z,y){var x=f.getAll(),w,Y;for(w in x){Y=x[w];if(z===Y.get("appId")&&y===Y.get("instanceId")&&!Y.get("closing")){a(w);}}E.fire("om:close_application"+y,y);}E.mix(g,{openView:q,closeView:a,closeApplication:o,getInternalViewId:B,getInternalUserViewId:O,getInternalDefaultViewId:h,isOpened:P,runActions:i},true);},"1.0.0",{requires:["common-utils","om-controller-base","om-common-utils","om-model-datastore","om-controller-crossframe","om-common-errors","querystring-stringify-simple"]});YUI.add("_shared_module_open_mail_application_list_menu",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_open_mail_application_list_menu={base:'<div id="menu-applist" class="optionMenu"> <ul> <li data-action="app-remove"><a href="#"><span>{{str_menu_remove}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("om-ui-applicationlist-base",function(F){var E=F.common.Utils,D=F.Lang,A=E.substitute,C=F.common.persist.getCookie();var B=function(){var W=this,M=F.om,g=M.common.Utils,H=M.model.DataStore,Y=H.ApplicationList,S=H.ApplicationSubFolderList,U=H.Registry,P=H.APP_FLAGS,c=F.ui.Templates._shared_module_open_mail_application_list,L=F.one("#nav-applications"),T=F.one("#app-list"),X="om.applex",K=F.common.Utils.rocketstats,N=M.Controller,f=true,b={appList:function(h){if(h){var o={app_id:"retry",app_status:P.PUBLIC,app_row_id:"_app_retry",app_icon_url:"",app_name:strings["str_om_app_list_retry"]},r=A(c.application_list,o,b);return r.replace(/<img [^>]*>/i,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");}var m,p="",t,o,k=Y.getAll(),q=Y.getSpriteURL(),n,l,j=H.Registry.hasOldAndNewCalendarApps();q=V(q);for(m in k){t=k[m];if(typeof t.image_url=="number"){l=t.image_url*16;n=true;}else{l=0;n=false;if(t&&t.image_url){t.image_url=V(t.image_url);}}o={app_id:t.app,app_status:t.status,app_row_id:"_app_"+t.app,app_name:t.label+(!(t.status&P.PUBLIC)?" (Private)":""),app_icon_url:n?q:t.image_url.replace(/<!--IMAGE_TYPE-->/,"icon"),app_icon_pos:(NeoConfig.isRTL?" 100%":" 0px ")+" -"+l+"px",app_row_name_id:"_app_name_"+t.app,app_row_info_id:"_app_info_"+t.app};if(H.Registry.isNoAppList(t)&&H.Registry.isPublic(t)){continue;}if(j&&H.Registry.isOldCalendarApp(t)){continue;}p+=A(c.application_list,o,b);}return p;},application_refresh:function(i){var k=i.app_id,h,j="";if(!(i.app_status&H.APP_FLAGS.PUBLIC)){h={app_ref_id:"_ref_"+k,app_refblock_id:"_refblock_"+k};j=A(c.application_refresh,h,b);}return j;},application_list_subfolder:function(i){var l=i.app_id,h,j,k="";j=S.get(l);if(j&&j.length>0){h={app_id:l,app_subfolder_div_id:"_sub_container_"+l};k=A(c.application_list_subfolder,h,b);}return k;},application_list_subfolder_row:function(k){var m,o=k.app_id,j,p,l,n="";l=S.get(o);for(m in l){var h=l[m];j={app_sub_folder_row_id:"_sub_"+o+"_"+m,app_sub_folder_label:"- "+h.label,app_sub_folder_tooltip:h.tooltip||h.label,app_sub_folder_count:typeof(h.count)!="undefined"?h.count:null};n+=A(c.application_list_subfolder_row,j,b);}return n;},application_list_subfolder_count:function(i){var k=i.app_sub_folder_count,h,j="";if(k!=null){h={app_sub_folder_count:k};j+=A(c.application_list_subfolder_count,h,b);}return j;},application_count:function(i){var h,k="",j=i.count;if(typeof(j)!="undefined"){h={app_folder_count:j,count:j};k+=A(c.application_count,h,b);}return k;},application_count_markup:function(i){var h,k="",j=i.count;if(typeof(j)!="undefined"){h={app_folder_count:j};k+=A(c.application_count_markup,h,b);}return k;}};function G(k,l){var j,i="subfolder.click",h={};j=H.Registry.get(k).instance;h={app:k,index:l,instance:j};F.fire(g.getEventName(j,i),h);}function J(){var h;if(!T.one('a[tabindex="0"]')&&(h=T.one("a[role=option]"))){h.set("tabIndex",0);}return h;}function a(){var h=F.one("doc").get("activeElement");return(T.contains(h)?T.all("a[role=option]").indexOf(h):-1);}function I(k){var j=T.all("a[role=option]"),i=j.item(k),h;if(!i){h=k+1;if(h>j.size()){h=k-1;}i=j.item(h);}if(i){i.set("tabIndex",0);i.focus();}}function Z(){var h=F.one("#apps-toggle-btn");F.on("om:updateFolders",function(m,l){var n=L.ancestor("div"),p,k=a(),o;o=C.get(X);if(!NeoConfig.isFresh){p=o>0?1:0;}else{p=o<2?0:1;}m=m?m:false;if(p==1){n.removeClass("collapsed");n.addClass("expanded");h.set("aria-expanded",true);e(l);f=false;}else{n.removeClass("expanded");n.addClass("collapsed");h.set("aria-expanded",false);if(!m){e(l);}}if(k>=0){I(k);}else{J();}F.one("#nav-applications span.btn").removeClass("hidden");T.removeClass("hidden");});F.on("om:updateSingleFolder",function(p){var w=a(),z,t,y,n,u,o="";if(t=p.config.label){var x=F.one("#_app_name_"+p.ctx.appid),s;if(x){u=x.getContent();s=u.indexOf("(Private)");o=(s>-1)?u.substring(0,s)+t+" "+u.substring(s):u+t;x.setContent(o);}}var l=F.one("#_app_info_"+p.ctx.appid);if(l){if(y=p.config.tooltip){l.setAttribute("title",y);}else{if(o){l.setAttribute("title",o);}}if(n=p.config.count){var r=F.one("#_refblock_"+p.ctx.appid),q;if(r){q=b.application_count_markup({"count":n});q+=r.getContent();r.setContent(q);}else{q=l.getContent();q+=b.application_count({"count":n});l.setContent(q);}}}if(z=p.config.subFolders){var v=p.ctx.appid,k,m=F.one("#_sub_container_"+v);if(m){m.get("parentNode").removeChild(m);}S.set(v,z);d(v);}else{S.del(v);}if(w>=0){I(w);}else{J();}});if(!L){return;}function j(m){var k=L.ancestor("div"),l;if(k){k.toggleClass("collapsed").toggleClass("expanded");if(f){T.set("aria-live","polite");l='<li role="presentation"><span style="padding-left:20px;margin-left:8px;">'+strings["str_om_loading"]+"</span></li>";T.setContent(l);e();f=false;}if(k.hasClass("collapsed")){C.set(X,0);h.set("aria-expanded",false);F.fire("om:list:collapse");F.fire("mt:click",{action:"toggle_applications",append:{ltxt:"collapse"}});}else{NeoConfig.isFresh?C.set(X,2):C.set(X,1);h.set("aria-expanded",true);F.fire("om:list:expand");F.fire("mt:click",{action:"toggle_applications",append:{ltxt:"expand"}});}}}h.on("click",j);h.on("keydown",function(k){switch(k.keyCode){case 13:j(k);break;case 37:k.halt();break;case 38:k.halt();break;case 39:k.halt();L.one(".btn input").focus();break;case 40:k.halt();T.one("li a").focus();break;}});T.delegate("keydown",function(q){var r=q.target,s=q.keyCode,k,m,p,o,t,n,l=F.UA.os;if((l=="macintosh")&&(s==8)){s=46;}switch(s){case 38:if(r===T.one("li a")){q.halt();h.focus();break;}case 40:q.halt();k=q.container.all("a[role=option]");p=k.indexOf(this);o=q.keyCode===40?p+1:p-1;if((m=k.item(o))){r.set("tabIndex",-1);m.set("tabIndex",0);m.focus();}break;case 46:q.halt();t=r.ancestor("li").get("id");if(t.indexOf("_app_")>=0){t=t.slice(5);if(!(H.Registry.isPermanent(t))){F.use("om-controller-addremoveapp",function(u){N.AddRemoveApp.uninstallApp(t);});}}break;case 121:case 77:n=(l=="windows"||l=="win");if((n&&q.shiftKey&&s==121)||(!n&&q.ctrlKey&&q.shiftKey&&q.altKey&&s==77)){q.preventDefault();E.simulateContextMenu(q.target,false);
}break;}},"a[role=option]");T.delegate("click",function(l){var n=l.currentTarget,k,m;l.halt();m=l.currentTarget.getAttribute("id");k=m.slice(5);appData=U.get(k);O(m);R(k);F.fire("om:refreshApp",appData);O(m);},"li input");function i(o){o.halt();var s,u,n,v,t,m,r,p,l,k;n=(o.currentTarget).one("a");s=(o.currentTarget.getAttribute("id")).slice(5);v=U.get(s);K.stat("OM","APPLIST:clickApp");K.stat("OM","APPLIST:clickApp:"+s);m=v&&v.config;t=m&&m.events;r=t&&t["click"];p=r&&r.action;l=p&&p.launch.target_zone;if(l=="window"){K.stat("OM","APP:INVOKE:"+s);k=s;window.open(p.launch.view,k);o.stopPropagation();return;}var q=(o.target).getAttribute("id");if(q.indexOf("_ref_")>=0){return;}u=s.split("_");if(u.length==1){F.fire("om:appclicklaunch",s);F.fire("mt:click",{action:"launch_app",append:{ltxt:s},spid:"om_app_click"});}else{G(u[0],u[1]);}}T.delegate("click",i,"li");F.on("om:appclick",i);T.delegate("contextmenu",function(m){var n=m.currentTarget,l=m.target;if(!n.menu){var k=n.get("id");if(k.indexOf("_app_")>=0){k=k.slice(5);if(!(H.Registry.isPermanent(k))){F.use("om-ui-applicationlistmenu-base","common-ui-menu-helper",function(p,o){p.om.ui.ApplicationListMenu.insert("menu-applist",function(){var q=p.one("#menu-applist");p.common.ui.MenuHelper.create(n,{menu:q,isContext:true,xy:[m.clientX,m.clientY],contextTarget:m.target},function(){q.on("menuSelected",Q,null,k);q.on("menu:state",function(r){if(r.state=="hide"){l&&l.focus();}});});});});}}}m.halt();},"li");L.delegate("click",function(l){var k=U.getGalleryData();if(k&&k.app){F.fire("om:appclicklaunch",k.app);}else{}F.fire("mt:click",{action:"open_gallery",spid:"om_app_click"});l.halt();},"input");L.delegate("keydown",function(k){switch(k.keyCode){case 37:k.halt();h.focus();break;case 38:k.halt();break;case 39:k.halt();break;case 40:k.halt();T.one("li a").focus();break;}},"input");}function Q(i,h){if(i.dataAction&&i.dataAction=="app-remove"){F.use("om-controller-addremoveapp",function(j){N.AddRemoveApp.uninstallApp(h);});}}function O(i){i="#"+i;var h=F.one(i);if(!h.hasClass("loading")){h.addClass("loading");}else{h.removeClass("loading");}}function R(i){var h=H.Registry.get(i).instance;N.Views.closeApplication(i,h);N.Openapi.upgrade(i,h,null,null,true);}function e(h){var i=b.appList(h);T.setContent(i);T.setAttrs("aria-live","off");}function d(j){var h=F.one("#_app_"+j),i=b.application_list_subfolder({app_id:j});h.append(i);}function V(h){if(F.Lang.isString(h)&&!h.match(/^https?:\/\/image-/)){return h.replace(/^https?:\/\//,NeoConfig.launch_protocol+"image-");}return h;}Z();F.mix(W,{render:e});F.om.Controller.ApplicationList.loadApplication();};F.namespace("om.ui");F.om.ui.ApplicationList=new B();},"1.0.0",{requires:["common-utils","_shared_module_open_mail_application_list","om-model-datastore","om-controller-applicationlist","om-controller-views","_shared_module_open_mail_application_list_menu","common-persist-cookie-data"]});YUI.add("om-ui-workspace-base",function(A){A.namespace("om.ui");A.om.ui.Workspace=new function(){var G=this,D=A.om.model.DataStore.Registry,E=A.om.ui.ApplicationList;function C(H){var J=H.appId,I=H.hiliteAppId,K=H.param;B(J,I,K);}function B(I,H,J){A.use("om-controller-views",function(M){var K,L={};K=I?D.get(I):D.getGalleryData();if(!K){K={app:I};}if(H){L=[H];}else{if(J){L.launchParams=J;}}M.om.Controller.Views.runActions(K,"events","click",true,L);});}function F(){A.on("om:appclicklaunch",B);A.on("om:mrd:gallery",C);A.on("om:mrd:launch",C);}A.augment(G,A.EventTarget);A.augment(G,A.Attribute);F();if(NeoConfig.om.isSandboxEnabled&&A.UA.ie!=7){A.use("om-ui-messagepane-base",function(H){H.mail.ui.Factory.register("mail.ui.MessagePane",H.om.ui.OMMessagePane);});}}();},"1.0.0",{requires:["mail-ui-factory-base","om-model-datastore","om-ui-applicationlist-base"]});