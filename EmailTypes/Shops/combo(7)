YUI.add("contacts-api-config",function(F){F.namespace("contacts");var A=F.contacts,D={1:"asc",2:"desc"},C={1:"first",3:"last",6:"email"},B;B=function(){var I=this,H=function(J){return !!J;},G={baseHost:{validator:H},uri:{},headers:{},wssid:{},guid:{},requestFn:{},wspath:{value:"/ws/sd",validator:H},start:{},count:{value:"max",validator:H},sortfields:{},out:{value:"name,email,nickname,yahooid,phone,otherid,guid"},prefs:{value:null},sort:{},fields:{},view:{value:["compact"]},rev:{value:0,validator:H},loadSmartContacts:{value:true},reloadOnUpdate:{value:true},fieldsToProcess:{value:["name","nickname","email"],validator:function(J){return F.Lang.isArray(J);}}};I.addAttrs(G);I.setSortField=function(J){I.set("sortfields",C[J]);return I.get("sortfields");};I.setSortOrder=function(J){I.set("sort",D[J]);return I.get("sort");};};F.augment(B,F.Attribute);A.config=new B();if(A.clientConfig){A.config.setAttrs(A.clientConfig);}else{if(NeoConfig){var E={guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,wspath:NeoConfig.socdirProxyPath,sortfields:"first",sort:"asc"};if(F.Object.getValue(F,["common","net","SessionMgr"])){E.requestFn=F.common.net.SessionMgr.requestProxy;}A.config.setAttrs(E);}}},"1.0.0",{requires:["attribute"]});YUI.add("contacts-api-cache",function(F){F.namespace("contacts");var B=F.contacts,C=F.contacts.config,E,D=F.Lang,A={CONTACT_CHANGED:"contacts:api:contactChanged",CONTACTS_LOADED:"contacts:api:loaded",CONTACT_IMAGE_UPDATED:"contacts:api:imageUpdated"};B.EVENTS=A;E=function(){var O=this,G=false,N=0,L,P={},T={},U={},Q={},R=[],J=null,I,H,K,S,M;I=function(V,Y){var W,X;if(!Y){Q={};}for(W in V){if(V.hasOwnProperty(W)){X=V[W];Q[X.id]=Q[X.id]||X;if(Y){Q[X.id].contacts=Q[X.id].contacts||[];Q[X.id].contacts.push(Y.id);}}}};M=function(a,Z){var V=a.fields,b,d,W,c,Y,X=P[a.id]={typedFields:{},typedFieldValues:{}};if(!V){return;}Z=Z||[];b=Z.length>0;for(Y in V){if(V.hasOwnProperty(Y)){d=V[Y];W=d.value;c=d.type;if(b&&F.Array.indexOf(Z,c)===-1){continue;}if(!X.typedFields[c]){X.typedFields[c]=[];}if(!X.typedFieldValues[c]){X.typedFieldValues[c]=[];}if(c==="name"){if(W.familyName.indexOf("<")!==-1){W.familyName="";}if(W.givenName.indexOf("<")!==-1){W.givenName="";}}X.typedFields[c].push(d);X.typedFieldValues[c].push(W);}}};O.loadSortPrefs=function(V,W){if(!J){J={};}J.sort_order=V;J.sort_field=W;};O.setSortPrefs=function(V,W){O.loadSortPrefs(V,W);F.later(10,O,F.contacts.api.load,[1]);};O.getSortPrefs=function(){return J;};O.load=function(Y){var b,a=C.get("loadSmartContacts"),Z,V=C.get("fieldsToProcess"),W=[];var X=Y.contacts.contact||[];U={};R=[];T={};Q={};P={};for(Z=0;Z<X.length;Z++){b=X[Z];if(!a&&b.isSmartContact){continue;}W.push(b);M(b,V);R[Z]=b.id;U[b.id]=b;H(b);I(b.categories,b);}L=Y;L.contacts.contact=W;L.contacts.count=L.contacts.total=W.length;G=true;F.later(10,O,O.fire,[A.CONTACTS_LOADED]);};O.removeFromCategories=function(V){var X=V.categories||[],W=X.length,Y,Z,a;for(Y=0;Y<W;Y++){Z=X[Y].id;a=Q[Z].contacts;if(a){a.splice(F.Array.indexOf(a,V.id),1);}}};O.update=function(k){var g,f,a,c,b=C.get("fieldsToProcess"),X=[],j=[],d=[],Z=[],e=[],h=[],W=[],V,Y;if(k.syncresult){N=k.syncresult.rev;g=k.syncresult.diff.contacts;W=k.syncresult.results.contacts;}else{if(D.isArray(k)){g=k;}else{g=[k.contact];}}for(Y=0;Y<W.length;Y+=1){f=W[Y];c=f.op;a=U[f.id];switch(c){case"remove":h.push(a);break;case"add":Z.push(f);break;case"update":e.push(f);break;}}for(Y=0;Y<g.length;Y+=1){f=g[Y];c=f.op||"add";a=U[f.id];switch(c){case"remove":if(a){K(a);R.splice(F.Array.indexOf(R,a.id),1);O.removeFromCategories(a);d.push(a);}break;default:if(a){K(a);j.push(f);}else{X.push(f);}M(f,b);I(f.categories,f);U[f.id]=f;H(f);break;}}V={created:X,modified:j,removed:d,createdCurrent:Z,modifiedCurrent:e,removedCurrent:h};if(X.length||j.length){if(C.get("reloadOnUpdate")){F.later(10,O,F.contacts.api.load,[1]);}}else{F.later(10,O,O.fire,[A.CONTACTS_LOADED]);}F.later(10,O,O.fire,[A.CONTACT_CHANGED,V]);return V;};O.updateCategories=function(){var V={categories:Q};if(C.get("reloadOnUpdate")){F.later(10,O,F.contacts.api.load,[1]);}F.later(10,O,O.fire,[A.CONTACT_CHANGED,V]);};H=function(Y){var V,X,Z,W;V=P[Y.id].typedFieldValues.email;if(!V||V.length===0){return;}for(W in V){if(V.hasOwnProperty(W)){X=V[W];Z=X.toLowerCase();T[Z]=T[Z]||[];T[Z].push(Y);}}};K=function(Z){var V,Y,W,b,a,X;V=P[Z.id].typedFieldValues.email||[];a=Z.id;for(X in V){if(V.hasOwnProperty(X)){Y=V[X];b=Y.toLowerCase();W=T[b];if(W&&W[a]){W[a]=undefined;}}}};O.isLoaded=function(){return G;};O.getResponseObject=function(){return L;};O.getContactsData=function(){return P;};O.getContacts=function(){return U;};O.getEmails=function(){return T;};O.getCategories=function(){return Q;};O.getContactOrder=function(){return R;};O.getCurrentRevision=function(){return N;};O.setCurrentRevision=function(V){N=V;};O.loadTinyUserCard=function(W){var Z=W.contacts.contact,a,V=C.get("fieldsToProcess"),Y=[],X;for(X in Z){if(Z.hasOwnProperty(X)){a=Z[X];M(a,V);U[a.id]=a;H(a);Y.push(a);}}F.later(10,O,O.fire,[A.CONTACT_IMAGE_UPDATED,Y]);return Y;};O.getContactsByBucket=function(W,b,Y){var c,d=[],X,Z=W+b,a,V=[];if(Y){X=Q[Y];if(X){d=X.contacts||[];}}else{d=R||[];}for(a=W;a<Z;a++){c=d[a];if(c){V.push(U[c]);}else{break;}}return{contacts:V,total:d.length};};O.removeFlatContact=function(a,Z){var Y=P[a].flatContacts,W,V=Y.length,X;for(W=0;W<V;W++){X=Y[W];if(X.emailField&&X.emailField.id===Z){Y.splice(W,1);break;}}};O.removeField=function(b,Y){var W=U[b];if(W){var V=W.fields,Z,X=V.length,a;for(Z=0;Z<X;Z++){a=V[Z];if(a.id===Y){V.splice(Z,1);if(a.type==="email"){O.removeFlatContact(b,Y);}break;}}}};S=(function(){var V={broadcast:1,emitFacade:true};O.publish(A.CONTACT_CHANGED,V);O.publish(A.CONTACTS_LOADED,V);O.publish(A.CONTACT_IMAGE_UPDATED,V);}());};F.augment(E,F.EventTarget);B.cache=new E();},"1.0.0",{requires:["contacts-api-config","common-utils-stats"]});YUI.add("contacts-api-utils",function(F){F.namespace("contacts");var B=F.contacts,E=B.Contact,C=B.cache,A,D=function(){var G=this;G.getContactsByEmail=function(H){if(!H||H===""){return null;}return C.getEmails()[H.toLowerCase()];};G.isEmailKnown=function(H,I){var J,K;J=G.getContactsByEmail(H);if(I&&J){for(K=0;K<J.length;K++){if(!(J[K].isSmartContact)){return 1;}}return 0;}return(J)?1:0;};G.getContactById=function(I){var H;H=C.getContacts()[I];return H;};G.getContactsByIds=function(I){var J,H;J=[];for(H in I){if(I.hasOwnProperty(H)){J.push(G.getContactById(I[H]));}}return J;};G.getCategoryById=function(I){var H;H=C.getCategories()[I];return H;};G.areContactsLoaded=function(){return C.isLoaded();};G.getResponseObject=function(){return C.getResponseObject();};G.getContacts=function(J){var H,K={},I=C.getContacts();if(!J){return I;}for(H in I){if(I.hasOwnProperty(H)&&I[H].id>=0){K[H]=I[H];}}return K;};G.getSmartContacts=function(){var H,I={};for(H in C.getContacts()){if(C.getContacts().hasOwnProperty(H)&&C.getContacts()[H].id<0){I[H]=C.getContacts()[H];}}return I;};G.getAllContacts=function(){return C.getContacts();};G.getCategories=function(){return C.getCategories();};G.getContactsClone=function(I){var J={};if(I){var H=C.getContactsByBucket(0,C.getContactOrder().length,I).contacts,M=H.length;while(M--){J[H[M].id]=H[M];}}else{var K=G.getContacts(),L;for(L in K){J[L]=K[L];}}return J;};G.getFlatContacts=function(){var I=G.getContacts(),K=[],J,L,H;for(L in I){if(I.hasOwnProperty(L)){J=G.getBasicFlatContacts(I[L]);for(H in J){if(J.hasOwnProperty(H)){K.push(J[H]);}}}}return K;};G.getFieldsByType=function(H,I){return C.getContactsData()[H.id].typedFields[I];};G.getFieldValues=function(I,L,J){var K,H,M;if(!I||!L){return null;}if(J){H=G.getFieldsByType(I,L);if(H){K=[];for(M in H){if(H.hasOwnProperty(M)&&F.Array.indexOf(M.flags,J)){K.push(M.value);}}}return K;}return C.getContactsData()[I.id].typedFieldValues[L];};G.getShownContactName=function(J){var I,M,H=F.Lang.trim,L=H(J.name),K=J.email;if(G.isEmailKnown(K)){I=G.getContactsByEmail(K);M=G.getFirstFieldValue(I[0],"nickname");if(M){return M;}M=G.getFirstFieldValue(I[0],"name");if(M){M=M.familyName+" "+M.givenName;if(H(M)){return M;}}}return L||K;};G.getFirstFieldValue=function(H,J,I){if(!H||!J){return null;}return(G.getFieldValues(H,J,I)||[])[0];};G.getHigherPrecedenceFieldByType=function(I,J){if(!I){return null;}function K(M,L){return M.id-L.id;}var H=(G.getFieldsByType(I,J)||[]);if(H.sort(K)[0]){return H.sort(K)[0].value;}return null;};G.getBasicFlatContacts=function(H){var M=C.getContactsData()[H.id].flatContacts,I,N,L=H.isSmartContact?1:0,K,J;if(!M){M=[];N=G.getFieldsByType(H,"email")||[];I=G.getHigherPrecedenceFieldByType(H,"name")||{};K=(N.length&&N[0])||{value:""};for(J in N){if(N.hasOwnProperty(J)){M.push({firstname:I.givenName,lastname:I.familyName,middlename:I.middleName,nickname:G.getFirstFieldValue(H,"nickname"),email:N[J].value,emailField:N[J],id:H.id,isPrimary:N[J].value===K.value,isSmartContact:L,sc_score:N[J].sc_score});}}C.getContactsData()[H.id].flatContacts=M;}return M;};G.getContactImage=function(H){var J=C.getContactsData()[H.id].image,I;if(!J){I=G.getFirstFieldValue(H,"guid");if(I){J=I.image;}C.getContactsData()[H.id].image=J;}return J;};G.getSortedFlatContacts=function(H){return G.sortFlatContacts(G.getFlatContacts(),H);};G.sortFlatContacts=function(L,K){var J=K||["sc_score","firstname","lastname","email"];function H(O,M,Q){var P=O[Q],N=M[Q];if(P&&N){return(P===N)?null:(Q==="sc_score")?((P>N)?-1:1):((P<N)?-1:1);}else{if(!P&&!N){return null;}}return(P)?-1:1;}function I(O,N){var M,P;for(P in J){if(J.hasOwnProperty(P)){M=H(O,N,J[P]);if(M){return M;}}}return 0;}L.sort(I);return L;};G.getContactsCacheBucket=function(J,I,H){return C.getContactsByBucket(J,I,H);};G.getContactOrder=function(){return C.getContactOrder();};G.loadSortPrefs=function(H,I){C.loadSortPrefs(H,I);};G.getSortPrefs=function(){return C.getSortPrefs();};G.getSortedContacts=function(){var K=G.getContacts(),L=G.getContactOrder(),J=L.length,H=[],I;for(I=0;I<J;I++){H.push(K[L[I]]);}return H;};G.getTotalContacts=function(){return C.getContactOrder().length;};};B.utils=new D();},"1.0.0",{requires:["contacts-api-cache","common-utils-stats"]});YUI.add("contacts-api-urigenerator",function(A){var E=A.contacts,L=E.utils,M,C=A.Lang,K="/v1/user/{guid}/contacts",J="/v1/user/{guid}/contact/{cid}",N="{field}.{condition}={query}",D={"asc":1,"desc":2,1:1,2:2},I={"first":-10001,"last":-10003,"email":4,"-10001":"first","-10003":"last",4:"email",1:-10001,3:-10003,6:4};if(A.common&&A.common.Utils){M=A.common.Utils;}function B(S,T,R){var U=S.split(" "),P,O="",Q=U.length;while(Q--){P=U[Q];if(P){if(O){O+=";";}O+=N.replace("{field}",T).replace("{condition}",R).replace("{query}",encodeURIComponent(P.replace(/,/g,"\\,")));}}return O;}function H(S,V){var W={id:S.id,op:"update",fields:[],categories:[]},Z=W.fields,R=S.fields||[],X=V.fields||[],P={},U,a,O,T,Y,Q;S=A.clone(S,true);V=A.clone(V,true);Q=R.length;while(Q--){P[parseInt(R[Q].id,10)]=R[Q];}Q=X.length;while(Q--){O=X[Q];U=parseInt(O.id,10);Y=O.categories;a=P[U];if(!a){Z.push({op:"add",value:O.value,type:O.type,flags:O.flags||[]});if(Y){Z[Z.length-1].categories=Y;}}else{if(O.type!==a.type||!M.congruent(O.value,a.value,false)||!M.congruent(O.flags,a.flags,false)||!M.congruent(Y,a.categories,false)){if(O.type==="yahooid"&&!M.congruent(Y,a.categories,false)){Z.push({op:"remove",id:a.id});Z.push({op:"add",value:O.value,type:O.type,flags:O.flags||[],categories:Y});}else{Z.push({op:"update",id:U,value:O.value,type:O.type,flags:O.flags||[]});if(Y){Z[Z.length-1].categories=Y;}}}delete P[U];}}for(Q in P){if(P.hasOwnProperty(Q)){Z.push({op:"remove",id:Q});}}return W;}function G(S,O){S=S||[];O=O||[];var V=[],U={},R,Q,T,P;P=S.length;while(P--){U[parseInt(S[P].id,10)]=S[P];}P=O.length;while(P--){R=O[P];T=R.id;Q=U[T];if(!Q){V.push({op:"addTo",id:T});}else{delete U[T];}}for(P in U){if(U.hasOwnProperty(P)){V.push({op:"removeFrom",id:S[P].id});}}return V;}function F(O){O.path=O.wspath||"ws/sd";O.baseHost=O.baseHost||A.config.win.location.host;this.params=undefined;this.method="GET";this.rev=O.rev;this.headers=O.headers||{"Content-Type":"application/json"};this.uri=O.uri||A.config.win.location.protocol+"//"+O.baseHost+O.path+"?";this.uri+=(O.singleContact?J.replace("{guid}",O.guid).replace("{cid}",O.id):K.replace("{guid}",O.guid));if(O.prefs){this.uri+="/preferences;";}this.init(O);}F.prototype={init:function(P){var O=F.METHODS,Q=P.type||O.DEFAULT;switch(Q){case O.SAVE:case O.DELETE:if(C.isNumber(this.rev)&&this.rev>=0){this.method="PUT";if(P.isCreateList){this.setCreateListParams(P);}else{this.setPUTParams(P);}this.setPUTUri(P);}else{this.method="POST";if(P.isCreateList){this.setCreateListParams(P);}else{this.setPOSTParams(P);}this.setPOSTUri(P);}break;case O.SAVE_PREFS:this.method="POST";this.setPOSTPrefsParams(P);this.setPOSTUri(P);break;case O.DELETE_CATEGORIES:case O.SAVE_CATEGORIES:this.method="PUT";this.setCategoriesParams(P);this.setPUTUri(P);break;case O.UPDATE_CONTACTS_CATEGORIES:this.method="PUT";this.setUpdateCategoriesParams(P);this.setPUTUri(P);break;case O.REMOVE_FIELD:this.method="PUT";this.setRemoveFieldParams(P);this.setPUTUri(P);break;default:this.method="GET";this.setGETUri(P);break;}},getURI:function(){return this.uri;},getMethod:function(){return this.method;},setMethod:function(O){this.method=O;},getHeaders:function(){return this.headers;},setHeaders:function(O){this.headers=O;},getParams:function(){return this.params;},stripContact:function(O){if(O._data){O._data=undefined;}},setPOSTPrefsParams:function(R){var Q=R.prefs,P={},O=Q.sort_order,S=Q.sort_field;this.params={};if(Q){if(O){P.sort_order=D[O];}if(S){P.sort_type=I[S];}this.params.preferences=P;}},setPOSTParams:function(P){var O={};this.params={};if(P.contacts&&C.isArray(P.contacts)&&!C.isUndefined(P.contacts[0])){O=P.contacts[0];}this.stripContact(O);this.params.contact=O;},setPOSTUri:function(O){this.uri+="?format=json";if(O.wssid){this.uri+="&wssid="+O.wssid;}},setCreateListParams:function(R){var W=R.newContacts,S=R.updateContacts,O={"name":R.category,"op":"add","refid":"01"},P=[{"refid":"01",op:"addTo"}],Q={rev:this.rev,categories:[],contacts:[]},V,U,T;Q.categories.push(O);T=W.length;while(T--){V=W[T];U={"op":"add","fields":[{"value":{givenName:V.name},"type":"name","op":"add"},{"value":V.email,"type":"email","op":"add"}],"categories":P};Q.contacts.push(U);}T=S.length;while(T--){U={"id":S[T].id,"op":"update","categories":P};Q.contacts.push(U);}this.params={contactsync:Q};},setPUTParams:function(O){var a=O.contacts||[],T=O.categories||[],Z=[],S=[],X,W,b,R,V,Y,U,Q,P;this.params={contactsync:{rev:this.rev}};Q=a.length;if(Q>0){while(Q--){X=A.clone(a[Q]);if(C.isValue(X.id)){if(X.op&&X.op==="remove"){}else{W=L.getContactById(X.id);R=X.categories;b=W.categories;X=H(W,X);X.categories=G(b,R);}}else{X.op="add";Y=X.fields||[];P=Y.length;while(P--){Y[P].op="add";}Y=X.categories||[];P=Y.length;while(P--){Y[P]={op:"addTo",id:Y[P].id};}this.stripContact(X);}Z.push(X);}this.params.contactsync.contacts=Z;}Q=T.length;if(Q>0){while(Q--){V=A.clone(T[Q]);if(C.isValue(V.id)){throw new Error("category modification not yet implemented");}else{V.op="add";}V.contacts=L.getContactsByIds(V.contacts);S.push(V);}this.params.contactsync.categories=S;}},setPUTUri:function(O){this.setPOSTUri(O);},setGETUri:function(P){var S,O=P.fields,T,Q,R=this.uri;if(O){for(Q in O){if(O.hasOwnProperty(Q)){S=O[Q];if(S.name&&S.condition&&S.value){R+=";"+S.name+"."+S.condition+"="+S.value;}}}}if(P.searchQuery&&P.searchField&&P.searchCondition){R+=";"+B(P.searchQuery,P.searchField,P.searchCondition);}if(P.out){R+=";out="+P.out;}if(P.start){R+=";start="+P.start;}if(P.count){R+=";count="+P.count;}if(P.sortfields){R+=";sort-fields="+P.sortfields;}if(P.sort){R+=";sort="+P.sort;}R+="?format=json";if(P.view){if(C.isArray(P.view)){R+="&view="+P.view.join("&view=");}else{R+="&view="+P.view;}}if(C.isValue(P.rev)){R+="&rev="+P.rev;}if(P.wssid){R+="&wssid="+P.wssid;}if(P.id){R+="&id="+P.id;}if(!P._sc){R+="&_sc=0";}this.uri=R;},setCategoriesParams:function(S){var P=S.categories||[],U={rev:this.rev,categories:[],contacts:[]},R=[],Q={},O,T=P.length;while(T--){O=P[T];if(O.id){if(O.op==="remove"){Q=O;
}else{Q={"op":"update","new":{"name":O.name},"old":{"id":O.id}};}}else{Q={"op":"add","name":O.name};}R.push(Q);}U.categories=R;this.params={contactsync:U};},setUpdateCategoriesParams:function(U){var S=U.categories.addTo||[],Z=S.length,Y=U.categories.removeFrom||[],V=Y.length,a=U.contacts,P=a.length,R=[],X=[],O=[],b=1,T={rev:this.rev,categories:[],contacts:[]},W,Q;W=Z;while(W--){Q=S[W];if(A.Lang.isNumber(Q)){X.push({"id":S[W],"op":"addTo"});}else{O.push({"name":Q,"op":"add","refid":b});X.push({"refid":b,"op":"addTo"});b++;}}W=V;while(W--){X.push({"id":Y[W],"op":"removeFrom"});}W=P;while(W--){R.push({"id":a[W],"op":"update","categories":X});}T.contacts=R;T.categories=O;this.params={contactsync:T};},setRemoveFieldParams:function(Q){var P={rev:this.rev,contacts:[]},O=false,U=Q.fieldId,R=Q.contactId,V=L.getContactById(R),X={"id":R},T=V.fields,W,S=T.length;while(S--){W=T[S];if(W.id!==U&&W.type!=="guid"){O=true;break;}}if(O){X.op="update";X.fields=[{"op":"remove","id":U}];}else{X.op="remove";}P.contacts=[X];this.params={contactsync:P};}};F.METHODS={DEFAULT:0,GETCONTACTS:1,SAVE:2,DELETE:3,SAVE_CATEGORIES:4,DELETE_CATEGORIES:5,SAVE_PREFS:6,UPDATE_CONTACTS_CATEGORIES:7,REMOVE_FIELD:8};A.namespace("contacts");E.URIGenerator=F;},"1.0.0",{requires:["contacts-api-utils"]});YUI.add("contacts-api-io",function(F){F.namespace("contacts");var A=F.contacts,D=F.Lang,E=F.JSON;function B(G,H){return function(L,J){var I={};if(!J){return G.failure(I,J,H);}try{I=G.parseJSON(J);}catch(K){return G.failure(I,J,H);}if(I.error||!G.isSuccess(J.status)){return G.failure(I,J,H);}return G.success(I,J,H);};}function C(G){this.io=null;this.maxRetries=2;this.retryCount=0;this.uriGenerator=A.URIGenerator;this.onSuccess=function(){};this.onFailure=function(){};this.hook=G;}C.prototype={parseJSON:function(H){var G={};if(typeof H.body==="string"){G=E.parse(H.body);}else{if(typeof H.body==="object"){G=H.body;}else{if(typeof H.responseText==="string"){G=E.parse(H.responseText);}else{throw new Error("no response body to parse");}}}G.status=H.status;G.statusText=H.statusText;return G;},isSuccess:function(G){switch(G){case 200:case 201:case 202:case 204:return true;}return false;},doRetry:function(G){switch(G){case 500:return true;}return false;},success:function(G,H,I){this.onSuccess(G,H,I);this.retryCount=0;},failure:function(G,H,J){var I=G.error&&G.error.detail&&G.error.detail.match(/-\d+/);if(("-50304"===I||!H||this.doRetry(H.status))&&this.retryCount<this.maxRetries){this.retryCount+=1;return F.later(100,this,function(){this.send(J);});}this.retryCount=0;G.errorCode=(!D.isUndefined(I)&&!D.isNull(I))?I:"-99999";this.onFailure(G,H,J);},send:function(J){var K=B(this,J),I=this,H=this.uriGenerator.getURI(),G={data:E.stringify(this.uriGenerator.getParams()),on:{success:K,failure:K},headers:this.uriGenerator.getHeaders(),method:this.uriGenerator.getMethod(),sync:false};if(this.hook){I.io=this.hook(H,G);}else{F.use("io",function(L){I.io=L.io(H,G);});}},abort:function(){if(this.io&&(typeof this.io.abort==="function")){this.io.abort();return true;}else{return false;}}};A.sendRequest=function(L,K,H,G,J){var I=new C(G,J);K&&(I.onSuccess=K);H&&(I.onFailure=H);L&&(I.uriGenerator=L);I.send();return I;};A.Request=C;},"1.0.0",{requires:["contacts-api-urigenerator","json"]});YUI.add("contacts-api-adapter",function(D){D.namespace("contacts");var E=D.contacts,H=E.URIGenerator,B=E.cache,G=D.Lang,J=D.JSON,F="CONTACTS",I,C,A;if(D.common&&D.common.Utils){I=D.common.Utils;C=I.rocketstats;A=new I.Stopwatch("ContactsRequest");}E.APIAdapter={};(function(){var O=this,K=false,N=E.sendRequest;this.getContact=function(R,Y,U,S){if(B.isLoaded()&&!S){var X=B.getContacts()[R];if(X){if(Y&&G.isFunction(Y)){Y({contact:X});}}return;}var V=E.config.getAttrs(),Z=V.requestFn||null,W={baseHost:V.baseHost||D.config.win.location.host,uri:V.uri,headers:V.headers,guid:V.guid,wssid:V.wssid,type:H.METHODS.GETCONTACTS,start:V.start,count:V.count||"max",sortfields:V.sortfields,out:V.out,sort:V.sort,fields:V.fields,wspath:V.wspath,_sc:false,view:V.view,rev:V.rev,singleContact:true,id:R},P=new H(W);function T(b,a,c){if(Y&&G.isFunction(Y)){Y(b);}if(C){C.stat(F,"API:getContact");C.stat(F,"API:getContact:",b.status);}}function Q(b,a,c){if(C){C.stat(F,"API:ERR:getContact");C.stat(F,"API:ERR:getContact:",b.errorCode);}if(U&&G.isFunction(U)){U(b);}}N(P,T,Q,Z);};this.getContacts=function(S,X,U){if(B.isLoaded()&&!S){if(X&&G.isFunction(X)){X(B.getContacts());}return;}var V=E.config.getAttrs(),Y=V.requestFn||null,P,Q,W={baseHost:V.baseHost||D.config.win.location.host,uri:V.uri,headers:V.headers,guid:V.guid,wssid:V.wssid,type:H.METHODS.GETCONTACTS,start:V.start,count:V.count||"max",sortfields:V.sortfields,out:V.out,sort:V.sort,fields:V.fields,wspath:V.wspath,_sc:(typeof(NeoConfig)!=="undefined"&&NeoConfig.smartcomplete_enabled),view:V.view};function T(b,Z,d){var c=Z.responseHeaders;if(c){var a=c["X-Yahoo-Social-ContactsRev"]||c["X-Yahoo-Social-Contactsrev"]||c["x-yahoo-social-contactsrev"];if(a){B.setCurrentRevision(parseInt(a,10));}}B.load(b);if(X&&G.isFunction(X)){X(B.getContacts());}if(C){C.stat(F,"API:getContacts");C.stat(F,"API:getContacts:",b.status);}K=false;}function R(a,Z,b){K=false;if(C){C.stat(F,"API:ERR:getContacts");C.stat(F,"API:ERR:getContacts:",a.errorCode);}if(U&&G.isFunction(U)){U(a);}}if(K&&X&&G.isFunction(X)){D.once("contacts:api:loaded",function(){X(B.getContacts());});}else{K=true;P=new H(W);N(P,T,R,Y);}};this.createList=function(Z,V,R,X,T){var U=E.config.getAttrs(),Y=U.requestFn||null,W={baseHost:U.baseHost,uri:U.uri,headers:U.headers,guid:U.guid,type:H.METHODS.SAVE,wspath:U.wspath,wssid:U.wssid,rev:B.getCurrentRevision(),newContacts:Z,updateContacts:V,category:R,isCreateList:true},P=new H(W);P.setMethod("PUT");function S(c,b,d){if(C){C.stat(F,"API:createList");C.stat(F,"API:createList:",c.status);}var a=B.update(c);if(X&&G.isFunction(X)){X(a,c);}}function Q(b,a,c){if(C){C.stat(F,"API:ERR:createList");C.stat(F,"API:ERR:createList:",b.errorCode);}if(T&&G.isFunction(T)){T(b);}}N(P,S,Q,Y);};this.deleteContacts=function(Z,X,U){var V=E.config.getAttrs(),Y=V.requestFn||null,S=[],Q=(Z&&G.isArray(Z))?Z.length:0,W={baseHost:V.baseHost,guid:V.guid,type:H.METHODS.DELETE,wspath:V.wspath,uri:V.uri,headers:V.headers,rev:B.getCurrentRevision(),wssid:V.wssid},P;while(Q--){S.push({id:Z[Q],op:"remove"});}W.contacts=S;P=new H(W);function R(a){if(C){C.stat(F,"API:ERR:contactsDelete");C.stat(F,"API:ERR:contactsDelete:",a.errorCode);}if(U&&G.isFunction(U)){U(a);}}function T(d,b,g){if(d.status===202){var f=d.syncresult.results,c=f.contacts,e=c.length;while(e--){if(c[e].error){d.errorCode=c[e].error;R(false,d);return;}}}if(C){C.stat(F,"API:contactsDelete");C.stat(F,"API:contactsDelete:",d.status);}var a=B.update(d);if(X&&G.isFunction(X)){X(a,d);}}N(P,T,R,Y);};function M(Y,T,W,Z,V,S){var X=T.requestFn||null,P,U={baseHost:T.baseHost,uri:T.uri,headers:T.headers,guid:T.guid,type:H.METHODS.SAVE,wspath:T.wspath,wssid:T.wssid};function R(c,b,d){W.push(c.contact);if(C){C.stat(F,"API:multiTransactionSave");C.stat(F,"API:multiTransactionSave:",c.status);}if(Y.length===0){var a=B.update(W);if(V&&G.isFunction(V)){V(a);}}else{M(Y,T,W,Z,V,S);}}function Q(a,b){if(C){C.stat(F,"API:ERR:multiTransactionSave");C.stat(F,"API:ERR:multiTransactionSave:",a.errorCode);}if(Y.length===0&&W.length>0){B.update(W);}else{if(Y.length>0){M(Y,T,W,Z,V,S);return;}}if(S&&G.isFunction(S)){S(a);}}if(Z){U.contacts=Z;}else{U.contacts=[Y.shift()];}P=new H(U);N(P,R,Q,X,{contact:U.contacts});}function L(X,T,V,R){var W=T.requestFn||null,P,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE,wspath:T.wspath,uri:T.uri,headers:T.headers,rev:B.getCurrentRevision(),wssid:T.wssid};function S(a,Z,b){if(C){C.stat(F,"API:singleTransactionSave");C.stat(F,"API:singleTransactionSave:",a.status);}var Y=B.update(a);if(V&&G.isFunction(V)){V(Y,a);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:singleTransactionSave");C.stat(F,"API:ERR:singleTransactionSave:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}if(!G.isArray(X)){X=[X];}U.contacts=X;P=new H(U);N(P,S,Q,W);}this.saveContacts=function(S,T,R){var Q=E.config.getAttrs(),P=B.getCurrentRevision();if(P>0||!G.isArray(S)||S.length===1){L(S,Q,T,R);}else{M(S,Q,[],T,R);}};this.getContactsTinyUserCard=function(W,V,R){var T=E.config.getAttrs(),X=T.requestFn||null,U={baseHost:T.baseHost||D.config.win.location.host,uri:T.uri,headers:T.headers,guid:T.guid,wssid:T.wssid,type:H.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:W}],wspath:T.wspath,view:"tinyusercard"},P=new H(U);function S(a,Z,b){if(C){C.stat(F,"API:getUserCard");C.stat(F,"API:getUserCard:",a.status);}var Y=B.loadTinyUserCard(a)[0];if(V&&G.isFunction(V)){V(Y);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERRgetUserCard");C.stat(F,"API:ERRgetUserCard:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.saveCategory=function(R,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.SAVE_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:[R],wssid:U.wssid},P=new H(V);function T(Z,Y,d){var a=Z.syncresult.results;if(Z.status===202){var b=a.categories;if(b[0].error){Z.errorCode=b[0].error;Q(false,Z);return;}}var c=Z.syncresult.diff;if(C){C.stat(F,"API:saveCategories");
C.stat(F,"API:saveCategories:",Z.status);}B.updateCategories(Z);if(W&&G.isFunction(W)){W(c,Z);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:saveCategory");C.stat(F,"API:ERR:saveCategory:",Z.errorCode);}if(S&&G.isFunction(S)){S(Z);}}N(P,T,Q,X);};this.deleteCategory=function(R,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.DELETE_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:[{id:R,op:"remove"}],wssid:U.wssid},P=new H(V);function T(Z,Y,c){var a=Z.syncresult.results;if(Z.status===202){var b=a.categories;if(b[0].error){Z.errorCode=b[0].error;Q(false,Z);return;}}if(C){C.stat(F,"API:deleteCategories");C.stat(F,"API:deleteCategories:",Z.status);}B.updateCategories(Z);if(W&&G.isFunction(W)){W(Z.syncresult.diff,Z);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:deleteCategory");C.stat(F,"API:ERR:deleteCategory:",Z.errorCode);}if(S&&G.isFunction(S)){S(Z);}}N(P,T,Q,X);};this.updateContactsCategories=function(Z,T,Y,W,S){var U=E.config.getAttrs(),X=U.requestFn||null,V={baseHost:U.baseHost,guid:U.guid,type:H.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:U.wspath,uri:U.uri,headers:U.headers,rev:B.getCurrentRevision(),categories:{addTo:T,removeFrom:Y},contacts:Z,wssid:U.wssid},P=new H(V);function R(b,a,e){var c=b.syncresult.results;if(b.status===202){var d=c.categories;if(d[0].error){b.errorCode=d[0].error;Q(false,b);return;}}if(C){C.stat(F,"API:updateContactsCategories");C.stat(F,"API:updateContactsCategories:",b.status);}B.updateCategories(b);if(W&&G.isFunction(W)){W(b.syncresult.diff,b);}}function Q(a,c,b,d){if(C){C.stat(F,"API:ERR:updateContactsCategories");C.stat(F,"API:ERR:updateContactsCategories:",c.errorCode);}if(S&&G.isFunction(S)){S(c);}}N(P,R,Q,X);};this.removeField=function(U,W,X,S){var T=E.config.getAttrs(),Y=T.requestFn||null,V={rev:B.getCurrentRevision(),contactId:U,fieldId:W,baseHost:T.baseHost,guid:T.guid,type:H.METHODS.REMOVE_FIELD,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid},P=new H(V);function R(a,Z,b){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",a.status);}B.updateCategories(a);if(X&&G.isFunction(X)){X(a.syncresult.diff,a);}}function Q(Z,b,a,c){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",b.errorCode);}if(S&&G.isFunction(S)){S(b);}}N(P,R,Q,Y);};this.setSortField=function(U,W,R){var T=E.config.getAttrs(),X=T.requestFn||null,V={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE_PREFS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,prefs:{sort_field:U}},P=new H(V);function S(a,Y,b){var Z=a.preferences;if(Z){B.setSortPrefs(Z.sort_order,Z.sort_type);if(W&&G.isFunction(W)){W();}if(C){C.stat(F,"API:setSortField");C.stat(F,"API:setSortField:",a.status);}}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:setSortField");C.stat(F,"API:ERR:setSortField:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.setSortOrder=function(U,W,R){var T=E.config.getAttrs(),X=T.requestFn||null,V={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.SAVE_PREFS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,prefs:{sort_order:U}},P=new H(V);function S(a,Y,b){var Z=a.preferences;if(Z){B.setSortPrefs(Z.sort_order,Z.sort_type);if(W&&G.isFunction(W)){W();}if(C){C.stat(F,"API:setSortOrder");C.stat(F,"API:setSortOrder:",a.status);}}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:setSortOrder");C.stat(F,"API:ERR:setSortOrder:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,X);};this.getSortPrefs=function(V,S){if(B.getSortPrefs()){if(V&&G.isFunction(V)){V(B.getSortPrefs());}return;}var R=E.config.getAttrs(),Q=R.requestFn||null,W={baseHost:R.baseHost||D.config.win.location.host,uri:R.uri,headers:R.headers,guid:R.guid,wssid:R.wssid,type:H.METHODS.DEFAULT,wspath:R.wspath,prefs:true},T=new H(W);function P(Z,X,a){var Y=Z.preferences;if(Y){if(Y.sort_order&&Y.sort_type){B.setSortPrefs(Y.sort_order,Y.sort_type);if(V&&G.isFunction(V)){V();}if(C){C.stat(F,"API:getSortPreferences");C.stat(F,"API:getSortPreferences:",Z.status);}}}}function U(Y,X,Z){if(C){C.stat(F,"API:ERR:getSortPreferences");C.stat(F,"API:ERR:getSortPreferences:",Y.errorCode);}if(S&&G.isFunction(S)){S(Y);}}N(T,P,U,Q);};this.removeField=function(U,W,X,S){var T=E.config.getAttrs(),Y=T.requestFn||null,V={rev:B.getCurrentRevision(),contactId:U,fieldId:W,baseHost:T.baseHost,guid:T.guid,type:H.METHODS.REMOVE_FIELD,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid},P=new H(V);function R(a,Z,b){if(C){C.stat(F,"API:removeEmail");C.stat(F,"API:removeEmail:",a.status);}B.updateCategories(a);if(X&&G.isFunction(X)){X(a.syncresult.diff,a);}}function Q(Z,b,a,c){if(C){C.stat(F,"API:ERR:removeEmail");C.stat(F,"API:ERR:removeEmail:",b.errorCode);}if(S&&G.isFunction(S)){S(b);}}N(P,R,Q,Y);};this.searchContacts=function(X,V,R){var T=E.config.getAttrs(),W=T.requestFn||null,U={baseHost:T.baseHost,guid:T.guid,type:H.METHODS.GETCONTACTS,wspath:T.wspath,uri:T.uri,headers:T.headers,wssid:T.wssid,out:T.out,fields:T.fields,search:T.search,searchField:"all",searchCondition:"contains",searchQuery:X},P=new H(U);function S(Z,Y,b){var a=Z.contacts.contact||[];if(V&&G.isFunction(V)){V(a);}if(C){C.stat(F,"API:searchContacts");C.stat(F,"API:searchContacts:",Z.status);}}function Q(Z,Y,a){if(C){C.stat(F,"API:ERR:searchContacts");C.stat(F,"API:ERR:searchContacts:",Z.errorCode);}if(R&&G.isFunction(R)){R(Z);}}N(P,S,Q,W);};this.createEmptyContact=function(){return{fields:[],categories:[]};};}.apply(E.APIAdapter));},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils","rocket-stats"]});YUI.add("contacts-api",function(E){E.namespace("contacts");var B=E.contacts,D=B.APIAdapter,C=B.cache,A=function(){var F=this;this.load=function(H,I,G){D.getContacts(H,I,G);};this.saveContacts=function(H,I,G){D.saveContacts(H,I,G);};this.deleteContacts=function(H,I,G){D.deleteContacts(H,I,G);};this.saveCategory=function(G,I,H){D.saveCategory(G,I,H);};this.deleteCategory=function(G,I,H){D.deleteCategory(G,I,H);};this.createList=function(G,I,J,K,H){D.createList(G,I,J,K,H);};this.getContacts=function(H,I,G){if(typeof(H)!=="boolean"){return;}D.getContacts(H,I,G);};this.getContact=function(J,I,G,H){D.getContact(J,I,G,H);};this.createEmptyContact=function(H,G){return D.createEmptyContact(H,G);};this.getContactImage=function(G,I,H){D.getContactsTinyUserCard(G,I,H);};this.searchContacts=function(H,I,G){D.searchContacts(H,I,G);};E.on("contacts:contactChanged",function(){F.load(1);});this.setSortOrder=function(G,I,H){D.setSortOrder(G,I,H);};this.setSortField=function(H,I,G){D.setSortField(H,I,G);};this.getSortPrefs=function(H,G){D.getSortPrefs(H,G);};this.updateContactsCategories=function(J,H,G,K,I){D.updateContactsCategories(J,H,G,K,I);};this.removeEmail=function(I,G,J,H){D.removeField(I,G,J,H);};this.removeEmail=function(J,I,H){C.removeField(J,I);var G=E.contacts.utils.getContactById(J);if(G&&!G.isSmartContact){D.removeField(J,I);}if(H){H();}};};B.api=new A();},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});